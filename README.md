Azure Cloud Foundation
Documentation
Foundation version:
21.05.2025
This document is an offline version normally hosted online. This PDF
version may not be complete and can not show dynamic content.
If you wish to access the online version please check with your cloud
representative either internally or at Nordcloud.
2
2
6262626272728 292930 313132 323333353536 3738 383939404040 4040414141 4141 424242424243 43444444 4444464646464647 4748 48 485050 5151515151
T
a
ble
o
f
C
o
n
t
e
n
t
s
T
a
ble
o
f
C
o
n
t
e
n
t
s
W
h
a
t is
A
z
u
r
e
Clo
u
d
F
o
u
n
d
a
tio
n
(
A
C
F
)
C
o
r
e in
f
r
a
s
t
r
u
c
t
u
r
e in
clu
d
e
s: Core infrastructure is not: Azure Cloud Foundation mo
d
ule
s
H
o
w
A
C
F
u
s
e
s
m
o
d
ule
s
W
h
a
t
m
o
d
ule
s
N
o
r
d
clo
u
d
p
r
o
vid
e
s
E
x
t
e
n
sibilit
y
A
C
F
O
v
e
rvie
w
M
a
n
a
g
e
m
e
n
t
g
r
o
u
p
s
a
n
d
s
u
b
s
c
rip
tio
n
s
t
r
u
c
t
u
r
e
P
u
r
p
o
s
e
d
e
t
ails
N
e
t
w
o
r
k
c
o
n
n
e
c
tivit
y
A
z
u
r
e
H
u
b
&
S
p
o
k
e
A
z
u
r
e
v
W
a
n
R
e
s
o
u
r
c
e
s in
s
u
b
s
c
rip
tio
n
s Identity and Access Manag
e
m
e
n
t
R
ole
-
b
a
s
e
d
a
c
c
e
s
s
c
o
n
t
r
ol Acess role blueprints - infrastruc
t
u
r
e
t
e
a
m
s
G
uidin
g
p
rin
cip
als
B
a
sic
rig
h
t
s
m
o
d
el Azure service
p
rin
cip
al Azure Lighthouse
L
o
g
gin
g
a
n
d
A
u
ditin
g
R
e
m
o
t
e
A
c
c
e
s
s
M
o
nit
o
rin
g
a
n
d
Ale
r
tin
g
Dis
a
s
t
e
r
R
e
c
o
v
e
r
y
a
n
d
D
a
t
a
P
r
o
t
e
c
tio
n
A
C
F
D
e
sig
n
r
e
silie
n
c
y
Vir
t
u
al m
a
c
hin
e
b
a
c
k
u
p
C
o
m
plia
n
c
e
a
n
d
S
e
c
u
rit
y
A
z
u
r
e
S
e
c
u
rit
y
C
e
n
t
e
r
(
A
S
C
)
A
z
u
r
e
P
olicie
s
N
a
min
g
C
o
n
v
e
n
tio
n
T
a
g
gin
g
S
t
r
a
t
e
g
y
C
o
s
t
m
a
n
a
g
e
m
e
n
t
A
p
plic
a
tio
n
L
a
n
din
g
Z
o
n
e
p
r
o
visio
nin
g
D
e
plo
yin
g
A
z
u
r
e
Clo
u
d
F
o
u
n
d
a
tio
n
A. P
r
e
f
a
c
e
1. R
e
p
o
sit
o
r
y
2. P
r
e
r
e
q
uisit
e
s
2.1. A
u
t
o
m
a
t
e
d
D
e
plo
y
m
e
n
t
(
r
e
c
o
m
m
e
n
d
e
d
)
2.2
M
a
n
u
al D
e
plo
y
m
e
n
t
(
fo
r in
t
e
r
a
c
tiv
e
c
o
d
e
e
x
e
c
u
tio
n
wit
h
o
u
t
c
o
n
t
ain
e
r
s
&
pip
elin
e
s
)
3. Git
H
u
b
c
o
m
m
e
n
t
b
a
s
e
d
d
e
plo
y
m
e
n
t
(
fo
r
a
u
t
o
m
a
t
e
d
d
e
plo
y
m
e
n
t
o
nly
)
4. A
r
c
hit
e
c
t
u
r
e
c
o
n
sid
e
r
a
tio
n
s
o
f
t
h
e
A
z
u
r
e
Clo
u
d
F
o
u
n
d
a
tio
n
T
e
s
t
A
C
F
wit
h
o
u
t
w
o
r
klo
a
d
s: Production ACF for workload
s: B. Deployment initialis
a
tio
n
5. C
u
s
t
o
m
e
r
r
e
p
o
sit
o
r
y
(
@
C
F
D
e
v
t
e
a
m
)
6. P
A
T
t
o
k
e
n
(
@
C
F
D
e
v
t
e
a
m
)
7. Rig
h
t
s
fo
r
r
e
p
o
sit
o
r
y
(
@
C
F
D
e
v
t
e
a
m
)
8. C
o
n
s
e
n
t
fo
r
t
h
e
c
u
s
t
o
m
e
r
d
e
dic
a
t
e
d
S
P
N
(
o
nly
fo
r
t
h
e
m
a
n
a
g
e
d
c
u
s
t
o
m
e
r
s
)
9. P
r
o
visio
n
e
r
-
a
k
a
B
o
o
t
s
t
r
a
p
p
e
r
A
u
t
o
m
a
t
e
d
d
e
plo
y
m
e
n
t
M
a
n
u
al d
e
plo
y
m
e
n
t
1
0. Clo
u
d
C
o
n
t
ain
e
r
-
a
k
a
CI/
C
D
S
e
rvic
e
(
fo
r
a
u
t
o
m
a
t
e
d
d
e
plo
y
m
e
n
t
o
nly
)
M
a
n
u
al d
e
plo
y
m
e
n
t
(
wit
h
o
u
t
CI/
C
D
c
o
n
t
ain
e
r
)
1
1. R
e
p
o
sit
o
r
y
c
o
p
y
(
fo
r
n
o
n
-
m
a
n
a
g
e
d
c
u
s
t
o
m
e
r
s
o
nly
)
C. D
e
plo
y
m
e
n
t
p
h
a
s
e
P
r
e
f
a
c
e
glo
b
al_v
a
r
s
1
2. C
o
r
e
1
3. A
u
dit
1
4. G
o
v
e
r
n
a
n
c
e
1
5. D
C In
f
r
a
1
6. N
e
t
w
o
r
k
2
/
4
5
4
51
52
52
52
52
52
54
55
55
55
55
55
55
55
56
56
56
56
56
56
56
56
57
57
57
57
57
58
58
58
58
58
58
59
59
59
60
60
62
62
62
62
62
62
62
62
62
62
62
63
63
63
63
63
63
63
64
64
64
65
65
65
65
65
17. Application Gateway
18. Management
19. Firewall
20. Shared Services
21. Policies
22. Application Landing Zone
Version 1.1
Support Team Handbook
Important notes
Editing parameter (*_vars.yaml) files
Customising ACF
New Azure Subscription / Application Landing Zone creation
Add/Change network routes
DNS changes: adding, deleting or modifying records, forward zones and delegation
Deploy new IAM/custom RBAC role
Adding new compliance alerts
Audit log replication changes
Audit logs Filters
Changes to policies
New rules for Firewall / ACL
New Data Collection Rule
Known Issues
FAQ for Ki Insurance Azure Cloud Foundation
General
Access and RBAC
Service Requests
Networking
End-User Handbook
1. Getting Help
2. Governance
3. Access Levels
4. Service Requests
Support Model
The Service Request Process
Sample request of New Application Landing Zone
6. Requesting Exemptions
7. TAG based automations
8. Requesting Other Changes to your Environment
ACF Modules - User Docs
Landing Zones functional parts
Intro
Boostrapper and Provisioner
CI/CD
CORE
Network
Tools
Organizational Units
Application
organization bootstrapper
deployments
resource_group
storage_account
storage_containers
required access for deployment
rbac roles
EntraId roles
Terraform documentation
cicd
deployments
aci_resource_group
azure_container_registry
vnet
keyvault
msi
3/454
6
5
6
5
6
6
6
768 68686869707071 71717171717272737373 7373747474 74757778 787879798081828283 83838384 8484 8585858690909191 92 92929393 9393 9494 9596969799 100 101 103 104 105 106 106 106 107 107 107 108
s
p
n
_
p
e
r
mis
sio
n
s
a
z
u
r
e
_
a
d
_
r
ole
_
a
s
sig
n
m
e
n
t
p
o
s
t
d
e
plo
y
m
e
n
t
a
c
tio
n
s
h
o
w
t
o
u
s
e
T
e
r
r
a
fo
r
m
d
o
c
u
m
e
n
t
a
tio
n
c
o
r
e
blu
e
p
rin
t
d
e
plo
y
m
e
n
t
s
glo
b
al_
v
a
ria
ble
s
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
s
p
n
_
p
a
r
a
m
e
t
e
r
s
p
a
r
t
n
e
r_
d
e
t
ails
t
e
r
r
a
fo
r
m
d
o
c
u
m
e
n
t
a
tio
n
a
u
dit
blu
e
p
rin
t
(
s
t
a
n
d
a
r
d
)
d
e
plo
y
m
e
n
t
s logging how it works log analytics storage accou
n
t
h
o
w
t
o
u
s
e
p
e
r
mis
sio
n
s
a
u
dit lo
g
r
e
plic
a
tio
n
c
h
a
n
g
e
s
t
e
r
r
a
fo
r
m
d
o
c
u
m
e
n
t
a
tio
n
g
o
v
e
r
n
a
n
c
e
blu
e
p
rin
t
(
s
t
a
n
d
a
r
d
)
d
e
plo
y
m
e
n
t
s
r
b
a
c
h
o
w
t
o
u
s
e
d
e
plo
y
m
e
n
t
c
o
n
fig
u
r
a
tio
n
-
a
d
din
g
a
n
e
w
c
u
s
t
o
m
r
b
a
c
r
ole
r
e
g
ula
t
o
r
y_
c
o
m
plia
n
c
e
h
o
w it
w
o
r
k
s
p
o
s
t
d
e
plo
y
m
e
n
t
c
o
n
fig
u
r
a
tio
n
t
e
r
r
a
fo
r
m
d
o
c
u
m
e
n
t
a
tio
n
n
e
t
w
o
r
k
blu
e
p
rin
t
(
s
t
a
n
d
a
r
d
)
d
e
plo
y
m
e
n
t
s
n
e
t
w
o
r
k
s
c
o
n
n
e
c
tivit
y
s
h
a
r
e
d
s
e
rvic
e
s identity multi-region custom terraform docum
e
n
t
a
tio
n identity blueprint deployments networks keyvault post_deployment terraform documenta
tio
n
a
p
plic
a
tio
n
g
a
t
e
w
a
y
blu
e
p
rin
t
d
e
plo
y
m
e
n
t
s
a
p
plic
a
tio
n
_
g
a
t
e
w
a
y
h
o
w
t
o
u
s
e
f
r
o
n
t
e
n
d
_ip
_
c
o
n
fig
u
r
a
tio
n
h
t
t
p
_lis
t
e
n
e
r
r
e
q
u
e
s
t_
r
o
u
tin
g
_
r
ule
b
a
c
k
e
n
d
t
e
r
r
a
fo
r
m
d
o
c
u
m
e
n
t
a
tio
n
m
a
n
a
g
e
m
e
n
t
blu
e
p
rin
t
(
s
t
a
n
d
a
r
d
)
d
e
plo
y
m
e
n
t
s
a
u
t
o
m
a
tio
n
_
a
c
c
o
u
n
t
h
o
w it
w
o
r
k
s
blo
b
_
b
a
c
k
u
p
_
a
u
t
o
m
a
tio
n
h
o
w it
w
o
r
k
s
e
s
t
a
t
e
_
h
elp
e
r
h
o
w it’s
u
s
e
d ipamhow to use cidr reservatio
n
fo
r
v
n
e
t
n
o
t
c
o
m
min
g
f
r
o
m
t
h
e
p
s
p
-
s
e
t
n
e
t
w
o
r
k
r
a
n
g
e
a
u
t
o
m
a
tic
c
alc
ula
tio
n
fo
r
s
u
b
n
e
t
s in
giv
e
n
v
n
e
t
-
slic
e
cid
r
d
ele
tio
n
o
f
t
h
e
v
n
e
t
allo
c
a
tio
n
(
v
n
e
t
d
ele
tio
n in
a
z
u
r
e
will n
o
t
d
ele
t
e
r
e
s
e
rv
a
tio
n
)
-
d
ele
t
e
n
e
t
w
o
r
k
g
e
t
a lis
t
a
b
o
u
t
all cid
r
s
allo
c
a
tio
n
-
g
e
t
n
e
t
w
o
r
k
s
n
e
w
s
u
b
n
e
t
allo
c
a
tio
n
-
S
e
t
S
u
b
n
e
t
R
a
n
g
e
R
e
t
rie
v
al o
f
e
xis
tin
g
s
u
b
n
e
t
allo
c
a
tio
n
s
-
G
e
t
S
u
b
n
e
t
u
p
d
a
t
e
o
f
e
xis
tin
g
s
u
b
n
e
t
allo
c
a
tio
n
-
U
p
d
a
t
e
S
u
b
n
e
t
R
e
m
o
v
al o
f
e
xis
tin
g
s
u
b
n
e
t
allo
c
a
tio
n
-
D
ele
t
e
S
u
b
n
e
t light_house how it’s used how access is managed log_analytics monitoring how it works vm insights
4
/
4
5
4
1
0
8
1
0
8
1
1
0
1
1
0
1
1
1
1
1
1
1
1
3
1
1
3
1
1
3
1
1
4
1
1
4
1
1
8
1
1
8
1
1
9
1
1
9
1
2
7
1
2
7
1
2
7
1
2
7
1
2
8
1
2
8
1
2
9
1
2
9
1
3
0
1
3
1
1
3
1
1
3
1
1
3
1
1
3
2
1
3
2
1
3
3
1
3
3
1
3
3
1
3
3
1
3
6
1
3
7
1
3
8
1
3
8
1
3
8
1
4
0
1
4
0
1
4
1
1
4
1
1
4
2
1
4
2
1
4
2
1
4
2
1
4
3
1
4
3
1
4
3
1
4
3
1
4
4
1
4
4
1
4
4
1
4
4
1
4
4
1
4
5
1
4
8
1
4
8
1
4
9
1
5
0
1
5
0
1
5
0
1
5
1
1
5
3
1
5
3
1
5
3
1
5
3
1
5
4
1
5
4
1
5
4
1
5
4
1
5
6
1
5
7
1
5
7
1
5
8
1
5
9
1
6
0
1
6
0
1
6
0
1
6
1
1
6
1
1
6
2
1
6
2
1
6
2
1
6
2
1
6
2
1
6
2
1
6
3
v
m
s
e
c
u
rit
y
c
u
s
t
o
m lo
g
gin
g
pla
t
fo
r
m
_
c
h
a
n
g
e
_
ale
r
tin
g
q
u
e
r
y
s
a
n
d
b
o
x_
a
u
t
o
m
a
tio
n
h
o
w it
w
o
r
k
s
s
e
rvic
e
_
h
e
alt
h
_
ale
r
tin
g
s
u
b
s
c
rip
tio
n
_
b
u
d
g
e
t
h
o
w it’s
u
s
e
d
v
m
_
c
h
a
n
g
e
_
t
r
a
c
kin
g
h
o
w it
w
o
r
k
s
v
m
_
m
a
n
a
g
e
m
e
n
t
h
o
w it
w
o
r
k
s
v
m
_
m
a
n
a
g
e
m
e
n
t_w
o
r
k
e
r
h
o
w
t
his
pip
elin
e
w
o
r
k
s
t
e
r
r
a
fo
r
m
d
o
c
u
m
e
n
t
a
tio
n
fir
e
w
all blu
e
p
rin
t
d
e
plo
y
m
e
n
t
n
e
t
w
o
r
k
s
fir
e
w
all firewall_
p
olicie
s ip_groups diagnostics policy_insights dns dns_resolver routing_intent upgrade_to_premiu
m
-
s
k
u
fir
e
w
all_
r
ule
s
t
e
r
r
a
fo
r
m
d
o
c
u
m
e
n
t
a
tio
n
s
h
a
r
e
d
s
e
rvic
e
s
blu
e
p
rin
t
(
s
t
a
n
d
a
r
d
)
d
e
plo
y
m
e
n
t
s
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g
h
o
w it
w
o
r
k
s
p
riv
a
t
e
_
d
n
s
h
o
w it
w
o
r
k
s
a
d
din
g
a
n
A
-
r
e
c
o
r
d
p
riv
a
t
e
_
r
e
s
olv
e
r
h
o
w it
w
o
r
k
s
p
a
r
a
m
e
t
e
r
h
a
n
dlin
g
s
c
e
n
a
rio
-
h
u
b
s
p
o
k
e
wit
h
fir
e
w
all p
r
o
x
y
s
c
e
n
a
rio
-
h
u
b
s
p
o
k
e
wit
h
o
u
t
fir
e
w
all p
r
o
x
y
s
c
e
n
a
rio
-
v
w
a
n
fir
e
w
all in
fo inbound en
d
p
oin
t
o
u
t
b
o
u
n
d
e
n
d
p
oin
t
k
n
o
w
n limit
a
tio
n
s
-
r
e
gio
n
al a
v
aila
bilit
y
t
e
r
r
a
fo
r
m
d
o
c
u
m
e
n
t
a
tio
n
p
olicie
s
blu
e
p
rin
t
(
s
t
a
n
d
a
r
d
)
p
olic
y
s
ele
c
tio
n
s
u
p
p
o
r
t
a
z
u
r
e
p
olic
y limit
s
A
C
F
-
b
a
s
elin
e
p
olicie
s introduction baseline_recommended_policie
s
b
a
s
elin
e
r
e
c
o
m
m
e
n
d
e
d
-
b
uilt
-in
b
a
s
elin
e
r
e
c
o
m
m
e
n
d
e
d
-
c
u
s
t
o
m
b
a
s
elin
e
_
o
p
tio
n
al_
p
olicie
s
b
a
s
elin
e
o
p
tio
n
al -
b
uilt
-in
b
a
s
elin
e
o
p
tio
n
al -
c
u
s
t
o
m initiatives dine-cis-alerts dine-alerting dine-diagnostics dine-az-mon-agent dine-vm-ct dine-az-sec-agent dine-nsg-flowlogs append-vmmonitor-tag dine-centralized-rsv other intiatives private-endpoint-dns
d
e
p
r
e
c
a
t
e
d
/
p
r
e
vie
w
p
olicie
s important notes how to use steps_for_making_changes acf_policy_parameters changes default policy assignment changes parameters_for_policy_assignments scenario : updating parameters of a policy
a
s
sig
n
m
e
n
t
e
x
clu
sio
n
s
s
c
e
n
a
rio : d
e
fin
e
e
x
clu
sio
n
s
fo
r
a
p
olic
y
a
s
sig
n
m
e
n
t
A. E
x
clu
din
g
a
M
a
n
a
g
e
m
e
n
t
G
r
o
u
p
B. E
x
clu
din
g
a
S
u
b
s
c
rip
tio
n
C. E
x
clu
din
g
a
R
e
s
o
u
r
c
e
G
r
o
u
p
s
r
e
_
a
s
sig
n
_
p
olic
y
s
c
e
n
a
rio : r
e
-
a
s
sig
n
a
p
olic
y
a
s
sig
n
m
e
n
t
A. r
e
-
a
s
sig
n
f
r
o
m
o
n
e
m
a
n
a
g
e
m
e
n
t
g
r
o
u
p
s
c
o
p
e
t
o
a
n
o
t
h
e
r
B. a
s
sin
gin
g
t
o
a
d
ditio
n
al m
a
n
a
g
e
m
e
n
t
g
r
o
u
p
s
c
o
p
e
5
/
4
5
4
1
6
4
1
6
4
1
6
4
1
6
4
1
6
5
1
6
5
1
6
5
1
6
6
1
6
6
1
6
7
1
6
7
1
6
7
1
6
8
1
6
8
1
6
8
1
6
8
1
6
8
1
6
9
1
7
0
1
7
1
1
7
2
1
7
2
1
7
3
1
7
3
1
7
4
1
7
6
1
7
6
1
7
7
1
7
7
1
7
7
1
7
7
1
7
8
1
7
8
1
7
8
1
7
9
1
7
9
1
7
9
1
7
9
1
7
9
1
7
9
1
8
0
1
8
0
1
8
0
1
8
0
1
8
1
1
8
1
1
8
5
1
8
7
1
8
8
1
8
9
1
9
0
1
9
0
1
9
0
1
9
0
1
9
0
1
9
0
1
9
1
1
9
1
1
9
1
1
9
1
1
9
1
1
9
1
1
9
1
1
9
1
1
9
1
1
9
2
1
9
2
1
9
2
1
9
2
1
9
2
1
9
2
1
9
2
1
9
2
1
9
2
1
9
2
1
9
3
1
9
3
1
9
3
1
9
3
1
9
3
1
9
3
1
9
3
1
9
3
1
9
3
1
9
3
1
9
3
1
9
3
1
9
3
1
9
3
1
9
4
d
ele
t
e
_
p
olic
y
s
c
e
n
a
rio : d
ele
tin
g
a
p
olic
y
a
s
sig
n
m
e
n
t
c
u
s
t
o
m
_
n
o
n
_
c
o
m
plia
n
c
e
_
m
e
s
s
a
g
e
s
c
e
n
a
rio : c
u
s
t
o
m
n
o
n
c
o
m
plia
n
c
e
m
e
s
s
a
g
e linked_scope_for_policy_assignment scenario : define a linked scope for a policy
a
s
sig
n
m
e
n
t
a
d
ditio
n
al p
olic
y
a
s
sig
n
m
e
n
t
s
b
uilt
-in
p
olic
y
a
s
sig
n
m
e
n
t
1. id
e
n
tify
t
h
e
b
uilt
-in
p
olic
y
d
e
finitio
n
2. id
e
n
tify
t
h
e
b
uilt
-in
p
olic
y
s
e
t
d
e
finitio
n
(initia
tiv
e
)
3. a
d
d
t
o
t
e
r
r
a
g
r
u
n
t in
p
u
t
file
p
r
e
-
d
e
fin
e
d
c
u
s
t
o
m
p
olic
y
a
s
sig
n
m
e
n
t
n
e
w
c
u
s
t
o
m
p
olic
y
d
e
finitio
n
s
a
n
d
a
s
sig
n
m
e
n
t
s
p
r
e
-
r
e
q
uisit
e
s
s
t
r
u
c
t
u
r
e
d
y
n
a
mic_
a
n
d
_
s
t
a
tic_
r
e
f
e
r
e
n
c
e
d
y
n
a
mic
a
n
d
s
t
a
tic
p
a
r
a
m
e
t
e
r
s in
c
u
s
t
o
m
p
olicie
s
(
als
o initia
tiv
e
s
)
a
n
d
c
u
s
t
o
m
p
olic
y
a
s
sig
n
m
e
n
t
s
A. u
sin
g
p
a
r
a
m
e
t
e
r
s
f
r
o
m
a
b
o
v
e
t
a
ble
-
d
y
n
a
mic
B. u
sin
g
p
a
r
a
m
e
t
e
r
s
f
r
o
m
a
b
o
v
e lin
k
-
d
y
n
a
mic
C. s
t
a
tic
p
a
r
a
m
e
t
e
r
s
n
e
w_
c
u
s
t
o
m
_
p
olic
y_
d
e
finitio
n
c
r
e
a
t
e
a
n
e
w
c
u
s
t
o
m
p
olic
y
d
e
finitio
n
n
e
w_
c
u
s
t
o
m
_initia
tiv
e
c
r
e
a
t
e
a
n
e
w
c
u
s
t
o
m initia
tiv
e
c
r
e
a
t
e
a
n
e
w
c
u
s
t
o
m initia
tiv
e
-
b
uiltin
p
olic
y
r
e
f
e
r
e
n
c
e
s
n
e
w_
c
u
s
t
o
m
_
a
s
sig
n
m
e
n
t
s
c
r
e
a
t
e
a
n
e
w
c
u
s
t
o
m
a
s
sig
n
m
e
n
t
s
c
o
m
plia
n
c
e
s
c
a
n
w
h
y
h
a
v
e
t
his
pip
elin
e
? limitations how this pipeline works process for checking co
m
plia
n
c
y
r
e
m
e
dia
tio
n
h
o
w
t
his
pip
elin
e
w
o
r
k
s
r
u
n
nin
g
t
h
e
pip
elin
e
c
h
e
c
kin
g
r
e
m
e
dia
tio
n
s
t
a
t
u
s
s
p
e
cial r
e
m
e
dia
tio
n
p
r
o
c
e
d
u
r
e
s
din
e
-
v
m
-
b
a
c
k
u
p
-
c
e
n
t
r
alis
e
d
-
r
s
v
din
e
-
n
s
g
-
flo
wlo
g
s
din
e
-
a
z
-
m
o
n
-
a
g
e
n
t
T
e
r
r
a
fo
r
m
d
o
c
u
m
e
n
t
a
tio
n
A
p
plic
a
tio
n
L
a
n
din
g
Z
o
n
e
p
r
oj
e
c
t_
s
p
a
c
e
_
p
r
o
visio
n
e
r
h
o
w it
w
o
r
k
s landingzone
d
e
plo
y
m
e
n
t
E
x
a
m
ple
o
f
p
a
r
a
m
e
t
ris
e
d
n
e
w la
n
din
g
z
o
n
e: integration_with_ipam route subnet terraform documentation
A
C
F
M
o
d
ule
s
-
T
e
c
h
nic
al D
o
c
s
Clo
u
d
F
o
u
n
d
a
tio
n
f
u
n
c
tio
n
al p
a
r
t
s Intro Boostrapper and Provisioner org_hcl example_1 provisioner_details storage_account_id example_2 CI/CD CORE Network Tools Organizational Units Application modules inputs bootstrap LAST APPLIED CONFIGURATION outputs terragrunt_provisioner_environment input descriptions bootstrap append_tags custom_service_name resource_group_name storage_account_name storage_enabled storage_byok_enabled storage_storageaccount_tier storage_storageaccount_replication_type storage_supports_https_traffic_only storage_allow_blob_public_access storage_min_tls_version output descriptions terragrunt_provisioner_environment storage_account_id modules inputs cicd
6
/
4
5
4
1
9
4
1
9
4
1
9
4
1
9
5
1
9
5
1
9
5
1
9
5
1
9
5
1
9
5
1
9
5
1
9
5
1
9
5
1
9
5
1
9
5
1
9
5
1
9
6
1
9
6
1
9
6
1
9
6
1
9
6
1
9
6
1
9
6
1
9
6
1
9
6
1
9
6
1
9
6
1
9
6
1
9
6
1
9
6
1
9
7
1
9
7
1
9
7
1
9
7
1
9
7
1
9
7
1
9
7
1
9
7
1
9
7
1
9
7
1
9
7
1
9
7
1
9
7
1
9
7
1
9
9
1
9
9
1
9
9
1
9
9
1
9
9
2
0
0
2
0
0
2
0
0
2
0
0
2
0
0
2
0
0
2
0
0
2
0
1
2
0
1
2
0
1
2
0
1
2
0
1
2
0
1
2
0
1
2
0
1
2
0
2
2
0
2
2
0
2
2
0
2
2
0
2
2
0
2
2
0
2
2
0
2
2
0
2
2
0
2
2
0
2
2
0
2
2
0
3
2
0
3
2
0
3
2
0
3
2
0
3
2
0
4
2
0
4
2
0
4
2
0
4
2
0
4
2
0
4
2
0
5
2
0
5
2
0
6
2
0
6
2
0
6
L
A
S
T
A
P
P
LIE
D
C
O
N
FIG
U
R
A
TIO
N
o
u
t
p
u
t
s
t
e
r
r
a
g
r
u
n
t_
cic
d
_
e
n
vir
o
n
m
e
n
t input descriptions cicdappend_tags custom_service_name resource_group_name route_table_name vnet_name nsg_name msi_name container_registry_name msi_ad_roles_enabled msi_ad_roles key_vault_name key_vault_kek_expiry_days key_vault_enable_purge_protectio
n
k
e
y_v
a
ult_
e
n
a
ble
d
_fo
r_
d
e
plo
y
m
e
n
t
k
e
y_v
a
ult_
e
n
a
ble
d
_fo
r_
t
e
m
pla
t
e
_
d
e
plo
y
m
e
n
t
k
e
y_v
a
ult_
e
n
a
ble
d
_fo
r_
dis
k_
e
n
c
r
y
p
tio
n
k
e
y_v
a
ult_
e
n
a
ble
_
r
b
a
c_
a
u
t
h
o
riz
a
tio
n
k
e
y_v
a
ult_
k
e
y_v
a
ult_
s
k
u
k
e
y_v
a
ult_
a
c
c
e
s
s
_
p
olicie
s
k
e
y_v
a
ult_
n
e
t
w
o
r
k_
a
cls
_
b
y
p
a
s
s
k
e
y_v
a
ult_
n
e
t
w
o
r
k_
a
cls
_
d
e
f
a
ult_
a
c
tio
n
k
e
y_v
a
ult_
n
e
t
w
o
r
k_
a
cls
_vir
t
u
al_
n
e
t
w
o
r
k_
r
ule
s
k
e
y_v
a
ult_
n
e
t
w
o
r
k_
a
cls
_ip
_
r
ule
s
s
t
o
r
a
g
e
_
n
e
t
w
o
r
k_
a
cls
_
b
y
p
a
s
s
s
t
o
r
a
g
e
_
n
e
t
w
o
r
k_
a
cls
_
d
e
f
a
ult_
a
c
tio
n
s
t
o
r
a
g
e
_
n
e
t
w
o
r
k_
a
cls
_vir
t
u
al_
n
e
t
w
o
r
k_
r
ule
s
s
t
o
r
a
g
e
_
n
e
t
w
o
r
k_
a
cls
_ip
_
r
ule
s
o
u
t
p
u
t
d
e
s
c
rip
tio
n
s
k
e
y_v
a
ult_id
a
c
r_
n
a
m
e
r
g
_
n
a
m
e image user_assig
n
e
d
_id
v
n
e
t_id
s
u
b
n
e
t_
n
a
m
e
m
si_
clie
n
t_id
m
o
d
ule
s inputs inputs managem
e
n
t_
g
r
o
u
p
s
_
s
c
h
e
m
a
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
s
c
h
e
m
a.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_
r
o
o
t
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
r
o
o
t_
c
hild
s
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
s
c
h
e
m
a.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_
r
o
o
t.c
hild
s.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
m
g
-
pla
t
fo
r
m
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
s
c
h
e
m
a.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_
r
o
o
t.c
hild
s.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
[
0
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
m
g
-
pla
t
fo
r
m
_
c
hild
s
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
s
c
h
e
m
a.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_
r
o
o
t.c
hild
s.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
[
0
].c
hild
s.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
[
0
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
s
c
h
e
m
a.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_
r
o
o
t.c
hild
s.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
[
0
].c
hild
s.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
[
1
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
s
c
h
e
m
a.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_
r
o
o
t.c
hild
s.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
[
0
].c
hild
s.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
[
2
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
s
c
h
e
m
a.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_
r
o
o
t.c
hild
s.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
[
0
].c
hild
s.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
[
3
]
m
g
-la
n
din
g
-
z
o
n
e
s
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
s
c
h
e
m
a.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_
r
o
o
t.c
hild
s.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
[
1
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
m
g
-la
n
din
g
-
z
o
n
e
s
_
c
hild
s
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
s
c
h
e
m
a.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_
r
o
o
t.c
hild
s.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
[
1
].c
hild
s.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
[
0
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
s
c
h
e
m
a.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_
r
o
o
t.c
hild
s.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
[
1
].c
hild
s.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
[
1
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
s
c
h
e
m
a.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_
r
o
o
t.c
hild
s.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
[
1
].c
hild
s.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
[
2
]
m
g
-
d
e
c
o
m
mis
sio
n
e
d
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
s
c
h
e
m
a.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_
r
o
o
t.c
hild
s.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
[
2
]
m
g
-
s
a
n
d
b
o
x
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
s
c
h
e
m
a.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_
r
o
o
t.c
hild
s.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
[
3
]
m
g
-
a
u
dit
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
s
c
h
e
m
a.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_
r
o
o
t.c
hild
s.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
[
4
]
m
g
-
b
a
c
k
e
n
d
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
s
c
h
e
m
a.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_
r
o
o
t.c
hild
s.m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
[
5
]
p
a
r
t
n
e
r_
d
e
t
ails
p
a
r
t
n
e
r_
d
e
t
ails.a
z
u
r
e
_
p
a
r
t
n
e
r_lin
k.p
r
o
p
e
r
tie
s
s
p
n
_
p
a
r
a
m
e
t
e
r
s
s
p
n
_
p
a
r
a
m
e
t
e
r
s.d
e
v
o
p
s last applied configuration input descriptions management_groups_en
a
ble
d
s
p
n
_
e
n
a
ble
d
p
a
r
t
n
e
r_lin
k_
e
n
a
ble
d
o
u
t
p
u
t
s
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_
n
a
m
e
s
o
u
t
p
u
t
d
e
s
c
rip
tio
n
s
d
e
p
e
n
d
e
n
c
y
/
P
R
O
VISIO
N
E
R
/
CIC
D
m
o
d
ule
s inputs common
p
a
r
a
m
e
t
e
r
s logging LAST APPLIED CON
FIG
U
R
A
TIO
N
o
u
t
p
u
t
s
a
u
dit_
o
u
t
p
u
t
s input descrip
tio
n
s
7
/
4
5
4
2
0
6
2
0
6
2
0
6
2
0
6
2
0
6
2
0
6
2
0
6
2
0
6
2
0
6
2
0
6
2
0
7
2
0
7
2
0
7
2
0
7
2
0
7
2
0
7
2
0
7
2
0
7
2
0
7
2
0
7
2
0
7
2
0
7
2
0
7
2
0
8
2
0
8
2
0
8
2
0
8
2
0
8
2
0
8
2
0
8
2
0
8
2
0
8
2
0
8
2
0
8
2
0
8
2
0
8
2
0
9
2
0
9
2
0
9
2
0
9
2
0
9
2
0
9
2
0
9
2
0
9
2
0
9
2
0
9
2
1
0
2
1
0
2
1
0
2
1
0
2
1
0
2
1
1
2
1
1
2
1
1
2
1
1
2
1
1
2
1
1
2
1
2
2
1
2
2
1
2
2
1
2
2
1
2
2
1
2
2
1
2
2
1
2
2
1
3
2
1
3
2
1
3
2
1
3
2
1
3
2
1
3
2
1
4
2
1
4
2
1
4
2
1
4
2
1
4
2
1
4
2
1
4
2
1
4
2
1
4
2
1
4
2
1
5
2
1
5
2
1
5
2
1
5
2
1
5
2
1
5
2
1
5
2
1
5
2
1
5
2
1
5
2
1
5
2
1
6
2
1
6
2
1
6
2
1
6
2
1
6
2
1
6
2
1
6
2
1
6
2
1
6
2
1
7
2
1
7
2
1
7
2
1
7
2
1
7
2
1
7
2
1
7
2
1
7
2
1
7
a
p
p
e
n
d
_
t
a
g
s logging log_analytics_
e
n
a
ble
d log_analytics_workspa
c
e
_
n
a
m
e log_analytics_workspace_sku log_analytics_retention_in_days log_analytics_daily_quota_gb storage_enabled storage_byok_enabled storage_storageaccount_tier storage_storageaccount_replica
tio
n
_
t
y
p
e
s
t
o
r
a
g
e
_
s
u
p
p
o
r
t
s
_
h
t
t
p
s
_
t
r
a
ffic_
o
nly
s
t
o
r
a
g
e
_
allo
w_
blo
b
_
p
u
blic_
a
c
c
e
s
s
s
t
o
r
a
g
e
_
n
e
t
w
o
r
k_
a
cls
_
b
y
p
a
s
s
s
t
o
r
a
g
e
_
n
e
t
w
o
r
k_
a
cls
_
d
e
f
a
ult_
a
c
tio
n
s
t
o
r
a
g
e
_
n
e
t
w
o
r
k_
a
cls
_vir
t
u
al_
n
e
t
w
o
r
k_
r
ule
s
s
t
o
r
a
g
e
_
n
e
t
w
o
r
k_
a
cls
_ip
_
r
ule
s
s
t
o
r
a
g
e
_
min
_
tls
_v
e
r
sio
n
s
t
o
r
a
g
e
_w
o
r
m
_
p
olic
y_im
m
u
t
a
bilit
y_
p
e
rio
d
s
t
o
r
a
g
e
_
tie
r_
t
o
_
c
o
ol_in
_
d
a
y
s
s
t
o
r
a
g
e
_
tie
r_
t
o
_
a
r
c
hiv
e
_in
_
d
a
y
s
s
t
o
r
a
g
e
_
d
ele
t
e
_in
_
d
a
y
s
k
e
y_v
a
ult_
s
h
o
r
t_
n
a
m
e
k
e
y_v
a
ult_
k
e
k_
e
x
pir
y_
d
a
y
s
k
e
y_v
a
ult_
e
n
a
ble
_
p
u
r
g
e
_
p
r
o
t
e
c
tio
n
k
e
y_v
a
ult_
e
n
a
ble
d
_fo
r_
d
e
plo
y
m
e
n
t
k
e
y_v
a
ult_
e
n
a
ble
d
_fo
r_
t
e
m
pla
t
e
_
d
e
plo
y
m
e
n
t
k
e
y_v
a
ult_
e
n
a
ble
d
_fo
r_
dis
k_
e
n
c
r
y
p
tio
n
k
e
y_v
a
ult_
e
n
a
ble
_
r
b
a
c_
a
u
t
h
o
riz
a
tio
n
k
e
y_v
a
ult_
k
e
y_v
a
ult_
s
k
u
k
e
y_v
a
ult_
p
e
r
mis
sio
n
s
k
e
y_v
a
ult_
n
e
t
w
o
r
k_
a
cls
_
b
y
p
a
s
s
k
e
y_v
a
ult_
n
e
t
w
o
r
k_
a
cls
_
d
e
f
a
ult_
a
c
tio
n
k
e
y_v
a
ult_
n
e
t
w
o
r
k_
a
cls
_vir
t
u
al_
n
e
t
w
o
r
k_
r
ule
s
k
e
y_v
a
ult_
n
e
t
w
o
r
k_
a
cls
_ip
_
r
ule
s
k
e
y_v
a
ult_
a
c
c
e
s
s
_
p
olicie
s
O
u
t
p
u
t
d
e
s
c
rip
tio
n
s
a
u
dit_
o
u
t
p
u
t
s
w
o
r
k
s
p
a
c
e
_
r
e
s
o
u
r
c
e
_id
w
o
r
k
s
p
a
c
e
_
r
e
s
o
u
r
c
e
_
n
a
m
e
w
o
r
k
s
p
a
c
e
_
r
e
s
o
u
r
c
e
_
g
r
o
u
p
_
n
a
m
e
s
t
o
r
a
g
e
_
a
c
c
o
u
n
t_
n
a
m
e
s
t
o
r
a
g
e
_
e
n
a
ble
d
d
e
p
e
n
d
e
n
c
y
m
o
d
ule
s inputs rbac custom_
r
ole
_
d
e
finitio
n
s
c
u
s
t
o
m
_
r
ole
_
d
e
finitio
n
s
[
0
]
c
u
s
t
o
m
_
r
ole
_
d
e
finitio
n
s
[
1
]
c
u
s
t
o
m
_
r
ole
_
d
e
finitio
n
s
[
2
]
c
u
s
t
o
m
_
r
ole
_
d
e
finitio
n
s
[
3
]
c
u
s
t
o
m
_
r
ole
_
d
e
finitio
n
s
[
4
]
c
u
s
t
o
m
_
r
ole
_
d
e
finitio
n
s
[
5
]
c
u
s
t
o
m
_
r
ole
_
d
e
finitio
n
s
[
5
]
c
u
s
t
o
m
_
r
ole
_
d
e
finitio
n
s
[
6
]
c
u
s
t
o
m
_
r
ole
_
d
e
finitio
n
s
[
7
]
r
e
g
ula
t
o
r
y_
c
o
m
plia
n
c
e
r
e
g
ula
t
o
r
y_initia
tiv
e
s
r
e
g
ula
t
o
r
y_initia
tiv
e
s
[
0
]
p
olic
y_
a
s
sig
n
m
e
n
t_
c
o
n
fig
_
d
e
f
a
ult_
0
r
e
g
ula
t
o
r
y_initia
tiv
e
s
[
0
].p
olic
y_
a
s
sig
n
m
e
n
t_
c
o
n
fig
p
olic
y_
e
x
e
m
p
tio
n
_
c
o
n
fig
_
d
e
f
a
ult_
0
r
e
g
ula
t
o
r
y_initia
tiv
e
s
[
0
].p
olic
y_
e
x
e
m
p
tio
n
_
c
o
n
fig
r
e
g
ula
t
o
r
y_initia
tiv
e
s
[
1
]
p
olic
y_
a
s
sig
n
m
e
n
t_
c
o
n
fig
_
d
e
f
a
ult_
1
r
e
g
ula
t
o
r
y_initia
tiv
e
s
[
1
].p
olic
y_
a
s
sig
n
m
e
n
t_
c
o
n
fig
p
olic
y_
e
x
e
m
p
tio
n
_
c
o
n
fig
_
d
e
f
a
ult_
1
r
e
g
ula
t
o
r
y_initia
tiv
e
s
[
1
].p
olic
y_
e
x
e
m
p
tio
n
_
c
o
n
fig
r
e
g
ula
t
o
r
y_initia
tiv
e
s
[
2
]
p
olic
y_
a
s
sig
n
m
e
n
t_
c
o
n
fig
_
d
e
f
a
ult_
2
r
e
g
ula
t
o
r
y_initia
tiv
e
s
[
2
].p
olic
y_
a
s
sig
n
m
e
n
t_
c
o
n
fig
p
olic
y_
e
x
e
m
p
tio
n
_
c
o
n
fig
_
d
e
f
a
ult_
2
r
e
g
ula
t
o
r
y_initia
tiv
e
s
[
2
].p
olic
y_
e
x
e
m
p
tio
n
_
c
o
n
fig
L
A
S
T
A
P
P
LIE
D
C
O
N
FIG
U
R
A
TIO
N input descriptions rbac rbac_enabled acf_root_level custom_role_definitions custom_role_definitions_name custom_role_definitions_description custom_role_definitions_actions custom_role_definitions_not_actions additional_custom_role_definitions regulatory_compliance regulatory_initiatives_enabled regulatory_initiatives initiative_active initiative_management_groups policy_assignment_config_descr policy_assignment_name policy_assignment_policy_name policy_assignment_location policy_assignment_identity policy_assignment_display_name policy_assignment_description policy_assignment_metadata policy_assignment_not_scopes policy_assignment_parameters policy_assignment_parameters_value_0 policy_assignment_enforce policy_exemption_config_descr policy_exemption_name policy_exemption_display_name policy_exemption_description policy_exemption_metadata policy_exemption_policy_definition_reference_id
s
p
olic
y_
e
x
e
m
p
tio
n
_
c
o
n
fig
_
p
olic
y_
d
e
finitio
n
_
r
e
f
e
r
e
n
c
e
_id
s
_
0
N
o
r
d
clo
u
d
CIS
B
e
n
c
h
m
a
r
k
v
1.3.0
8
/
4
5
4
2
1
9
2
1
9
2
2
1
2
2
1
2
2
6
2
2
6
2
2
6
2
2
6
2
2
6
2
2
6
2
2
6
2
2
6
2
2
7
2
2
7
2
2
7
2
2
7
2
2
7
2
2
7
2
2
8
2
2
8
2
2
8
2
2
8
2
2
8
2
2
9
2
2
9
2
2
9
2
2
9
2
2
9
2
3
0
2
3
0
2
3
0
2
3
0
2
3
0
2
3
0
2
3
1
2
3
1
2
3
1
2
3
1
2
3
1
2
3
2
2
3
2
2
3
4
2
3
4
2
3
4
2
3
4
2
3
4
2
3
4
2
3
5
2
3
5
2
3
5
2
3
5
2
3
5
2
3
5
2
3
5
2
3
6
2
3
6
2
3
7
2
3
7
2
3
7
2
3
7
2
3
7
2
3
7
2
3
8
2
3
8
2
3
8
2
3
8
2
3
8
2
3
8
2
3
8
2
3
9
2
3
9
2
3
9
2
3
9
2
3
9
2
3
9
2
3
9
2
4
0
2
4
0
2
4
0
2
4
0
2
4
0
2
4
0
2
4
0
2
4
0
2
4
1
2
4
1
2
4
1
2
4
2
2
4
2
2
4
3
2
4
3
2
4
6
2
4
7
2
4
8
2
4
8
2
4
8
2
4
9
2
4
9
2
4
9
2
4
9
2
4
9
p
olic
y_
e
x
e
m
p
tio
n
_
c
o
n
fig
_
p
olic
y_
d
e
finitio
n
_
r
e
f
e
r
e
n
c
e
_id
s
_
1
N
o
r
d
clo
u
d IS
O
2
7
0
0
1
-
2
0
1
3
B
e
n
c
h
m
a
r
k
v
7
p
olic
y_
e
x
e
m
p
tio
n
_
c
o
n
fig
_
p
olic
y_
d
e
finitio
n
_
r
e
f
e
r
e
n
c
e
_id
s
_
2
N
o
r
d
clo
u
d
Clo
u
d
S
e
c
u
rit
y
B
e
n
c
h
m
a
r
k
v
3
p
olic
y_
e
x
e
m
p
tio
n
_
e
x
e
m
p
tio
n
_
c
a
t
e
g
o
r
y
d
e
p
e
n
d
e
n
c
y
m
o
d
ule
s inputs tags keyvault_
s
e
rvic
e
s
n
e
t
w
o
r
k_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s
c
o
n
n
e
c
tivit
y_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.c
o
n
n
e
c
tivit
y
c
o
n
n
e
c
tivit
y_
c
o
n
fig
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.c
o
n
n
e
c
tivit
y.c
o
n
fig
c
o
n
n
e
c
tivit
y_
b
a
s
tio
n
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.c
o
n
n
e
c
tivit
y.a
z
u
r
e
_
b
a
s
tio
n
c
o
n
n
e
c
tivit
y_
m
ultir
e
gio
n
_
h
u
b
_
p
e
e
rin
g
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.c
o
n
n
e
c
tivit
y.m
ulti_
r
e
gio
n
_
h
u
b
_
p
e
e
rin
g
c
o
n
n
e
c
tivit
y_v
p
n
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.c
o
n
n
e
c
tivit
y.v
p
n
c
o
n
n
e
c
tivit
y_v
p
n
_
b
g
p
_
s
e
t
tin
g
s
_
s
e
rvic
e
s
c
o
n
n
e
c
tivit
y_v
p
n
_
c
o
n
n
e
c
tio
n
s
_
b
g
p
_
s
e
t
tin
g
s
_
p
e
e
rin
g
_
a
d
d
r
e
s
s
e
s
c
o
n
n
e
c
tivit
y_v
p
n
_
c
o
n
n
e
c
tio
n
s
_
s
e
rvic
e
s
c
o
n
n
e
c
tivit
y_v
p
n
_
c
o
n
n
e
c
tio
n
s
_v
p
n
_ip
s
e
c_
p
olicie
s
_
s
e
rvic
e
s
c
o
n
n
e
c
tivit
y_v
p
n
_lo
c
al_
n
e
t
w
o
r
k_
g
a
t
e
w
a
y
s
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.c
o
n
n
e
c
tivit
y.v
p
n.lo
c
al_
n
e
t
w
o
r
k_
g
a
t
e
w
a
y
s
c
o
n
n
e
c
tivit
y_v
p
n
_lo
c
al_
n
e
t
w
o
r
k_
g
a
t
e
w
a
y
s
_
b
g
p
_
s
e
t
tin
g
s
_
s
e
rvic
e
s
c
o
n
n
e
c
tivit
y_v
p
n
_v
p
n
_
sit
e
s
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.c
o
n
n
e
c
tivit
y.v
p
n.v
p
n
_
sit
e
s
c
o
n
n
e
c
tivit
y_v
p
n
_v
p
n
_
sit
e
s
_
n
a
m
e
_lin
k
s
_
s
e
rvic
e
s
c
o
n
n
e
c
tivit
y_v
p
n
_v
p
n
_
sit
e
s
_
n
a
m
e
_lin
k
s
_
s
e
rvic
e
s
_
b
g
p
_
p
r
o
p
e
r
tie
s
c
o
n
n
e
c
tivit
y_v
p
n
_v
p
n
_
sit
e
s
_
n
a
m
e
_lin
k
s
_v
p
n
_ip
s
e
c_
p
olicie
s
_
s
e
rvic
e
s
c
o
n
n
e
c
tivit
y_
e
x
p
r
e
s
s
r
o
u
t
e
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.c
o
n
n
e
c
tivit
y.e
x
p
r
e
s
s
_
r
o
u
t
e
c
o
n
n
e
c
tivit
y_
e
x
p
r
e
s
s
r
o
u
t
e
_
b
g
p
_
s
e
t
tin
g
s
_
s
e
rvic
e
s
c
o
n
n
e
c
tivit
y_
e
x
p
r
e
s
s
r
o
u
t
e
_
b
g
p
_
s
e
t
tin
g
s
_
p
e
e
rin
g
_
a
d
d
r
e
s
s
e
s
c
o
n
n
e
c
tivit
y_
e
x
p
r
e
s
s
r
o
u
t
e
_
cir
c
uit
s
_
s
e
rvic
e
s
c
o
n
n
e
c
tivit
y_
e
x
p
r
e
s
s
r
o
u
t
e
_
glo
b
al_
r
e
a
c
h
_
s
e
rvic
e
s
c
o
n
n
e
c
tivit
y_
s
u
b
n
e
t
s
_
s
e
rvic
e
s
c
o
n
n
e
c
tivit
y_
s
e
rvic
e
_
e
n
d
p
oin
t
s
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.c
o
n
n
e
c
tivit
y.s
e
rvic
e
_
e
n
d
p
oin
t
s
c
o
n
n
e
c
tivit
y_
n
e
t
w
o
r
k_
s
e
c
u
rit
y_
g
r
o
u
p
s
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.c
o
n
n
e
c
tivit
y.n
e
t
w
o
r
k_
s
e
c
u
rit
y_
g
r
o
u
p
s
c
o
n
n
e
c
tivit
y_
n
e
t
w
o
r
k_
s
e
c
u
rit
y_
g
r
o
u
p
s
_
r
ule
s
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.c
o
n
n
e
c
tivit
y.n
e
t
w
o
r
k_
s
e
c
u
rit
y_
g
r
o
u
p
s.s
e
c
u
rit
y_
r
ule
s
c
o
n
n
e
c
tivit
y_
r
o
u
t
e
_
t
a
ble
s
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.c
o
n
n
e
c
tivit
y.r
o
u
t
e
_
t
a
ble
s
c
o
n
n
e
c
tivit
y_
r
o
u
t
e
_
t
a
ble
s
_
r
o
u
t
e
s
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.c
o
n
n
e
c
tivit
y.r
o
u
t
e
_
t
a
ble
s.r
o
u
t
e
s
s
h
a
r
e
d
s
e
rvic
e
s
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.s
h
a
r
e
d
s
e
rvic
e
s
s
h
a
r
e
d
s
e
rvic
e
s
_
c
o
n
fig
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.s
h
a
r
e
d
s
e
rvic
e
s.c
o
n
fig
s
h
a
r
e
d
s
e
rvic
e
s
_
s
u
b
n
e
t
s
_
s
e
rvic
e
s
s
h
a
r
e
d
s
e
rvic
e
s
_
s
e
rvic
e
_
e
n
d
p
oin
t
s
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.s
h
a
r
e
d
s
e
rvic
e
s.s
e
rvic
e
_
e
n
d
p
oin
t
s
s
h
a
r
e
d
s
e
rvic
e
s
_
n
e
t
w
o
r
k_
s
e
c
u
rit
y_
g
r
o
u
p
s
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.s
h
a
r
e
d
s
e
rvic
e
s.n
e
t
w
o
r
k_
s
e
c
u
rit
y_
g
r
o
u
p
s
s
h
a
r
e
d
s
e
rvic
e
s
_
n
e
t
w
o
r
k_
s
e
c
u
rit
y_
g
r
o
u
p
s
_
r
ule
s
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.s
h
a
r
e
d
s
e
rvic
e
s.n
e
t
w
o
r
k_
s
e
c
u
rit
y_
g
r
o
u
p
s.s
e
c
u
rit
y_
r
ule
s
s
h
a
r
e
d
s
e
rvic
e
s
_
r
o
u
t
e
_
t
a
ble
s
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.s
h
a
r
e
d
s
e
rvic
e
s.r
o
u
t
e
_
t
a
ble
s
s
h
a
r
e
d
s
e
rvic
e
s
_
r
o
u
t
e
_
t
a
ble
s
_
r
o
u
t
e
s
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.s
h
a
r
e
d
s
e
rvic
e
s.r
o
u
t
e
_
t
a
ble
s.r
o
u
t
e
s identity_services settings.networks.identity identity_config_services settings.networks.identity.config identity_subnets_services identity_service_endpoints_services settings.networks.identity.service_endpoints identity_network_security_groups_services settings.networks.identity.network_security_groups identity_network_security_groups_rules_servic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.id
e
n
tit
y.n
e
t
w
o
r
k_
s
e
c
u
rit
y_
g
r
o
u
p
s.s
e
c
u
rit
y_
r
ule
s identity_route_tables_services settings.networks.identity.route_tables identity_route_tables_routes_services settings.networks.identity.route_tables.routes last applied configuration input descriptions append_tags networks networks_enabled connectivity connectivity_bastion connectivity_multi_region_hub_peering connectivity_vpn connectivity_vpn_enabled connectivity_expressroute connectivity_expressroute_global_reach subnets subnets_subnet service_endpoints service_endpoints_service network_security_groups network_security_groups_subnet route_tables route_tables_subnet
9
/
4
5
4
249
250
250
250
250
251
251
252
252
254
254
254
254
254
254
254
255
255
256
256
256
256
257
257
257
257
257
257
257
258
258
258
258
258
258
258
259
259
260
260
260
261
261
261
261
261
261
261
261
262
262
262
262
262
262
263
263
263
263
263
263
263
263
264
264
264
264
264
264
265
265
265
265
265
265
265
265
265
265
266
266
266
266
266
266
266
266
266
266
267
267
sharedservices
identity
identity_config
keyvault
key_vault_short_name
outputs
network
base_network_prefixes
output descriptions
dependency
modules
common parameters
dc_infra
dc_infra_settings.dc_infra[0]
key_vaults
dc_infra_settings.dc_infra.key_vaults[0]
LAST APPLIED CONFIGURATION
inputs
append_tags
dc_infra_enabled
key_vault_name
key_vault_network_acls_default_action
key_vault_key_vault_network_acls_bypass
outputs
output descriptions
dependency
modules
inputs
tag
application_gateway
applicationgateway_settings
applicationgateway_settings.applicationgateway[0]
applicationgateway_settings_key_vaults
applicationgateway_settings.applicationgateway[0].key_vaults[0]
key_vaults_access_policies
applicationgateway_settings.applicationgateway[0].key_vaults[0].key_vault_access_policies[0]
applicationgateway_settings_appgws
applicationgateway_settings.applicationgateway[0].appgws[0]
appgws_autoscale_configuration
applicationgateway_settings.applicationgateway[0].appgws[0].autoscale_configuration
appgws_frontend_ip_configuration
applicationgateway_settings.applicationgateway[0].appgws[0].frontend_ip_configuration[0]
applicationgateway_settings.applicationgateway[0].appgws[0].frontend_ip_configuration[1]
appgws_frontend_port
applicationgateway_settings.applicationgateway[0].appgws[0].frontend_port[0]
appgws_backend_address_pool
applicationgateway_settings.applicationgateway[0].appgws[0].backend_address_pool[0]
appgws_backend_http_settings
applicationgateway_settings.applicationgateway[0].appgws[0].backend_http_settings[0]
backend_http_settings_connection_draining
applicationgateway_settings.applicationgateway[0].appgws[0].backend_http_settings[0].connection_draining
appgws_http_listener
applicationgateway_settings.applicationgateway[0].appgws[0].http_listener[0]
http_listener_custom_error_configuration
applicationgateway_settings.applicationgateway[0].appgws[0].http_listener[0].custom_error_configuration[0]
appgws_request_routing_rule
applicationgateway_settings.applicationgateway[0].appgws[0].request_routing_rule[0]
appgws_probe
applicationgateway_settings.applicationgateway[0].appgws[0].probe[0]
probe_match
applicationgateway_settings.applicationgateway[0].appgws[0].probe[0].match[0]
appgws_url_path_map
applicationgateway_settings.applicationgateway[0].appgws[0].url_path_map[0]
url_path_map_path_rule
applicationgateway_settings.applicationgateway[0].appgws[0].url_path_map[0].path_rule[0]
appgws_waf_configuration
applicationgateway_settings.applicationgateway[0].appgws[0].waf_configuration[0]
appgws_waf_policy
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0]
waf_policy_policy_settings
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0].policy_settings[0]
waf_policy_managed_rule_set
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0].managed_rule_set[0]
managed_rule_set_rule_group_override
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0].managed_rule_set[0].rule_group_override[0]
rule_group_override_rule
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0].managed_rule_set[0].rule_group_override[0].rule[0]
waf_policy_exclusion
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0].exclusion[0]
exclusion_excluded_rule_set
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0].exclusion[0].excluded_rule_set[0]
excluded_rule_rule_group
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0].exclusion[0].excluded_rule_set[0].rule_group[0]
waf_policy_custom_rules
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0].custom_rules[0]
custom_rules_match_conditions
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0].custom_rules[0].match_conditions[0]
match_conditions_match_variable
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0].custom_rules[0].match_conditions[0].match_variables[0]
appgws_rewrite_rule_set
applicationgateway_settings.applicationgateway[0].appgws[0].rewrite_rule_set[0]
10/454
2
6
7
2
6
7
2
6
7
2
6
7
2
6
7
2
6
7
2
6
7
2
6
7
2
6
8
2
6
8
2
6
8
2
6
8
2
6
8
2
6
8
2
6
8
2
6
8
2
6
8
2
6
9
2
6
9
2
6
9
2
6
9
2
6
9
2
6
9
2
6
9
2
6
9
2
6
9
2
6
9
2
6
9
2
6
9
2
6
9
2
6
9
2
7
0
2
7
0
2
7
0
2
7
0
2
7
0
2
7
0
2
7
0
2
7
0
2
7
0
2
7
0
2
7
0
2
7
0
2
7
0
2
7
1
2
7
1
2
7
1
2
7
1
2
7
1
2
7
1
2
7
1
2
7
1
2
7
1
2
7
1
2
7
1
2
7
1
2
7
1
2
7
2
2
7
2
2
7
2
2
7
2
2
7
2
2
7
2
2
7
2
2
7
2
2
7
2
2
7
2
2
7
2
2
7
2
2
7
2
2
7
2
2
7
3
2
7
3
2
7
3
2
7
3
2
7
3
2
7
3
2
7
3
2
7
3
2
7
3
2
7
3
2
7
3
2
7
3
2
7
3
2
7
3
2
7
4
2
7
4
2
7
4
2
7
4
2
7
4
2
7
4
2
7
4
2
7
4
r
e
w
rit
e
_
r
ule
_
s
e
t_
r
e
w
rit
e
_
r
ule
a
p
plic
a
tio
n
g
a
t
e
w
a
y_
s
e
t
tin
g
s.a
p
plic
a
tio
n
g
a
t
e
w
a
y
[
0
].a
p
p
g
w
s
[
0
].r
e
w
rit
e
_
r
ule
_
s
e
t
[
0
].r
e
w
rit
e
_
r
ule
[
0
]
r
e
w
rit
e
_
r
ule
s
_
r
e
q
u
e
s
t_
h
e
a
d
e
r_
c
o
n
fig
u
r
a
tio
n
a
p
plic
a
tio
n
g
a
t
e
w
a
y_
s
e
t
tin
g
s.a
p
plic
a
tio
n
g
a
t
e
w
a
y
[
0
].a
p
p
g
w
s
[
0
].r
e
w
rit
e
_
r
ule
_
s
e
t
[
0
].r
e
w
rit
e
_
r
ule
[
0
].r
e
q
u
e
s
t_
h
e
a
d
e
r_
c
o
n
fig
u
r
a
tio
n
[
0
]
a
p
p
g
w
s
_
r
e
dir
e
c
t_
c
o
n
fig
u
r
a
tio
n
a
p
plic
a
tio
n
g
a
t
e
w
a
y_
s
e
t
tin
g
s.a
p
plic
a
tio
n
g
a
t
e
w
a
y
[
0
].a
p
p
g
w
s
[
0
].r
e
dir
e
c
t_
c
o
n
fig
u
r
a
tio
n
[
0
]
a
p
p
g
w
s
_
s
sl_
c
e
r
tific
a
t
e
a
p
plic
a
tio
n
g
a
t
e
w
a
y_
s
e
t
tin
g
s.a
p
plic
a
tio
n
g
a
t
e
w
a
y
[
0
].a
p
p
g
w
s
[
0
].s
sl_
c
e
r
tific
a
t
e
[
0
]
a
p
p
g
w
s
_
s
sl_
p
r
o
file
a
p
plic
a
tio
n
g
a
t
e
w
a
y_
s
e
t
tin
g
s.a
p
plic
a
tio
n
g
a
t
e
w
a
y
[
0
].a
p
p
g
w
s
[
0
].s
sl_
p
r
o
file
[
0
]
a
p
plic
a
tio
n
g
a
t
e
w
a
y_
s
e
t
tin
g
s.a
p
plic
a
tio
n
g
a
t
e
w
a
y
[
0
].a
p
p
g
w
s
[
0
].s
sl_
p
r
o
file
[
0
].s
sl_
p
olic
y
[
0
]
a
p
p
g
w
s
_
t
r
u
s
t
e
d
_
r
o
o
t_
c
e
r
tific
a
t
e
a
p
plic
a
tio
n
g
a
t
e
w
a
y_
s
e
t
tin
g
s.a
p
plic
a
tio
n
g
a
t
e
w
a
y
[
0
].a
p
p
g
w
s
[
0
].t
r
u
s
t
e
d
_
r
o
o
t_
c
e
r
tific
a
t
e
[
0
]
a
p
p
g
w
s
_
t
r
u
s
t
e
d
_
clie
n
t_
c
e
r
tific
a
t
e
a
p
plic
a
tio
n
g
a
t
e
w
a
y_
s
e
t
tin
g
s.a
p
plic
a
tio
n
g
a
t
e
w
a
y
[
0
].a
p
p
g
w
s
[
0
].t
r
u
s
t
e
d
_
clie
n
t_
c
e
r
tific
a
t
e
[
0
]
a
p
p
g
w
s
_
a
u
t
h
e
n
tic
a
tio
n
_
c
e
r
tific
a
t
e
a
p
plic
a
tio
n
g
a
t
e
w
a
y_
s
e
t
tin
g
s.a
p
plic
a
tio
n
g
a
t
e
w
a
y
[
0
].a
p
p
g
w
s
[
0
].a
u
t
h
e
n
tic
a
tio
n
_
c
e
r
tific
a
t
e
[
0
]
a
p
plic
a
tio
n
g
a
t
e
w
a
y_
s
e
t
tin
g
s.a
p
plic
a
tio
n
g
a
t
e
w
a
y
[
0
].a
p
p
g
w
s
[
0
].c
u
s
t
o
m
_
e
r
r
o
r_
c
o
n
fig
u
r
a
tio
n
[
0
] last applied configuration Input descriptions append_tags applicationgateway_enabled applicationgateway_settings_enabled applicationgateway_settings_instance applicationgateway_settings_custom_service_name applicationgateway_settings_resource_group_name applicationgateway_settings_location applicationgateway_settings_location_short key_vaults key_vaults_name key_vaults_enable_purge_protection key_vaults_enabled_for_deployment key_vaults_enabled_for_template_deployment key_vaults_enabled_for_disk_encryption key_vaults_enable_rbac_authorization key_vaults_key_vault_sku key_vaults_permissions key_vaults_network_acls_bypass key_vaults_network_acls_default_action key_vaults_network_acls_ip_rules key_vaults_network_acls_virtual_network_rules access_policies_tenant_id access_policies_object_id access_policies_certificate_permissions access_policies_secret_permissions access_policies_key_permissions access_policies_storage_permissions appgws appgws_version appgws_appgw_name appgws_availabililty_zones appgws_private_ip_address appgws_autoscale_configuration appgws_sku_name appgws_sku_tier appgws_enable_http2 appgws_delegate_control appgws_gateway_ip_configuration_name appgws_gateway_ip_configuration_subnet_id appgws_force_firewall_policy_association appgws_firewall_policy_id appgws_rewrite_rule_set appgws_redirect_configuration appgws_ssl_certificate appgws_ssl_profile appgws_trusted_root_certificate appgws_trusted_client_certificate appgws_authentication_certificate appgws_custom_error_configuration autoscale_configuration_mincapacity autoscale_configuration_maxcapacity frontend_ip_configuration_name frontend_ip_configuration_private_ip_address frontend_ip_configuration_public_ip_address_id frontend_ip_configuration_private_ip_address_allocation frontend_ip_configuration_subnet_id frontend_ip_configuration_private_link_configuration_name frontend_port_name frontend_port_port backend_address_pool_name backend_address_pool_ip_addresses backend_address_pool_fqdns backend_http_settings_name backend_http_settings_port backend_http_settings_protocol backend_http_settings_cookie_based_affinity backend_http_settings_host_name backend_http_settings_pick_host_name_from_backend_address backend_http_settings_affinity_cookie_name backend_http_settings_request_timeout backend_http_settings_path backend_http_settings_probe_name backend_http_settings_authentication_certificate
1
1
/
4
5
4
2
7
4
2
7
4
2
7
4
2
7
4
2
7
4
2
7
4
2
7
5
2
7
5
2
7
5
2
7
5
2
7
5
2
7
5
2
7
5
2
7
5
2
7
5
2
7
5
2
7
5
2
7
5
2
7
5
2
7
5
2
7
6
2
7
6
2
7
6
2
7
6
2
7
6
2
7
6
2
7
6
2
7
6
2
7
6
2
7
6
2
7
6
2
7
6
2
7
6
2
7
6
2
7
7
2
7
7
2
7
7
2
7
7
2
7
7
2
7
7
2
7
7
2
7
7
2
7
7
2
7
7
2
7
7
2
7
7
2
7
7
2
7
7
2
7
8
2
7
8
2
7
8
2
7
8
2
7
8
2
7
8
2
7
8
2
7
8
2
7
8
2
7
8
2
7
8
2
7
8
2
7
8
2
7
8
2
7
9
2
7
9
2
7
9
2
7
9
2
7
9
2
7
9
2
7
9
2
7
9
2
7
9
2
7
9
2
7
9
2
7
9
2
7
9
2
7
9
2
8
0
2
8
0
2
8
0
2
8
0
2
8
0
2
8
0
2
8
0
2
8
0
2
8
0
2
8
0
2
8
0
2
8
0
2
8
0
2
8
0
2
8
1
2
8
1
b
a
c
k
e
n
d
_
h
t
t
p
_
s
e
t
tin
g
s
_
t
r
u
s
t
e
d
_
r
o
o
t_
c
e
r
tific
a
t
e
_
n
a
m
e
s
c
o
n
n
e
c
tio
n
_
d
r
ainin
g
_
e
n
a
ble
d
c
o
n
n
e
c
tio
n
_
d
r
ainin
g
_
d
r
ain
_
tim
e
o
u
t
h
t
t
p
_lis
t
e
n
e
r_
n
a
m
e
h
t
t
p
_lis
t
e
n
e
r_f
r
o
n
t
e
n
d
_
p
o
r
t_
n
a
m
e
h
t
t
p
_lis
t
e
n
e
r_f
r
o
n
t
e
n
d
_ip
_
c
o
n
fig
u
r
a
tio
n
_
n
a
m
e
h
t
t
p
_lis
t
e
n
e
r_
p
r
o
t
o
c
ol http_listener_host_na
m
e
s
h
t
t
p
_lis
t
e
n
e
r_
r
e
q
uir
e
_
s
ni http_listener_ssl_certifica
t
e
_
n
a
m
e
h
t
t
p
_lis
t
e
n
e
r_
s
sl_
p
r
o
file
_
n
a
m
e
h
t
t
p
_lis
t
e
n
e
r_fir
e
w
all_
p
olic
y_id
c
u
s
t
o
m
_
e
r
r
o
r_
c
o
n
fig
u
r
a
tio
n
_
c
u
s
t
o
m
_
e
r
r
o
r_
p
a
g
e
_
u
rl custom_error_configuration_status_code_range request_routing_rule_name request_routing_rule_http_listener_name request_routing_rule_backend_address_pool_name request_routing_rule_backend_http_settings_name request_routing_rule_rule_type request_routing_rule_priority request_routing_rule_redirect_configuration_name request_routing_rule_url_path_map_name request_routing_rule_rewrite_rule_set_name probe_name probe_protocol probe_port probe_host probe_path probe_interval probe_timeout probe_unhealthy_threshold probe_pick_host_name_from_backend_http_settings probe_minimum_servers match_status_code match_body url_path_map_name url_path_map_default_backend_address_pool_name url_path_map_default_backend_http_settings_name url_path_map_default_redirect_configuration_name url_path_map_default_rewrite_rule_set_name path_rule_name path_rule_paths path_rule_backend_address_pool_name path_rule_backend_http_settings_name path_rule_redirect_configuration_name path_rule_rewrite_rule_set_name path_rule_firewall_policy_id waf_configuration_enabled waf_configuration_firewal_mode waf_configuration_rule_set_type waf_configuration_rule_set_version waf_configuration_file_upload_limit_mb waf_configuration_file_max_request_body_size_kb waf_configuration_file_request_body_check waf_configuration_file_disabled_rule_group waf_configuration_file_exclusion waf_policy_name waf_policy_global policy_settings_enabled policy_settings_mode policy_settings_request_body_check policy_settings_max_request_body_size_in_kb policy_settings_file_upload_limit_in_mb managed_rule_set_rule_set_type managed_rule_set_rule_set_version managed_rule_set_rule_group_override rule_group_override_rule_group_name rule_group_override_rule_group_name rule_group_override_action rule_group_override_enabled rule_group_override_id exclusion_match_variable exclusion_selector_match_operator exclusion_selector excluded_rule_set_type excluded_rule_set_version rule_group_rule_group_name rule_group_excluded_rule custom_rules_name custom_rules_priority custom_rules_rule_type custom_rules_action match_conditions_operator match_conditions_negation match_conditions_match_values match_variables_variable_name rewrite_rule_set_name rewrite_rules_name rewrite_rules_rule_sequence rewrite_rules_conditions rewrite_rulese_response_header_configuration rewrite_rules_url 1
2
/
4
5
4
2
8
1
2
8
1
2
8
1
2
8
1
2
8
1
2
8
1
2
8
1
2
8
1
2
8
1
2
8
1
2
8
1
2
8
1
2
8
2
2
8
2
2
8
2
2
8
2
2
8
2
2
8
2
2
8
2
2
8
2
2
8
2
2
8
2
2
8
2
2
8
2
2
8
2
2
8
2
2
8
3
2
8
3
2
8
3
2
8
3
2
8
3
2
8
3
2
8
3
2
8
3
2
8
3
2
8
4
2
8
4
2
8
4
2
8
5
2
8
5
2
8
5
2
8
5
2
8
5
2
8
5
2
8
6
2
8
6
2
8
6
2
8
6
2
8
7
2
8
7
2
8
7
2
8
7
2
8
7
2
8
7
2
8
7
2
8
7
2
8
7
2
8
8
2
8
8
2
8
8
2
8
8
2
8
9
2
8
9
2
8
9
2
9
0
2
9
0
2
9
0
2
9
1
2
9
1
2
9
1
2
9
2
2
9
2
2
9
2
2
9
2
2
9
3
2
9
3
2
9
3
2
9
3
2
9
3
2
9
3
2
9
3
2
9
3
2
9
4
2
9
4
2
9
4
2
9
4
2
9
4
2
9
5
2
9
5
2
9
5
2
9
5
2
9
5
2
9
5
2
9
6
2
9
6
2
9
6
2
9
6
2
9
6
2
9
7
2
9
7
2
9
7
2
9
7
2
9
7
2
9
7
r
e
q
u
e
s
t_
h
e
a
d
e
r_
c
o
n
fig
u
r
a
tio
n
_
h
e
a
d
e
r_
n
a
m
e
r
e
q
u
e
s
t_
h
e
a
d
e
r_
c
o
n
fig
u
r
a
tio
n
_
h
e
a
d
e
r_v
alu
e
r
e
dir
e
c
t_
c
o
n
fig
u
r
a
tio
n
_
n
a
m
e
r
e
dir
e
c
t_
c
o
n
fig
u
r
a
tio
n
_
r
e
dir
e
c
t_
t
y
p
e
r
e
dir
e
c
t_
c
o
n
fig
u
r
a
tio
n
_
t
a
r
g
e
t_lis
t
e
n
e
r_
n
a
m
e
r
e
dir
e
c
t_
c
o
n
fig
u
r
a
tio
n
_
t
a
r
g
e
t_
u
rl redirect_configuration_include_p
a
t
h
r
e
dir
e
c
t_
c
o
n
fig
u
r
a
tio
n
_in
clu
d
e
_
q
u
e
r
y_
s
t
rin
g
s
sl_
c
e
r
tific
a
t
e
_
n
a
m
e
s
sl_
c
e
r
tific
a
t
e
_
k
e
y_v
a
ult_
s
e
c
r
e
t_id
s
sl_
p
r
o
file
_
n
a
m
e
s
s
sl_
p
r
o
file
_
t
r
u
s
t
e
d
_
r
o
o
t_
c
e
r
tific
a
t
e
_
n
a
m
e
s
s
sl_
p
r
o
file
_v
e
rify_
clie
n
t_
c
e
r
t_is
s
u
e
r_
d
n
s
sl_
p
r
o
file
_v
e
rify_
clie
n
t_
c
e
r
tific
a
t
e
_
r
e
v
o
c
a
tio
n
s
sl_
p
r
o
file
_
p
olic
y
s
sl_
p
olic
y_
t
y
p
e
s
sl_
p
olic
y_
n
a
m
e
s
sl_
p
olic
y_
cip
h
e
r_
s
uit
e
s
s
sl_
p
olic
y_
min
_
p
r
o
t
o
c
ol_v
e
r
sio
n
s
sl_
p
olic
y_
dis
a
ble
d
_
p
r
o
t
o
c
ols
t
r
u
s
t
e
d
_
r
o
o
t_
c
e
r
tific
a
t
e
_
n
a
m
e
t
r
u
s
t
e
d
_
r
o
o
t_
c
e
r
tific
a
t
e
_
k
e
y_v
a
ult_
s
e
c
r
e
t_id
t
r
u
s
t
e
d
_
r
o
o
t_
c
e
r
tific
a
t
e
_
d
a
t
a
t
r
u
s
t
e
d
_
clie
n
t_
c
e
r
tific
a
t
e
_
n
a
m
e
t
r
u
s
t
e
d
_
clie
n
t_
c
e
r
tific
a
t
e
_
d
a
t
a
a
u
t
h
e
n
tic
a
tio
n
_
c
e
r
tific
a
t
e
_
n
a
m
e
a
u
t
h
e
n
tic
a
tio
n
_
c
e
r
tific
a
t
e
_
d
a
t
a
c
u
s
t
o
m
_
e
r
r
o
r_
c
o
n
fig
u
r
a
tio
n
_
c
o
d
e
c
u
s
t
o
m
_
e
r
r
o
r_
c
o
n
fig
u
r
a
tio
n
_
u
rl outputs pip_not_scope dependency
/
C
O
R
E
/
N
E
T
W
O
R
K
m
o
d
ule
s inputs common
p
a
r
a
m
e
t
e
r
s log_analytics blob_backup_automa
tio
n
s
e
n
tin
el sandbox_
a
u
t
o
m
a
tio
n
s
a
n
d
b
o
x_
a
u
t
o
m
a
tio
n
_
s
e
t
tin
g
s
s
a
n
d
b
o
x_
a
u
t
o
m
a
tio
n
_
s
e
t
tin
g
s.in
s
t
a
n
c
e
_
0
0
1
s
a
n
d
b
o
x_
a
u
t
o
m
a
tio
n
_
d
e
f
a
ult_
p
r
o
p
e
r
tie
s
s
a
n
d
b
o
x_
a
u
t
o
m
a
tio
n
_
s
e
t
tin
g
s.in
s
t
a
n
c
e
_
0
0
1.d
e
f
a
ult_
p
r
o
p
e
r
tie
s
s
a
n
d
b
o
x_
a
u
t
o
m
a
tio
n
_
p
r
o
p
e
r
tie
s
s
a
n
d
b
o
x_
a
u
t
o
m
a
tio
n
_
s
e
t
tin
g
s.in
s
t
a
n
c
e
_
0
0
1.p
r
o
p
e
r
tie
s
s
a
n
d
b
o
x_
a
u
t
o
m
a
tio
n
_
a
p
p
_
s
e
rvic
e
s
a
n
d
b
o
x_
a
u
t
o
m
a
tio
n
_
s
e
t
tin
g
s.in
s
t
a
n
c
e
_
0
0
1.a
p
p
_
s
e
rvic
e
s
a
n
d
b
o
x_
a
u
t
o
m
a
tio
n
_
s
e
rv
e
r_f
a
r
m
s
s
a
n
d
b
o
x_
a
u
t
o
m
a
tio
n
_
s
e
t
tin
g
s.in
s
t
a
n
c
e
_
0
0
1.s
e
rv
e
r_f
a
r
m
s
s
a
n
d
b
o
x_
a
u
t
o
m
a
tio
n
_
s
t
o
r
a
g
e
_
a
c
c
o
u
n
t
s
a
n
d
b
o
x_
a
u
t
o
m
a
tio
n
_
s
e
t
tin
g
s.in
s
t
a
n
c
e
_
0
0
1.s
t
o
r
a
g
e
_
a
c
c
o
u
n
t
s
a
n
d
b
o
x_
a
u
t
o
m
a
tio
n
_
q
u
e
u
e
_
s
t
o
r
a
g
e
_
a
c
c
o
u
n
t
s
a
n
d
b
o
x_
a
u
t
o
m
a
tio
n
_
s
e
t
tin
g
s.in
s
t
a
n
c
e
_
0
0
1.q
u
e
u
e
_
s
t
o
r
a
g
e
_
a
c
c
o
u
n
t light_house light_house_settings light_house_settings.instance_001 light_house_server_farms light_house_settings.instance_001.server_farms light_house_function_app light_house_settings.instance_001.function_app light_house_storage_account light_house_settings.instance_001.storage_account estate_helper service_health_alerting service_health_settings service_health_alerting_settings ipamipam_settings ipam_settings.instance_001 ipam_supernet ipam_settings.instance_001.supernet ipam_server_farms ipam_settings.instance_001.server_farms ipam_app_service ipam_settings.instance_001.app_service ipam_secure_storage_account ipam_settings.instance_001.secure_storage_account ipam_azure_storage_account ipam_settings.instance_001.azure_storage_account ipam_aws_storage_account ipam_settings.instance_001.aws_storage_account ipam_gcp_storage_account ipam_settings.instance_001.gcp_storage_account subscription_budget subscription_budget_settings subscription_budget_settings.instance_001 subscription_budget_server_farms subscription_budget_settings.instance_001.server_farms subscription_budget_app_service subscription_budget_settings.instance_001.app_service subscription_budget_secure_storage_account subscription_budget_settings.instance_001.secure_storage_account platform_change_alerting platform_change_alert_settings platform_change_alert_exclusions platform_change_alert_settings.exclusions monitoring monitoring_settings monitoring_workspace_vm_insights monitoring_settings.vm_insights monitoring_workspace_security_solution monitoring_settings.security_solution monitoring_workspace_action_groups
1
3
/
4
5
4
2
9
7
2
9
8
2
9
8
2
9
8
2
9
8
2
9
8
2
9
8
2
9
8
2
9
8
2
9
9
2
9
9
2
9
9
2
9
9
2
9
9
2
9
9
3
0
0
3
0
0
3
0
0
3
0
0
3
0
1
3
0
1
3
0
1
3
0
1
3
0
2
3
0
2
3
0
2
3
0
2
3
0
3
3
0
3
3
0
3
3
0
3
3
0
4
3
0
4
3
0
4
3
0
4
3
0
5
3
0
5
3
0
5
3
0
5
3
0
5
3
0
5
3
0
6
3
0
6
3
0
6
3
0
6
3
0
6
3
0
6
3
0
6
3
0
6
3
0
6
3
0
7
3
0
7
3
0
7
3
0
7
3
0
7
3
0
7
3
0
7
3
0
7
3
0
7
3
0
8
3
0
8
3
0
8
3
0
8
3
0
8
3
0
8
3
0
8
3
0
8
3
0
8
3
0
9
3
0
9
3
0
9
3
0
9
3
0
9
3
0
9
3
0
9
3
0
9
3
1
0
3
1
0
3
1
0
3
1
0
3
1
0
3
1
0
3
1
0
3
1
0
3
1
1
3
1
1
3
1
1
3
1
1
3
1
1
3
1
1
3
1
1
3
1
1
3
1
1
3
1
2
3
1
2
3
1
2
3
1
2
3
1
2
3
1
2
3
1
2
3
1
2
3
1
3
3
1
3
3
1
3
3
1
3
3
1
3
3
1
3
3
1
3
3
1
3
3
1
4
3
1
4
3
1
4
3
1
4
3
1
4
3
1
4
3
1
4
3
1
5
m
o
nit
o
rin
g
_
s
e
t
tin
g
s.a
c
tio
n
_
g
r
o
u
p
s
m
o
nit
o
rin
g
_w
o
r
k
s
p
a
c
e
_
d
c
r_
d
a
t
a
_
s
o
u
r
c
e
s
m
o
nit
o
rin
g
_
s
e
t
tin
g
s.d
c
r_
d
a
t
a
_
s
o
u
r
c
e
s.win
d
o
w
s
m
o
nit
o
rin
g
_
s
e
t
tin
g
s.d
c
r_
d
a
t
a
_
s
o
u
r
c
e
s.lin
u
x
a
u
t
o
m
a
tio
n
_
a
c
c
o
u
n
t
a
u
t
o
m
a
tio
n
_
a
c
c
o
u
n
t_
s
e
t
tin
g
s
a
u
t
o
m
a
tio
n
_
a
c
c
o
u
n
t_
s
e
t
tin
g
s.in
s
t
a
n
c
e
_
0
0
1
a
u
t
o
m
a
tio
n
_
a
c
c
o
u
n
t_
c
o
n
fig
u
r
a
tio
n
_
m
a
n
a
g
e
m
e
n
t_
r
b
a
c
a
u
t
o
m
a
tio
n
_
a
c
c
o
u
n
t_
s
e
t
tin
g
s.in
s
t
a
n
c
e
_
0
0
1.c
o
n
fig
u
r
a
tio
n
_
m
a
n
a
g
e
m
e
n
t_
r
b
a
c
v
m
_
c
h
a
n
g
e
_
t
r
a
c
kin
g
v
m
_
c
h
a
n
g
e
_
t
r
a
c
kin
g
_
s
e
t
tin
g
s
c
h
a
n
g
e
_
t
r
a
c
k_win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g.e
x
t
e
n
sio
n
_
s
e
t
tin
g
s
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g.r
e
gis
t
r
y_in
fo.S
h
ellIc
o
n
O
v
e
rla
yId
e
n
tifie
r
s
_
0
1
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g.r
e
gis
t
r
y_in
fo.K
n
o
w
n
Dlls
_
0
2
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g.r
e
gis
t
r
y_in
fo.E
x
t
e
n
sio
n
s
_
0
3
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g.r
e
gis
t
r
y_in
fo.B
r
o
w
s
e
r_
H
elp
e
r_
O
bj
e
c
t
s
_
0
4
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g.r
e
gis
t
r
y_in
fo.S
h
ellIc
o
n
O
v
e
rla
yId
e
n
tifie
r
s
_
0
5
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g.r
e
gis
t
r
y_in
fo.C
o
n
t
e
x
t
M
e
n
u
H
a
n
dle
r
s
_
0
6
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g.r
e
gis
t
r
y_in
fo.C
o
n
t
e
x
t
M
e
n
u
H
a
n
dle
r
s
_
0
7
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g.r
e
gis
t
r
y_in
fo.S
h
u
t
d
o
w
n
_
0
8
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g.r
e
gis
t
r
y_in
fo.S
t
a
r
t
u
p
_
0
9
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g.r
e
gis
t
r
y_in
fo.E
x
t
e
n
sio
n
s
_
1
0
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g.r
e
gis
t
r
y_in
fo.D
riv
e
r
s
3
2
_
1
1
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g.r
e
gis
t
r
y_in
fo.C
o
p
y
H
o
o
k
H
a
n
dle
r
s
_
1
2
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g.r
e
gis
t
r
y_in
fo.R
u
n
_
1
3
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g.r
e
gis
t
r
y_in
fo.B
r
o
w
s
e
r_
H
elp
e
r_
O
bj
e
c
t
s
_x
6
4
_
1
4
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g.r
e
gis
t
r
y_in
fo.D
riv
e
r
s
3
2
_x
6
4
_
1
5
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g.r
e
gis
t
r
y_in
fo.In
s
t
alle
d
_
C
o
m
p
o
n
e
n
t
s
_
1
6
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g.r
e
gis
t
r
y_in
fo.N
o
tify_
1
7
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g.file
_in
fo.Win
d
o
w
s
_
h
o
s
t
s
_file
_
0
1
c
h
a
n
g
e
_
t
r
a
c
k_lin
u
x_
c
h
a
n
g
e
_
t
r
a
c
kin
g linux_change_tracking.extension_settin
g
s linux_change_tracking.file_info.Linux_hos
t
s
_file
_
0
1 linux_change_tracking.file_info.Linux_conf_files_02
v
m
_
m
a
n
a
g
e
m
e
n
t
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.3
-
t
u
e
s
d
a
y
-
0
2
0
0
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
0
3
_
t
u
e
_
0
2
_
m
ain
t
e
n
a
n
c
e
_win
d
o
w
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.3
-
t
u
e
s
d
a
y
-
0
2
0
0.m
ain
t
e
n
a
n
c
e
_win
d
o
w
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
0
3
_
t
u
e
_
0
2
_in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.3
-
t
u
e
s
d
a
y
-
0
2
0
0.in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.3
-
t
u
e
s
d
a
y
-
1
2
0
0
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
0
3
_
t
u
e
_
1
2
_
m
ain
t
e
n
a
n
c
e
_win
d
o
w
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.3
-
t
u
e
s
d
a
y
-
1
2
0
0.m
ain
t
e
n
a
n
c
e
_win
d
o
w
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
0
3
_
t
u
e
_
1
2
_in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.3
-
t
u
e
s
d
a
y
-
1
2
0
0.in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.3
-
t
u
e
s
d
a
y
-
1
9
0
0
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
0
3
_
t
u
e
_
1
9
_
m
ain
t
e
n
a
n
c
e
_win
d
o
w
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.3
-
t
u
e
s
d
a
y
-
1
9
0
0.m
ain
t
e
n
a
n
c
e
_win
d
o
w
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
0
3
_
t
u
e
_
1
9
_in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.3
-
t
u
e
s
d
a
y
-
1
9
0
0.in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.4
-
t
u
e
s
d
a
y
-
0
2
0
0
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
0
4
_
t
u
e
_
0
2
_
m
ain
t
e
n
a
n
c
e
_win
d
o
w
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.4
-
t
u
e
s
d
a
y
-
0
2
0
0.m
ain
t
e
n
a
n
c
e
_win
d
o
w
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
0
4
_
t
u
e
_
0
2
_in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.4
-
t
u
e
s
d
a
y
-
0
2
0
0.in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.4
-
t
u
e
s
d
a
y
-
1
2
0
0
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
0
4
_
t
u
e
_
1
2
_
m
ain
t
e
n
a
n
c
e
_win
d
o
w
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.4
-
t
u
e
s
d
a
y
-
1
2
0
0.m
ain
t
e
n
a
n
c
e
_win
d
o
w
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
0
4
_
t
u
e
_
1
2
_in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.4
-
t
u
e
s
d
a
y
-
1
2
0
0.in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.4
-
t
u
e
s
d
a
y
-
1
9
0
0
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
0
4
_
t
u
e
_
1
9
_
m
ain
t
e
n
a
n
c
e
_win
d
o
w
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.4
-
t
u
e
s
d
a
y
-
1
9
0
0.m
ain
t
e
n
a
n
c
e
_win
d
o
w
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
0
4
_
t
u
e
_
1
9
_in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.4
-
t
u
e
s
d
a
y
-
1
9
0
0.in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.d
c
-
3
-
t
u
e
s
d
a
y
-
0
2
0
0
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
d
c_
0
3
_
t
u
e
_
0
2
_
m
ain
t
e
n
a
n
c
e
_win
d
o
w
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.d
c
-
3
-
t
u
e
s
d
a
y
-
0
2
0
0.m
ain
t
e
n
a
n
c
e
_win
d
o
w
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
d
c_
0
3
_
t
u
e
_
0
2
_in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.d
c
-
3
-
t
u
e
s
d
a
y
-
0
2
0
0.in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.d
c
-
3
-
w
e
d
n
e
s
d
a
y
-
0
2
0
0
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
d
c_
0
3
_w
e
d
_
0
2
_
m
ain
t
e
n
a
n
c
e
_win
d
o
w
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.d
c
-
3
-
w
e
d
n
e
s
d
a
y
-
0
2
0
0.m
ain
t
e
n
a
n
c
e
_win
d
o
w
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
d
c_
0
3
_w
e
d
_
0
2
_in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.d
c
-
3
-
w
e
d
n
e
s
d
a
y
-
0
2
0
0.in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.s
h
a
r
e
d
s
e
rvic
e
s
-
3
-
t
u
e
s
d
a
y
-
0
2
0
0
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
s
s
_
0
3
_
t
u
e
_
0
2
_
m
ain
t
e
n
a
n
c
e
_win
d
o
w
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.s
h
a
r
e
d
s
e
rvic
e
s
-
3
-
t
u
e
s
d
a
y
-
0
2
0
0.m
ain
t
e
n
a
n
c
e
_win
d
o
w
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
s
s
_
0
3
_
t
u
e
_
0
2
_in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.s
h
a
r
e
d
s
e
rvic
e
s
-
3
-
t
u
e
s
d
a
y
-
0
2
0
0.in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.s
h
a
r
e
d
s
e
rvic
e
s
-
3
-
w
e
d
n
e
s
d
a
y
-
0
2
0
0
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
s
s
_
0
3
_w
e
d
_
0
2
_
m
ain
t
e
n
a
n
c
e
_win
d
o
w
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.s
h
a
r
e
d
s
e
rvic
e
s
-
3
-
w
e
d
n
e
s
d
a
y
-
0
2
0
0.m
ain
t
e
n
a
n
c
e
_win
d
o
w
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
s
s
_
0
3
_w
e
d
_
0
2
_in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.s
h
a
r
e
d
s
e
rvic
e
s
-
3
-
w
e
d
n
e
s
d
a
y
-
0
2
0
0.in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.a
p
p
-
3
-
t
u
e
s
d
a
y
-
0
2
0
0
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
a
p
p
_
0
3
_
t
u
e
_
0
2
_
m
ain
t
e
n
a
n
c
e
_win
d
o
w
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.a
p
p
-
3
-
t
u
e
s
d
a
y
-
0
2
0
0.m
ain
t
e
n
a
n
c
e
_win
d
o
w
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
a
p
p
_
0
3
_
t
u
e
_
0
2
_in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.a
p
p
-
3
-
t
u
e
s
d
a
y
-
0
2
0
0.in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.a
p
p
-
3
-
t
u
e
s
d
a
y
-
1
2
0
0
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
a
p
p
_
0
3
_
t
u
e
_
1
2
_
m
ain
t
e
n
a
n
c
e
_win
d
o
w
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.a
p
p
-
3
-
t
u
e
s
d
a
y
-
1
2
0
0.m
ain
t
e
n
a
n
c
e
_win
d
o
w
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
a
p
p
_
0
3
_
t
u
e
_
1
2
_in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.a
p
p
-
3
-
t
u
e
s
d
a
y
-
1
2
0
0.in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.a
p
p
-
3
-
t
u
e
s
d
a
y
-
1
9
0
0
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
a
p
p
_
0
3
_
t
u
e
_
1
9
_
m
ain
t
e
n
a
n
c
e
_win
d
o
w
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.a
p
p
-
3
-
t
u
e
s
d
a
y
-
1
9
0
0.m
ain
t
e
n
a
n
c
e
_win
d
o
w
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
a
p
p
_
0
3
_
t
u
e
_
1
9
_in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.a
p
p
-
3
-
t
u
e
s
d
a
y
-
1
9
0
0.in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.a
p
p
-
4
-
t
u
e
s
d
a
y
-
0
2
0
0
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
a
p
p
_
0
4
_
t
u
e
_
0
2
_
m
ain
t
e
n
a
n
c
e
_win
d
o
w
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.a
p
p
-
4
-
t
u
e
s
d
a
y
-
0
2
0
0.m
ain
t
e
n
a
n
c
e
_win
d
o
w
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
a
p
p
_
0
4
_
t
u
e
_
0
2
_in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.a
p
p
-
4
-
t
u
e
s
d
a
y
-
0
2
0
0.in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.a
p
p
-
4
-
t
u
e
s
d
a
y
-
1
9
0
0
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
a
p
p
_
0
4
_
t
u
e
_
1
9
_
m
ain
t
e
n
a
n
c
e
_win
d
o
w
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.a
p
p
-
4
-
t
u
e
s
d
a
y
-
1
9
0
0.m
ain
t
e
n
a
n
c
e
_win
d
o
w
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
a
p
p
_
0
4
_
t
u
e
_
1
9
_in
s
t
all_
p
a
t
c
h
e
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
s
e
t
tin
g
s.m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s.a
p
p
-
4
-
t
u
e
s
d
a
y
-
1
9
0
0.in
s
t
all_
p
a
t
c
h
e
s
L
A
S
T
A
P
P
LIE
D
C
O
N
FIG
U
R
A
TIO
N
o
u
t
p
u
t
s
m
a
n
a
g
e
m
e
n
t_
o
u
t
p
u
t
s ipam_endpoints
1
4
/
4
5
4
315
315
315
315
315
315
316
316
316
316
316
317
317
317
317
317
317
317
317
317
318
318
318
318
318
318
318
318
318
318
318
318
318
318
319
319
319
319
319
319
319
319
319
319
319
319
319
320
320
320
320
320
320
320
320
320
320
320
320
321
321
321
321
321
321
321
321
321
321
321
321
322
322
322
322
322
322
322
322
322
322
322
322
322
322
323
323
323
323
323
323
323
323
323
323
323
323
323
323
324
324
324
324
324
324
324
324
324
324
324
324
325
315
ipam_token - the primary key for the IPAM function (sensitive value) being used to authenticate the IPAM function (in the Application Landing Zone Blueprint)
input descriptions
instance
append_tags
log_analytics
log_analytics_enabled
log_analytics_workspace_name
log_analytics_workspace_sku
blob_backup_automation
blob_backup_enable
blob_backup_function_name
blob_backup_management_group_id_scope
sentinel
sentinel_enabled
sandbox_automation
sandbox_automation_enabled
sandbox_automation_instance_enabled
sandbox_automation_location
sandbox_automation_location_short
sandbox_automation_rg_name
sandbox_automation_custom_service_name
sandbox_automation_service_plan_name
sandbox_automation_app_insights_name
sandbox_automation_vnet_name
sandbox_automation_nsg_name
sandbox_automation_snet_name
sandbox_automation_cis_compliant
sandbox_automation_log_analytics_workspace_id
sandbox_automation_vnet_address_prefixes
sandbox_automation_snet_address_prefixes
sandbox_automation_settings_default_properties
default_properties_rg_delete_cron
default_properties_vm_shutdown_cron
default_properties_sub_disable_cron
default_properties_sub_auto_enabled
default_properties_vm_auto_enabled
default_properties_rg_auto_enabled
default_properties_decommissioned_mgmt_group_name
default_properties_rg_delete_tag_name
default_properties_rg_delete_days
default_properties_vm_shutdown_default
default_properties_vm_shutdown_tag
default_properties_vm_startup_tag
default_properties_vm_disable_shutdown_tag
default_properties_hostile_delete_rg
default_properties_protected_rg_list
default_properties_sub_disable_tag_name
default_properties_sub_disable_days
default_properties_protected_sub_list
default_properties_force_disable_sub
sandbox_automation_settings_properties
properties_sub_auto_enabled
properties_sandbox_management_group_name
properties_vm_auto_enabled
properties_rg_auto_enabled
properties_rg_delete_tagname
properties_rg_delete_days
properties_rg_delete_cron
properties_vm_shutdown_cron
properties_vm_shutdown_default
properties_vm_shutdown_tag
properties_vm_startup_tag
properties_vm_disable_shutdown_tag
properties_hostile_delete_rg
properties_protected_rg_list
app_service
app_service_name
app_service_client_cert_enabled
app_service_http2_enabled
server_farms
server_farms_sku
server_farms_cis_sku
storage_account
storage_account_name
storage_account_tier
storage_account_replication
storage_account_supports_https_traffic_only
storage_account_allow_blob_public_access
storage_account_network_acls_bypass
storage_account_network_acls_default_action
storage_account_network_acls_virtual_network_rules
storage_account_network_acls_ip_rules
light_house
light_house_enabled
light_house_instance_enabled
light_house_location
light_house_location_short
light_house_rg_name
light_house_custom_service_name
light_house_service_plan_name
light_house_app_insights_name
light_house_vnet_name
light_house_nsg_name
light_house_snet_name
light_house_cis_compliant
light_house_management_goup_id_scope
light_house_msp_offer_name
light_house_msp_offer_description
light_house_managed_by_tenant_id
light_house_principal_id
light_house_role_definition_id
light_house_principal_id_display_name
light_house_excluded_tag_name
light_house_excluded_tag_value
light_house_vnet_address_prefixes
light_house_snet_address_prefixes
light_house_snet_endpoints
light_house_log_analytics_workspace_id
function_app
function_app_name
function_app_identity_type
function_app_https_only
function_app_client_certificate_enabled
15/454
3
2
5
3
2
5
3
2
5
3
2
5
3
2
5
3
2
5
3
2
5
3
2
5
3
2
5
3
2
5
3
2
5
3
2
5
3
2
5
3
2
5
3
2
6
3
2
6
3
2
6
3
2
6
3
2
6
3
2
6
3
2
6
3
2
6
3
2
6
3
2
6
3
2
6
3
2
6
3
2
7
3
2
7
3
2
7
3
2
7
3
2
7
3
2
7
3
2
7
3
2
7
3
2
7
3
2
7
3
2
7
3
2
7
3
2
7
3
2
7
3
2
8
3
2
8
3
2
8
3
2
8
3
2
8
3
2
8
3
2
8
3
2
8
3
2
8
3
2
8
3
2
9
3
2
9
3
2
9
3
2
9
3
2
9
3
2
9
3
2
9
3
2
9
3
2
9
3
2
9
3
2
9
3
2
9
3
2
9
3
3
0
3
3
0
3
3
0
3
3
0
3
3
0
3
3
0
3
3
0
3
3
0
3
3
0
3
3
0
3
3
0
3
3
0
3
3
0
3
3
1
3
3
1
3
3
1
3
3
1
3
3
1
3
3
1
3
3
1
3
3
1
3
3
1
3
3
1
3
3
1
3
3
1
3
3
2
3
3
2
3
3
2
3
3
2
3
3
2
3
3
2
3
3
2
3
3
2
3
3
2
3
3
2
3
3
2
3
3
2
3
3
2
3
3
2
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
3
4
3
3
4
f
u
n
c
tio
n
_
a
p
p
_
clie
n
t_
c
e
r
tific
a
t
e
_
m
o
d
e
f
u
n
c
tio
n
_
a
p
p
_
a
u
t
h
_
s
e
t
tin
g
s
f
u
n
c
tio
n
_
a
p
p
_
h
t
t
p
2
_
e
n
a
ble
d
f
u
n
c
tio
n
_
a
p
p
_ft
p
s
_
s
t
a
t
e
f
u
n
c
tio
n
_
a
p
p
_
minim
u
m
_
tls
_
v
e
r
sio
n
f
u
n
c
tio
n
_
a
p
p
_
s
c
ale
_limit
f
u
n
c
tio
n
s
_
e
x
t
e
n
sio
n
_
v
e
r
sio
n
e
s
t
a
t
e
_
h
elp
e
r
e
s
t
a
t
e
_
h
elp
e
r_
e
n
a
ble
d
e
s
t
a
t
e
_
h
elp
e
r_
r
g
_
n
a
m
e
e
s
t
a
t
e
_
h
elp
e
r_
k
v_
n
a
m
e
e
s
t
a
t
e
_
h
elp
e
r_
k
v_
s
h
o
r
t_
n
a
m
e
e
s
t
a
t
e
_
h
elp
e
r_
k
v_
k
e
k_
e
x
pir
y_
d
a
y
s
e
s
t
a
t
e
_
h
elp
e
r_
k
v_
e
n
a
ble
_
p
u
r
g
e
_
p
r
o
t
e
c
tio
n
e
s
t
a
t
e
_
h
elp
e
r_
k
v_
e
n
a
ble
d
_fo
r_
d
e
plo
y
m
e
n
t
e
s
t
a
t
e
_
h
elp
e
r_
k
v_
e
n
a
ble
d
_fo
r_
t
e
m
pla
t
e
_
d
e
plo
y
m
e
n
t
e
s
t
a
t
e
_
h
elp
e
r_
k
v_
e
n
a
ble
d
_fo
r_
dis
k_
e
n
c
r
y
p
tio
n
e
s
t
a
t
e
_
h
elp
e
r_
k
v_
e
n
a
ble
_
r
b
a
c_
a
u
t
h
o
riz
a
tio
n
e
s
t
a
t
e
_
h
elp
e
r_
k
v_
s
k
u
e
s
t
a
t
e
_
h
elp
e
r_
k
v_
p
e
r
mis
sio
n
s
e
s
t
a
t
e
_
h
elp
e
r_
k
v_
a
c
c
e
s
s
_
p
olicie
s
e
s
t
a
t
e
_
h
elp
e
r_
k
v_
n
e
t
w
o
r
k_
a
cls
_
b
y
p
a
s
s
e
s
t
a
t
e
_
h
elp
e
r_
k
v_
n
e
t
w
o
r
k_
a
cls
_
d
e
f
a
ult_
a
c
tio
n
e
s
t
a
t
e
_
h
elp
e
r_
k
v_
n
e
t
w
o
r
k_
a
cls
_vir
t
u
al_
n
e
t
w
o
r
k_
r
ule
s
e
s
t
a
t
e
_
h
elp
e
r_
k
v_
n
e
t
w
o
r
k_
a
cls
_ip
_
r
ule
s
e
s
t
a
t
e
_
h
elp
e
r_
s
p
n
_
n
a
m
e
e
s
t
a
t
e
_
h
elp
e
r_id
e
n
tifie
r_
u
ris
e
s
t
a
t
e
_
h
elp
e
r_
d
e
plo
y
m
e
n
t_
a
r
c
hit
e
c
t_
o
bj
e
c
t_id
e
s
t
a
t
e
_
h
elp
e
r_
a
p
plic
a
tio
n
_
p
a
s
s
w
o
r
d
_
e
x
pir
y
e
s
t
a
t
e
_
h
elp
e
r_
r
o
t
a
t
e
_
a
p
plic
a
tio
n
_
p
a
s
s
w
o
r
d
e
s
t
a
t
e
_
h
elp
e
r_
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_
a
s
sig
n
m
e
n
t
e
s
t
a
t
e
_
h
elp
e
r_
r
b
a
c_
r
ole
s
e
rvic
e
_
h
e
alt
h
_
ale
r
tin
g
s
e
rvic
e
_
h
e
alt
h
_
ale
r
tin
g
_
e
n
a
ble
d
s
e
rvic
e
_
h
e
alt
h
_
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_id
_
s
c
o
p
e
s
e
rvic
e
_
h
e
alt
h
_
a
c
tio
n
_
g
r
o
u
p
_
n
a
m
e
s
e
rvic
e
_
h
e
alt
h
_
m
o
nit
o
r
e
d
_
r
e
gio
n
s
s
e
rvic
e
_
h
e
alt
h
_
ale
r
t_
n
a
m
e
s
e
rvic
e
_
h
e
alt
h
_
r
e
s
o
u
r
c
e
_
g
r
o
u
p
s
e
rvic
e
_
h
e
alt
h
_
e
m
ail_
r
e
c
eiv
e
r
s
s
e
rvic
e
_
h
e
alt
h
_w
e
b
h
o
o
k_
r
e
c
eiv
e
r
s
_w
a
r
nin
g
_
e
n
a
ble
d
s
e
rvic
e
_
h
e
alt
h
_w
e
b
h
o
o
k_
r
e
c
eiv
e
r
s
_w
a
r
nin
g
_
p
r
o
p
e
r
tie
s ipamipam_enabled ipam_instance_enabled ipam_location ipam_location_short ipam_rg_name ipam_custom_service_name ipam_service_plan_name ipam_app_insights_name ipam_vnet_name ipam_nsg_name ipam_snet_name ipam_cis_compliant ipam_supernet_table_name ipam_network_table_name ipam_subnet_table_name ipam_azure_enabled ipam_aws_enabled ipam_gcp_enabled ipam_ip_security_restrictions ipam_ip_security_restrictions_allow ipam_vnet_address_prefixes ipam_snet_address_prefixes ipam_log_analytics_workspace_id supernet supernet_azure subscription_budget subscription_budget_enabled subscription_budget_instance_enabled subscription_budget_location subscription_budget_location_short subscription_budget_rg_name subscription_budget_custom_service_name subscription_budget_service_plan_name subscription_budget_app_insights_name subscription_budget_vnet_name subscription_budget_nsg_name subscription_budget_snet_name subscription_budget_cis_compliant subscription_budget_management_group_id_scope subscription_budget_tenant_id subscription_budget_contact_tag_name subscription_budget_budget_tag_name subscription_budget_threshold_tag_name subscription_budget_budgets subscription_budget_budgets_value subscription_budget_vnet_address_prefixes subscription_budget_snet_address_prefixes subscription_budget_log_analytics_workspace_id platform_change_alerting platform_change_alerting_enabled platform_change_alert_rg_name platform_change_alert_action_group_name platform_change_alert_platform_change_alert_name platform_change_alert_evaluation_frequency platform_change_alert_window_duration platform_change_alert_severity platform_change_alert_workspace_id platform_change_alert_scope_names platform_change_alert_email_receivers platform_change_alert_webhook_receivers_warning_en
a
ble
d
pla
t
fo
r
m
_
c
h
a
n
g
e
_
ale
r
t_w
e
b
h
o
o
k_
r
e
c
eiv
e
r
s
_w
a
r
nin
g
_
p
r
o
p
e
r
tie
s
pla
t
fo
r
m
_
c
h
a
n
g
e
_
ale
r
t_
s
e
t
tin
g
s
_
e
x
clu
sio
n
s
e
x
clu
sio
n
s
_
o
p
e
r
a
tio
n
_
n
a
m
e
_v
alu
e
s
e
x
clu
sio
n
s
_
o
p
e
r
a
tio
n
_
n
a
m
e
_
v
alu
e
s
_
d
e
f
a
ult
e
x
clu
sio
n
s
_
s
u
b
s
c
rip
tio
n
_id
s
e
x
clu
sio
n
s
_
r
e
s
o
u
r
c
e
_id
s
e
x
clu
sio
n
s
_
r
e
s
o
u
r
c
e
_
g
r
o
u
p
s
m
o
nit
o
rin
g
1
6
/
4
5
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
5
3
3
5
3
3
5
3
3
5
3
3
5
3
3
5
3
3
5
3
3
5
3
3
5
3
3
5
3
3
5
3
3
6
3
3
6
3
3
6
3
3
6
3
3
6
3
3
6
3
3
6
3
3
7
3
3
7
3
3
7
3
3
7
3
3
7
3
3
7
3
3
7
3
3
7
3
3
7
3
3
7
3
3
7
3
3
7
3
3
8
3
3
8
3
3
8
3
3
8
3
3
8
3
3
8
3
3
8
3
3
8
3
3
8
3
3
8
3
3
8
3
3
8
3
3
8
3
3
8
3
3
8
3
3
9
3
3
9
3
3
9
3
3
9
3
3
9
3
3
9
3
3
9
3
3
9
3
3
9
3
3
9
3
3
9
3
3
9
3
3
9
3
3
9
3
4
0
3
4
0
3
4
0
3
4
0
3
4
0
3
4
0
3
4
0
3
4
0
3
4
0
3
4
0
3
4
0
3
4
0
3
4
0
3
4
0
3
4
1
3
4
1
3
4
1
3
4
1
3
4
1
3
4
1
3
4
1
3
4
1
3
4
1
3
4
1
3
4
1
3
4
1
3
4
1
3
4
1
3
4
2
3
4
2
3
4
2
3
4
2
3
4
2
3
4
2
3
4
2
3
4
2
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
4
m
o
nit
o
rin
g
_
e
n
a
ble
d
m
o
nit
o
rin
g
_
r
g
_
n
a
m
e
_lo
g
gin
g
m
o
nit
o
rin
g
_lo
g
_
a
n
aly
tic
s
_w
o
r
k
s
p
a
c
e
_id
m
o
nit
o
rin
g
_w
o
r
k
s
p
a
c
e
_f
rie
n
dly_
n
a
m
e
m
o
nit
o
rin
g
_
e
m
ail_
r
e
c
eiv
e
r
s
_
d
e
f
a
ult
m
o
nit
o
rin
g
_
e
m
ail_
r
e
c
eiv
e
r
s
_
c
ritic
al monitoring_webhook_receivers_criticial_
e
n
a
ble
d
m
o
nit
o
rin
g
_w
e
b
h
o
o
k_
r
e
c
eiv
e
r
s
_
c
ritic
al_
p
r
o
p
e
r
tie
s
m
o
nit
o
rin
g
_w
e
b
h
o
o
k_
r
e
c
eiv
e
r
s
_w
a
r
nin
g
_
e
n
a
ble
d
m
o
nit
o
rin
g
_w
e
b
h
o
o
k_
r
e
c
eiv
e
r
s
_w
a
r
nin
g
_
p
r
o
p
e
r
tie
s
m
o
nit
o
rin
g
_v
m
_in
sig
h
t
s
v
m
_in
sig
h
t
s
_
e
n
a
ble
d
v
m
_in
sig
h
t
s
_
v
mi_
d
c
r_
s
u
ffix
m
o
nit
o
rin
g
_
s
e
c
u
rit
y_
s
olu
tio
n
s
e
c
u
rit
y_
s
olu
tio
n
_
e
n
a
ble
d
s
e
c
u
rit
y_
s
olu
tio
n
_
s
e
c
u
rit
y_
d
c
r_
s
u
ffix
m
o
nit
o
rin
g
_
a
c
tio
n
_
g
r
o
u
p
s
a
c
tio
n
_
g
r
o
u
p
s
_
g
r
o
u
p
_
s
h
o
r
t_
n
a
m
e
_
c
ritic
al action_groups_enabled_critical action_groups_enabled_warning action_groups_group_short_name_warnin
g
m
o
nit
o
rin
g
_
d
c
r
d
c
r_
e
n
a
ble
d
d
c
r_
n
a
m
e
d
c
r_
kin
d
d
c
r_
d
a
t
a
_
s
o
u
r
c
e
s
d
c
r_
s
t
r
e
a
m
s
a
u
t
o
m
a
tio
n
_
a
c
c
o
u
n
t
a
u
t
o
m
a
tio
n
_
a
c
c
o
u
n
t_
e
n
a
ble
d
a
u
t
o
m
a
tio
n
_
a
c
c
o
u
n
t_in
s
t
a
n
c
e
_
e
n
a
ble
d
a
u
t
o
m
a
tio
n
_
a
c
c
o
u
n
t_lo
c
a
tio
n
a
u
t
o
m
a
tio
n
_
a
c
c
o
u
n
t_lo
c
a
tio
n
_
s
h
o
r
t
a
u
t
o
m
a
tio
n
_
a
c
c
o
u
n
t_
r
g
_
n
a
m
e
a
u
t
o
m
a
tio
n
_
a
c
c
o
u
n
t_
a
u
t
o
m
a
tio
n
_
a
c
c
o
u
n
t_
n
a
m
e
a
u
t
o
m
a
tio
n
_
a
c
c
o
u
n
t_
u
plo
a
d
_
r
u
n
_
b
o
o
k
s
a
u
t
o
m
a
tio
n
_
a
c
c
o
u
n
t_
c
o
n
fig
u
r
a
tio
n
_
m
a
n
a
g
e
m
e
n
t_
r
b
a
c
r
b
a
c_
e
n
a
ble
d
r
b
a
c_
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_
n
a
m
e
r
b
a
c_
r
ole
_
d
e
finitio
n
_
n
a
m
e
v
m
_
c
h
a
n
g
e
_
t
r
a
c
kin
g
v
m
_
c
h
a
n
g
e
_
t
r
a
c
kin
g
_
e
n
a
ble
d
c
h
a
n
g
e
_
t
r
a
c
k_
r
g
_
n
a
m
e
c
h
a
n
g
e
_
t
r
a
c
k_lo
g
_
a
n
aly
tic
s
_w
o
r
k
s
p
a
c
e
_id
c
h
a
n
g
e
_
t
r
a
c
k_
d
c
r_
s
u
ffix
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g
_win
d
o
w
s
_
e
x
t
e
n
sio
n
win
d
o
w
s
_
e
x
t
e
n
sio
n
_
e
n
a
ble
_file
s
win
d
o
w
s
_
e
x
t
e
n
sio
n
_
e
n
a
ble
_
s
o
ft
w
a
r
e
win
d
o
w
s
_
e
x
t
e
n
sio
n
_
e
n
a
ble
_
r
e
gis
t
r
y
win
d
o
w
s
_
e
x
t
e
n
sio
n
_
e
n
a
ble
_
s
e
rvic
e
s
win
d
o
w
s
_
e
x
t
e
n
sio
n
_
e
n
a
ble
_in
v
e
n
t
o
r
y
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g
_win
d
o
w
s
_
r
e
gis
t
r
y_in
fo
win
d
o
w
s
_
r
e
gis
t
r
y_in
fo
_
n
a
m
e
win
d
o
w
s
_
r
e
gis
t
r
y_in
fo
_
g
r
o
u
p
t
a
g
win
d
o
w
s
_
r
e
gis
t
r
y_in
fo
_
e
n
a
ble
d
win
d
o
w
s
_
r
e
gis
t
r
y_in
fo
_
r
e
c
u
r
s
e
win
d
o
w
s
_
r
e
gis
t
r
y_in
fo
_
d
e
s
c
rip
tio
n
win
d
o
w
s
_
r
e
gis
t
r
y_in
fo
_
k
e
y
n
a
m
e
win
d
o
w
s
_
r
e
gis
t
r
y_in
fo
_
v
alu
e
n
a
m
e
win
d
o
w
s
_
c
h
a
n
g
e
_
t
r
a
c
kin
g
_win
d
o
w
s
_file
_in
fo
win
d
o
w
s
_file
_in
fo
_
n
a
m
e
win
d
o
w
s
_file
_in
fo
_
e
n
a
ble
d
win
d
o
w
s
_file
_in
fo
_
d
e
s
c
rip
tio
n
win
d
o
w
s
_file
_in
fo
_
p
a
t
h
win
d
o
w
s
_file
_in
fo
_
r
e
c
u
r
s
e
win
d
o
w
s
_file
_in
fo
_
m
a
x
c
o
n
t
e
n
t
s
_
r
e
t
u
r
n
a
ble
win
d
o
w
s
_file
_in
fo
_
m
a
x
o
u
t
p
u
t_
siz
e
win
d
o
w
s
_file
_in
fo
_
c
h
e
c
k
s
u
m
win
d
o
w
s
_file
_in
fo
_
p
a
t
h
t
y
p
e
win
d
o
w
s
_file
_in
fo
_
g
r
o
u
p
t
a
g linux_change_tracking_lin
u
x_
e
x
t
e
n
sio
n linux_extension_enable_files linux_extension_enable_software linux_extension_enable_services linux_extension_enable_inventory linux_change_tracking_linux_file_info linux_file_info_name linux_file_info_enabled linux_file_info_destination_path linux_file_info_use_sudo linux_file_info_recurse linux_file_info_maxcontents_returnable linux_file_info_path_type linux_file_info_type linux_file_info_links linux_file_info_max_output_size linux_file_info_group_tag
v
m
_
m
a
n
a
g
e
m
e
n
t
v
m
_
m
a
n
a
g
e
m
e
n
t_
e
n
a
ble
d
v
m
_
m
a
n
a
g
e
m
e
n
t_
r
g
_
n
a
m
e
v
m
_
m
a
n
a
g
e
m
e
n
t_
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_id
_
s
c
o
p
e
v
m
_
m
a
n
a
g
e
m
e
n
t_
e
x
clu
d
e
_
s
u
b
s
c
rip
tio
n
s
v
m
_
m
a
n
a
g
e
m
e
n
t_
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
e
n
a
ble
d
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
n
a
m
e
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_
m
ain
t
e
n
a
n
c
e
_win
d
o
w
m
ain
t
e
n
a
n
c
e
_win
d
o
w_
s
t
a
r
t_
d
a
t
e
_
tim
e
m
ain
t
e
n
a
n
c
e
_win
d
o
w_
d
u
r
a
tio
n
m
ain
t
e
n
a
n
c
e
_win
d
o
w_
tim
e
_
z
o
n
e
m
ain
t
e
n
a
n
c
e
_win
d
o
w_
r
e
c
u
r_
e
v
e
r
y
m
ain
t
e
n
a
n
c
e
_
s
c
h
e
d
ule
s
_in
s
t
all_
p
a
t
c
h
e
s install_patches_reboot_setting install_patches_windows_settings install_patches_linux_settings
o
u
t
p
u
t
d
e
s
c
rip
tio
n
s
m
a
n
a
g
e
m
e
n
t_
o
u
t
p
u
t
s
w
o
r
k
s
p
a
c
e
_
r
e
s
o
u
r
c
e
_id
w
o
r
k
s
p
a
c
e
_
r
e
s
o
u
r
c
e
_
n
a
m
e
w
o
r
k
s
p
a
c
e
_
r
e
s
o
u
r
c
e
_
g
r
o
u
p
_
n
a
m
e ipam_function_name ipam_resource_group_name ipam_subscription_id action_group_name_warning action_group_name_critical action_group_id_warning action_group_id_critical dcr_name_linux
1
7
/
4
5
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
5
3
4
5
3
4
5
3
4
5
3
4
5
3
4
5
3
4
5
3
4
5
3
4
5
3
4
6
3
4
6
3
4
6
3
4
6
3
4
6
3
4
7
3
4
7
3
4
7
3
4
7
3
4
7
3
4
7
3
4
7
3
4
7
3
4
7
3
4
7
3
4
7
3
4
8
3
4
8
3
4
8
3
4
8
3
4
8
3
4
8
3
4
8
3
4
8
3
4
8
3
4
8
3
4
8
3
4
9
3
4
9
3
4
9
3
4
9
3
4
9
3
4
9
3
5
0
3
5
0
3
5
0
3
5
0
3
5
0
3
5
0
3
5
1
3
5
1
3
5
1
3
5
1
3
5
1
3
5
1
3
5
1
3
5
1
3
5
1
3
5
1
3
5
1
3
5
1
3
5
2
3
5
2
3
5
2
3
5
2
3
5
2
3
5
2
3
5
3
3
5
3
3
5
3
3
5
3
3
5
4
3
5
4
3
5
4
3
5
4
3
5
4
3
5
4
3
5
5
3
5
5
3
5
5
3
5
5
3
5
5
3
5
6
3
5
6
3
5
6
3
5
6
3
5
6
3
5
6
3
5
6
d
c
r_
n
a
m
e
_win
d
o
w
s
d
c
r_
s
u
ffix_
s
t
a
n
d
a
r
d
d
c
r_v
mi_
s
u
ffix
d
c
r_
s
e
c_
s
u
ffix
v
m
_
m
a
n
a
g
e
m
e
n
t_
r
g
_
n
a
m
e ipam_endpoints get_networks delete_network update_network set_network_range slice_cidr
d
e
p
e
n
d
e
n
c
y
m
o
d
ule
s inputs tags networks
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s
fir
e
w
all_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.fir
e
w
all settings.networks.firewall.s
k
u
fir
e
w
all_
p
olic
y_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.fir
e
w
all_
p
olic
y
t
h
r
e
a
t_in
t
ellig
e
n
c
e
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.fir
e
w
all_
p
olic
y.t
h
r
e
a
t_in
t
ellig
e
n
c
e
t
h
r
e
a
t_in
t
ellig
e
n
c
e
_w
hit
e
_lis
t_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.fir
e
w
all_
p
olic
y.t
h
r
e
a
t_in
t
ellig
e
n
c
e.w
hit
e
_lis
t intrusion_detection_services settings.networks.firewall_policy.intrusion_detection intrusion_detection_signature_overrides_services settings.networks.firewall_policy.intrusion_detection.signature
_
o
v
e
r
rid
e
s intrusion_detection_bypass_traffic_settings_services settings.networks.firewall_policy.intrusion_detection.bypass_traffic_settin
g
s
s
n
a
t_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.fir
e
w
all_
p
olic
y.s
n
a
t ip_groups_services settings.networks.ip_groups ip_groups_ip_groups_services settings.networks.ip_groups.ip_group
s
p
olic
y_in
sig
h
t
s
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.p
olic
y_in
sig
h
t
s
dia
g
n
o
s
tic
s
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.dia
g
n
o
s
tic
s
dia
g
n
o
s
tic
s
_
e
n
a
ble
d
_lo
g
s
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.dia
g
n
o
s
tic
s.e
n
a
ble
d
_lo
g.A
Z
F
W
N
e
t
w
o
r
k
R
ule
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.dia
g
n
o
s
tic
s.e
n
a
ble
d
_lo
g.A
Z
F
W
A
p
plic
a
tio
n
R
ule
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.dia
g
n
o
s
tic
s.e
n
a
ble
d
_lo
g.A
Z
F
W
N
a
t
R
ule
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.dia
g
n
o
s
tic
s.e
n
a
ble
d
_lo
g.A
Z
F
W
T
h
r
e
a
tIn
t
el settings.networks.diagnostics.enabled_log.AZFWIdpsSignat
u
r
e
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.dia
g
n
o
s
tic
s.e
n
a
ble
d
_lo
g.A
Z
F
W
D
n
s
Q
u
e
r
y
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.dia
g
n
o
s
tic
s.e
n
a
ble
d
_lo
g.A
Z
F
W
F
q
d
n
R
e
s
olv
e
F
ailu
r
e
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.dia
g
n
o
s
tic
s.e
n
a
ble
d
_lo
g.A
Z
F
W
F
a
t
Flo
w
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.dia
g
n
o
s
tic
s.e
n
a
ble
d
_lo
g.A
Z
F
W
Flo
w
T
r
a
c
e
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.dia
g
n
o
s
tic
s.e
n
a
ble
d
_lo
g.A
Z
F
W
A
p
plic
a
tio
n
R
ule
A
g
g
r
e
g
a
tio
n
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.dia
g
n
o
s
tic
s.e
n
a
ble
d
_lo
g.A
Z
F
W
N
a
t
R
ule
A
g
g
r
e
g
a
tio
n
dia
g
n
o
s
tic
s
_
m
e
t
ric_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.dia
g
n
o
s
tic
s.m
e
t
ric.AllM
e
t
ric
s
d
n
s
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.d
n
s
d
n
s
_
r
e
s
olv
e
r_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.d
n
s
_
r
e
s
olv
e
r
r
o
u
tin
g
_in
t
e
n
t_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.r
o
u
tin
g
_in
t
e
n
t
u
p
g
r
a
d
e
_
t
o
_
p
r
e
miu
m
_
s
e
rvic
e
s
s
e
t
tin
g
s.n
e
t
w
o
r
k
s.u
p
g
r
a
d
e
_
t
o
_
p
r
e
miu
m
L
A
S
T
A
P
P
LIE
D
C
O
N
FIG
U
R
A
TIO
N input descriptions append_tags networks networks_enabled firewall firewall_availability_zones firewall_policy threat_intelligence threat_intelligence_mode intrusion_detection intrusion_detection_mode intrusion_detection_bypass_traffic_setting
s
s
n
a
t
s
n
a
t_
e
n
a
ble
_
c
u
s
t
o
m
_
s
n
a
t
d
a
t
a
d
o
g
_
r
ule
_
s
e
t ip_groups ip_groups_enable
d
dia
g
n
o
s
tic
s
dia
g
n
o
s
tic
s
_
e
n
a
ble
d
dia
g
n
o
s
tic
s
_
m
e
t
ric
p
olic
y_in
sig
h
t
s
p
olic
y_in
sig
h
t
s
_
e
n
a
ble
d
d
n
sdn
s
_
p
r
o
x
y_
e
n
a
ble
d
d
n
s
_
r
e
s
olv
e
r
d
n
s
_
r
e
s
olv
e
r_
e
n
a
ble
d
r
o
u
tin
g
_in
t
e
n
t
r
o
u
tin
g
_in
t
e
n
t_
e
n
a
ble
d
u
p
g
r
a
d
e
_
t
o
_
p
r
e
miu
m
u
p
g
r
a
d
e
_
t
o
_
p
r
e
miu
m
_
e
n
a
ble
d
fir
e
w
all_
b
a
s
elin
e
_
n
e
t
w
o
r
k_
r
ule
s
1
8
/
4
5
4
3
5
7
3
5
8
3
5
9
3
5
9
3
5
9
3
5
9
3
5
9
3
5
9
3
6
0
3
6
0
3
6
0
3
6
0
3
6
0
3
6
0
3
6
1
3
6
1
3
6
1
3
6
1
3
6
2
3
6
2
3
6
2
3
6
2
3
6
2
3
6
2
3
6
2
3
6
2
3
6
2
3
6
3
3
6
3
3
6
3
3
6
4
3
6
4
3
6
4
3
6
4
3
6
5
3
6
5
3
6
5
3
6
5
3
6
5
3
6
5
3
6
5
3
6
5
3
6
5
3
6
6
3
6
6
3
6
6
3
6
6
3
6
6
3
6
6
3
6
7
3
6
7
3
6
7
3
6
7
3
6
7
3
6
7
3
6
7
3
6
8
3
6
8
3
6
8
3
6
8
3
6
8
3
6
8
3
6
9
3
6
9
3
6
9
3
6
9
3
6
9
3
6
9
3
6
9
3
6
9
3
6
9
3
6
9
3
6
9
3
6
9
3
7
0
3
7
0
3
7
0
3
7
0
3
7
0
3
7
0
3
7
0
3
7
0
3
7
0
3
7
0
3
7
0
3
7
0
3
7
0
3
7
0
3
7
1
3
7
1
3
7
1
3
7
1
3
7
1
3
7
1
3
7
1
3
7
1
3
7
1
3
7
1
3
7
1
3
7
1
3
7
1
3
7
1
3
7
2
3
7
2
3
7
2
3
7
2
3
7
2
3
7
2
3
7
2
3
7
2
fir
e
w
all_
b
a
s
elin
e
_
a
p
plic
a
tio
n
_
r
ule
s
fir
e
w
all_
b
a
s
elin
e
_
n
e
t
w
o
r
k_
r
ule
s
_
e
x
t
e
n
d
e
d
o
u
t
p
u
t
s
n
e
t
w
o
r
k
o
u
t
p
u
t
d
e
s
c
rip
tio
n
s
d
e
p
e
n
d
e
n
c
y
m
o
d
ule
s inputs common
p
a
r
a
m
e
t
e
r
s
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g
_
s
e
t
tin
g
s
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g.in
s
t
a
n
c
e
s
[
0
]
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g
_
0
_
k
e
y_
v
a
ult
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g.in
s
t
a
n
c
e
s
[
0
].k
e
y_
v
a
ult
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g
_
0
_
c
r
e
a
t
e
_
v
m
s
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g.in
s
t
a
n
c
e
s
[
0
].c
r
e
a
t
e
_
v
m
s
c
r
e
a
t
e
_
v
m
s
_
v
m
_
a
r
r
a
y_
0
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g.in
s
t
a
n
c
e
s
[
0
].c
r
e
a
t
e
_
v
m
s.v
m
_
a
r
r
a
y
[
0
]
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g
_
0
_
c
o
n
n
e
c
tio
n
_
m
o
nit
o
r
s
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g.in
s
t
a
n
c
e
s
[
0
].c
o
n
n
e
c
tio
n
M
o
nit
o
r
s
[
0
]
c
o
n
n
e
c
tio
n
m
o
nit
o
r
s
_
ale
r
t_
e
n
d
_
p
oin
t
s
_
0
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g.in
s
t
a
n
c
e
s
[
0
].c
o
n
n
e
c
tio
n
M
o
nit
o
r
s
[
0
].e
n
d
P
oin
t
s
[
0
]
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g.in
s
t
a
n
c
e
s
[
0
].c
o
n
n
e
c
tio
n
M
o
nit
o
r
s
[
0
].e
n
d
P
oin
t
s
[
1
]
c
o
n
n
e
c
tio
n
m
o
nit
o
r
s
_
ale
r
t_
t
e
s
t_
c
o
n
fig
u
r
a
tio
n
_
0
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g.in
s
t
a
n
c
e
s
[
0
].c
o
n
n
e
c
tio
n
M
o
nit
o
r
s
[
0
].t
e
s
t
C
o
n
fig
u
r
a
tio
n
[
0
]
c
o
n
n
e
c
tio
n
m
o
nit
o
r
s
_
ale
r
t_
t
e
s
t_
g
r
o
u
p
s
_
0
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g.in
s
t
a
n
c
e
s
[
0
].c
o
n
n
e
c
tio
n
M
o
nit
o
r
s
[
0
].t
e
s
t
G
r
o
u
p
s
[
0
]
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g.in
s
t
a
n
c
e
s
[
1
]
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g
_
1
_
k
e
y_
v
a
ult
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g.in
s
t
a
n
c
e
s
[
1
].k
e
y_
v
a
ult
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g
_
1
_
c
r
e
a
t
e
_
v
m
s
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g.in
s
t
a
n
c
e
s
[
1
].c
r
e
a
t
e
_
v
m
s
c
r
e
a
t
e
_
v
m
s
_
v
m
_
a
r
r
a
y_
1
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g.in
s
t
a
n
c
e
s
[
1
].c
r
e
a
t
e
_
v
m
s.v
m
_
a
r
r
a
y
[
0
]
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g
_
1
_
c
o
n
n
e
c
tio
n
_
m
o
nit
o
r
s
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g.in
s
t
a
n
c
e
s
[
1
].c
o
n
n
e
c
tio
n
M
o
nit
o
r
s
c
o
n
n
e
c
tio
n
m
o
nit
o
r
s
_
ale
r
t_
e
n
d
_
p
oin
t
s
_
1
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g.in
s
t
a
n
c
e
s
[
1
].c
o
n
n
e
c
tio
n
M
o
nit
o
r
s.e
n
d
P
oin
t
s
[
0
]
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g.in
s
t
a
n
c
e
s
[
1
].c
o
n
n
e
c
tio
n
M
o
nit
o
r
s.e
n
d
P
oin
t
s
[
1
]
c
o
n
n
e
c
tio
n
m
o
nit
o
r
s
_
ale
r
t_
t
e
s
t_
c
o
n
fig
u
r
a
tio
n
_
1
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g.in
s
t
a
n
c
e
s
[
1
].t
e
s
t
C
o
n
fig
u
r
a
tio
n
[
0
]
c
o
n
n
e
c
tio
n
m
o
nit
o
r
s
_
ale
r
t_
t
e
s
t_
g
r
o
u
p
s
_
1
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g.in
s
t
a
n
c
e
s
[
1
].t
e
s
t
G
r
o
u
p
s
[
0
]
p
riv
a
t
e
_
d
n
s
p
riv
a
t
e
_
d
n
s
_
s
e
t
tin
g
s
p
riv
a
t
e
_
d
n
s
_
s
e
t
tin
g
s
_
d
n
s
_
p
riv
a
t
e
_
z
o
n
e
p
riv
a
t
e
_
r
e
s
olv
e
r
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s.in
s
t
a
n
c
e
s
[
0
]
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s
_
n
e
t
w
o
r
k_
0
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s.in
s
t
a
n
c
e
s
[
0
].n
e
t
w
o
r
k.in
b
o
u
n
d
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s.in
s
t
a
n
c
e
s
[
0
].n
e
t
w
o
r
k.o
u
t
b
o
u
n
d
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s
_
r
e
m
o
t
e
_vir
t
u
al_
n
e
t
w
o
r
k
s
_
0
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s.in
s
t
a
n
c
e
s
[
0
].r
e
m
o
t
e
_vir
t
u
al_
n
e
t
w
o
r
k
s
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s
_
r
ule
s
_
0
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s.in
s
t
a
n
c
e
s
[
0
].r
ule
s
[
0
]
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s.in
s
t
a
n
c
e
s
[
1
]
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s
_
n
e
t
w
o
r
k_
1
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s.in
s
t
a
n
c
e
s
[
1
].n
e
t
w
o
r
k.in
b
o
u
n
d
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s.in
s
t
a
n
c
e
s
[
1
].n
e
t
w
o
r
k.o
u
t
b
o
u
n
d
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s
_
r
e
m
o
t
e
_vir
t
u
al_
n
e
t
w
o
r
k
s
_
1
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s.in
s
t
a
n
c
e
s
[
1
].r
e
m
o
t
e
_vir
t
u
al_
n
e
t
w
o
r
k
s
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s
_
r
ule
s
_
1
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s.in
s
t
a
n
c
e
s
[
1
].r
ule
s
[
0
]
L
A
S
T
A
P
P
LIE
D
C
O
N
FIG
U
R
A
TIO
N
o
u
t
p
u
t
s
s
h
a
r
e
d
s
e
rvic
e
s
_
o
u
t
p
u
t
s input descriptions instance append_tags connection_testing connection_testing_enabled connection_testing_instance
_
e
n
a
ble
d
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g
_lo
c
a
tio
n
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g
_lo
c
a
tio
n
_
s
h
o
r
t
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g
_in
s
t
a
n
c
e
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g
_
c
u
s
t
o
m
_
s
e
rvic
e
_
n
a
m
e
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g
_
r
g
_
n
a
m
e
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g
_
dis
k_
e
n
c
r
y
p
tio
n
_
e
n
a
ble
d
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g
_
k
e
y
v
a
ult
k
e
y_
v
a
ult_
n
a
m
e
k
e
y_
v
a
ult_
s
h
o
r
t_
n
a
m
e
k
e
y_
v
a
ult_
e
n
a
ble
_
p
u
r
g
e
_
p
r
o
t
e
c
tio
n
k
e
y_
v
a
ult_
e
n
a
ble
d
_fo
r_
d
e
plo
y
m
e
n
t
k
e
y_
v
a
ult_
e
n
a
ble
d
_fo
r_
t
e
m
pla
t
e
_
d
e
plo
y
m
e
n
t
k
e
y_
v
a
ult_
e
n
a
ble
d
_fo
r_
dis
k_
e
n
c
r
y
p
tio
n
k
e
y_
v
a
ult_
e
n
a
ble
_
r
b
a
c_
a
u
t
h
o
riz
a
tio
n
k
e
y_
v
a
ult_
e
n
a
ble
_
s
o
ft_
d
ele
t
e
k
e
y_
v
a
ult_
s
k
u
k
e
y_
v
a
ult_
u
rl_
s
u
ffix
k
e
y_
v
a
ult_
k
e
k_
e
x
pir
y_
d
a
y
s
k
e
y_
v
a
ult_
s
e
t
u
p
_
u
s
e
r
n
a
m
e
_
e
x
pir
y_
d
a
y
s
k
e
y_
v
a
ult_
s
e
t
u
p
_
p
a
s
s
w
o
r
d
_
e
x
pir
y_
d
a
y
s
k
e
y_
v
a
ult_
p
e
r
mis
sio
n
s
k
e
y_
v
a
ult_
n
e
t
w
o
r
k_
a
cls
_
b
y
p
a
s
s
k
e
y_
v
a
ult_
n
e
t
w
o
r
k_
a
cls
_
d
e
f
a
ult_
a
c
tio
n
k
e
y_
v
a
ult_
n
e
t
w
o
r
k_
a
cls
_ip
_
r
ule
s
k
e
y_
v
a
ult_
n
e
t
w
o
r
k_
a
cls
_
vir
t
u
al_
n
e
t
w
o
r
k_
r
ule
s
k
e
y_
v
a
ult_
a
c
c
e
s
s
_
p
olicie
s
c
o
n
n
n
e
c
tio
n
_
t
e
s
tin
g
_
c
r
e
a
t
e
_v
m
s
c
r
e
a
t
e
_
v
m
s
_
e
n
a
ble
d
c
r
e
a
t
e
_
v
m
s
_
r
g
_
s
h
o
r
t_
n
a
m
e
c
r
e
a
t
e
_
v
m
s
_
h
a
r
d
w
a
r
e
_
siz
e
c
r
e
a
t
e
_
v
m
s
_im
a
g
e
_
p
u
blis
h
e
r
c
r
e
a
t
e
_
v
m
s
_im
a
g
e
_
o
ff
e
r
c
r
e
a
t
e
_
v
m
s
_im
a
g
e
_
s
k
u
v
m
_
e
n
a
ble
d
n
e
w_
v
m
_
n
a
m
e
n
e
w_
v
m
_
s
u
b
n
e
t_
a
s
s
o
cia
tio
n
u
p
d
a
t
e
_
m
a
n
a
g
e
m
e
n
t_
e
n
a
ble
d
1
9
/
4
5
4
3
7
2
3
7
2
3
7
2
3
7
2
3
7
2
3
7
2
3
7
3
3
7
3
3
7
3
3
7
3
3
7
4
3
7
4
3
7
4
3
7
4
3
7
4
3
7
5
3
7
5
3
7
5
3
7
5
3
7
5
3
7
6
3
7
6
3
7
6
3
7
6
3
7
6
3
7
6
3
7
6
3
7
6
3
7
6
3
7
6
3
7
6
3
7
6
3
7
6
3
7
7
3
7
7
3
7
7
3
7
7
3
7
7
3
7
7
3
7
7
3
7
7
3
7
7
3
7
7
3
7
7
3
7
7
3
7
7
3
7
7
3
7
7
3
7
8
3
7
8
3
7
8
3
7
8
3
7
8
3
7
8
3
7
8
3
7
8
3
7
8
3
7
8
3
7
9
3
7
9
3
7
9
3
7
9
3
8
0
3
8
0
3
8
1
3
8
1
3
8
1
3
8
1
3
8
1
3
8
2
3
8
2
3
8
4
3
8
4
3
8
4
3
8
4
3
8
4
3
8
5
3
8
5
3
8
5
3
8
5
3
8
5
3
8
5
3
8
6
3
8
6
3
8
6
3
8
6
3
8
6
3
8
6
3
8
7
3
8
7
3
8
7
3
8
7
3
8
7
3
8
7
3
8
8
3
8
8
3
8
8
3
8
8
3
8
8
3
8
8
3
8
9
3
8
9
3
8
9
3
8
9
3
8
9
3
9
0
3
9
0
3
9
0
3
9
0
3
9
0
3
9
0
m
ain
t
e
n
a
n
c
e
_
c
o
n
fig
c
o
n
n
e
c
tio
n
_
t
e
s
tin
g
_
c
o
n
n
n
e
c
tio
n
_
m
o
nit
o
r
s
c
o
n
n
e
c
tio
n
m
o
nit
o
r
s
_
c
o
n
n
e
c
tio
n
_
m
o
nit
o
r_
e
n
a
ble
d
c
o
n
n
e
c
tio
n
m
o
nit
o
r
s
_
c
o
n
n
e
c
tio
n
_
m
o
nit
o
r_
ale
r
t_
e
n
a
ble
d
c
o
n
n
e
c
tio
n
m
o
nit
o
r
s
_
c
o
n
n
e
c
tio
n
_
m
o
nit
o
r_
s
u
b
s
c
rip
tio
nid
c
o
n
n
e
c
tio
n
m
o
nit
o
r
s
_
c
o
n
n
e
c
tio
n
_
m
o
nit
o
r_
n
a
m
e
c
o
n
n
e
c
tio
n
m
o
nit
o
r
s
_lo
g
_
a
n
aly
tic
s
_w
o
r
k
s
p
a
c
e
_id
c
o
n
n
e
c
tio
n
m
o
nit
o
r
s
_
ale
r
t_
a
c
tio
n
_
g
r
o
u
p
_id
c
o
n
n
e
c
tio
n
m
o
nit
o
r
s
_
e
n
d
_
p
oin
t
s
c
o
n
n
e
c
tio
n
m
o
nit
o
r
s
_
t
e
s
t_
c
o
n
fig
u
r
a
tio
n
s
c
o
n
n
e
c
tio
n
m
o
nit
o
r
s
_
t
e
s
t_
g
r
o
u
p
s
p
riv
a
t
e
_
d
n
s
p
riv
a
t
e
_
d
n
s
_
e
n
a
ble
d
p
riv
a
t
e
_
d
n
s
_
r
g
_
n
a
m
e
p
riv
a
t
e
_
d
n
s
_
z
o
n
e
_v
n
e
t_lin
k
s
p
rim
a
r
y_
p
riv
a
t
e
_
d
n
s
_
z
o
n
e
_v
n
e
t_lin
k
s
d
n
s
_
p
riv
a
t
e
_
z
o
n
e
d
n
s
_
p
riv
a
t
e
_
z
o
n
e
_
p
rim
a
r
y_
n
a
m
e
d
n
s
_
p
riv
a
t
e
_
z
o
n
e
_
p
riv
a
t
e
_lin
k_
z
o
n
e
s
p
riv
a
t
e
_lin
k_
z
o
n
e
s
_
v
alu
e
s
p
riv
a
t
e
_
r
e
s
olv
e
r
p
riv
a
t
e
_
r
e
s
olv
e
r_
e
n
a
ble
d
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s
_
e
n
a
ble
d
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s
_lo
c
a
tio
n
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s
_lo
c
a
tio
n
_
s
h
o
r
t
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s
_in
s
t
a
n
c
e
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s
_
r
g
_
n
a
m
e
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s
_
c
u
s
t
o
m
_
s
e
rvic
e
_
n
a
m
e
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s
_
h
u
b
_
s
p
o
k
e
_wit
h
_fir
e
w
all_
a
s
_
p
r
o
x
y
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s
_
p
riv
a
t
e
_
d
n
s
_
r
e
s
olv
e
r_
n
a
m
e
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
e
t
tin
g
s
_
p
riv
a
t
e
_
r
e
s
olv
e
r_
r
ule
s
e
t_
n
a
m
e
p
riv
a
t
e
_
r
e
s
olv
e
r_
n
e
t
w
o
r
k
n
e
t
w
o
r
k_in
b
o
u
n
d
_
e
n
a
ble
d
n
e
t
w
o
r
k_in
b
o
u
n
d
_
e
n
d
p
oin
t_
n
a
m
e
n
e
t
w
o
r
k_in
b
o
u
n
d
_
s
u
b
n
e
t_
n
a
m
e
n
e
t
w
o
r
k_
o
u
t
b
o
u
n
d
_
e
n
a
ble
d
n
e
t
w
o
r
k_
o
u
t
b
o
u
n
d
_
e
n
d
p
oin
t_
n
a
m
e
n
e
t
w
o
r
k_
o
u
t
b
o
u
n
d
_
s
u
b
n
e
t_
n
a
m
e
p
riv
a
t
e
_
r
e
s
olv
e
r_
r
e
m
o
t
e
_vir
t
u
al_
n
e
t
w
o
r
k
s
r
e
m
o
t
e
_
vir
t
u
al_
n
e
t
w
o
r
k
s
_
h
u
b
_
s
p
o
k
e
_
n
e
t
w
o
r
k_
v
n
e
t_id
r
e
m
o
t
e
_
vir
t
u
al_
n
e
t
w
o
r
k
s
_
s
h
a
r
e
d
_
s
e
rvic
e
s
_
n
e
t
w
o
r
k_
v
n
e
t_id
p
riv
a
t
e
_
r
e
s
olv
e
r_
r
ule
s
r
ule
s
_
s
t
a
t
e
r
ule
s
_
r
ule
_
n
a
m
e
r
ule
s
_
d
o
m
ain
_
n
a
m
e
r
ule
s
_
t
a
r
g
e
t_
d
n
s
_
s
e
rv
e
r
s
o
u
t
p
u
t
d
e
s
c
rip
tio
n
s
s
h
a
r
e
d
s
e
rvic
e
s
_
o
u
t
p
u
t
s
o
u
t
p
u
t_
p
riv
a
t
e
_
d
n
s
_
r
g
_
n
a
m
e
o
u
t
p
u
t_
p
riv
a
t
e
_
d
n
s
_
r
g
_id
o
u
t
p
u
t_
p
riv
a
t
e
_
d
n
s
_
s
u
b
_id
o
u
t
p
u
t_
p
rim
a
r
y_
d
n
s
_
z
o
n
e
_
n
a
m
e
o
u
t
p
u
t_
p
riv
a
t
e
_
r
e
s
olv
e
r_
s
u
b
_id
o
u
t
p
u
t_
p
riv
a
t
e
_
r
e
s
olv
e
r_
r
g
_
n
a
m
e
o
u
t
p
u
t_
p
riv
a
t
e
_
r
e
s
olv
e
r_
r
g
_id
o
u
t
p
u
t_
p
riv
a
t
e
_
r
e
s
olv
e
r_
r
uls
e
t_
n
a
m
e
d
e
p
e
n
d
e
n
c
y
m
o
d
ule
s inputs policies 1. policy
d
e
finitio
n
s
2. p
olic
y
s
e
t
d
e
finitio
n
s
3. p
olic
y
a
s
sig
n
m
e
n
t
s
3
a
)
p
olic
y
a
s
sig
n
m
e
n
t
c
h
a
n
g
e
s
o
r
a
d
ditio
n
al p
olic
y
a
s
sig
n
m
e
n
t
3
b
)
e
x
clu
sio
n
s
fo
r
p
olic
y
a
s
sig
n
m
e
n
t
s
a
u
t
o
m
a
tic
e
x
clu
sio
n
s
m
a
n
u
al e
x
clu
sio
n
s
p
olicie
s
_in
p
u
t
s
a
c
f_
p
olic
y_
p
a
r
a
m
e
t
e
r
s
a
c
f_
p
olic
y_
p
a
r
a
m
e
t
e
r
s
_
d
e
f
a
ult
s
a
c
f_
p
olic
y_
p
a
r
a
m
e
t
e
r
s.d
e
f
a
ult
s
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
0
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
0
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
0
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
1
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
2
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
3
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
4
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
5
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
6
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
7
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
8
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
8
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
8
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
9
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
9
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
9
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
0
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
1
0
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
0
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
1
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
1
1
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
1
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
2
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
1
2
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
2
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
2
0
/
4
5
4
3
9
1
3
9
1
3
9
1
3
9
1
3
9
1
3
9
1
3
9
1
3
9
2
3
9
2
3
9
2
3
9
2
3
9
2
3
9
3
3
9
3
3
9
3
3
9
3
3
9
3
3
9
3
3
9
4
3
9
4
3
9
4
3
9
4
3
9
4
3
9
4
3
9
5
3
9
5
3
9
5
3
9
5
3
9
5
3
9
6
3
9
6
3
9
6
3
9
6
3
9
6
3
9
6
3
9
6
3
9
7
3
9
7
3
9
7
3
9
7
3
9
7
3
9
7
3
9
8
3
9
8
3
9
8
3
9
8
3
9
9
3
9
9
3
9
9
3
9
9
3
9
9
3
9
9
3
9
9
4
0
0
4
0
0
4
0
0
4
0
0
4
0
0
4
0
0
4
0
0
4
0
1
4
0
1
4
0
1
4
0
1
4
0
1
4
0
2
4
0
2
4
0
2
4
0
2
4
0
2
4
0
2
4
0
3
4
0
3
4
0
3
4
0
3
4
0
3
4
0
3
4
0
3
4
0
4
4
0
4
4
0
4
4
0
4
4
0
4
4
0
4
4
0
5
4
0
5
4
0
5
4
0
5
4
0
5
4
0
5
4
0
6
4
0
6
4
0
6
4
0
6
4
0
6
4
0
6
4
0
7
4
0
7
4
0
7
4
0
7
4
0
7
4
0
8
4
0
8
4
0
8
4
0
8
4
0
8
4
0
9
4
0
9
4
0
9
4
0
9
4
1
0
4
1
0
4
1
0
4
1
0
4
1
0
4
1
1
4
1
1
4
1
1
4
1
1
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
3
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
1
3
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
3
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
4
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
1
4
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
4
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
5
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
1
5
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
5
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
6
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
1
6
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
6
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
7
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
1
7
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
7
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
8
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
1
8
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
8
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
9
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
1
9
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
1
9
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
0
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
2
0
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
0
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
1
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
2
1
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
1
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
2
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
2
2
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
2
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
3
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
2
3
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
3
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
4
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
2
4
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
4
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
5
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
2
5
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
5
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
6
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
2
6
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
6
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
7
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
2
7
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
7
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
8
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
2
8
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
8
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
9
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
2
9
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
2
9
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
0
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
3
0
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
0
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
1
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
3
1
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
1
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
2
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
3
2
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
2
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
3
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
3
3
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
3
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
4
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
3
4
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
4
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
5
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
3
5
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
5
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
6
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
3
6
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
6
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
7
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
3
7
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
7
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
8
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
3
8
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
8
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
9
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
3
9
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
3
9
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
0
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
4
0
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
0
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
1
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
4
1
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
1
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
2
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
4
2
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
2
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
3
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
4
3
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
3
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
4
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
4
4
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
4
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
4
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
1
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
5
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
4
5
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
5
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
6
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
4
6
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
6
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
7
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
4
7
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
7
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
8
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
4
8
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
8
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
9
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
4
9
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
4
9
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
0
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
5
0
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
0
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
1
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
5
1
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
1
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
2
]
2
1
/
4
5
4
4
1
1
4
1
1
4
1
2
4
1
2
4
1
2
4
1
2
4
1
2
4
1
3
4
1
3
4
1
3
4
1
3
4
1
3
4
1
4
4
1
4
4
1
4
4
1
5
4
1
5
4
1
5
4
1
5
4
1
5
4
1
6
4
1
6
4
1
6
4
1
6
4
1
6
4
1
6
4
1
7
4
1
7
4
1
7
4
1
7
4
1
7
4
1
7
4
1
8
4
1
8
4
1
8
4
1
8
4
1
8
4
1
8
4
1
9
4
1
9
4
1
9
4
1
9
4
2
0
4
2
0
4
2
0
4
2
0
4
2
0
4
2
1
4
2
1
4
2
1
4
2
1
4
2
1
4
2
1
4
2
2
4
2
2
4
2
2
4
2
2
4
2
2
4
2
3
4
2
3
4
2
3
4
2
3
4
2
3
4
2
3
4
2
3
4
2
4
4
2
4
4
2
4
4
2
4
4
2
4
4
2
4
4
2
5
4
2
5
4
2
5
4
2
5
4
2
5
4
2
5
4
2
6
4
2
6
4
2
6
4
2
6
4
2
6
4
2
6
4
2
7
4
2
8
4
2
8
4
2
8
4
2
8
4
2
8
4
2
8
4
2
8
4
2
8
4
2
8
4
2
9
4
2
9
4
2
9
4
2
9
4
2
9
4
3
0
4
3
0
4
3
0
4
3
0
4
3
0
4
3
0
4
3
0
4
3
0
4
3
0
4
3
0
4
3
0
4
3
0
4
3
0
4
3
0
4
3
1
4
3
1
4
3
1
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
5
2
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
2
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
3
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
5
3
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
3
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
4
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
5
4
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
4
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
5
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
5
5
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
5
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
6
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
5
6
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
6
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
7
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
5
7
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
7
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
8
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
5
8
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
8
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
9
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
5
9
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
5
9
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
0
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
6
0
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
0
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
1
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
6
1
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
1
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
2
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
6
2
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
2
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
3
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
6
3
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
3
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
4
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
6
4
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
4
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
5
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
6
5
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
5
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
6
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
6
6
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
6
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
7
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
6
7
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
7
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
8
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
6
8
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
8
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
9
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
6
9
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
6
9
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
0
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
7
0
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
0
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
1
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
7
1
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
1
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
2
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
7
2
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
2
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
3
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
7
3
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
3
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
4
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
7
4
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
4
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
5
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
7
5
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
5
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
6
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
7
6
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
6
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
7
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
7
7
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
7
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
8
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
7
8
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
8
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
9
]
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
s
_
7
9
_
0
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s.p
olic
y_
a
s
sig
n
m
e
n
t
s
[
7
9
].m
a
n
a
g
e
m
e
n
t
G
r
o
u
p
s
[
0
]
a
d
ditio
n
al_
p
olic
y_
a
s
sig
n
m
e
n
t
s
L
A
S
T
A
P
P
LIE
D
C
O
N
FIG
U
R
A
TIO
N input descriptions default_azure_policies_enabled customised_azure_policies_enable
d
a
c
f_
p
olic
y_
p
a
r
a
m
e
t
e
r
s image_publisher image_offer image_sku image_sku_value list_of_allowed_skus list_of_allowed_skus_value approved_extensions approved_extensions_value vault_scheduled_run_time vault_default_retention_daily_
c
o
u
n
t
v
a
ult_
d
e
f
a
ult_
r
e
t
e
n
tio
n
_w
e
e
kly_
c
o
u
n
t
r
s
v_
n
a
m
e
_
p
r
e
fix
r
s
v_
r
e
s
o
u
r
c
e
_
g
r
o
u
p
_
n
a
m
e
_
p
r
e
fix
d
a
t
a
d
o
g
_
sit
e
d
a
t
a
d
o
g
_
a
pi_
s
e
c
r
e
t_
n
a
m
e
s
t
o
r
a
g
e
_
a
c
c
o
u
n
t_
dia
g
n
o
s
tic
s
_w
rit
e
s
t
o
r
a
g
e
_
a
c
c
o
u
n
t_
dia
g
n
o
s
tic
s
_
r
e
a
d
w
a
f_
m
o
d
e
_
r
e
q
uir
e
m
e
n
t
s
u
b
n
e
t_
n
s
g
_
e
x
clu
sio
n
s
a
s
c_
e
m
ail_
c
o
n
t
a
c
t
a
s
c_
s
e
c
u
rit
y_
p
h
o
n
e
_
n
u
m
b
e
r
a
s
c_
p
ricin
g
_
tie
r
a
s
c_
a
u
t
o
_
p
r
o
visio
n
a
s
c_
m
c
a
s
_in
t
e
g
r
a
tio
n
a
s
c_w
d
a
t
p
_in
t
e
g
r
a
tio
n
m
o
dify_v
m
_
b
a
c
k
u
p
_
t
a
g
_
p
a
r
a
m
2
2
/
4
5
4
4
3
1
4
3
1
4
3
1
4
3
1
4
3
1
4
3
1
4
3
1
4
3
1
4
3
1
4
3
1
4
3
1
4
3
2
4
3
2
4
3
2
4
3
2
4
3
2
4
3
2
4
3
2
4
3
2
4
3
2
4
3
2
4
3
2
4
3
2
4
3
2
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
3
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
4
3
5
4
3
5
4
3
5
4
3
5
4
3
5
4
3
5
4
3
6
4
3
6
4
3
6
4
3
6
4
3
6
4
3
6
4
3
6
4
3
6
4
3
6
4
3
7
4
3
7
4
3
7
4
3
7
4
3
7
4
3
7
4
3
7
4
3
7
4
3
8
4
3
8
4
3
8
4
3
8
4
3
8
4
3
9
4
3
9
4
3
9
4
3
9
4
3
9
4
3
9
4
3
9
4
4
0
4
4
0
4
4
0
4
4
0
4
4
0
4
4
0
4
4
1
4
4
1
4
4
1
4
4
1
4
4
1
4
4
1
4
4
1
4
4
1
4
4
1
m
o
dify_v
m
_
u
p
d
a
t
e
_
t
a
g
_
p
a
r
a
m
m
o
dify_
blo
b
_
b
a
c
k
u
p
_
t
a
g
_
p
a
r
a
m
a
c
f_lo
c
a
tio
n
s
allo
w
e
d
_lo
c
a
tio
n
s
a
u
dit_w
o
r
k
s
p
a
c
e
_
s
u
b
s
c
rip
tio
n
_id
w
o
r
k
s
p
a
c
e
_
s
u
b
s
c
rip
tio
n
_id
s
p
o
k
e
_w
o
r
k
s
p
a
c
e
_
n
a
m
e
_
p
r
e
fix
s
p
o
k
e
_w
o
r
k
s
p
a
c
e
_
r
g
s
p
o
k
e
_w
o
r
k
s
p
a
c
e
_lo
c
a
tio
n
s
h
a
r
e
d
_
k
e
y
v
a
ult_id
cis
_
ale
r
t
s
r
g
_
n
a
m
e
cis
_
ale
r
t
s
_lo
c
a
tio
n
s
a
_
r
e
s
o
u
r
c
e
_
g
r
o
u
p
_
n
a
m
e
_
p
r
e
fix
din
e
_
n
s
g
_flo
wlo
g
s
_
p
a
r
a
m
s
u
b
n
e
t_
r
t_
e
x
clu
sio
n
s
s
a
n
d
b
o
x_
m
g
_id
c
o
n
n
e
c
tivit
y_
m
g
_id
o
nlin
e
_
m
g
_id
a
u
dit_
m
g
_id
a
u
dit_w
o
r
k
s
p
a
c
e
_
r
e
s
o
u
r
c
e
_
g
r
o
u
p
_
n
a
m
e
a
u
dit_
s
t
o
r
a
g
e
_
n
a
m
e
a
u
dit_w
o
r
k
s
p
a
c
e
_
n
a
m
e
a
u
dit_
s
t
o
r
a
g
e
_
e
n
a
ble
d
w
o
r
k
s
p
a
c
e
_
r
e
s
o
u
r
c
e
_
g
r
o
u
p
_
n
a
m
e
w
o
r
k
s
p
a
c
e
_
n
a
m
e
a
c
tio
n
_
g
r
o
u
p
_
n
a
m
e
_w
a
r
nin
g
_id
a
c
tio
n
_
g
r
o
u
p
_
n
a
m
e
_
c
ritic
al_id
d
c
r_
n
a
m
e
_win
d
o
w
s
d
c
r_
n
a
m
e
_lin
u
x
d
c
r_
s
u
ffix_
s
t
a
n
d
a
r
d
t
o
p
olo
g
y
s
u
b
n
e
t_w
o
_
r
t_
n
o
t_
s
c
o
p
e
e
r_
g
w_
n
o
t_
s
c
o
p
e
v
p
n
_
g
w_
n
o
t_
s
c
o
p
e
d
e
f
a
ult_
r
o
u
t
e
_in
t
e
r
n
e
t_
n
o
t_
s
c
o
p
e
h
u
b
_v
n
e
t_
r
e
s
o
u
r
c
e
_id
s
s
u
b
n
e
t_w
o
_
n
s
g
_
n
o
t_
s
c
o
p
e
pip
_
n
o
t_
s
c
o
p
e
fir
e
w
all_ip
_
a
d
d
r
e
s
s
e
s
p
riv
a
t
e
_
d
n
s
_
z
o
n
e
_
r
e
s
o
u
r
c
e
_
g
r
o
u
p
_id
v
m
_
m
a
n
a
g
e
m
e
n
t_
r
e
s
o
u
r
c
e
_
g
r
o
u
p
_
n
a
m
e
p
riv
a
t
e
_
e
n
d
p
oin
t_
d
n
s
_
n
o
t_
s
c
o
p
e
d
e
f
a
ult_
a
c
f_
p
olic
y_
a
s
sig
n
m
e
n
t
s
_
c
h
a
n
g
e
s
_
d
e
s
c
rip
tio
n
s
d
e
finitio
n
_id
n
a
m
e
a
s
sig
n
m
e
n
t_
n
a
m
e
d
e
s
c
rip
tio
n
dis
pla
y_
n
a
m
e identity is_initiative management_
g
r
o
u
p
_
n
a
m
e
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_
e
n
a
ble
d
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_lin
k
e
d
_
s
c
o
p
e
s
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_
n
o
t_
s
c
o
p
e
s
m
a
n
a
g
e
m
e
n
t_
g
r
o
u
p
_
p
a
r
a
m
e
t
e
r
s
n
o
n
_
c
o
m
plia
n
c
e
_
m
s
g
d
e
p
e
n
d
e
n
c
y inputs app_vars application advisory_alert
s
a
p
plic
a
tio
n.a
d
vis
o
r
y_
ale
r
t
s.$
e
n
v
r
e
s
o
u
r
c
e
_
g
r
o
u
p
a
p
plic
a
tio
n.r
e
s
o
u
r
c
e
_
g
r
o
u
p.$
e
n
v
[
0
]
r
e
s
o
u
r
c
e
_
g
r
o
u
p
_ia
m
a
p
plic
a
tio
n.r
e
s
o
u
r
c
e
_
g
r
o
u
p.$
e
n
v
[
0
].ia
m
[
0
]
s
u
b
s
c
rip
tio
n
a
p
plic
a
tio
n.s
u
b
s
c
rip
tio
n.$
e
n
v
s
u
b
s
c
rip
tio
n
_ia
m
a
p
plic
a
tio
n.s
u
b
s
c
rip
tio
n.$
e
n
v.ia
m
[
0
]
a
a
d
_
s
p
n
a
p
plic
a
tio
n.a
a
d
_
s
p
n
[
0
]
a
a
d
_
g
r
o
u
p
a
p
plic
a
tio
n.a
a
d
_
g
r
o
u
p
[
0
]
vir
t
u
al_
n
e
t
w
o
r
k
s
a
p
plic
a
tio
n.vir
t
u
al_
n
e
t
w
o
r
k
s.$
e
n
v
[
0
]
p
e
e
rin
g
a
p
plic
a
tio
n.vir
t
u
al_
n
e
t
w
o
r
k
s.$
e
n
v
[
0
].p
e
e
rin
g
a
z
u
r
e
_
b
a
s
tio
n
a
p
plic
a
tio
n.vir
t
u
al_
n
e
t
w
o
r
k
s.$
e
n
v
[
0
].a
z
u
r
e
_
b
a
s
tio
n
s
u
b
n
e
t
s
a
p
plic
a
tio
n.vir
t
u
al_
n
e
t
w
o
r
k
s.$
e
n
v
[
0
].s
u
b
n
e
t
s
[
0
]
n
e
t
w
o
r
k_
s
e
c
u
rit
y_
g
r
o
u
p
a
p
plic
a
tio
n.vir
t
u
al_
n
e
t
w
o
r
k
s.$
e
n
v
[
0
].s
u
b
n
e
t
s
[
0
].n
e
t
w
o
r
k_
s
e
c
u
rit
y_
g
r
o
u
p
s
e
c
u
rit
y_
r
ule
s
a
p
plic
a
tio
n.vir
t
u
al_
n
e
t
w
o
r
k
s.$
e
n
v
[
0
].s
u
b
n
e
t
s
[
0
].n
e
t
w
o
r
k_
s
e
c
u
rit
y_
g
r
o
u
p.s
e
c
u
rit
y_
r
ule
s
[
0
]
r
o
u
t
e
_
t
a
ble
a
p
plic
a
tio
n.vir
t
u
al_
n
e
t
w
o
r
k
s.$
e
n
v
[
0
].s
u
b
n
e
t
s
[
0
].r
o
u
t
e
_
t
a
ble
r
o
u
t
e
s
a
p
plic
a
tio
n.vir
t
u
al_
n
e
t
w
o
r
k
s.$
e
n
v
[
0
].s
u
b
n
e
t
s
[
0
].r
o
u
t
e
_
t
a
ble.r
o
u
t
e
s
[
0
]
g
r
o
u
p
_v
a
r
s input desc
rip
tio
n
s
n
a
m
e
e
n
vir
o
n
m
e
n
t location locationshort advisoryalert
s
e
n
a
ble
d
a
d
vis
o
r
y
ale
r
t
s
r
e
s
o
u
r
c
e
g
r
o
u
p
n
a
m
e
r
e
s
o
u
r
c
e
g
r
o
u
p
n
a
m
e
r
e
s
o
u
r
c
e
g
r
o
u
pia
m
o
w
n
e
r
r
e
s
o
u
r
c
e
g
r
o
u
p
t
a
g
s
s
u
b
s
c
rip
tio
n
n
a
m
e
o
rid
s
u
b
s
c
rip
tio
n
c
r
e
a
t
e
n
e
w
2
3
/
4
5
4
4
4
1
4
4
1
4
4
1
4
4
2
4
4
2
4
4
2
4
4
2
4
4
2
4
4
2
4
4
2
4
4
2
4
4
2
4
4
2
4
4
2
4
4
2
4
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
4
3
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
4
5
4
4
5
4
4
5
4
4
5
4
4
5
4
4
5
4
4
5
4
4
5
4
4
5
4
4
5
4
4
5
4
4
5
4
4
6
4
4
6
4
4
6
4
4
6
4
4
6
4
4
6
4
4
6
4
4
6
4
4
6
4
4
6
4
4
6
4
4
6
4
4
6
4
4
7
4
4
7
4
4
7
4
4
7
4
4
7
4
4
7
4
4
7
4
4
8
4
4
9
4
5
0
4
5
1
4
5
1
4
5
1
4
5
1
4
5
1
4
5
1
4
5
1
4
5
1
4
5
1
4
5
1
4
5
1
4
5
1
s
u
b
s
c
rip
tio
n
e
n
r
ollm
e
n
t
a
c
c
o
u
n
t
s
u
b
s
c
rip
tio
n
billin
g
a
c
c
o
u
n
t
s
u
b
s
c
rip
tio
n
billin
g
p
r
o
file
s
u
b
s
c
rip
tio
nin
v
oic
e
s
e
c
tio
n
s
u
b
s
c
rip
tio
n
p
u
r
c
h
a
sin
g
m
o
d
el subscriptionworkloadtype subscriptionmanagementgrou
pid
s
u
b
s
c
rip
tio
n
r
e
s
o
u
r
c
e
p
r
o
vid
e
r
s
s
u
b
s
c
rip
tio
n
t
a
g
s
s
u
b
s
c
rip
tio
nia
m
o
w
n
e
r
a
a
d
s
p
n
n
a
m
e
a
a
d
s
p
n
o
w
n
e
r
a
a
d
g
r
o
u
p
n
a
m
e
a
a
d
g
r
o
u
p
d
e
s
c
rip
tio
n
a
a
d
g
r
o
u
p
o
w
n
e
r
vir
t
u
aln
e
t
w
o
r
k
s
v
n
e
t
vir
t
u
aln
e
t
w
o
r
k
s
c
u
s
t
o
m
v
n
e
t
n
a
m
e
vir
t
u
aln
e
t
w
o
r
k
s
r
e
s
o
u
r
c
e
g
r
o
u
p
n
a
m
e
vir
t
u
aln
e
t
w
o
r
k
s
r
e
s
o
u
r
c
e
g
r
o
u
plo
c
k
vir
t
u
aln
e
t
w
o
r
k
s
e
n
vir
o
n
m
e
n
t
vir
t
u
aln
e
t
w
o
r
k
slo
c
a
tio
n
vir
t
u
aln
e
t
w
o
r
k
slo
c
a
tio
n
s
h
o
r
t
vir
t
u
aln
e
t
w
o
r
k
sip
a
m
n
e
t
w
o
r
k
m
a
s
k
vir
t
u
aln
e
t
w
o
r
k
sip
a
m
s
u
p
e
r
n
e
t
n
a
m
e
vir
t
u
aln
e
t
w
o
r
k
s
n
e
t
w
o
r
k
p
r
e
fix
e
s
vir
t
u
aln
e
t
w
o
r
k
s
d
n
s
s
e
rv
e
r
s
vir
t
u
aln
e
t
w
o
r
k
s
p
riv
a
t
e
d
n
s
n
a
m
e
vir
t
u
aln
e
t
w
o
r
k
s
p
riv
a
t
e
d
n
s
c
u
s
t
o
m
r
e
s
o
u
r
c
e
g
r
o
u
p
p
e
e
rin
g
e
n
a
ble
d
p
e
e
rin
g
n
a
m
e
o
v
e
rw
rit
e
p
e
e
rin
g
u
s
e
r
e
m
o
t
e
g
a
t
e
w
a
y
s
a
u
t
o
_
r
e
gis
t
e
r_in
_
p
rim
a
r
y_
p
riv
a
t
e
_
d
n
s
a
z
u
r
e
b
a
s
tio
n
e
n
a
ble
d
a
z
u
r
e
b
a
s
tio
n
s
k
u
a
z
u
r
e
b
a
s
tio
n
s
c
ale
u
nit
s
a
z
u
r
e
b
a
s
tio
n
c
o
p
y
p
a
s
t
e
e
n
a
ble
d
a
z
u
r
e
b
a
s
tio
n
file
c
o
p
y
e
n
a
ble
d
a
z
u
r
e
b
a
s
tio
nip
c
o
n
n
e
c
t
e
n
a
ble
d
a
z
u
r
e
b
a
s
tio
n
t
u
n
n
elin
g
e
n
a
ble
d
s
u
b
n
e
t
s
u
b
n
e
t
s
u
b
n
e
t
s
c
u
s
t
o
m
s
u
b
n
e
t
n
a
m
e
s
u
b
n
e
t
sip
a
m
s
u
b
n
e
t
m
a
s
k
s
u
b
n
e
t
s
u
b
n
e
t
p
r
e
fix
s
u
b
n
e
t
s
d
e
plo
y
r
o
u
t
e
t
a
ble
d
e
plo
y_
s
e
rvic
e
_
e
n
d
p
oin
t
s
d
e
plo
y_
n
e
t
w
o
r
k_
s
e
c
u
rit
y_
g
r
o
u
p
s
e
rvic
e
_
e
n
d
p
oin
t
s
n
e
t
w
o
r
k
s
e
c
u
rit
y
g
r
o
u
p
c
u
s
t
o
m
n
s
g
n
a
m
e
s
e
c
u
rit
y
r
ule
s
n
a
m
e
s
e
c
u
rit
y
r
ule
s
p
r
o
t
o
c
ol securityrulessourcep
o
r
t
r
a
n
g
e
s
e
c
u
rit
y
r
ule
s
d
e
s
tin
a
tio
n
p
o
r
t
r
a
n
g
e
s
s
e
c
u
rit
y
r
ule
s
s
o
u
r
c
e
a
d
d
r
e
s
s
p
r
e
fix
e
s
s
e
c
u
rit
y
r
ule
s
d
e
s
tin
a
tio
n
a
d
d
r
e
s
s
p
r
e
fix
e
s
s
e
c
u
rit
y
r
ule
s
a
c
c
e
s
s
s
e
c
u
rit
y
r
ule
s
p
rio
rit
y
s
e
c
u
rit
y
r
ule
s
dir
e
c
tio
n
s
e
c
u
rit
y
r
ule
s
d
e
s
c
rip
tio
n
r
o
u
t
e
t
a
ble
c
u
s
t
o
m
r
o
u
t
e
t
a
ble
n
a
m
e
r
o
u
t
e
t
a
ble
dis
a
ble
b
g
p
r
o
u
t
e
p
r
o
p
a
g
a
tio
n
r
o
u
t
e
s
n
a
m
e
r
o
u
t
e
s
a
d
d
r
e
s
s
p
r
e
fix
r
o
u
t
e
s
n
e
x
t
h
o
pip
a
d
d
r
e
s
s
r
o
u
t
e
s
n
e
x
t
h
o
p
t
y
p
e
d
e
p
e
n
d
e
n
c
y
S
e
c
u
rit
y
a
n
d lin
tin
g
a
n
aly
sis
s
olu
tio
n
fo
r
T
e
r
r
a
fo
r
m
t
e
r
r
a
fo
r
m
_f
m
t
t
e
r
r
a
fo
r
m
_lin
t
c
h
e
c
k
o
v
E
x
clu
sio
n lis
t
E
x
clu
sio
n
o
f
r
ule
s
E
x
t
e
n
sibilit
y
R
ele
a
s
e
n
o
t
e
s
V
e
r
sio
n: A
C
F
T
F
1.1.0
(
2
0
2
4.0
8
)
N
e
w
f
e
a
t
u
r
e
s
E
n
h
a
n
c
e
m
e
n
t
s
/
U
p
d
a
t
e
s
B
u
g
fix
e
s
D
e
p
r
e
c
a
t
e
d
a
n
d
r
e
m
o
v
e
d
f
e
a
t
u
r
e
s
V
e
r
sio
n: A
C
F
T
F
1.0.4
(
2
0
2
4.0
8
)
N
e
w
f
e
a
t
u
r
e
s
E
n
h
a
n
c
e
m
e
n
t
s
/
U
p
d
a
t
e
s
B
u
g
fix
e
s
D
e
p
r
e
c
a
t
e
d
a
n
d
r
e
m
o
v
e
d
f
e
a
t
u
r
e
s
V
e
r
sio
n: A
C
F
T
F
1.0.3
(
2
0
2
4.0
8
)
2
4
/
4
5
4
451
451
452
452
452
452
452
452
452
452
452
452
452
452
452
452
452
453
453
454
New features
Enhancements / Updates
Bugfixes
Deprecated and removed features
Version: ACF TF 1.0.2 (2024.07)
New features
Enhancements / Updates
Bugfixes
Deprecated and removed features
Version: ACF TF 1.0.1 (2024.07)
New features
Enhancements / Updates
Bugfixes
Deprecated and removed features
Version: ACF TF 1.0 (2024.04)
New features
Enhancements / Updates
Bugfixes
Deprecated and removed features
Download documentation in PDF (always contains the latest version)
25/454
What is Azure Cloud Foundation (ACF)
Azure Cloud Foundation (ACF) is Nordcloud’s production ready implementation of Azure Landing Zone, following
Microsoft Cloud Adoption Framework and Enterprise-Scale principles and guidelines, enhanced with Nordcloud’s realworld customer experiences. It’s a tried and tested ‘ready to go’ solution.
A Cloud Foundation resembles the entirety of all governance and technical activities needed to achieve a secure and
controlled Azure environment for a customer. A cloud landing zone is defined to be all infrastructure and systems required
to run applications in the cloud. Typically this equals a spoke in Azure Cloud Foundation. A landing zone covers elements
like networking, automation, DNS, remote access, auditing, platform security, backup etc.
The purpose of the ACF is to enable simple management of the core infrastructure on AZURE at scale.
Core infrastructure includes:
Networking
IAM access Management group structure
Project vending
Organization Policies & Security
Audit logging
Various Automations
Core infrastructure is not:
Business applications
DevOps tooling
Monitoring suites
Basically the core infrastructure is everything you need to run Ki Insurance’s application stacks in AZURE.
Azure Cloud Foundation modules
Nordcloud’s ACF comes with a set of Terraform (TF) modules that can be used to provision parts of infrastructure in
Azure Cloud Platform. There is no “must” in using those, but these modules provide all the basic elements that might be
needed to successfully migrate or start applications in the Cloud.
26/454
How ACF uses modules
Under the hood ACF is using Terraform (TF) templates for defining infrastructure, while Terragrunt is the medium used
for provisioning foundations. Terragrunt is system agnostic and can be deployed from Github Actions, a desktop
computer, or a server.
When we make a new feature release or when a bug is corrected, the version of the artifact is raised automatically.
Previous artifact versions are kept too. Consequently customers who would like to redeploy using older version can do it
without problem and just need to specify given artifact version instead of choosing the latest one.
What modules Nordcloud provides
Nordcloud provides a set of core modules capable of configuring network, security, identity, etc. related infrastructure in
AZURE Cloud.
The remaining subpages documents the specification of all the core modules available. Here are selected ones:
blueprint.bootstrap - Terraform modules to prepare customer’s AZURE Organization for the Cloud Foundation
deplyoment (mainly storage for the state file).
bluperint.cloud_container - Used to deploy and manage CI/CD functionality within Ki Insurance’s Azure
Environment with rights delegation.
blueprint.core - Terraform modules to create “CORE” management group structure, registers PAL and rotate SPN
secret.
blueprint.audit - Terraform modules to create Audit Log workspace and related resources.
bluperint.network.standard - Terraform modules to deploy network configuration for Cloud Foundation - Central
vWAN/VNET, Shared Vnet, Peerings, DNS, Routes, VPN or Express Route.
bluperint.governance - Terraform modules to deploy custom RBAC roles and Regulatory Compliance initatives.
bluperint.firewall.standard - Terraform modules to deploy Azure Firewall and to manipulate rules.
bluperint.identity.standard - Terraform modules to provisions DC Infrastructure ready to host Domain
Controllers.
27/454
blueprint.management.standard - Terraform modules to create and manage different Azure services such as Log
Analytics, Azure Sentinel, Monitoring, Lighthouse, Monitoring, Alerting, VM patching etc.
blueprint.sharedservices.standard - Terraform modules to provision resources in subscription with the shared
services such as preconfigured Connection Monitor, DNS Private Resolver, private DNS zone, etc.
blueprint.landingzone.standard - Terraform modules to create application environments (projects) with all
needed resources (subscription, vnets, resource groups, permissions, etc.)
blueprint.policies.standard - Terraform modules to create Azure Policies and Initiatives.
blueprint.applicationgateway.standard - Terraform modules to create Azure Application Gateway with WAF
and related resources.
Extensibility
Even though Nordcloud modules does not cover 100% of the functionality of the AZURE Public Cloud, they can be easily
extended or entirely new modules can be written. Those modules could be written either by Nordcloud or Customers
themselves.
28/454
ACF Overview
Nordcloud prepared a so-called Opinionated Azure Foundation, which is recommended by Nordcloud way of Azure
Foundation deployment. It fulfills most of the requirements of the organizations, while still leaving place for customization
where required.
It’s using a set of Azure subscriptions, creates security guardrails, basic Identity and Access Management solution, comes
with audibility and customization possibilities. It also makes sure that every new subscription follows the defined rules.
Diagram below shows a high-level architecture of the services used and resources being created. Link to the larger image
is here.
Management groups and subscription structure
Picture below provides an overview of the Management Group hierarchy being created during Azure Cloud Foundation
deployment with subscriptions being used.
29/454
Be aware that for customers who will grant Nordcloud tenant root group level, Audit will be deployed under tenant root
group level. For customers who will give rights to the customer root level (i.e. Managed Landing Zone), Audit will be
deployed under customer root level.
Purpose details
30/454
Management Group Subscription Purpose/Resources
mg-acf n/a
Intermediate root management group for Azure Cloud Foundation. RBAC and Azure Policies being
common for the entire organisation are applied here. This management group is a parent to all the other management groups created by the Cloud Foundation.
mg-platform n/a
Platform part of the Cloud Foundation where all centralised platform services are located, often managed by central team(s). RBAC and Azure Policies being common for the entire platform are
applied here.
mg-shared-services ACF - Shared Services
Contains subscription dedicated for various shared services, like: DNS Private Resolver, DNS Private
zone, vNet, Route Tables, NSG’s, ASG’s. RBAC and Azure Policies being specific for SharedServices
are assigned to this management group.
mg-management ACF - Management
Constitutes foundation for operations management, monitoring and security by using resources like: Log Analytics Workspace, Automation Account, Sentinel, Function Apps for IPAM, LightHouse,
SandboxAutomation. RBAC and Azure Policies being specific for Management are assigned to this management group.
mg-identity ACF - Identity
Contains dedicated subscription for infrastructure required for Active Directory Domain Services
installation (VMs are not part of it). RBAC and Azure Policies being specific for Identity are assigned
to this management group.
mg-connectivity ACF - Connectivity
Contains dedicated subscription for vWAN or HubSpoke network topology, with central Firewall, VPN/ER Gateway. RBAC and Azure Policies being specific for Connectivity are assigned to this management group.
mg-landing-zones n/a
Parent management group for all Application Landing Zones. RBAC and Azure Policies being
common for the app workloads are applied here.
mg-corp various
Placeholder for future subscriptions containing workloads that might require connectivity to other workloads or to on-premises - which is provided by central hub in connectivity subscription. Direct
internet inbound/outbound connectivity must be prohibited here. RBAC and Azure Policies being
specific for mg-corp are assigned to this management group.
mg-online various
Placeholder for future subscriptions containing workloads that might require direct internet
inbound/outbound connectivity or for workloads that might not require a virtual network at all. RBAC
and Azure Policies being specific for mg-online are assigned to this management group.
mg-hybrid various
Placeholder for future specific subscriptions containing workloads that require connectivity not only to
other workloads or to on-premises - which is provided by central hub in connectivity subscription - but
also direct internet inbound/outbound connectivity. This type of subscription might be used on a
strict exception basis as a last resort. RBAC and Azure Policies being specific for mg-hybrid are
assigned to this management group.
mg-audit ACF - Audit
Contains dedicated subscription for security logs copy. It’s directly under mg-acf, so only organisation wide permissions and policies are applied here, limiting the number of people being able to read or
alter the logs. Sample resources are:. Log Analytics Workspace, Storage Account. RBAC and Azure
Policies being specific for mg-audit are assigned to this management group.
mg-sandbox ACF - Sandbox
Placeholder for future subscriptions containing a playground for POC, exploration of new technologies. Must be isolated from workloads, that’s why RBAC and Azure Policies being specific for mg-sandbox
are assigned to this management group.
mg-decommissioned various Placeholder for subscription being cancelled, so being in Disabled state (prior permanent deletion).
mg-backend ACF - Backend
Contains resources needed for ACF deployment: storage account (to keep Terraform state file),
container registry with docker image, container instances from which actual deployment is performed.
It contains also managed identity which is used as main identity for deployment rights delegation.
Network connectivity
ACF supports two base reference architectures:
Hub&Spoke
Azure vWan
A decision must be made prior to the start of the deployment and will impact other areas in this deployment guide, such as
service connections setup, pipelines etc., and is marked accordingly (Scenario Hub&Spoke or Scenario vWAN) in this
document.
Azure Hub & Spoke
31/454
The hub virtual network acts as a central point of connectivity. The hub is used to connect to your on-premise networks
and the spoke virtual networks are peered with the hub to isolate traffic. This architecture can be deployed with an Azure
Firewall module in order to have more advanced routing and filtering capabilities. Alternatively customer might deploy
their own Network Virtual Appliance as a custom routing engine (not being part of Azure Cloud Foundation).
Please
Note: Not all services (ACF modules) shown in this picture must be provisioned. If you are using Azure Bastion services
where you would like to access all the VMs across the spoke networks then you will need to deploy these services into the
Hub virtual network. Otherwise you will need to deploy an Azure Bastion Network in each of the spoke networks.
Azure vWan
The virtual WAN architecture is a Microsoft SD-WAN solution that brings networking, security and routing functionalities
together to provide a single operational interface to reduce the management efforts compared to the classic hub & spoke model. Azure Firewall is an integral part of the deployment and promotes the solution into a so-called secured vhub.
Resources in subscriptions
ACF solution deploys several categories of resources using applicable pipelines. Resources and pipelines are presented on
the diagrams below.
32/454
Identity and Access Management
Identity and Access Management is in a key role when securing a cloud based environment. It is highly recommended to
follow Microsoft best practices in securing identities.
Azure Cloud Foundation provides custom RBAC roles proven to be useful for segregation of duties, utilizes service
principals for automation and are built to handle identities according to best practices. ACF also provides a Platform
Identity subscription as recommended in Enterprise-Scale, with pre-defined infrastructure for AD domain controllers. (VM
template is not part of the ACF)
Within Project Space Provisioner module, rights to newly created subscription or resource group are delegated to the
selected user or newly created AAD group.
Role-based access control
RBAC is used for Azure administration, allowing fine-grained control on who can do what on a selected scope. Best
practice is to grant users the least privilege to get their work done.
RBAC can be applied to four different scopes in Azure. From the highest scope to the lowest one, they are as follows:
Management group (highest)
Subscription
Resource group
33/454
Resource
RBAC will give customers a way to assign different teams to various management tasks within the Azure subscription. It
gives central IT control over core access and security features, but also allows for a distributed approach to give access to
application owners and other teams to control their specific workloads. Below is a table, which lists the most often used
roles, with custom roles provided by Nordcloud as part of the Cloud Foundation delivery. Please note that custom roles must not be used if given built-in one fulfills given RBAC scenario and still following the least privileges principle.
34/454
Azure IAM Role Description Use Case
Owner Can manage everything, including access Very limited usage, mainly as backup and contact
point. Management group and subscription level.
Contributor Can manage everything, excluding access Typically assigned to AAD group and service
principal on Resource Group level.
Reader Readers can view everything, but can’t make changes Stakeholders that require access to view details of the
subscription and workloads.
Security Reader
View permissions for Microsoft Defender for Cloud. Can
view recommendations, alerts, a security policy, and
security states, but cannot make changes.
Insights for security team to security controls without
granting any permissions to the data.
Network Contributor Lets you manage networks, but not access to them. Can create and manage networks, deployments, list
resources groups and permissions
User Access Administrator Lets you manage user access to Azure resources Cases where user access needs to be modified manually.
Custom - Limited Owner
No rights to change policies. Cannot modify RBAC. Cannot modify classic administrators. Cannot modify management groups i.e. move or place
own subscription in MG
Secure the subscription governance policies from
modification by subscription owners e.g. application
project. More powerful than a contributor, e.g. can use
resource locks.
Custom - Virtual network user Can read virtual networks and subnets Can join network interface(s) to subnet(s)
To be able to join virtual machines to IT controlled
subnets (typically for a larger AAD group).
Custom - KeyVault reader Minimal read permissions for Key Vaults
Applicable for shared Key Vaults to limit visibility to
only the secrets specified in the Access Policy. Other
roles would allow seeing all other Key Vault contents
excluding actual secrets.
Custom - Storage account connection string
reader Read storage account data contents i.e. blob data Used by optional blob storage backup function
Custom - Security operator Can read all
Can use policies Security administrator
Custom - Network manager
Can read all
Can use RBAC and Policies Can modify route tables, VPN and ExpressRoute
Network administrator
Custom - Application owner
Cannot modify RBAC
Cannot modify public IP’s Cannot modify virtual networks Cannot purge key vaults
Application administrator Reduced access to RBAC, Key Vault and network
Custom - Subscription owner Cannot modify RBAC
Cannot modify VPN, route tables or ExpressRoute
Subscription administrator Reduced access to RBAC and network
Custom - Reader Without Bastion
Readers can view everything, except Azure Bastion
resource type. Can’t make changes in resources
Allow to grant reader to resources without risk that
someone will be able to make use of Azure Bastion
Azure includes a wide range of roles for finer grained access management, the complete list can be found from this link.
Acess role blueprints - infrastructure teams
Guiding principals
Looking at various ACF implementations, we noticed that no single customer’s teams are structured the same. That’s why
there are variety of options for team(s) rights delegation. No matter which option will be selected, it’s always
recommended to define in Azure Privileged Identity Manager (PIM), all privileged roles as eligible, instead of granting
pernament and static access.
Another guiding principle is to delegate rights for groups instead doing it directly to users and despite PIM, enable also MFA, Identity Protection and Conditional Acces.
Note: that PIM, Identity Protection and Conditional Access might require addition Azure AD license (i.e. P1 or
P2). Furthermore, configuration of these Azure AD features is not included in the standard Azure Cloud
Foundation product automation but might be delivered as a custom request extension.
35/454
Rights in Azure should be granted using Azure AD-only groups. If the organisation is having presence on-premise and is
using Active Directory Domain Services, it’s recommended to synchronise on-premise identities to the Azure AD in order
to keep better identities management from the single location. If mature group management system is already in place onpremise (and synchronised to the cloud), add on-premises groups to the Azure AD-only group. Otherwise build new
system and add sychnronised identites to the Azure AD-only group directly in order to buld new group management
system. For organisation being cloud only, it would be required to create cloud only identities and next add them to the
respective Azure AD-only group.
There are no negative rights in RBAC, so permissions assigned on management group level will be inherited to all
subscriptions, resource groups and resources being lower in the hierarchy (child or granchild). The same applies for
permissions granted on subscription, where all resources groups and resources within them will inherit rights. Finally all
resources will get permissions set on parental resource group.
Organisations over the time evolves from the cloud adoption and cloud governance teams only to the full blown Cloud
Center of Excellence model. Below graphics ilustrate this process.
> Note:
Based on link1 & link2
Basic rights model
Following Azure IAM roles being available by default in the Azure, below rights matrix is recommended as a starting
point for the most of the deployments. It might be expanded or reduced, depends on the given customer hierarchy
structure. Approperiate mapping of below roles to exact team must be performed. Also for mature - from cloud perspective
- organisation, some of the below teams (i.e. Cloud Platform, Cloud Security, Cloud Network) might be merged into Cloud
Center of Excellence.
Note: Teams mapping and rights delegation is not included in the standard ACF delivery but might be delivered as
a customisation extension.
36/454
IAM role ��
Scope ��
Owner /
SubOwner* Contributor Reader
Security
Reader /
SecOps*
Network
Contributor /
NetOps*
User Access Administrator Various
mg-acf
up to 3
accounts +
automation
SPN
Cloud Security Cloud Identity
mg-platform
Cloud
Platform
Cloud
Operation Cloud Network
mg-shared-services
mg-management
mg-identity
Cloud Identity - DC VM Access
mg-connectivity
Cloud Network - NVA VM
Access
mg-landing-zones Cloud
Operation
Cloud
Platform
Cloud Network
mg-corp
mg-online
mg-hybrid
mg-audit Cloud
Security
Cloud
Platform
mg-sandbox Cloud
Operation
Cloud
Platform
Cloud Network
mg-decommissioned Cloud
Operation
given subscription
under mg-landingzones or
under mg-sandbox
Application Team
mg-backend Cloud
Platform
Cloud
Operation
*Optional custom roles:
SubOwner = Custom - Subscription owner
SecOps = Custom - Security operator
NetOps = Custom - Network manager
Teams short summary:
Cloud Platform - Creation and support of your cloud platform or landing zones.
Cloud Operation - Support and operate adopted solutions. Might be 3rd party - i.e. Nordcloud Managed Cloud.
Cloud Security - Manage information security risk.
Cloud Identity - Manage RBAC and is responsible for the identity (Azure AD + Domain Controllers)
Cloud Network - Team responsible for the network configuration of all network related cloud resources.
Application Team - due to the subscription democratisation, project team is responsible for own solution
Note: Based on link1 & link2
Azure service principal
In the Windows Server Active Directory world, automated tasks are performed by service accounts, be they traditional
dedicated accounts or (group) managed service accounts.
37/454
Azure Active Directory does not have the concept of service accounts, but there is a functional equivalent: Service
Principals. The key to securely performing several tasks is ensuring that unique security principals are used for each
task/application, ensuring they have only the amount of access they need to perform the task in question, and that they’re monitored proactively.
Therefore, to manage Azure Cloud resources and automation tasks, Service Principals and Managed Service identities are
created with least-privilege RBAC permissions for deploying and automating ACF.
Azure Lighthouse
Azure Lighthouse enables multi-tenant management with scalability, higher automation, and enhanced governance across
resources.
In ACF, Lighthouse is being used to provide access to Nordcloud’s Managed Cloud, enabling them to support Managed
Landing Zones. The recommended access is Contributor Level and provided at the ACF root management group level, a
tag can be specified on the subscription to exclude that from Lighthouse management.
Logging and Auditing
Azure Activity Log maintains a complete audit trail of every action that is made in all subscriptions, whether it is by a
user, or an Azure service, via the portal or API. Azure Activity Logs are forwarded to Azure Log Analytics service for
further processing, storing and analysis. As a result, specific events can be monitored and actions or alerts triggered based
on defined API activity. Azure Cloud Foundation default configuration includes three destinations for all logs. Operational
logs are forwarded to Log Analytics workspace in management subscription, activity logs are also forwarded to Audit
subscription and also to a blob storage account in the Audit subscription for archiving. It is important to limit and secure
access to the audit subscription to prevent tampering and deletion. This configuration is enforced by Azure policies, which
enforces subscriptions to send their activity logs into both operational and audit log analytics and audit subscription’s
storage account. The storage account can be configured with Write Once, Read Many (WORM) to achieve immutability of
the audit data. The immutability is based on time-based retention with a default setting of 146 000 days.
Operational log flow
Audit log flow
38/454
Remote Access
ACF Supports both Bastion hosts and Azure Bastion service. Bastion service is deployed to VNETs. Bastion hosts are
deployed in the Shared Services subscription for accessing VMs in the spoke/AppLZ subscriptions. Hosts can be either Windows or Linux. Both are accessible from the on-premises network or internet and use local accounts for authentication.
Monitoring and Alerting
The Azure platform provides a comprehensive capability for monitoring. All data collected by Azure Monitor fits into one
of two fundamental types, metrics and logs. Metrics are numerical values that describe some aspect of a system at a
particular point in time. They are lightweight and capable of supporting near real-time scenarios. Logs contain different
kinds of data organized into records with different sets of properties for each type. Telemetry such as events and traces are
stored as logs in addition to performance data so that it can all be combined for analysis.
ACF provides the foundation to do holistic monitoring of all resources. This includes policies to automatically connect all
resources to defined operational log analytics workspace, automatically deploying monitoring and dependency agents and
auditing to verify this configuration is enforced. ACF also includes a baseline for ACF’s VM monitoring, with predefined
alerts. Default alerting method is email but monitoring can also be integrated to third party tools with webhooks. Detailed
configuration of monitoring and alerting of workloads is part of operational readiness done post-deployment, as it differs
by customers and must follow processes.
39/454
Disaster Recovery and Data Protection
ACF Design resiliency
The solution is designed to be resilient, both in how the resources are defined & deployed and how ACF also supports multi-region redundancy and rapid re-deployments.
IaaS workloads: Redundant duplicate virtual machines for DNS Relay, Bastion hosts, Domain controllers
PaaS workloads: Gateways are highly available and redundant
Business continuity: The whole solution is built as infrastructure-as-code based on parameters, can be re-deployed if
needed
Virtual machine backup
Azure platform provides a built-in service, which provides native backup for all workloads supported by the platform -
using Zero-infrastructure.
ACF provides automation which adds virtual machines to the backup and enforce it. Backup schedules can be modified
according to customer requirements.
Compliance and Security
Azure Security Center (ASC)
ASC is a key platform capability to ensure security posture and compliance. Free version offers basic platform security,
whilst the paid version (Defender) provides additional capabilities and workload protection. Default and recommended
pricing tier is Azure Defender to allow all capabilities to be utilised.
In ACF, Security Center policies per subscription are pre-defined as a best practices baseline, which can be adjusted in the
code. The default configuration with policies and automation acts as a starting point to start improving the security posture
of the customers Azure environment with Azure Security Center.
40/454
Azure Policies
Azure Policy is an essential service in Azure, which is used to create, assign, and manage policies. These policies enforce
different rules and effects over resources, so that those resources stay compliant with customer standards and
requirements. The use of Azure policies plays a significant role in cloud native governance, allowing speed and agility
while retaining control for security, compliance and cost.
With ACF, there is a predefined best practices policy baseline, which should be reviewed and then applied on the management group level as agreed. Automation ensures policy enforcement. Azure Cloud Foundation includes a rich set
of Nordcloud & Enterprise-Scale custom policies.
Naming Convention
Microsoft Cloud Adoption Framework naming best practices are recommended as a naming convention. Naming is
especially important for higher-level objects such as subscriptions and resource groups. From the name, one can quickly
identify the environment’s resources types, service/application, and additional details useful for understanding information
of resources and resource groups, especially useful in inventory and billing. It is important to agree and commit to the
naming standard as it is very difficult to change naming of resources afterwards.
ACF uses a naming convention following CAF best practices for all ACF resources.
Tagging Strategy
Tags are metadata attached to resource groups and resources in the cloud. Tagging is essential for governance, e.g. cost management of the environment.
In ACF, tags and corresponding tagging policies can be customized and deployed using ACF designed automation.
Cost management
This is realized through tagging and could be supported by Nordcloud dedicated product - Nordcloud Klarity (not being
part of ACF), that gives an overview of the cost, spending, reservations within Azure Subscriptions.
Application Landing Zone provisioning
Fast and secure new project provisioning is one of the most demanded feature by the business. Within ACF, Nordcloud
provides solution for that, where within minutes, space (resource group or new subscription) for new project will be
created. It will be performed with rights delegation, network connectivity and security guardrails being applied and
enforced.
41/454
Deploying Azure Cloud Foundation
A. Preface
1. Repository
All customer specific configuration, in a case of managed customers is stored on Github in the (https://github.com/AzureCloud-Foundation/alz-CUSTOMER_NAME) repositories. For non-managed customers, the configuration is stored in the
customer’s own repository.
This repository should be checked out locally, changes developed in branches and ultimately merged to master/main
branch on the customer’s repository to maintain the state (YAML configuration files) and be integrated it with customer’s
CI/CD solution.
All template and initial configuration source repositories with examples are stored on Nordcloud’s Azure Cloud
Foundation Github.
There are a two main repositories there: - acf-terraform that contains the Terraform code for all modules. - template-acfcustomer that contains the Terragrunt code, YAML configuration files and tarball archive of Terraform code. This
repository is cloned into the customer’s repository.
There is also a third repository acf-backend that contains backend configuration for Nordcloud side allowing initial
configuration of the backend (storage account for the Terraform state and containers with managed identity) for the
customer’s repository.
2. Prerequisites
Azure Cloud Foundation code is written in the Terraform and Terragrunt and either can be deployed manually (in a user
session interractively) or automatically (using GitHub actions and containers). For manual deployment user rights in
customer’s environment are laveraged while automated deployment is based on SPN and Managed Identity being created
as a part of the automation.
Technically it is possible to mix together manual and automated deployment BUT it is not recommended and not
supported (mainly due to the risk of resources’ permissions overwrition, missing fw rules, etc).
Initially, the following high level decisions must be taken: - customer name - primary location - service name -
environment name(s) - tenant id(s) - backend subscription id(s) - ACF root level management group(s) - deployment type
(1=managed (federated), 2=unmanaged (federated), 3=managed (secret), 4=unmanaged (secret), 5=unmanaged and no
permissions - manual without SPN)
2.1. Automated Deployment (recommended)
Please, complete the following prerequisites before you initiate Azure Cloud Foundation deployment.
Grant consent for the Nordcloud SPN (nordcloud-acf-tf-multitenant):
edit this link https://login.microsoftonline.com/xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx/adminconsent?
client_id=482312c8-7430-40b1-8a5e-ce1c9b061905, by replacing xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx with a
given customer tenant ID
login using personal account with Global Admin rights in customer’s tenant
open edited link in the browser
accept consent granting
42/454
Assign Entra ID role: Privileged Role Administrator for nordcloud-acf-tf-multitenant (needed to delegate Azure AD
roles for MSI: Application Developer, Group Administrator and Directory Reader)
Create ACF root level management group(s) (ie. mg-acf-prod and mg-acf-test) and set owner rights for nordcloud-acftf-multitenant. If ACF root level suppose to be automatically created then set owner on the Tenant Root Level (needed
to create or import ACF Root Level, and delegate ownership for the MSI)
7 platform subscriptions created and placed under ACF root level (Audit, Backend, Connectivity, Identity, Management, Sandbox, SharedServices)
Customer Github repository created in customer organisation with rights assigned to Nordcloud (only for non- managed customers)
Quota increased on Backend subscription(s) for Azure Container Instances provider - Standard Cores to 30 cores
2.2 Manual Deployment (for interactive code execution without containers & pipelines)
Please, complete the following prerequisites before you initiate Azure Cloud Foundation deployment.
User account executing the code in the customer tenant with:
Azure AD roles: Application Developer, Group Administrator and Directory Reader
Owner rights at ACF root level management group(s) or Tenant root management group
7 platform subscriptions created and placed under ACF root level
Storage Account in the backend subscription for the Terraform state with tfstate container
Customer Github repository created in customer organisation with rights assigned to Nordcloud (only for non- managed customers)
3. GitHub comment based deployment (for automated deployment only)
Automated deployment is created and managed by GitHub workflows having GitHub actions.
The deployment can be triggered by Pull Request’s (PR) comments in the customer’s repository.
The deployment is divided into two stages: plan and apply.
Once the PLAN comment is submitted, automation will return back with the confirmation about tasks to be executed (first
from the workflow, and the from the inside of container). Such information will allow for progress tracking. Sample view
is visible below:
43/454
After a short while, request will be proceesed by the container and returned with the plan output. First contains detailed
Terraform plan output, while second is a short and condense summary about resources creation, deletion or update. It
might look like that:
If the plan is correct, to process further, APPLY comment has to be specified which will trigger the deployment. The
output will be similar to the plan output, but with the final status of the deployment. It might look like that:
4. Architecture considerations of the Azure Cloud Foundation
Each deployment consits by default two ACF environments:
Test ACF without workloads:
This non production test ACF deployment is used only by Nordcloud and no access provided for the customer. It is used
for validating Landing Zone deployments from successful deployment and valid configuration perspective as well as to
validate Azure Cloud Foundation updates.
This organization has nothing to do with customers’ test workloads and environments.
Production ACF for workloads:
This Production ACF deployment is used for customer workloads.
This Organization will have all of the customer’s AZURE environments for their projects/applications, including their test
environments for any given project/application.
All of the prerequisites and details provided above apply to both AZURE deployments.
Customer might decide about number of tiers in the Azure Cloud Foundation production deployment. The default
deployment is a single tier deployment, where all workloads are deployed in the same Azure Cloud Foundation. In some
cases, it is required to have a multitier deployment, where the production and non-production workloads are separated.
For more details read the Multitier ACF deployment architecture section.
B. Deployment initialisation
5. Customer repository (@CF Dev team)
44/454
In order to create a new customer dedicated repository, run “Add New Customer” [https://github.com/Azure-CloudFoundation/template-acf-customer/actions/workflows/acf_cli_customers_add.yml] action workflow filling all required
fields: - customer name (must be unique as it will be used as a repository name - alz-CUSTOMER_NAME) - primary
location (must be provided in the Azure region format, ie. northeurope) - service name (max 3 characters - it’s a part of the
resource name) - environment name (max 4 characters - it’s a part of the resource name too) - tenant id (customer’s tenant
id - one tenant per one environment) - backend subscription id (subscription id where the storage account for the Terraform
state is located - one subscription per one environment) - ACF root level management group(s) (comma separated list of management group ids, if the same tenant then they must be different) - customer repository URL (only for non-managed
customers) - deployment type (1=managed (federated), 2=unmanaged (federated), 3=managed (secret), 4=unmanaged
(secret), 5=unmanaged and no permissions - manual without SPN) ::::note Federated deployment is recommended. Secret
based deployment would require manual pipeline adjustments. ::::
As a consequence, the workflow will: - Create new customer repository in the Azure-Cloud-Foundation organisation as a
clone of template-acf-customer - Define new federation on shared nordcloud-acf-tf-multitenant SPN to the cloned repo -
Create a new SPN (redirected url to https://portal.azure.com , API permissions User.Read) dedicated for given customer
(one per each environment) - Create for above SPN a federation to the cloned repo or a secret (depends on the deployment
type) - Create secret in the key vault with dummy value for PAT token - Assign “KV secret reader” only on above secret to
the newly created SPN(s) - Create PR in the newly cloned repository and write org.hcl - Add newly created SPN(s) with
rights on KV allowing for network ACL manipulation. - Save secret for the customer’s SPN in the Key Vault (depends on
the deployment type)
Sample terragrunt/prod/org.hcl (where prod is an enviornment) file content:
locals {
customer = "nordcloud" #will be replaced with the provided customer name
tenant_id = "xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx" #will be replaced with the provided customer
tenant id
subscription_id = yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy #will be replaced with the provided
customer backend subscription id
environment = "prod" #Take/pre-fill value of parent folder name of terragrunt automatically
acf_root_level = "mg-acf" #will be replaced with the provided ACF root level management
group(s)
service_request_url = "{CUSTOMER_SERVICE_REQUEST_FORM_URL}" #not in use for now
runbook_url = "{CUSTOMER_RUNBOOK_URL}" #not in use for now
customer_lz_documentation_url = "{CUSTOMER_LZ_DOCUMENTATION_URL}" #not in use for now
repository_url = "https://github.com/Azure-Cloud-Foundation/template-acf-customer" #will be
filled with the provided customer repository URL
location = "northeurope" #will be replaced with the provided primary location
location_short = "ne" #will be replaced with computed based on provided primary location
managed_lz = true #will be replaced with the selection if the deployment type is managed or
not
spn_with_secret = false #will be replaced with the selection if the deployment type is with
secret or not
service_name = "sch" #will be replaced with the provided service name
environment_name = "tst" #will be replaced with the provided environment name
image_version = "v1.0" #will be set to the latest container image version
customer_spn_object_id = "zzzzzzzz-zzzz-zzzz-zzzz-zzzzzzzzzzz" #will be set to the newly
created SPN object id
customer_spn_client_id = "aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaa" #will be set to the newly
created SPN client id
}
45/454
This step can be ilustrated by the following diagram:
6. PAT token (@CF Dev team)
Manually generate PAT token targeted to the customer’s cloned repo and update value in the Key Vault -> instruction
https://github.com/Azure-Cloud-Foundation/acfterraform/blob/main/docs/CUSTOMER_PAT_CREATION_FOR_CUSTOMER_REPO.md .
7. Rights for repository (@CF Dev team)
Assign Admin rights for the customer’s repository to the dedicated CF delivery team members.
8. Consent for the customer dedicated SPN (only for the managed customers)
Grant consent for newly created SPN to the customer tenant - https://login.microsoftonline.com/xxxxxxx-xxxx-xxxx-xxxxxxxxxxxxxx/adminconsent?client_id=aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaa, where xxxxxxx-xxxx-xxxx-xxxxxxxxxxxxxx is a given customer tenant ID and aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaa is newly created SPN client ID.
(Client ID and tenant ID can be read from org.hcl). :::note Consent grating would require logon using user account to the
customer tenant(s) having Global Admin permissions. :::
9. Provisioner - aka Bootstrapper
Automated deployment
In order to deploy the backend storage account for the Terraform state state file in the automated manner, go to the newly
created customer repository (https://github.com/Azure-Cloud-Foundation/alz-CUSTOMER_NAME), open already created
pull request and submit GitHub comment with the following content: /PROVISIONER_PLAN_PROD (where PROD is
the environment name, so the TEST environment equivalent would be /PROVISIONER_PLAN_TEST). Next review the
plan output and if it is correct, submit GitHub comment with the following content: /PROVISIONER_APPLY_PROD
(where PROD is the environment name).
The following resources will be created: - Resource Groups - Storage Account - IAM - Reader rights for the dedciated SPN
Automation will also create new terragrunt/prod/provisioner_details.hcl (where prod is an enviornment) file in the
customer’s repository (the same branch as PR is already created) with the newly created storage account resource id.
Sample content:
locals {
storage_account_id = "/subscriptions/yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy/resourceGroups/rg-schtst-ne-001/providers/Microsoft.Storage/storageAccounts/stschkze3424chtstne001"
}
46/454
This step can be ilustrated by the following diagram:
Once deployed, Provisioner MUST NOT be executed again.
Manual deployment
For the manual deployment, the storage account was created already as a part of the prequesites manually. It’s required
however in this step, to create new terragrunt/prod/provisioner_details.hcl (where prod is an enviornment) file in the
customer’s repository and place storage account id in the file (the same structure as above).
10. Cloud Container - aka CI/CD Service (for automated deployment only)
As a deployment continuation, now it’s time to submit a comment for the Cloud Container deployment. The comment
should be submitted in the same PR as the Provisioner deployment. The comment should be in the following format:
/CICD_PLAN_PROD (where PROD is the environment name, so the TEST environment equivalent would be
/CICD_PLAN_TEST). Next review the plan output and if it is correct, submit GitHub comment with the following
content: /CICD_APPLY_PROD (where PROD is the environment name).
The following resources will be created: - Resource group for the CI/CD service - Azure Container Registry - Virtual
Network - Subnet - Route table - Network Security Group - Managed Identity (MSI) - Firewall configuration between the
containers and storage account - Key Vault (only for not managed customers) - IAM - KeyVault Admin rights for the
current user to the KeyVault (only for not managed customers) - Key Vault Secret for PAT token (only for not managed
customers) - IAM - KeyVault Admin rights for the MSI (only for not managed customers) - IAM - various rights for the
dedicated SPN (Contributor on the Resource Group, Managed Identity Operator on the MSI, Virtual Machine Contributor”
on the Virtual Network) - IAM - Entra ID roles (“Application Administrator”, “Groups Administrator”, “Directory
Readers”) for MSI (if enabled)
Automation will also create new terragrunt/prod/cicd_details.hcl (where prod is an enviornment) file in the customer’s
repository (the same branch as PR is already created) with the newly created CI/CD resources details. Sample content:
Lastly, worflow execution will be finalised by execution of following steps: - Import ACR Image from Nordcloud to the
newly created customer’s ACR - Copy State File to Customer Storage Account (for the CI/CD service) - Remove Owner
Permission for the Nordcloud SPN (nordcloud-acf-tf-multitenant) in the Customer tenant (being set in the prerequisites) -
Remove AD Role for the Nordcloud SPN (nordcloud-acf-tf-multitenant) in Customer tenant (being set in the prerequisites)
- Remove Federation for the Nordcloud SPN (nordcloud-acf-tf-multitenant) in the Nordcloud tenant
locals {
acr_name = "acrschtstne001" #Azure Container Resgistry name
image = "acrschtstne001.azurecr.io/cicd:v1.36" #Image path
key_vault_id = "" #KeyVault resource id (only for not managed customers)
msi_client_id = "b8f1d397-8dd3-4b96-b994-3f54bd028ddb" #Managed Identity ID
rg_name = "rg-aci-sch-tst-ne-001" #Resource Group name where resources are created
subnet_name = "snet-sch-tst-ne-001" #Subnet name created within virtual network
user_assigned_id = "/subscriptions/yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy/resourceGroups/rg-schtst-ne-001/providers/Microsoft.ManagedIdentity/userAssignedIdentities/msi-sch-tst-ne-001"
#MSI resource id
vnet_id = "/subscriptions/yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy/resourceGroups/rg-sch-tst-ne001/providers/Microsoft.Network/virtualNetworks/vnet-sch-tst-ne-001" #VNET resource id
}
47/454
This step can be ilustrated by the following diagram:
In case of the resources config update, it’s possible to run CI/CD service workflow again. The following prerequesites must be fulfilled: - Privileged Role Administrato for the customer dedicate SPN (not for nordcloud-acf-tf-multitenant) -
Owner rights at ACF root level management group(s) or Tenant root management group for the customer dedicate SPN
(not for nordcloud-acf-tf-multitenant)
Manual deployment (without CI/CD container)
For the manual deployment, using terragrunt plan and apply commands executed from the CLI, the workstation has to
fulfill following requirements: - Linux based worksation or WSL - Azure CLI installed (version 2.59) - Terraform installed
(version 1.5.2) - Terragrunt installed (version 0.48.0) - Linux packages installed: curl, jq - Powershell Core installed with
Az modules (version 7.4.1) - User account with Owner rights at ACF root level management group(s) or Tenant root management group - User account with Azure AD roles: Application Developer, Group Administrator and Directory
Reader - User logged in with active session in the Azure CLI (after az login) and PowerShell Core (after pwsh -command
“Connect-AzAccount”) - User with GitHub repository rights allowing for commits and PR creation, being cloned to the
local workstation - User’s workstation public IP white listed in the Azure Storage Account (keep TF state files) firewall
settings (see scripts/safirewall.sh as example) - User’s workstation session with environment variable
ORG_ACF_BACKEND_SA being set to the backend storage account resource id and SASToken (see scripts/setenv.sh as
an example) - Prior terragrunt plan/apply execution, decompress the tarball archive with the Terraform code by running
scripts/decompress.sh prod (where prod is sample environment name)
11. Repository copy (for non-managed customers only)
As our deployment automation won’t have rights to the customer GitHub, initially customer dedicated repository for both managed and non-managed customers will be cloned to Nordcloud owned GitHub organisation. Now it’s time to separate
the ownership and copy the repository to the customer’s GitHub organisation. Perform the following steps: - Merge the PR
in the customer’s repository - Download repository content as a zip file - Create new branch in the customer GitHub
repository - Upload the zip file content to the new branch - Create PR in the customer GitHub repository - Merge the PR to
the main/master branch - Set the following environmental variables for the respository (only for automated deployment) -
ORG_ACF_NORDCLOUD_TENANT_ID - with the “dummy” value - ORG_ACF_BACKEND_SA - with the backend
storage account resource id - SASToken - with the SASToken being shared by CF Dev team
For the manual deployment the same three variables have to be defined in the Linux based operating system of the user making interactive deployment. The script located at scripts/setenv.sh might be handy.
After the copy end, archive the customer repository on the Nordcloud side for the audit purpose (it won’t be used any
longer for the Azure Cloud Foundation maintanance).
C. Deployment phase
For the deployment phase, the following blueprint order must be followed (unless given bluepint is optional and not
required by the customer).
In below example prod/PROD is sample environment (it can be replaced for instance with test/TEST for the test
environment):
48/454
Group 1
terragrunt/prod/CORE - /CORE_PLAN_PROD & /CORE_APPLY_PROD
Group 2
terragrunt/prod/CORE/AUDIT - /AUDIT_PLAN_PROD & /AUDIT_APPLY_PROD
terragrunt/prod/CORE/GOVERNANCE - /GOVERNANCE_PLAN_PROD & /GOVERNANCE_APPLY_PROD
terragrunt/prod/CORE/IDENTITY - /IDENTITY_PLAN_PROD & /IDENTITY_APPLY_PROD
terragrunt/prod/CORE/NETWORK - /NETWORK_PLAN_PROD & /NETWORK_APPLY_PROD
Group 3
terragrunt/prod/CORE/APPLICATIONGATEWAY - /APPLICATIONGATEWAY_PLAN_PROD &
/APPLICATIONGATEWAY_APPLY_PROD
terragrunt/prod/CORE/MANAGEMENT - /MANAGEMENT_PLAN_PROD &
/MANAGEMENT_APPLY_PROD
Group 4
terragrunt/prod/CORE/FIREWALL - /FIREWALL_PLAN_PROD & /FIREWALL_APPLY_PROD
terragrunt/prod/CORE/SHAREDSERVICES - /SHAREDSERVICES_PLAN_PROD &
/SHAREDSERVICES_APPLY_PROD
Group 5
terragrunt/prod/CORE/AZUREPOLICIES - /AZUREPOLICIES_PLAN_PROD &
/AZUREPOLICIES_APPLY_PROD
For the initial creation (when the environment is created for the first time) the entire deployment plan can be executed by
using the PR Comment /RUNALL_PLAN_PROD. After the plan review, /RUNALL_APPLY_PROD will trigger all blueprints
deployment (keeping the right order).
The same can be applied for the manual deployment by using terragrunt run-all plan and terragrunt run-all
apply from the terragrunt/prod folder (where prod is an environment).
Prior to the RUNALL deployment, all respective blueprint configuration files must be filled with the required values. For
details see the blueprint documentation.
For the updates, the deployment MUST trigger particular blueprint being subject of the update.
49/454
Below diagram ilustrates the runall and bluepint based deployment concept:
All code adjustments (config files) have to be executed in the deployment branch using the code from customer’s dedicated
repository.
Preface
Before configuring or running deployments, the global_vars will need updating. Navigate to the terragrunt/(prod/test)
folder and open the global_vars.yaml file. Update the configuration. Information on the file is below:
global_vars
This is the global_vars.yaml file which contains the values for the variables used in the blueprint. Variables in this file are
hierarchically inherited to all children configurations and must be defined before the blueprint is applied.
Example of global_vars.yaml
tags:
nc-cf-version: "1.0"
nc-cf-managed: Yes
nc-cf-environment: prod
lock_resources: true
subscription:
audit: xxxxx-xxxxx-xxxx-xxxxx # Replace with the valid target subscription id
connectivity: xxxxx-xxxxx-xxxx-xxxxx # Replace with the valid target subscription id
identity: xxxxx-xxxxx-xxxx-xxxxx # Replace with the valid target subscription id
management: xxxxx-xxxxx-xxxx-xxxxx # Replace with the valid target subscription id
sharedservices: xxxxx-xxxxx-xxxx-xxxxx # Replace with the valid target subscription id
sandbox: xxxxx-xxxxx-xxxx-xxxxx # Replace with the valid target subscription id
# Used by ACF Policies module (dine-nsg-flowlogs and dine-vm-backup-centralised)
acf_locations:
westeurope: we
northeurope: ne
centralindia: ci
50/454
12. Core
Go to “terragrunt/(prod/test)/CORE/” folder.
Edit group_vars.yaml, fill in the required configuration fields accordingly.
Commit and push the changes.
For automated deployment, write PR comment /CORE_PLAN_PROD, review the plan output and if it is correct,
submit /CORE_APPLY_PROD comment. For manual deployment run terragrunt apply command.
13. Audit
Go to “terragrunt/(prod/test)/CORE/AUDIT/” folder.
Edit audit_vars.yaml file, fill in the required configuration fields accordingly. For more details see Audit blueprint
documentation.
Commit and push the changes.
For automated deployment, write PR comment /AUDIT_PLAN_PROD, review the plan output and if it is correct,
submit /AUDIT_APPLY_PROD comment. For manual deployment run terragrunt apply command.
14. Governance
Go to “terragrunt/(prod/test)/CORE/GOVERNANCE/” folder.
Edit governance_vars.yaml file, fill in the required configuration fields accordingly. For more details see Governance
blueprint documentation.
Commit and push the changes.
For automated deployment, write PR comment /GOVERNANCE_PLAN_PROD, review the plan output and if it is
correct, submit /GOVERNANCE_APPLY_PROD comment. For manual deployment run terragrunt apply
command.
15. DC Infra
Go to “terragrunt/(prod/test)/CORE/IDENTITY/” folder.
Edit identity_vars.yaml file, fill in the required configuration fields accordingly. For more details see DC Infra
blueprint documentation.
Commit and push the changes.
For automated deployment, write PR comment /IDENTITY_PLAN_PROD, review the plan output and if it is correct,
submit /IDENTITY_APPLY_PROD comment. For manual deployment run terragrunt apply command.
16. Network
Go to “terragrunt/(prod/test)/CORE/NETWORK/” folder.
Edit network_vars.yaml file, fill in the required configuration fields accordingly. For more details see Network
blueprint documentation.
Commit and push the changes.
For automated deployment, write PR comment /NETWORK_PLAN_PROD, review the plan output and if it is
correct, submit /NETWORK_APPLY_PROD comment. For manual deployment run terragrunt apply command.
17. Application Gateway
Go to “terragrunt/(prod/test)/CORE/APPLICATIONGATEWAY/” folder.
Edit applicationgateway_vars.yaml file, fill in the required configuration fields accordingly. For more details see
Application Gateway blueprint documentation.
Commit and push the changes.
51/454
For automated deployment, write PR comment /APPLICATIONGATEWAY_PLAN_PROD, review the plan output
and if it is correct, submit /APPLICATIONGATEWAY_APPLY_PROD comment. For manual deployment run
terragrunt apply command.
18. Management
Go to “terragrunt/(prod/test)/CORE/MANAGEMENT/” folder.
Edit management_vars.yaml file, fill in the required configuration fields accordingly. For more details see Management blueprint documentation.
Commit and push the changes.
For automated deployment, write PR comment /MANAGEMENT_PLAN_PROD, review the plan output and if it is
correct, submit /MANAGEMENT_APPLY_PROD comment. For manual deployment run terragrunt apply
command.
19. Firewall
Go to “terragrunt/(prod/test)/CORE/FIREWALL/” folder.
Edit firewall_vars.yaml file, fill in the required configuration fields accordingly. For more details see Firewall
blueprint documentation.
Commit and push the changes.
For automated deployment, write PR comment /FIREWALL_PLAN_PROD, review the plan output and if it is
correct, submit /FIREWALL_APPLY_PROD comment. For manual deployment run terragrunt apply command.
20. Shared Services
Go to “terragrunt/(prod/test)/CORE/SHAREDSERVICES/” folder.
Edit sharedservices_vars.yaml file, fill in the required configuration fields accordingly. For more details see Shared
Services blueprint documentation.
Commit and push the changes.
For automated deployment, write PR comment /SHAREDSERVICES_PLAN_PROD, review the plan output and if it
is correct, submit /SHAREDSERVICES_APPLY_PROD comment. For manual deployment run terragrunt apply
command.
21. Policies
Go to “terragrunt/(prod/test)/CORE/AZUREPOLICIES/” folder.
Edit policies_vars.yaml file, fill in the required configuration fields accordingly. For more details see Policies
blueprint documentation.
Commit and push the changes.
For automated deployment, write PR comment /AZUREPOLICIES_PLAN_PROD, review the plan output and if it
is correct, submit /AZUREPOLICIES_APPLY_PROD comment. For manual deployment run terragrunt apply
command.
22. Application Landing Zone
Go to “terragrunt/(prod/test)/APPLZ/” folder.
Create folder using subscription ID (if known) or subscription Name (if newly created) followed by the Application
Name (i.e. yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy_APP1, yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy_APP2,
New_Subscription_APP3, New_Subscription_APP4).
Enter above folder.
Copy .templates/application/app_vars.yaml to the newly created folder.
52/454
Edit app_vars.yaml file, fill in the required configuration fields accordingly. For more details see Application Landing
Zone blueprint documentation.
Commit and push the changes.
For automated deployment, write PR comment
/APP_PLAN_PROD/(SUB_NAME/SUB_ID)_APPLICATION_NAME (i.e. /APP_PLAN_PROD/yyyyyyyy-yyyyyyyy-yyyy-yyyyyyyyyyyy_APP1, /APP_PLAN_PROD/New_Subscription_APP3), review the plan output and if it is
correct, submit /APP_APPLY_PROD/(SUB_NAME/SUB_ID)_APPLICATION_NAME
(i.e. /APP_APPLY_PROD/yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy_APP1,
/APP_APPLY_PROD/New_Subscription_APP3) comment. For manual deployment run terragrunt apply
command. ::::note GitHub comemnts must instead of spaces (in subscription name or application name) use
underscore. :::: — title: Upgrading ACF sidebar_position: 50 id: upgrading-acf —
53/454
Version 1.1
Review automatically created PR.
Copy/Compare *var.yaml file between .tempaltes and terragrunt/$env. Copy file structure keeping still customer
decisions.
Set permissions being prerequisite for the CI/CD pipeline execution (which will upgrade the container image)
owner on the ACF root level and Entra ID Privileged Identity Manager role for customer dedicated SPN.
Run /CICD_PLAN_PROD and /CICD_APPLY_PROD
Run all other blueprints being selected for given customer for the deployment (keeping the order and groups for the
deployment - details in deployment docs).
54/454
Support Team Handbook
This part of the documentation is intended for the support team (i.e. Nordcloud Managed Cloud team). It contains
information on how to support the ACF Platform and is focusing on the most common tasks that the support team will
need to perform.
ACF Plaform consists of the following components: - all Azure resources (and its configuration) being under mg-platform
and mg-audit management groups and below - management group hierarchy under ACF root - policies/initiatives being
defined or linked under ACF root - Defender for Cloud configuration - Network Watchet Connection Monitor
configuration
All Platform Landing Zone (ACF) resources were created using code (IaC) and pipelines. As a consequence, any change
in those resources must be performed by making the change in the respective ACF module and by pipeline execution (via
GitHub comment) afterwards. If the change will be executed directly as an emergency, the break-fix approach must be
shortly after incorporated back into the code and the pipeline must be executed to ensure the synchronised state between
the runtime and the code. Otherwise, pipeline execution with a different state than the runtime can lead to outages, resource
deletion or pipeline failure.
There are some exception to the above, where resources is in the platform but is not maintained using code, i.e.: - records
in the PrivateDNS zones - peerings between Application Landing Zone vnets and the hub VNET
Important notes
Managed ACF
Unmanaged ACF
Editing parameter (*_vars.yaml) files
Editor Branching
Why is branching important for modifications?
Edit a Parameter File
Customising ACF
Intro Creating a custom module Existing modules
New Azure Subscription / Application Landing Zone creation
New Azure Subscription / Application Landing Zone
Add/Change network routes
Adding network routes Adding network routes using PSP API
Modifying default network routes Add VPN connectionfor vWAN
DNS changes: adding, deleting or modifying records, forward zones and
delegation
Adding, Deleting or Modifying records
55/454
Add Forward Zones Disabling an on-premise domain relay
Add New Private DNS Zones
Deploy new IAM/custom RBAC role
Create New Custom Role
Adding new compliance alerts
Add new compliance alerts
Audit log replication changes
Audit log replication changes
Audit logs Filters
Audit logs Filters
Changes to policies
Change Policy Parameter Default Policy Assignment Changes
New rules for Firewall / ACL
Add new custom FW rules Modify existing default FW rules
New Data Collection Rule
New Data Collection Rule
Known Issues
Function App Redeployment - Authentication Failure 401
Policy: dine-vm-backup-centralized-rsv - Remediation failed
Policy: dine-nsg-flowlogs - Remediation failed
Policy: dine-nsg-flowlogs - Complaince on two definitions still say non-compliant after remediating
Policy: dine-vm-backup-centralized-rsv + dine-nsg-flowlogs - Initiative remediation fails Policy: dine-vm-backup-centralized-rsv + dine-nsg-flowlogs - definition remediation fails for specific region Policy: dine-nsg-flowlogs - New NSG’s do not have flow logs configured automatically
Various modules using KeyVault
DCR Associated in function app fails because of no resource provider for Microsoft Maintenence VM Extensions on Windows VMs are failing to install
56/454
FAQ for Ki Insurance Azure Cloud Foundation
General
What is a Cloud Foundation What is a Nordcloud Cloud Foundation Azure Cloud Foundation vs Application Landing Zone
Access and RBAC
Does ACF control RBAC?
What is a Managemnet Group?
What is an Application and how do get a new?
Why does Nordcloud need SPN access to my tenant?
What is the provisioner service account used for?
Service Requests
Standard Service Requests Non standard Service Reqquests and Change Requests My ACF is Unmanaged and help is needed
Networking
Default firewall rules Get SSH/RDP access to my new VM
57/454
End-User Handbook
1. Getting Help
If you have a Managed ACF version, Service / Change Requests and Incidents can be made to the MC team via the Jira
Customer Portal:
https://help.nordcloud.com/
Escalating requests can be made to the Nordcloud Management Escalation Team in accordance to the agreements within
the runbook.
2. Governance
As a user, you are only allowed to createresources in your dedicated Application Landing Zone subscription or Sandbox
subscription. Platform resources changes need to be ordered from the central support team (for Managed ACF it would be Managed Cloud (MC) team), and will be approved or denied on a case by case basis.
The detailed governance constrain can be checked in the Governance and Policy section.
Any other services need to be requested through the proper process.
3. Access Levels
As a regular user, your access to do things is restricted to your needs in developing an application. This is done to prevent
accidental modifications to essential resources and comply with the principle of least privilege.
With your normal user account you should be able to view resources in all of your Application Landing Zones. The
exception here is that your access to sensitive data sets might be limited.
Access to environments is assigned directly for your user or is managed through the usage of the Entra ID groups.
Depending on the groups your user is a part of, you will have certain permissions (owner, contributor, reader).
4. Service Requests
Nordcloud managed your ACF through service requests if your organisaion have subscribed to the Managed Cloud Service
agreement. The Managed Cloud (MC) operations team are the single point of contact for all Incidents and Service Requests
with Norcloud. Needed optional services are also handled through th MC support teams.
Support Model
If your have Managed Cloud Service agreement on your Azure Cloud Foundation it is managed by Nordcloud through
Service Requests. English language is used in spoken & written communication with Nordcloud support.
Standard service hours for incidents and requests per service level are described below. The service level to define the
service hours and response times is defined in the service agreement.
Incident management: 24/7
Standard requests: 8/5
Custom requests: 8/5
In case the customer is buying also Nordcloud Software, Software support is provided per separate service agreement.
58/454
Time to acknowledge, is measured in service time. The service time of 8/5 refers to office hours which are typically 8 hours
a day, 5 days a week. Unless otherwise stated in our agreement, all requests are attended to within service hours, with a 4
hour first response time SLA measured in service hours. The notable exception being incident response times. Service
hours are 08:00 - 16:00 CET excluding public holidays (in Poland).
The Service Request Process
As part of our Managed Cloud standard service, Nordcloud provides the following request channels:
Using Nordcloud Service Desk portal https://help.nordcloud.com/ (primary)
Email (secondary)
Bi-directional ITSM integration using e.g. Exalate or ONEiO (will incur additional configuration and license costs)
For service requests, detailed processes are reviewed and agreed upon during on-boarding and changed in collaboration
with customer upon request. General process steps always include
Acknowledgement of the request
Validation of the source (using agreed methods, against documented valid sources)
Estimation of workload and approval of estimation with customer
Fulfillment of the request
Communication of the resolution back to the request source
Please be sure that additional services, resources, and etc are requested in separate requests. Use each service request for
one feature at a time.
Sample request of New Application Landing Zone
Create a support ticket for the MC team via the Jira Customer Portal at https://help.nordcloud.com/.
Include the following information:
create_new: Is subscription already created? [Yes/No]
name_or_id: If subscription is not yet created, provide it’s desired name. For existing subscription provide it’s ID. management_group_id: The Managemnet Group where subscription will be placed in hierarchy. <mg-corp/mghybrid/mg-internet/mg-sandbox>
name: Name of the application that requires the environment
location: Location of the resources. <Location>
networking type: If networking is required, is connectivity to other applications/on-premise required?
<disconnected/peered>
ipam_network_mask: If networking is required, how big mask VNET should have
ipam_subnet_mask If networking is required, how many subnets and how big mask subnets should have
iam What permissions should be delegated for this Application Landing Zone (i.e. user objectID who will become the
owner)
additional information: Any additional information that you would like to request. <Information>
Detailed list of input parameters for the New Application Landing Zone request can be found in the Application Landing
Zone section.
6. Requesting Exemptions
Azure Cloud Foundation provides certain default limitation in order to provide secure environment for the bussiness. If
neeeded you might raise a service request to create exemption in order to allow specific use case to be handled.
59/454
We might distinguish three main types of exemptions: - Azure Policy - policies are applied to all resources in the
environment. These policies are designed to ensure that the environment is secure and compliant with best practices.
However, there may be cases where you need to request an exclusion from a policy in order to meet your business
requirements. Just to provide few examples, policy might disallow for example to create resources in specific region, to
create certain resource type or will disallow for the specific resource configuration. After disallowe actions, error will be
raised (or UI limitation will be showned) and you will be informed about such situation by approperiate non compliance message. In such case raise a service requesting providing blocked used case, and the reason why you need to create such
resource. Please also specify is exclusion is going to be applied for the entire subscription, resources group or maybe for
the specific resource ID. - Azure Firewall rules - by default all not explicit allow traffic is blocked by the central Azure
Firewall. If you need to allow traffic to or from your Application Landing Zone, you need to request a new firewall rule
from the central support team. In the request please specify source and destination IP addresses, ports and protocols that
should be allowed. Do not forget to specify business justification for the request.
7. TAG based automations
In the ACF we have implemented a set of automations that are based on the tags. So if given functionality was decided to
be implemented then you need to tag the resources properly in order to steer the automation: - Backup of Azure Storage
v2 - if you want to enable backup for the Azure Storage Account you need to tag it with blobBackup tag. The value of the
tag has to be set to true. - Backup of Azure VMs - if you want to enable backup for the Azure VMs you need to tag it with
vm-backup tag. The value of the tag has to be set to enabled. - Automated VM patching - if you want to enable automatic
patching for the Azure VMs you need to tag it with vm-update tag. The value of the tag has to be set to pre-defined
patching window (i.e. 3-tuesday-1200) - Collect VM performance data to Log Analytics - if you want to enable sending
performance data to the Log Analytics you need to tag it with vm-monitor and the value must be the full name of the
DCR. For example Windows-nc-dcr-dev-we-001 - Sandbox automation tags: - delete - if you want to postpone the
deletion of the sandbox resource group, the tag value can be modify to the maximum allowed number of days (default 30) -
vmShutdownTag - if you want to change automatic shutdown hour of the VMs in the sandbox, the tag value has to be set to
desired full hour (i.e. 20). By default value is 16. - VMStart - if you want to set the automatic start hour of the VMs in the
sandbox, the tag value has to be set to desired full hour (i.e. 8). No defaults. - NO-SHUTDOWN - if you want to disable
automatic shutdown of the VMs in the sandbox, the tag value is ignored. No defaults. - subDisable - if you want to
postpone subscription disable date, the tag value has to be set to new number of days the date in the format YYYY/MM/DD.
By default the subscription is disabled after 30 days. - Subscription budget tags: - threshold - budget being allocated for
the specific subscription or resource group (depends where tag is set) - contact - email address of the person who should
be notified about the budget threshold being reached (different contact can be on the subscription and resource group level)
- budget - can be set only at the subscription level and is the total budget for the subscription. The value is in the currency
of the subscription. - LightHouse exclusion: - if you want to exclude the subscription from the Managed Cloud rights
assignemtn (via LightHouse), you need to tag it with Nordcloud-Managed and the value must be set to false.
Details about above tag based automation can be found in the respective module documentation.
The Application Landing Zone automation will remove tags from resource groups and subscriptions if they are not defined
explicity in the app_vars.yaml payload of given Application LZ. If any of above automation is enabled make sure to
include proper tag in your request.
8. Requesting Other Changes to your Environment
All communications other than service requests with Nordcloud are managed by the Customer Success Manager (CSM) in
our Service Delivery Management department. These elements provide you with a clear escalation path, technical
knowledge, and a contact with an understanding of your environment. In addition, they serve as your point of contact for
new projects requiring optional services.
60/454
The CSM ensures that the Nordcloud services are provided as agreed and advocates in your interest, managing continuous
service delivery within the agreed service scope. The CSM secures the quality and financial objectives from Ki Insurance’s
perspective. The CSM also provides the customer a single point of contact for the Nordcloud Managed Cloud Service
offering in general and Nordcloud consultancy services.
In the context of the Ki Insurance Landing Zone, the Nordcloud CSM takes care of the following:
Ensuring requests are delivered to SLA
Arranging joint road mapping sessions and facilitating new feature presentations
Providing timely cost and schedule estimate for major changes to landing zone design
Please refer to your Runbook or Statement-of-Work documents for the CSM’s contact information
61/454
ACF Modules - User Docs
Landing Zones functional parts
Intro
This section describes functional parts of your landing zone (LZ). Normally the information in this section isn’t required to
operate your LZ, we take care of it. However it’s great for orientation and knowledge if you custom requirements.
Boostrapper and Provisioner
The first action Nordcloud runs on an organisation that will recieve a Landing Zone. IT will deploy a folder with a project
inside. The project have very few resources, where the main ones are a Service account “Provisioner” that gains many
administrative roles on the organisation level. This service account is used for anything related to Nordclouds acticities.
The project also contains a storage bucket with the organisations terraform state files.
CI/CD
The second action Nordcloud needs to establish is the CI/CD functionality in your own organisation. For this purpose the
Provisioner project will be used and hosts the resources required to make changes on your Azure Platform.
CORE
The core functionality of the LZ. This builds out a folder structure with all LZ related functions separated by folders and
projects. This part of the LZ is updated regularly on new LZ releases.
Network
This is a folder and project oriented below the CORE deployment and folder. Depending on your configuration it will
deploy a project with three separate VPC’s apply default rules and access and share the VPC’s as a network host project.
By default there are no subnets created when the network deployment is run. - Subnets are created on demand when
initiating new Applications.
Tools
Tools contains several non workload critical functions such as documentation front end
Organizational Units
An Organisation Unit (OU) is the LZ’s way to structure and organise different applications and workloads across your
organisaion. Our practice is to apply roles and access on folders, an OU make it easy to separate access on a very high
level, lets’ say between e.g. Marketing and Finance or between Original Corp, and Aquired. Ltd.
Application
Applications are constructed of one or more different environmnets each enviroment have one or more project where you
create your resources to run your workloads. Each environment may be fully isloated or have common network
connections. There is also a possibility to adapt access and devide it per environment.
organization bootstrapper
This module deploys a foundational provisioning environment in to client environment.
62/454
The environment must be treated as restricted area, with no human day to day access. There is one storage account with
containers created to store terraform plan and state files corresponding to various acf blueprints.
deployments
The following key components required for bootstrapping would be created using this blueprint in the client environment.
Resource group
Storage Account
Storage Containers
resource_group
A resource group would be created in which the storage account for storing terraform state file would be created.
storage_account
A storage account would be created to store the state files
storage_containers
Two storage containers called tfplan and tfstate would be created within the storage account to store the plan and state
files
Example of default bootstrap deployment:
required access for deployment
The bootstrap is run by LZ architects at Nordcloud with the multi-tenant SPN This SPN would be having the following
roles:
rbac roles
Owner on acf root level defined in org hcl file
EntraId roles
append_tags:
nc-cf-deployment-name: blueprint.bootstrap
## custom_service_name : ""
## resource_group_name : ""
## storage_account_name : ""
## storage_enabled : true
## storage_byok_enabled : false
## storage_storageaccount_tier : "Standard"
## storage_storageaccount_replication_type : "GRS"
## storage_supports_https_traffic_only : true
## storage_allow_blob_public_access : false
## storage_min_tls_version : "TLS1_1"
63/454
Privileged Role Administrator
After execution of CICD module, these above permissions for Nordcloud multi-tenant SPN would be removed.
This module also would create terragrunt/prod/provisioner_details.hcl (where prod is an enviornment) file in the
customer’s repository (the same branch as PR is already created) with the newly created storage account resource id.
Sample content:
locals {
storage_account_id = "/subscriptions/yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy/resourceGroups/rg-schtst-ne-001/providers/Microsoft.Storage/storageAccounts/stschkze3424chtstne001"
}
Terraform documentation
The code used to deploy your organisation is updatade regularly. The following link describes possible input variables
when creating your application. Terraform Documentation
cicd
This module takes responsibility for deploying all the essential resources required to implement the container based CI/CD
(Continuous Integration/Continuous Deployment) pipeline for the automated deployment of the Landing Zone. The CI/CD
pipeline has been developed to simplify the deployment process for the various components of the Landing Zone.
To enable the deployment of the Landing Zone within the client’s environment, a combination of Github Actions and
Azure Container Instances were utilized. This integration ensures seamless deployment and synchronization between the
client’s Github Repository and the target environment.
By granting individuals the necessary rights and permissions to the client’s Github Repository, the CI/CD pipeline
empowers them to create a Pull Request that incorporates desired modifications to the Landing Zone. Remarkably, the
automated deployment process can be triggered effortlessly by including specific commands in the comments of the Pull
Request. This streamlined approach provides a convenient and efficient means for authorized individuals to contribute to
the deployment of the Landing Zone. This comprehensive pipeline enhances collaboration and streamlines the process of
deploying changes to the Landing Zone by leveraging version control and automation mechanisms.
deployments
The following key components required for container based cicd would be created using this blueprint in the client
environment.
ACI resource group
Azure Container Registry
Vnet and other network components
Keyvault
User Assigned Identity
SPN Permissions
AzureAD Role Assignment
64/454
aci_resource_group
A dedicated resource group would be created where all the azure container instances would be created.
azure_container_registry
Azure container registy would be created in the client environment in order to store the container image. This container
image would be used to create seperate azure container instances to run the terraform code for each of the blueprints such
as core, network etc.,
vnet
The network components such as vnet, subnets, nsg, route tables also would be created. Azure container instances would
be using this vnet and subnets.
keyvault
A keyvault would be created (only in case of Non-Managed Customer) in order to store the Github PAT token as a secret.
As of now a dummy secret would be created in this keyvault which would be place holder to store the PAT token. The
PAT token must be placed here manually (since as of now github does not provide a API to generate the PAT token
programatically)
This PAT token would be used by Azure container instances to retrieve the code from Github customer dedicated repo.
msi
A user assigned managed system identity(msi) would be created which would be assigned to the azure container instances
(ACI). This msi would be assigned with below necessary rbac roles required for ACI to execute the terraform code.
Role Scope Description
Contributor Backend Storage Account Access on Storage account to retrieve state file
Storage Blob Data Owner Backend Storage Account Access on Storage account to retrieve state file
Owner acf root level defined in org hcl file Access on ACF root level to create ACF
resources
Key Vault Administrator Keyvault Access on keyvault to retrieve PAT token secret
spn_permissions
The following rbac roles would be assigned to the SPN in the client environment. These minimum permissions would be
required for the SPN in order to create azure container instances:
Role Scope Description
Contributor ACI Resource Group
Access on ACI RG to create Azure container
instances
Managed Identity
Operator MSI Access on MSI to assign for ACI
Virtual Machine Contributor vnet Access on Vnet to create ACI using it
Reader vnet Access on Vnet to Read Subnet
Reader Azure Container Registry Access on ACR to pull image
azure_ad_role_assignment
65/454
The following AzureAD roles required also be activated and assigned to the MSI.
Application Administrator
Groups Administrator
Directory Readers
Example of default cicd deployment:
This module also would create new terragrunt/prod/cicd_details.hcl (where prod is an enviornment) file in the customer’s
repository (the same branch as PR is already created) with the newly created CI/CD resources details. Sample content:
locals {
acr_name = "acrschtstne001" #Azure Container Resgistry name
image = "acrschtstne001.azurecr.io/cicd:v1.36" #Image path
key_vault_id = "" #KeyVault resource id (only for not managed customers)
msi_client_id = "b888888-dddd-4444-bbbb-fffffffffff" #Managed Identity ID
rg_name = "rg-aci-sch-tst-ne-001" #Resource Group name where resources are created
subnet_name = "snet-sch-tst-ne-001" #Subnet name created within virtual network
user_assigned_id = "/subscriptions/yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy/resourceGroups/rg-schtst-ne-001/providers/Microsoft.ManagedIdentity/userAssignedIdentities/msi-sch-tst-ne-001" #MSI
resource id
vnet_id = "/subscriptions/yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy/resourceGroups/rg-sch-tst-ne001/providers/Microsoft.Network/virtualNetworks/vnet-sch-tst-ne-001" #VNET resource id
}
post deployment actions
Post deployment of the Azure components in the client environment required for container based CICD environment, the
following actions also would be performed.
Copy state file from NC to customer tenant
Copy ACR image from NC to customer tenant
append_tags:
nc-cf-deployment-name: blueprint.cloud_container
## custom_service_name : ""
## resource_group_name : ""
## route_table_name : ""
## vnet_name : ""
## subnet_name : ""
## nsg_name : ""
## msi_name : ""
## container_registry_name : ""
## msi_ad_roles_enabled : true
## msi_ad_roles :
## - "Application Administrator"
## - "Groups Administrator"
## - "Directory Readers"
## key_vault_name : ""
## key_vault_kek_expiry_days : 1825
## key_vault_enable_purge_protection : true
## key_vault_enabled_for_deployment : false
## key_vault_enabled_for_template_deployment : true
## key_vault_enabled_for_disk_encryption : true
## key_vault_enable_rbac_authorization : true
## key_vault_key_vault_sku : "standard"
## key_vault_access_policies : []
## key_vault_network_acls_bypass : "AzureServices"
## key_vault_network_acls_default_action : "Deny"
## key_vault_network_acls_virtual_network_rules : []
## key_vault_network_acls_ip_rules: []
## storage_network_acls_bypass : ["AzureServices"]
## storage_network_acls_default_action : "Deny"
## storage_network_acls_virtual_network_rules : []
## storage_network_acls_ip_rules : []
66/454
Remove owner permissions for NC shared SPN in customer tenant
Remove AD Roles for NC shared SPN in customer tenant
Remove federation for NC shared SPN in NC tenant
how to use
The container based cicd environment would work as follows
Create a new feature branch in the customer repo.
Update if any changes are required for the given blueprint
Commit and push the code.
Create pull request. Make a comment on the pull request. For eg. to run Audit Blueprint comment as /AUDIT_PLAN_PROD or
/AUDIT_PLAN_TEST based on the environment
Terraform would create a plan with the changes
Verfiy the changes and again make a comment on the pull request as /AUDIT_APPLY_PROD or /AUDIT_APPLY_TEST
based on the environment to apply the changes
67/454
Terraform documentation
The code used to deploy your organisation is updatade regularly. The following link describes possible input variables
when creating your application. Terraform Documentation — id: blueprint-core title: Core sidebar_position: 3 —
core blueprint
The purpose of this module is to deploy core components for the Azure Cloud Foundation.
deployments
The module contains main settings required for the deployment of the core module. The settings are divided into main parts
listed as below:
Global Variables Management Groups
SPN
Partner Link
global_variables
The settings are stored in the global_vars.yaml file and are used to define the main settings for the deployment of the
core module. Variables in this file are hierarchically inherited to all children configurations and must be defined before the
blueprint is applied.
Example of global_vars.yaml
tags:
nc-cf-version: "1.0"
nc-cf-managed: Yes
nc-cf-environment: prod
lock_resources: true
68/454
management_groups
The management groups might be created directly under the tenant root level or they can be placed under existing management group (i.e. mg-acf). Management groups are used to manage access, policies, and compliance across multiple
subscriptions. The Azure management groups support up to six levels of nesting which can be defined in a hierarchy level.
Note: Must remain commented out unless default does not apply. If the default does not apply, please uncomment the
entire schema and adjust values. Default deployment information about this section can be found in the Terraform
Documentation
Example of management groups default deployment:
subscription:
audit: xxxxx-xxxxx-xxxx-xxxxx # Replace with the valid target subscription id
connectivity: xxxxx-xxxxx-xxxx-xxxxx # Replace with the valid target subscription id
identity: xxxxx-xxxxx-xxxx-xxxxx # Replace with the valid target subscription id
management: xxxxx-xxxxx-xxxx-xxxxx # Replace with the valid target subscription id
sharedservices: xxxxx-xxxxx-xxxx-xxxxx # Replace with the valid target subscription id
sandbox: xxxxx-xxxxx-xxxx-xxxxx # Replace with the valid target subscription id
## Used by ACF Policies module (dine-nsg-flowlogs and dine-vm-backup-centralised)
acf_locations:
westeurope: we
northeurope: ne
centralindia: ci
## management_groups_schema:
## management_group_root:
## name: "" #If ACF root level is already created as a part of prerequesites, keep this value
as "". Provide value when rigts are granted on the Tenant Root Level only, so new ACF root
level will be created.
## parent: "" #Usually ACF Root Level is created under Tenant Root Level (which is presented
as "" in this case). It it's not the case, specify the parent management group ID.
## subscription_id: []
## childs:
## management_groups:
## - name: mg-platform
## subscription_id: []
## childs:
## management_groups:
## - name: mg-identity
## acf_reference_name: mg-identity # Do not change this value as it is used to match
subscription ID with modified management group name
## subscription_id: [] # Even when empty, corresponding subscription ID will be
automatically populated (if defined in global_vars.yaml)
## childs:
## management_groups: []
## - name: mg-management
## acf_reference_name: mg-management # Do not change this value as it is used to match
subscription ID with modified management group name
## subscription_id: [] # Even when empty, corresponding subscription ID will be
automatically populated (if defined in global_vars.yaml)
## childs:
## management_groups: []
## - name: mg-connectivity
## acf_reference_name: mg-connectivity # Do not change this value as it is used to
match subscription ID with modified management group name
## subscription_id: [] # Even when empty, corresponding subscription ID will be
automatically populated (if defined in global_vars.yaml)
## childs:
## management_groups: []
## - name: mg-shared-services
## acf_reference_name: mg-shared-services # Do not change this value as it is used to
match subscription ID with modified management group name
## subscription_id: [] # Even when empty, corresponding subscription ID will be
automatically populated (if defined in global_vars.yaml)
69/454
spn_parameters
The SPN will monitor expiration of SPN secret related to service connections in the DevOps portal. The powershell cmdlet
used in this module will based on information from spn_parameters. The script will check expiration date of the SPN
secret. 30 days before of secret expires, the script will check and renew SPN secret for next 3 months. After generating a
new secret, the script will loop through each of service connection in DevOps portal and update service connections that
contain the same Service Principal Id. Finally, the script will remove the old expired secret from AAD. The Service
Principal Name (SPN) must be created in AAD before execution. Default deployment information about this section can be
found in the Terraform Documentation
Example of SPN deployment:
Note: It is important to note, that the paramaters must be carefully considered. In case of SPN secret expires, the service
connections update will cause a short connection outage between DevOps and the Azure portal, so any of the running
pipelines using the same service connections will fail.
partner_details
PAL (Partner Admin Link) enables Microsoft to identify and recognise partners who work with clients to help establish a
footprint in Azure. The PAL should be created/updated at the start of every customer engagement, after receiving access to
the customer’s environment.
## childs:
## management_groups: []
## - name: mg-landing-zones
## subscription_id: []
## childs:
## management_groups:
## - name: mg-corp
## childs:
## management_groups: []
## - name: mg-online
## childs:
## management_groups: []
## - name: mg-hybrid
## childs:
## management_groups: []
## - name: mg-decommissioned
## - name: mg-sandbox
## acf_reference_name: mg-sandbox # Do not change this value as it is used to match
subscription ID with modified management group name
## subscription_id: [] # Even when empty, corresponding subscription ID will be
automatically populated (if defined in global_vars.yaml)
## - name: mg-audit
## acf_reference_name: mg-audit # Do not change this value as it is used to match
subscription ID with modified management group name
## subscription_id: [] # Even when empty, corresponding subscription ID will be
automatically populated (if defined in global_vars.yaml)
## - name: mg-backend
## acf_reference_name: mg-backend # Do not change this value as it is used to match
subscription ID with modified management group name
## subscription_id: [] # Even when empty, corresponding subscription ID will be
automatically populated (if defined in global_vars.yaml)
## spn_enabled: false
## is_devops_project: false
## spn_parameters:
## devops:
## organization_url: https://dev.azure.com/nc-azure-core-infra/
## project_name: ACF3.0 - ESLZ and ACF
70/454
This module is important for Nordcloud, as we are a Microsoft partner; Microsoft needs automatic information to see how
Nordcloud are driving customer success in Azure.
This module provides no functionality to ACF, nor does it add costs or resources in the target environment.
It is utilised as a tool to ensure that Microsoft is aware of Nordcloud’s relationship to clients and to help drive success.
Default deployment information about this section can be found in the Terraform Documentation
Example of partner details deployment:
terraform documentation
The code used to deploy your core may be updated regularly. The following link describes some of the possible input
variables when creating your application. Terraform Documentation
audit blueprint (standard)
The purpose of this module is to deploy audit components for the Azure Cloud Foundation.
The module contains all the necessary audit components like log analytics, storage account, etc.,
deployments
The module contains main settings required for the deployment of the audit. The settings have below main mandatory part:
Logging
logging
The purpose of this module is to provide long-term retention of activity logs across the ACF Environment.
The Audit module is considered the “Source of Truth” when auditing activity logs.
how it works
Generally, the auditing module runs in the background with little maintenance required. All activity logs are forwarded to
this module through the usage of policies.
Permissions to this module should be limited, only people who require access should have access. The audit logs are the
source of truth for the environment.
log analytics
By default, the log analytics workspace has 180 days retention. This can be changed in the parameter file.
For more recent logs, it’s recommended to utilise the log analytics workspace.
Log Analytics supports Kusto Queries. Log Queries in Azure Monitor
partner_link_enabled: true
partner_details:
azure_partner_link:
properties:
partner_id: '1156841'
customer: ACFDevelopment
added_by: name@nordcloud.com
71/454
storage account
The Storage Account is deployed in a WORM (Write Once, Ready Many) state. This ensures that data cannot be modified
or deleted for a user-specified interval, protecting the data from overwrites and deletes.
All logs being captured into Log Analytics are also sent to this storage account as well.
The retention period is configured in the parameter file. By default, it’s configured to the maximum retention period of
146000 days.
It is not recommended to regularly access this storage account. Only access it as and when needed.
There are numerous methods to access the contents of the storage account. Through the portal, storage explorer, API
usages and more.
An example of usage of this would be for general audits. If the business is under audit, requiring logs such as activity logs
in Azure (who deployed what and where) going back through the retention period, then these logs will provide that data.
It is possible resign from the storage account, if the retention period of 730 days on Log Analytics is sufficient
This data is the source of truth with the environment. It cannot be deleted nor overwritten due to WORM policy.
Example of default logging deployment:
how to use
The information stored in the log analytics/ storage account does not need to be accessed often. Only when required.
log_analytics_enabled : true
## log_analytics_workspace_name : "log-sch-audit-tst-ne-002"
## log_analytics_workspace_sku : "PerGB2018"
## log_analytics_retention_in_days : 365
## log_analytics_daily_quota_gb : 10
## storage_enabled : true
## storage_byok_enabled : true
## storage_storageaccount_tier : "Standard"
## storage_storageaccount_replication_type : "RAGRS"
## storage_supports_https_traffic_only : true
## storage_allow_blob_public_access : false
## storage_network_acls_bypass : ["AzureServices"]
## storage_network_acls_default_action : "Deny"
## storage_network_acls_virtual_network_rules : []
## storage_network_acls_ip_rules : []
## storage_min_tls_version : "TLS1_1"
## storage_worm_policy_immutability_period : 1095
## storage_tier_to_cool_in_days : 30
## storage_tier_to_archive_in_days : 90
## storage_delete_in_days: 1095
## key_vault_short_name : "log"
## key_vault_kek_expiry_days : 1825
## key_vault_enable_purge_protection : true
## key_vault_enabled_for_deployment : false
## key_vault_enabled_for_template_deployment : true
## key_vault_enabled_for_disk_encryption : true
## key_vault_enable_rbac_authorization : true
## key_vault_key_vault_sku : "standard"
## key_vault_permissions : {}
## key_vault_network_acls_bypass : "AzureServices"
## key_vault_network_acls_default_action : "Deny"
## key_vault_network_acls_virtual_network_rules : []
## key_vault_network_acls_ip_rules : []
## key_vault_access_policies : []
72/454
More recent logs can be found in the Operational Log Analytics Ref: Log Analytics
permissions
It is recommended to provide access on an as-needed basis. Only Reader access should be provided.
Log Analytics Reader (73c42c96-874c-492b-b04d-ab87d138a893)
Storage Blob Data Reader (2a2b9908-6ea1-4ae2-8e65-a410df84e7d1)
audit log replication changes
Create a new feature branch for the change in the repo.
Check out the newly created branch (i.e. in Visual Studio Code).
Adjust terragrunt_vars.yaml accordingly to set desire retention time for log analytics workspace and storage account.
It’s possible also to completely remove storage account copy (its not recommended)
Commit and push the code.
Create pull request.
Make a comment on the pull request as /AUDIT_PLAN_PROD or /AUDIT_PLAN_TEST based on the environment
Terraform would create a plan with the changes
Verfiy the changes and again make a comment on the pull request as /AUDIT_APPLY_PROD or /AUDIT_APPLY_TEST
based on the environment to apply the changes
terraform documentation
The code used to deploy your core may be updated regularly. The following link describes some of the possible input
variables when creating your application. Terraform Documentation
governance blueprint (standard)
The purpose of this module is to deploy governance components for the Azure Cloud Foundation.
The module contains the governance components like rbac and regulatory compliance.
deployments
log_analytics_enabled : true
## log_analytics_workspace_name : "log-sch-audit-tst-ne-002"
## log_analytics_workspace_sku : "PerGB2018"
## log_analytics_retention_in_days : 365
## log_analytics_daily_quota_gb : 10
## storage_enabled : true
## storage_byok_enabled : true
## storage_storageaccount_tier : "Standard"
## storage_storageaccount_replication_type : "RAGRS"
## storage_supports_https_traffic_only : true
## storage_allow_blob_public_access : false
## storage_network_acls_bypass : ["AzureServices"]
## storage_network_acls_default_action : "Deny"
## storage_network_acls_virtual_network_rules : []
## storage_network_acls_ip_rules : []
## storage_min_tls_version : "TLS1_1"
## storage_worm_policy_immutability_period : 1095
## storage_tier_to_cool_in_days : 30
## storage_tier_to_archive_in_days : 90
## storage_delete_in_days: 1095
73/454
The module contains main settings required for the deployment of the governance. The settings are divided into main mandatory parts listed as below:
Rbac
Regulatory Compliance
rbac
The purpose of this module is to deploy custom RBAC roles that define specific permissions over specific resource types.
These custom RBAC roles provide more granular permissions across the ACF environment.
how to use
ACF deploys with pre-configured RBAC roles, as detailed in the technical documentation here
deployment configuration - adding a new custom rbac role
Add the new custom roles required in here in the following format
name: Prefix with Custom - and add the name of the role after
description: Set a description of the RBAC role
actions: In this list, specify the actions that the role can perform. For example, keyvault read access would look like
this: "Microsoft.KeyVault/vaults/deploy/action" - for more information, refer to here: Custom Roles
not_actions: Specify the control plane actions that are subtracted or exlucded from the Actions that use a wildcard *
regulatory_compliance
The Regulatory Compliance module deploys 3 built-in initiatives which govern specific compliance standards.
The 3 compliance standards deployed are:
CIS (Center for Internet Security)
ISO (International Standards Organisation)
ASB (Azure Security Benchmark)
The development of ACF occurs with these standards in mind, meaning that all ACF modules are checked against these
standards to ensure that there’s no drift.
It is important to note that certain definitions within these initiatives are exempt from scanning. These are detailed in the
Regulatory Compliance technical documentation.
It is also important to understand that there are numerous definitions which will need to be handled during operations.
Relating to RBAC, IAM and MFA.
[ {
name = "Custom - Application owner"
description = "Application owner with reduced access to network and key vault"
actions = ["*"]
not_actions = [
"Microsoft.Authorization/*/write",
"Microsoft.Network/publicIPAddresses/write",
"Microsoft.Network/virtualNetworks/write",
"Microsoft.KeyVault/locations/deletedVaults/purge/action"
]
}
]
74/454
how it works
This module works no differently than standard policies.
Once deployed, compliance scans will start in the background, and remediation of non-compliant policies will be required
- refer to Post Deployment Configuration section.
Example of default regulatory compliance deployment:
regulatory_initiatives:
governance_settings:
# - policy_name: "612b5213-9160-4969-8578-1518bd2a000c"
# initiative_active: true
# management_groups: ["mg-acf"]
# policy_assignment_config:
# assignment_name: "CIS1.3"
# display_name: "Nordcloud CIS Benchmark v1.3.0"
# description: "This initiative includes policies that address a subset of CIS Microsoft
Azure Foundations Benchmark recommendations. Additional policies will be added in upcoming
releases. For more information, visit https://aka.ms/cisazure130-initiative."
# metadata:
# assignedBy: "NC Architects"
# not_scopes: []
# parameters:
# approvedExtensions-c0e996f8-39cf-4af9-9f45-83fbde810432:
# value: [
# "AzureDiskEncryption",
# "AzureDiskEncryptionForLinux",
# "DependencyAgentWindows",
# "DependencyAgentLinux",
# "IaaSAntimalware",
# "IaaSDiagnostics",
# "LinuxDiagnostic",
# "MicrosoftMonitoringAgent",
# "NetworkWatcherAgentLinux",
# "NetworkWatcherAgentWindows",
# "OmsAgentForLinux",
# "VMSnapshot",
# "VMSnapshotLinux",
# "DSC",
# "CustomScriptExtension",
# "OmsAgentForWindows",
# "DatadogLinuxAgent",
# "DatadogWindowsAgent",
# "VMAccessAgent",
# "ConfigurationforWindows",
# "ConfigurationforLinux",
# "MDE.Windows",
# "MDE.Linux",
# "AADLoginForWindows",
# "InstalldcFeatures",
# "VMAccessForLinux",
# "CloudSyncAgent",
# "AzurePolicyForWindows",
# "AzurePolicyForLinux",
# "AzureMonitorWindowsAgent",
# "AzureMonitorLinuxAgent"
# ]
# policy_exemption_config:
# exemptions_name: "CIS1.3"
# display_name: "Exemptions for Nordcloud CIS Benchmark v1.3.0"
# description: "Exemptions for Nordcloud CIS Benchmark v1.3.0"
# metadata:
# requestedBy: "Nordcloud Architects"
# approvedBy: "Nordcloud Architects"
# policy_definition_reference_ids: [
# "6fac406b-40ca-413b-bf8e-0bf964659c25",
# "fbb99e8e-e444-4da0-9ff1-75c92f5a85b2",
# "2a1a9cdf-e04d-429a-8416-3bfb72a1b26f",
75/454
# "c75248c1-ea1d-4a9c-8fc9-29a6aabd5da8",
# "4fa4b6c0-31ca-4c0d-b10d-24b96f62a751",
# "98728c90-32c7-4049-8429-847dc0f4fe37"
# ]
# exemption_category: "Waiver"
# - policy_name: "89c6cddc-1c73-4ac1-b19c-54d1a15a42f2"
# initiative_active: true
# management_groups: ["mg-acf"]
# policy_assignment_config:
# assignment_name: "ISO27001.2013"
# location: "westeurope"
# identity:
# type: "SystemAssigned"
# display_name: "Nordcloud ISO 27001-2013 Benchmark v7"
# description: "This initiative includes policies that address a subset of ISO 27001:2013
controls. Additional policies will be added in upcoming releases. For more information,
visit https://aka.ms/iso27001-init."
# metadata:
# assignedBy: "NC Architects"
# not_scopes: []
# parameters: {}
# enforce: true
# policy_exemption_config:
# exemptions_name: "ISO27001.2013"
# display_name: "Exemptions for Nordcloud ISO27001:2013 Benchmark v7"
# description: "Exemptions for Nordcloud ISO27001:2013 Benchmark v7"
# metadata:
# requestedBy: "Nordcloud Architects"
# approvedBy: "Nordcloud Architects"
# policy_definition_reference_ids: [
# "PreviewAuditExternalAccountsWithOwnerPermissionsOnASubscription",
# "AuditUsageOfCustomRBACRules",
# "PreviewAuditLinuxVmPasswdFilePermissions",
# "PreviewAuditWindowsVmEnforcesPasswordComplexityRequirements",
# "PreviewAuditWindowsVmMaximumPasswordAge70Days",
# "PreviewAuditWindowsVmShouldNotAllowPrevious24Passwords",
# "PreviewAuditWindowsVmMinimumPasswordAge1Day",
# "PreviewAuditWindowsVmPasswordsMustBeAtLeast14Characters",
# "PreviewAuditWindowsVmShouldNotStorePasswordsUsingReversibleEncryption",
# "PreviewAuditLinuxVmAccountsWithNoPasswords",
# "PreviewAuditLinuxVmAllowingRemoteConnectionsFromAccountsWithNoPasswords",
# "Prerequisite_DeployExtensionWindows",
# "Prerequisite_DeployExtensionLinux",
# "AuditDiagnosticSetting",
# "PreviewAuditLogAnalyticsAgentDeploymentVmImageOSUnlisted",
# "PreviewMonitorVmVulnerabilitiesInAzureSecurityCenter",
# "PreviewMonitorOSVulnerabilitiesInAzureSecurityCenter"
# ]
# exemption_category: "Waiver"
# - policy_name: "1f3afdf9-d0c9-4c3d-847f-89da613e70a8"
# initiative_active: true
# management_groups: ["mg-acf"]
# policy_assignment_config:
# assignment_name: "ASBv3"
# location: "westeurope"
# identity:
# type: "SystemAssigned"
# display_name: "Nordcloud Azure Security Benchmark v3"
# description: "The Azure Security Benchmark initiative represents the policies and controls
implementing security recommendations defined in Azure Security Benchmark v2, see
https://aka.ms/azsecbm. This also serves as the Azure Security Center default policy
initiative. You can directly assign this initiative, or manage its policies and compliance
results within Azure Security Center."
# metadata:
# assignedBy: "NC Architects"
# not_scopes: []
# parameters: {}
# enforce : true
# policy_exemption_config:
# exemptions_name: "ASBv3"
76/454
post deployment configuration
The usage of these are the same to that of standard policies.
After deployment, Azure will need a bit of time to scan the environment and get compliance data.
Once complete, in the Compliance Overview page in Azure, the initiative will inform you which policies are noncompliant.
You must remediate these by following the information in the description of the definition.
For example:
1. Navigate to the management group where you targeted the deployment
2. Click on Policies
3. Click on Compliance
# display_name: "Exemptions for Nordcloud Azure Security Benchmark v3"
# description: "Exemptions for Nordcloud Azure Security Benchmark v3"
# metadata:
# requestedBy: "Nordcloud Architects"
# approvedBy: "Nordcloud Architects"
# policy_definition_reference_ids: [
# "authenticationToLinuxMachinesShouldRequireSSHKeysMonitoringEffect",
# "serverSqlDbVulnerabilityAssesmentMonitoring",
# "windowsWebServersShouldBeConfiguredToUseSecureCommunicationProtocolsMonitoringEffect",
# "gcExtOnVMMonitoring",
# "privateEndpointShouldBeConfiguredForKeyVaultMonitoringEffect",
# "vnetEnableDDoSProtectionMonitoring",
# "windowsDefenderExploitGuardMonitoring",
# "windowsGuestConfigBaselinesMonitoring",
# "linuxGuestConfigBaselinesMonitoring",
# "serverVulnerabilityAssessment",
# "gcLinuxDiskEncryptionMonitoring",
# "gcWindowsDiskEncryptionMonitoring",
# "systemUpdatesAutoAssessmentMode",
# "endpointProtectionHealthIssuesMonitoringEffect",
# "installEndpointProtection",
# "systemConfigurationsMonitoring",
# "useRbacRulesMonitoring",
# "certificatesValidityPeriodMonitoring",
# "systemUpdatesV2Monitoring",
# "enableDefenderForApis",
# "ASCDependencyAgentAuditWindowsEffect",
# "ASCDependencyAgentAuditLinuxEffect",
# "AzureFirewallEffect",
# "ArcWindowsMonitoring",
# "ArcLinuxMonitoring",
# "arcEnabledKubernetesClustersShouldHaveAzureDefendersExtensionInstalled",
# "StorageDisallowPublicAccess",
# "VtpmShouldBeEnabledOnSupportedVirtualMachinesMonitoringEffect",
# "previewSecureBootShouldBeEnabledOnSupportedWindowsVirtualMachinesMonitoringEffect",
#
"GuestAttestationExtensionShouldBeInstalledOnSupportedLinuxVirtualMachinesMonitoringEffect",
#
"GuestAttestationExtensionShouldBeInstalledOnSupportedLinuxVirtualMachinesScaleSetsMonitoringEffect",
#
"GuestAttestationExtensionShouldBeInstalledOnSupportedWindowsVirtualMachinesMonitoringEffect",
#
"GuestAttestationExtensionShouldBeInstalledOnSupportedWindowsVirtualMachinesScaleSetsMonitoringEffect",
# "LinuxVirtualMachineShouldUseSignedAndTrustedBootComponentEffect"
# ]
# exemption_category: "Waiver"
77/454
4. Identify the initiative and click on it
5. In the provided list, there will be non-compliant policies, click on one
6. This will open a new page, with 3 tabs: Overview, Policies, Resource Compliance
7. Click on Policies tab
8. This page will tell you exactly what needs to happen in order to maintain compliance.
This is an ongoing task, where it’s recommended to review on a regular basis. During the review, it’s important to
highlight any non-compliant resources and remediate these issues where appropriate.
terraform documentation
The code used to deploy your core may be updated regularly. The following link describes some of the possible input
variables when creating your application. Terraform Documentation
network blueprint (standard)
The purpose of this module is to deploy primary network components for the Azure Cloud Foundation.
The module contains all the necessary network components like vpn, expressroute, bastion, subnets, service endpoints,
route tables or nsg. Firewall module is not included in this blueprint and must be deployed separately.
The network is based on Hub-and-Spoke or vWAN topology and is used as the main entry point for on-premise
connections using either VPN or Express Route
The module allows you to create the custom subnets, route tables or network security groups and it’s essential to note that
the standard ACF delivery does not include custom creation or maintenance. This means that customers may need to
customise their parametrised deployment if they want to use it with. Example: If you want to use a custom NVA, you need
to deploy it separately and configure it to your specific needs. Generally, deploying popular NVAs like Palo Alto,
Checkpoint, or Fortinet is feasible. It is also vital to recognise that the NVA is not a component of the ACF delivery and is
considered a custom module. Therefore, the CLZ team does not provide direct support for resources deployed by custom
modules. Finally, customers should configure their NVA to their specific needs, as there are numerous configuration
possibilities.
This architecture is best described by Microsoft:
Hub-spoke network topology in Azure
vWAN network topology in Azure
deployments
The module contains main network settings required for the deployment of the network. Some of the settings are
optional(marked) and can be used based on the customer’s requirement needs. The settings are divided into main mandatory parts like:
Networks
Connectivity
Sharedservices
Identity
Multi-region
78/454
Custom
networks
In this section you can define the basic mandatory settings required for the deployment. The default deployment is set to
use the hubspoke topology in northeurope region and contains only minimum settings required for the deployment. The most importat is to define the topology, instance, location, location_short and base_network_prefix.
Example of default hubspoke topology deployment:
Example of default vwan topology deployment
connectivity
The default deployment does not include services such as VPN, Express Route, or Bastion. These settings can be utilized
for parametrised deployments based on the customer’s requirements. The marked parameters are optional, so values can
remain as they are in the default deployment. Any other custom subnets, service endpoints, route tables or network security
groups must be unmarked/added. Details in Custom section.
Example of parametrised deployment with VPN, ExpressRoute and Bastion enabled:
settings:
networks:
- enabled: true
topology: "hubspoke"
instance: "instance_001"
location: "westeurope"
location_short: "we"
base_network_prefix: ["10.222.0.0/16"]
connectivity:
config:
- address_space: ["10.222.4.0/22"]
sharedservices:
config:
- address_space: ["10.222.8.0/22"]
identity:
config:
- address_space: ["10.222.12.0/24"]
settings:
networks:
- enabled: true
topology: "vwan"
vwan_is_main_region: true
vwan_name: "vwan-sch-tst-we-002"
vwan_resource_group_name: "rg-sch-tst-we-002"
instance: "instance_002"
location: "westeurope"
location_short: "we"
base_network_prefix: ["10.222.0.0/16"]
connectivity:
config:
- address_space: ["10.222.4.0/22"]
sharedservices:
config:
- address_space: ["10.222.8.0/22"]
identity:
config:
- address_space: ["10.222.12.0/24"]
connectivity:
config:
- address_space: ["10.200.4.0/22"]
# custom_dns_enabled: false
# custom_dns_ip_address: ["10.200.4.196", "10.200.4.197"]
79/454
sharedservices
The sharedservices is by dafault enabled but can be disabled based on the customer’s requirements. The default
deployment include only default services like DNS, Connection Monitor. The Application Gateway or Inbound DNS
Resolver is optional and can be used based on the customer’s needs. Any other custom subnets, service endpoints, route
tables or network security groups must be unmarked/added. Details in Custom section.
Example of parametrised deployment with Application Gateway and inbound DNS Resolver enabled:
azure_bastion:
- enabled: true
# sku: "Standard"
# scaleUnits: 2
# copy_paste_enabled: true
# file_copy_enabled: false
# ip_connect_enabled: false
# tunneling_enabled: false
vpn:
- enabled: true
# network_gateway_sku: "VpnGw2AZ"
# vpn_type: "RouteBased"
# active_active: true
# vpn_gateway_generation: "Generation2"
# gateway_public_ip_name1: "pip-vgw-sch-tst-ci-001"
# gateway_public_ip_name2: "pip-vgw-sch-tst-ci-001"
# availability_zones: ["1", "2", "3"]
# enable_bgp: false
express_route:
- enabled: true
# network_gateway_sku: "ErGw3AZ"
# vpn_type: "PolicyBased"
# pip_sku: "Standard"
# gateway_public_ip_name1: "pip-vgw-sch-tst-ci-001"
# availability_zones: ["1", "2", "3"]
# enable_bgp: false
sharedservices:
config:
- address_space: ["10.200.8.0/22"]
# enabled: true
# custom_dns_enabled: true
# custom_dns_ip_address: ["10.200.4.196", "10.200.4.197"]
# azure_bastion_enabled: true
subnets:
- subnet: connectionmonitor
enabled: true
# name: "snet-monitor"
# address_prefixes: ["10.200.8.32/29"]
# deploy_route_table: true
# deploy_service_endpoints: true
# deploy_network_security_group: true
- subnet: applicationgateway
enabled: true
# name: "ApplicationGatewaySubnet"
# address_prefixes: ["10.200.8.128/26"]
# deploy_route_table: true
# deploy_service_endpoints: true
# deploy_network_security_group: true
- subnet: dnsprinbound
enabled: true
# name: "snet-dnsprinbound"
# address_prefixes: ["10.200.10.0/25"]
80/454
identity
The sharedservices is by dafault enabled but can be disabled based on the customer’s requirements. The default
deployment include only default DCS services like vnet, nsg, service endpoints and route table. The custom subnets,
service endpoints, route tables or network security groups must be unmarked/added. Details in Custom section.
Example of parametrised deployment include custom service endpoints, route tables or network security groups:
# deploy_route_table: true
# deploy_service_endpoints: true
# deploy_network_security_group: true
- subnet: dnsproutbound
enabled: true
# name: "snet-dnsproutbound"
# address_prefixes: ["10.200.11.0/25"]
# deploy_route_table: true
# deploy_service_endpoints: true
# deploy_network_security_group: true
identity:
config:
- address_space: ["10.200.12.0/24"]
enabled: true
# custom_dns_enabled: false
# custom_dns_ip_address: ["10.200.4.196", "10.200.4.197"]
# whitelist_network_ranges: ["10.0.0.0/8", "172.16.0.0/16"]
# azure_bastion_enabled: true
subnets:
- subnet: dcs
enabled: true
# name: "snet-dc-dev-eu-001"
# address_prefixes: ["10.200.12.0/26"]
# deploy_route_table: false
# deploy_service_endpoints: false
# deploy_network_security_group: true
service_endpoints:
- service: Microsoft.AzureActiveDirectory
# - service: Microsoft.AzureCosmosDB
# - service: Microsoft.ContainerRegistry
# - service: Microsoft.EventHub
# - service: Microsoft.KeyVault
# - service: Microsoft.ServiceBus
# - service: Microsoft.Sql
# - service: Microsoft.Storage
# - service: Microsoft.Web
network_security_groups:
- subnet: dcs
security_rules:
- name: "in-allow-onprem-dc-traffic-azure-dc"
protocol: "*"
sourcePortRange: "*"
destinationPortRanges: ["49152-65535", "53"]
sourceAddressPrefixes: ["172.16.0.0/16", "10.0.0.0/8"]
destinationAddressPrefixes: ["10.200.12.0/26"]
access: "Allow"
priority: 110
direction: "Inbound"
description: "Default allow rule, blocks allow inbound traffic"
route_tables:
- subnet: dcs
disable_bgp_route_propagation: true
routes:
- name: "default-route-internet"
address_prefix: "0.0.0.0/0"
next_hop_type : "VirtualAppliance"
81/454
multi-region
The Networks can be used to deploy multiple networks with different topologies and regions. In case of using the same
region for multi networks, the instance parameter must be unique per region. In HubSpoke topology, the peering between
Hub networks is created automatically by default. The vHub within vWAN are peered by default. Any of extra peering must be added manually in section multi_region_hub_peering. The section multi_region_hub_peering is optional but if
used then all parameters must be defined.
Example of adding extra custom peering
Example of default hubspoke topology deployment in two regions:
custom
The custom subnets, service endpoints, route tables or network security groups can be added manually in the Connectivity,
Sharedservices and Identity section. The custom subnets, service endpoints, route tables or network security groups
required all mandatory parameters to be defined.
Example of adding new custom subnets, service endpoints, route tables or network security groups:
next_hop_in_ip_address : "10.10.10.1"
multi_region_hub_peering:
- vnet_id: "/subscriptions/1111ce11-1111-1111-111b-d1111111111/resourceGroups/rg-schnetwork-tst-ci-005/providers/Microsoft.Network/virtualNetworks/vnet-sch-hub-tst-ci-005"
use_remote_gateways: false
allow_gateway_transit: true
allow_forwarded_traffic: true
allow_virtual_network_access: true
remote_location_short: "we"
remote_instance: "instance_005"
settings:
networks:
- enabled: true
topology: "hubspoke"
instance: "instance_001"
location: "westeurope"
location_short: "we"
base_network_prefix: ["10.222.0.0/16"]
connectivity:
config:
- address_space: ["10.222.4.0/22"]
sharedservices:
config:
- address_space: ["10.222.8.0/22"]
identity:
config:
- address_space: ["10.222.12.0/24"]
- enabled: true
topology: "hubspoke"
instance: "instance_001"
location: "northeurope"
location_short: "ne"
base_network_prefix: ["10.222.0.0/16"]
connectivity:
config:
- address_space: ["10.222.4.0/22"]
sharedservices:
config:
- address_space: ["10.222.8.0/22"]
identity:
config:
- address_space: ["10.222.12.0/24"]
82/454
terraform documentation
The code used to deploy your core may be updated regularly. The following link describes some of the possible input
variables when creating your application. Terraform Documentation
identity blueprint
The purpose of this module is to deploy necessary components for the Domain Controllers infrastructure (VMs are not a
part of the ACF).
This module will deploy the platform level resources to support deployment of domain controller virtual machines. The
components like virtual network, subnets, network security group and route table are part of Network blueprint and are not
included in this module. More information about the network components can be found in Network blueprint.
deployments
The module contains main settings required for the deployment of the identity. The settings are divided into main mandatory parts listed as below:
Networks
Keyvault
Post deployment
networks
subnets:
- subnet: test
enabled: true
name: "testSubnet"
address_prefixes: ["10.222.6.0/26"]
deploy_route_table: true #if true, route table must be defined in
section route_tables
deploy_service_endpoints: true
deploy_network_security_group: true #if true, network security group must be
defined in section network_security_groups
service_endpoints:
- service: Microsoft.AzureActiveDirectory
network_security_groups:
- subnet: test #subnet name must be the same as defined in
subnets section
security_rules:
- name: "in-allow-onprem-dc-traffic-azure-dc"
protocol: "*"
sourcePortRange: "*"
destinationPortRanges: ["49152-65535", "53"]
sourceAddressPrefixes: ["172.16.0.0/16", "10.0.0.0/8"]
destinationAddressPrefixes: ["10.200.12.0/26"]
access: "Allow"
priority: 110
direction: "Inbound"
description: "Default allow rule, blocks allow inbound traffic"
route_tables:
- subnet: test #subnet name must be the same as defined in
subnets section
disable_bgp_route_propagation: true
routes:
- name: "default-route-internet"
address_prefix: "0.0.0.0/0"
next_hop_type : "VirtualAppliance"
next_hop_in_ip_address : "10.10.10.1"
83/454
In this section you can define the mandatory settings for the deployment. The default deployment contains only minimum
settings and can be extended with additional settings if needed. The most importat is to define the values like
dc_infra_enabled, topology, instance, location, location_short. It is possible to deploy multiple instances of identity for eg.,
in a different region by declaring a new instance of dc_infra with related configuration in below.
Example of multiple instances of identity deployment:
keyvault
The module will deploy a resource group and a keyvault in the specified location. A keyvault is also deployed with
appropriate configuration ready to store secrets and keys for the Domain Controllers. It is possible to deploy multiple
keyvaults in the same region with related configuration like in below.
Example of multiple keyvaults deployment:
post_deployment
The Domain Controllers themselves are not included in the ACF deployment. While this module deploys the infrastructure
to support them, they will need to be deployed and managed separately.
terraform documentation
dc_infra_enabled: true
dc_infra_settings:
dc_infra:
- enabled: true
instance: "instance_001"
location: "northeurope"
location_short: "ne"
- enabled: true
instance: "instance_002"
location: "westeurope"
location_short: "we"
key_vaults: #mandatory first
key_vault
- key_vault: "default" #mandatory
key_vault_enable_purge_protection: false #optional
key_vault_enabled_for_deployment: false #optional
key_vault_enabled_for_template_deployment: false #optional
key_vault_enabled_for_disk_encryption: false #optional
key_vault_enable_rbac_authorization: true #optional
key_vault_key_vault_sku: standard #optional
key_vault_permissions: #optional
Key Vault Administrator: ["f11d194e-1166-4026-81de-5a21dd817f9f"] #sample
Key Vault Reader: ["f11d194e-1166-4026-81de-5a21dd817f9f"] #sample
key_vault_access_policies: #optional
- tenant_id: "8111a120-d92b-4906-8da8-98f9b7e392fd" #sample
object_id: "f11d194e-1166-4026-81de-5a21dd817f9f" #sample
key_permissions: ["Get"] #sample
secret_permissions: ["Get"] #sample
storage_permissions: ["Get"] #sample
certificate_permissions: ["Get"] #sample
key_vault_network_acls_bypass: "AzureServices" #optional
key_vault_network_acls_default_action: "Deny" #optional
key_vault_network_acls_ip_rules: [] #optional
key_vault_network_acls_virtual_network_rules: [] #optional
- key_vault: "Another" #mandatory second
key_vault
name: "kv-name-custom" #mandatory
key_vault_enable_purge_protection: false #optional
84/454
The code used to deploy your core may be updated regularly. The following link describes some of the possible input
variables when creating your application. Terraform Documentation — id: blueprint-applicationgateway-standard title:
Application Gateway sidebar_position: 7 —
application gateway blueprint
The purpose of this module is to provide a centralised Application Gateway service to serve as layer 7 load balancing
option for http based applications.
It’s important to note that this module is not a requirement. It’s an option available for environments that wish to consume
a centralised Application Gateway.
Each target environment is different and has different requirements. While ACF does not prevent Application Gateways
being deployed directly to Application Landing Zones, having a centralised, shared Application Gateway can provide some
benefits.
Having a centralised Application Gateway in shared services can provide internal as well as public access to applications
that require http load balancing, without requiring to allow Public IP’s being deployed in said target Application Landing
Zone.
Additionally, centralising the Application Gateway reduces costs.
To sum this up, deploying this module is down to the requirements for the target environment.
While some environments may prefer to have local application gateways per application, this shared application gateway
provides additional options that can reduce ‘exclusions’ being made to existing environments to allow Public IPs.
It is worth mentioning that Application Gateway is supported in the version 1 and version 2. The version 1 is still
supported by Microsoft but it is recommended to use the version 2. Detailed comparison between Application Gateway v1
and v2 is available under this link
deployments
The module contains main settings required for the deployment of the Application Gateway service. The settings are listed
below:
Application Gateway
Frontend IP Configuration
HTTP Listener
Request Routing Rule
Backend
application_gateway
For routes associated to subnet containing Application Gateway V2, please ensure ‘0.0.0.0/0’ uses NextHopType as
‘Internet’ (this is required for both architectures: Hub&Spoke and vWAN).
For the Hub & Spoke architecture, any scenario where internal backend being published for the AppGw, would require
custom peering to the AppGw Vnet to work, due to AppGw v2 UDR limitation. Also traffic comming fron on-prem
towards private Application Gateway listener will be affected due to asymetric routing and will not work.
As an alternative, Application Gateway V1 might be used which supports UDR (can route incoming traffic as well as
backend traffic through Azure Firewall) but does not contain some new feature and capabilities (and configuration updates
take even 10 times longer).
85/454
For the vWAN architecture, as spokes are using system routes injected by the vHUB (instead of using UDR) Application
Gateway v2 works just fine (as mentioned earlier subnet containing Application Gateway V2 must has ‘0.0.0.0/0’ with
NextHopType as ‘Internet’ only).
For routes associated to subnet containing Application Gateway V2, please ensure ‘0.0.0.0/0’ uses NextHopType as
‘Internet’ (this is required for both architectures: Hub&Spoke and vWAN).
how to use
SSL certificates must be uploaded (outside of this code) to the KeyVault prior running the pipeline
Update default configuration with desired application configration (default can be overwritten)
For the public cert saving use this guide
Example of default application gateway deployment with optional possibilites:
applicationgateway_enabled: true
applicationgateway_settings:
applicationgateway:
- enabled: true
instance: "instance_001" #MANDATORY (with _001 ending)
# custom_service_name: "cust" #OPTIONAL, To be used in the name of the resources, to replace
the default service name
# resource_group_name: "rg-name-custom" #OPTIONAL, To replace default resource group name
location: "westeurope" #MANDATORY
location_short: "we" #MANDATORY
# key_vaults: #OPTIONAL to overwrite defaults
# - key_vault: "default" #MANDATORY, if above key_vaults is defined
# key_vault_enable_purge_protection: false #OPTIONAL
# key_vault_enabled_for_deployment: false #OPTIONAL
# key_vault_enabled_for_template_deployment: false #OPTIONAL
# key_vault_enabled_for_disk_encryption: false #OPTIONAL
# key_vault_enable_rbac_authorization: true #OPTIONAL
# key_vault_key_vault_sku: standard #OPTIONAL
# key_vault_permissions: #OPTIONAL
# Key Vault Administrator: ["fa1d194e-1166-4026-81de-5a21dd817f9f"] #SAMPLE
# Key Vault Reader: ["fa1d194e-1166-4026-81de-5a21dd817f9f"] #SAMPLE
# key_vault_access_policies: #OPTIONAL
# - tenant_id: "8221a120-d92b-4906-8da8-98f9b7e392fd" #SAMPLE
# object_id: "fa1d194e-1166-4026-81de-5a21dd817f9f" #SAMPLE
# key_permissions: ["Get"] #SAMPLE
# secret_permissions: ["Get"] #SAMPLE
# storage_permissions: ["Get"] #SAMPLE
# certificate_permissions: ["Get"] #SAMPLE
# key_vault_network_acls_bypass: "AzureServices" #OPTIONAL
# key_vault_network_acls_default_action: "Deny" #OPTIONAL
# key_vault_network_acls_ip_rules: ["195.85.252.5"] #OPTIONAL
# key_vault_network_acls_virtual_network_rules: [] #OPTIONAL
appgws:
- appgw: default #MANDATORY, and MUST NOT BE CHANGED for the first instance
# version: 2 #no new deployments with version 1 (due to deprecation by Microsoft)
# appgw_name: appgw-custom-we-001
# availabililty_zones: ["1", "2", "3"] #Only for AppGW v2
# private_ip_address: "10.222.8.133"
# autoscale_configuration: #Only for AppGW v2
# minCapacity: 1 #Only for AppGW v2
# maxCapacity: 10 #Only for AppGW v2
# sku_name: WAF_v2
# sku_tier: WAF_v2
# enable_http2: false
# delegate_control: false
# gateway_ip_configuration_name: appGatewayIpConfig
86/454
# gateway_ip_configuration_subnet_id: /subscriptions/xxxxx-xxxxxx-xxxxxxxxxxxxx/resourceGroups/rg-sch-network-tst-we001/providers/Microsoft.Network/virtualNetworks/vnet-sch-sharedservices-tst-we001/subnets/ApplicationGatewaySubnet
# frontend_ip_configuration:
# - name: appGwPrivateFrontendIp
# public_ip_address_id: null
# #private_ip_address: "10.222.8.133"
# private_ip_address_allocation: Static
# subnet_id: /subscriptions/xxxxx-xxxxxx-xxxxxxx-xxxxxx/resourceGroups/rg-sch-networktst-we-001/providers/Microsoft.Network/virtualNetworks/vnet-sch-sharedservices-tst-we001/subnets/ApplicationGatewaySubnet
# private_link_configuration_name: null
# - name: default-frontendIpConfiguration
# public_ip_address_id: /subscriptions/xxxxx-xxxxxx-xxxxxxx-xxxxxx/resourceGroups/rgsch-appgw-tst-we-001/providers/Microsoft.Network/publicIPAddresses/pip-appw-custom-we-001
# private_ip_address: null
# private_ip_address_allocation: null
# subnet_id: null
# private_link_configuration_name: null
# frontend_port:
# - name: default-port80
# port: 80
# backend_address_pool:
# - name: default-backendAddressPool
# ip_addresses: null
# fqdns: ["nordcloud.com"]
# backend_http_settings:
# - name: default-backendHttpSettings
# port: 80
# protocol: Http
# cookie_based_affinity: Enabled
# host_name: nordcloud.com
# pick_host_name_from_backend_address: false
# affinity_cookie_name: ApplicationGatewayAffinity
# request_timeout: 20
# path: /
# probe_name: default-probe
# authentication_certificate: null
# trusted_root_certificate_names: null # list of strings [""]
# connection_draining: null
# http_listener:
# - name: default-httpListener
# frontend_port_name: default-port80
# frontend_ip_configuration_name: appGwPrivateFrontendIp
# protocol: Http
# host_names: ["nordcloud.com"]
# require_sni: false
# ssl_certificate_name: null
# ssl_profile_name: null
# custom_error_configuration: null
# firewall_policy_id: null
# request_routing_rule:
# - name: default-routingRule
# http_listener_name: default-httpListener
# backend_address_pool_name: default-backendAddressPool
# backend_http_settings_name: default-backendHttpSettings
# rule_type: Basic #or PathBasedRouting to include url_path_map
# priority: 10
# redirect_configuration_name: null #MUST BE NULL IF NOT IN USE
# url_path_map_name: null #MUST BE NULL IF NOT IN USE
# rewrite_rule_set_name: null #MUST BE NULL IF NOT IN USE
# probe:
# - name: default-probe
87/454
# protocol: Http
# port: null
# host: nordcloud.com
# path: /
# interval: 30
# timeout: 30
# unhealthy_threshold: 3
# pick_host_name_from_backend_http_settings: false
# minimum_servers: 0
# match:
# - status_code: ["200-399"]
# body: null
# url_path_map: #for PathBasedRouting
# - name: sample-routing-rule
# default_backend_address_pool_name: default-backendAddressPool #Cannot be set if
default_redirect_configuration_name is set.
# default_backend_http_settings_name: default-backendHttpSettings #Cannot be set if
default_redirect_configuration_name is set.
# default_redirect_configuration_name: null #Cannot be set if either
default_backend_address_pool_name or default_backend_http_settings_name is set.
# default_rewrite_rule_set_name: null #Only valid for v2 SKUs.
# path_rule:
# - name: apps
# paths: ["/apps/*"]
# backend_address_pool_name: default-backendAddressPool #Cannot be set if
redirect_configuration_name is set.
# backend_http_settings_name: default-backendHttpSettings #Cannot be set if
redirect_configuration_name is set
# redirect_configuration_name: null #Cannot be set if backend_address_pool_name
or backend_http_settings_name is set.
# rewrite_rule_set_name: null #Only valid for v2 SKUs.
# firewall_policy_id: null
# waf_configuration:
# - enabled: true
# firewall_mode: Detection
# rule_set_type: OWASP
# rule_set_version: 3.2
# file_upload_limit_mb: 100
# max_request_body_size_kb: 128
# request_body_check: true
# disabled_rule_group: []
# exclusion: []
# force_firewall_policy_association: true
# firewall_policy_id: /subscriptions/xxxxx-xxxxxx-xxxxxxx-xxxxxx/resourceGroups/rg-schappgw-tst-we001/providers/Microsoft.Network/ApplicationGatewayWebApplicationFirewallPolicies/waf-schtst-we-001
# waf_policy: #If uncommented, name, rule_set_version & rule_group_name (and their
parents) must be uncommented too
# - name: waf-sch-tst-we-001
# global: true #true if global policy for the entire AppGW
# policy_settings:
# enabled: true
# mode: Detection
# request_body_check: true
# file_upload_limit_in_mb: 100
# max_request_body_size_in_kb: 128
# managed_rule_set:
# - rule_set_type: OWASP
# rule_set_version: 3.2
# rule_group_override:
# - rule_group_name: REQUEST-920-PROTOCOL-ENFORCEMENT
# rule:
# - action: Block
# enabled: true
# id: 920350
# exclusion:
88/454
# - match_variable: RequestHeaderNames
# selector_match_operator: EqualsAny
# selector: User-Agent
# excluded_rule_set:
# - type: "OWASP"
# version: 3.2
# rule_group:
# - rule_group_name: REQUEST-920-PROTOCOL-ENFORCEMENT
# excluded_rules: ["920350"]
# custom_rules:
# - name: allowipaddress
# priority: 5
# rule_type: MatchRule
# action: Allow
# match_conditions:
# - match_variables:
# - variable_name: RemoteAddr
# operator: IPMatch
# negation_condition: false
# match_values: ["10.222.8.24"]
# rewrite_rule_set:
# - name: test-ruleset
# rewrite_rule:
# - name: NewRewrite
# rule_sequence: 100
# condition: []
# request_header_configuration:
# - header_name: Accept
# header_value: foo
# response_header_configuration: []
# url: []
# redirect_configuration:
# - name: default-redirect
# redirect_type: Permanent
# target_listener_name: null #Cannot be set if target_url is set.
# target_url: http://nordcloud.com #Cannot be set if target_listener_name is set.
# include_path: false
# include_query_string: false
# ssl_certificate:
# - name: nordcloud.com
# key_vault_secret_id: https://{keyvaultname}.{keyvaultdomain}/secrets/{secretname}
# ssl_profile: #Only for AppGW v2
# - name: default-sslProfile
# trusted_client_certificate_names: []
# verify_client_cert_issuer_dn: false
# verify_client_certificate_revocation: "OCSP"
# ssl_policy:
# policy_name: AppGwSslPolicy20170401S
# policy_type: Predefined
# disabled_protocols: []
# min_protocol_version: TLSv1_2
# cipher_suites: []
# trusted_root_certificate: #Only for AppGW v2
# - name: nordcloud.com
# data: MIIDNDCCAhyg-SAMPLE-3r0RCJY3G9jESPo8enFF6HxvYWai58hmaib0= #base64 encoded
certificate, must be null if key_vault_secret_id is set
# key_vault_secret_id: https://{keyvaultname}.{keyvaultdomain}/secrets/{secretname}
#must be null if data is set
# trusted_client_certificate: #Only for AppGW v2
# - name: nordcloud.com
# data: MIIDNDCCAhyg-SAMPLE-3r0RCJY3G9jESPo8enFF6HxvYWai58hmaib0= #base64 encoded
certificate
# authentication_certificate: #Only for AppGW v1
# - name: nordcloud.com
89/454
frontend_ip_configuration
Frontend IP configuration is a component responsible for defining the frontend IP address and port that the Application
Gateway uses to listen for incoming traffic. It is possible to define one or more frontend IP configurations to handle
incoming traffic.
Example of parametrised frontend IP configuration:
http_listener
HTTP listener is a component responsible for listening to incoming HTTP requests on a specific port and forwarding them
to the appropriate backend pool based on routing rules It is possible to define one or more HTTP listeners to handle
incoming traffic. Each listener is associated with a frontend IP configuration and a specific port. When a request arrives at
the Application Gateway’s frontend IP address and port, the listener examines the request and determines which backend
pool to route it to based on the listener’s associated routing rules.
Example of parametrised HTTP listener configuration with SSL:
Example of parametrised HTTP listener configuration with WAF(only V2):
# data: MIIDNDCCAhyg-SAMPLE-3r0RCJY3G9jESPo8enFF6HxvYWai58hmaib0= #base64 encoded
certificate
# custom_error_configuration: #Custom Error on Global Level
# - status_code: HttpStatus502
# custom_error_page_url: https://nordcloud.com/default_502_page.html #SAMPLE ONLY
# - status_code: HttpStatus403
# custom_error_page_url: https://nordcloud.com/default_403_page.html #SAMPLE ONLY
frontend_ip_configuration:
- name: appGwPrivateFrontendIp
public_ip_address_id: null
private_ip_address: "10.222.8.133"
private_ip_address_allocation: Static
subnet_id: /subscriptions/xxxxx-xxxxxx-xxxxxxx-xxxxxx/resourceGroups/rg-sch-networktst-we-001/providers/Microsoft.Network/virtualNetworks/vnet-sch-sharedservices-tst-we001/subnets/ApplicationGatewaySubnet
private_link_configuration_name: null
http_listener:
- name: default-httpsListener
frontend_port_name: default-port443
frontend_ip_configuration_name: appGwPrivateFrontendIp
protocol: Https
host_names: ["nordcloud.com"]
require_sni: false
ssl_certificate_name: nordcloud.com
ssl_profile_name: null
custom_error_configuration: null
firewall_policy_id: null
ssl_certificate:
- name: nordcloud.com
key_vault_secret_id: https://{keyvaultname}.{keyvaultdomain}/secrets/{secretname}
http_listener:
- name: default-httpListener
frontend_port_name: default-port80
frontend_ip_configuration_name: appGwPrivateFrontendIp
protocol: Http
host_names: ["nordcloud.com"]
require_sni: false
ssl_certificate_name: null
ssl_profile_name: null
custom_error_configuration: null
90/454
request_routing_rule
Request routing rule is a component responsible for defining how incoming requests are routed to the appropriate backend
pool based on the listener’s associated routing rules. It is possible to define one or more request routing rules to handle
incoming traffic.
Example of parametrised request routing rule configuration:
Example of parametrised request routing rule configuration with PathBasedRouting:
backend
Backend is a component responsible for defining the backend pool that the Application Gateway routes requests to based
on the listener’s associated routing rules. It is possible to define one or more backend pools to handle incoming traffic.
Example of parametrised backend configuration (V2):
firewall_policy_id: /subscriptions/xxxxx-xxxxxx-xxxxxxx-xxxxxx//resourceGroups/rg-schnetwork-tst-we001/providers//providers/Microsoft.Network/ApplicationGatewayWebApplicationFirewallPolicies/wafsch-tst-we-001
request_routing_rule:
- name: default-routingRule
http_listener_name: default-httpListener
backend_address_pool_name: default-backendAddressPool
backend_http_settings_name: default-backendHttpSettings
rule_type: Basic
priority: 10
redirect_configuration_name: null
url_path_map_name: null
rewrite_rule_set_name: null
request_routing_rule:
- name: default-routingRule
http_listener_name: default-httpListener
backend_address_pool_name: default-backendAddressPool
backend_http_settings_name: default-backendHttpSettings
rule_type: PathBasedRouting
priority: 10
redirect_configuration_name: null
url_path_map_name: sample-routing-rule
rewrite_rule_set_name: null
url_path_map:
- name: sample-routing-rule
default_backend_address_pool_name: default-backendAddressPool
default_backend_http_settings_name: default-backendHttpSettings
default_redirect_configuration_name: null
default_rewrite_rule_set_name: null
path_rule:
- name: apps
paths: ["/apps/*"]
backend_address_pool_name: default-backendAddressPool
backend_http_settings_name: default-backendHttpSettings
redirect_configuration_name: null
rewrite_rule_set_name: null
firewall_policy_id: null
backend_address_pool:
- name: default-backendAddressPool
ip_addresses: null
fqdns: ["nordcloud.com"]
backend_http_settings:
- name: default-backendHttpSettings
91/454
terraform documentation
The code used to deploy your core may be updated regularly. The following link describes some of the possible input
variables when creating your application. Terraform Documentation
management blueprint (standard)
The purpose of this module is to deploy management components for the Azure Cloud Foundation.
The module contains all the necessary management components like blob backup, log analytics, monitoring, vm change
tracking etc.,
deployments
The module contains main settings required for the deployment of the management. The settings are divided into main mandatory parts listed as below:
Automation Account
Blob Backup
Estate Helper
Ipam
Light House
Log Analytics Monitoring
Platform Change Alerting
Sandbox Automation
Service Health Alerting
Subscription Budget
VM Change Tracking
port: 80
protocol: Http
cookie_based_affinity: Enabled
host_name: nordcloud.com
pick_host_name_from_backend_address: false
affinity_cookie_name: ApplicationGatewayAffinity
request_timeout: 20
path: /
probe_name: default-probe
authentication_certificate: null
trusted_root_certificate_names: nordcloud.com
connection_draining: null
probe:
- name: default-probe
protocol: Http
port: null
host: nordcloud.com
path: /
interval: 30
timeout: 30
unhealthy_threshold: 3
pick_host_name_from_backend_http_settings: false
minimum_servers: 0
match:
- status_code: ["200-399"]
body: null
trusted_root_certificate:
- name: nordcloud.com
data: MIIDNDCCAhyg-SAMPLE-3r0RCJY3G9jESPo8enFF6HxvYWai58hmaib0=
key_vault_secret_id: null
92/454
VM Management
automation_account
The purpose of this module is primary for backwards compatability with ACF 3.*. As it was previously used as a VM
Update Management solution.
But considering that there is still use for an Automation Account outside of VM updates, this module is still available as an
optional deployment.
how it works
The module will deploy a standard Automation Account with 2 optional runbooks. The runbooks were used to manage VM
off/on schedules for update management, but now they can be used for other purposes as well.
The Automation Account can also be deployed without the runbooks if desired.
In addition to this, if there is a use-case for the system identity of the Automation Account, then the module can also
deploy RBAC permissions with a given role and scope. This can be incrementally used to grant the Automation Account
permissions to different management groups and roles, but it is recommended to document all permissions granted to the
Automation Account.
We can deploy multiple instances of automation accounts for eg., in a different region by declaring a new instance of
automation account such as instance_002 with related configuration in below.
Example of default automation account deployment:
blob_backup_automation
The Blob Backup module enables the built-in soft delete functionality for Blobs in Storage Accounts.
how it works
Blobs in storage accounts have a built-in backup functionality, using a backup vault as the orchestrator.
This module - once deployed - will scan for all storage accounts under the specified management group (including
children).
Storage account kind must be StorageV2
On each storage account, it looks for a tag name called blobBackup. This tag value should be set to true.
Once it has found the storage accounts, it will enable blob backup functionality.
By default, the blob backup occurs every day at midnight UTC.
automation_account_settings :
instance_001 :
enabled : true
location : "northeurope"
location_short : "ne"
# rg_name : "rg-sch-automation-tst-ne-001"
# automation_account_name : "aa-sch-automation-tst-ne-001"
# upload_run_books : true
# configuration_management_rbac :
# enabled : true
# management_group_name : "mg-acf"
# role_definition_name : "Virtual Machine Contributor"
93/454
Example of default blob backup deployment:
estate_helper
The purpose of this module is to provide a service principal which will be used in managed environments for Nordcloud to
integrate tooling.
This SPN is required in managed scenarios, and by default is provided minimal rights on the tenant.
how it’s used
Once deployed, an Application Registration is configured, along with a Service Principal. The Service Principal is
provided (by default) Reader access on the top management group level. The credentials for this application is stored in a
new keyvault.
Once requested by Nordcloud, the Service Principal ID and Password should be provided.
These are both found in the relative keyvault.
Example of default estate helper deployment:
# blob_backup_management_group_id_scope : "mg-acf"
# blob_backup_redundancy : "LocallyRedundant"
# blob_backup_retention : 60
# blob_backup_container_soft_delete_retention : 30
# blob_backup_cis_compliant : true
# blob_backup_serverfarms : {
# sku = "Y1",
# cisSku = "S1",
# }
# windows_function_app_http2_enabled : true
# windows_function_app_client_certificate_enabled : true
# application_insights_workspace_id : "/subscriptions/7fefad98-b527-437d-9d1bbe6a1527f76c/resourceGroups/rg-sch-logging-tst-ne001/providers/Microsoft.OperationalInsights/workspaces/log-sch-audit-tst-ne-001"
# storage_supports_https_traffic_only : true
# storage_allow_blob_public_access : false
# storage_network_acls_bypass : ["AzureServices"]
# storage_network_acls_default_action : "Deny"
# storage_network_acls_virtual_network_rules : []
# storage_network_acls_ip_rules : []
# network_address_space : ["10.0.0.0/23"]
# subnet_network_address_space : ["10.0.0.0/24"]
# estate_helper_rg_name : ""
# estate_helper_kv_name : ""
# estate_helper_kv_short_name : "eh"
# estate_helper_kv_kek_expiry_days : 0
# estate_helper_kv_enable_purge_protection : true
# estate_helper_kv_enabled_for_deployment : false
# estate_helper_kv_enabled_for_template_deployment : true
# estate_helper_kv_enabled_for_disk_encryption : true
# estate_helper_kv_enable_rbac_authorization : true
# estate_helper_kv_sku : "standard"
# estate_helper_kv_permissions : {}
# estate_helper_kv_access_policies : []
# estate_helper_kv_network_acls_bypass : "AzureServices"
# estate_helper_kv_network_acls_default_action : "Deny"
# estate_helper_kv_network_acls_virtual_network_rules : []
# estate_helper_kv_network_acls_ip_rules : [] # ADD YOUR IP HERE, IF
TESTING LOCALLY
# estate_helper_spn_name : "spn-nc-estate-helper"
# estate_helper_identifier_uris : []
94/454
ipam
The general purpose of this module is to provide mechanism for CIDR(s) allocation for VNET(s), from not used ranges
within given supernets.
Module also can calculate CIDRs for subnets based on provided vnet CIDRs and masks.
Module can be used together with the Application Landing Zone deployment (aka Project Space Provisioner, or PSP) for
even easier new projects kickstarts, offloading from the requestor the need of calculation free network ranges beforehand.
However function can be called from any location (assuming that caller IP will be whitelisted) so the same function can be
used for other clouds (GCP, AWS) or even for on-prem.
We can deploy multiple instances of ipam for eg., in a different region by declaring a new instance of ipam such as
instance_002 with related configuration in below.
Example of default ipam deployment:
# estate_helper_deployment_architect_object_id : ""
# estate_helper_application_password_expiry : "17520h"
# estate_helper_rotate_application_password : 1
# estate_helper_management_group_assignment : "mg-acf"
# estate_helper_rbac_role : "Reader"
ipam_settings :
instance_001 :
enabled : true
location : "northeurope"
location_short : "ne"
# custom_service_name : ""
# rg_name : ""
# service_plan_name : ""
# app_insights_name : ""
# vnet_name : ""
# nsg_name : ""
# snet_name : ""
# log_analytics_workspace_id: ""
# cis_compliant : true
# supernet_table_name : "Supernet"
# network_table_name : "Network"
# subnet_table_name : "Subnet"
# azure_enabled : true
# aws_enabled : false
# gcp_enabled : false
# supernet :
# aws : []
# azure :
# - location: "westeurope"
# name: "mg-corp-we-1"
# cidr: "10.222.128.0/17"
# - location: "westeurope"
# name: "mg-hybrid-we-1"
# cidr: "10.222.32.0/19"
# - location: "westeurope"
# name: "mg-online-we-1"
# cidr: "172.16.0.0/12"
# gcp : []
# server_farms :
# sku : "Y1"
# cis_sku : "S1"
# app_service :
# name : ""
# client_cert_enabled : true
# http2_enabled : true
# ip_security_restrictions : true
# ip_security_restrictions_allow :
95/454
how to use
IPAM function can be also called directly for the specific use cases:
cidr reservation for vnet not comming from the psp - setnetworkrange
Request
HTTP-Method: POST
Content-Type: application/json
u r i : https://$ipamFunctionName.azurewebsites.net/api/SetNetworkRange?code=$functionKey
ipamFunctionName − nameofthefunctionAppfunctionKey - master key for the functionApp
# - action : "Allow"
# description : "Allow Traffic"
# ip_address : "0.0.0.0/0"
# name : "ClientIp"
# priority : "100"
# vnet_address_prefixes : [ "10.0.0.0/23" ]
# snet_address_prefixes : "10.0.1.0/24"
# secure_storage_account :
# name : ""
# tier : "Standard"
# replication_type : "LRS"
# supports_https_traffic_only : true
# allow_blob_public_access : false
# network_acls_bypass : ["AzureServices"]
# network_acls_default_action : "Deny"
# network_acls_virtual_network_rules : []
# network_acls_ip_rules : []
# azure_storage_account :
# name : ""
# tier : "Standard"
# replication_type : "LRS"
# supports_https_traffic_only : true
# allow_blob_public_access : false
# network_acls_bypass : ["AzureServices"]
# network_acls_default_action : "Deny"
# network_acls_virtual_network_rules : []
# network_acls_ip_rules : []
# aws_storage_account :
# name : ""
# tier : "Standard"
# replication_type : "LRS"
# supports_https_traffic_only : true
# allow_blob_public_access : false
# network_acls_bypass : ["AzureServices"]
# network_acls_default_action : "Deny"
# network_acls_virtual_network_rules : []
# network_acls_ip_rules : []
# gcp_storage_account :
# name : ""
# tier : "Standard"
# replication_type : "LRS"
# supports_https_traffic_only : true
# allow_blob_public_access : false
# network_acls_bypass : ["AzureServices"]
# network_acls_default_action : "Deny"
# network_acls_virtual_network_rules : []
# network_acls_ip_rules : []
96/454
Body:
CloudProvider: Required, must be one of AWS, AZURE, GCP
Mask: Required, the mask of target network
ResourceName: Required, the name of the resource for example account or subscription or project which the
network is used for
Location: Required, the geographic location of the supernet, will allocate the CIDR from the supernet of the same
Location and SupernetName
SupernetName: Required, the name of the supernet used for allocating the CIDR, if there are multiple CIDRs for
the same Location and SupernetName, a random one will be chosen, set CIDRHint if you want to use a particular
supernet CIDR
Extend: Required, the extend attribute can be set to true for allocating additional CIDRs of the same
ResourceName and VPCName, if set to false it will only allocate a new CIDR block if the ResourceName and
VPCName does not yet exist in the Table. Once you set Extend to true and there are more than one CIDRs have
been allocated from same supernet with same ResourceName and VPCName, you cannot set Extend back to false
VPCName: Optional with default value null, the VPC name of allocated network
CIDRHint: Optional with default value null, the network CIDR which the allocated network should be a subnet
of. It can also be used to force the allocation to be this exact network by making its prefix equal to the Mask
parameter (network is a subnet of itself).
Response
Content-Type: application/json
Body
Success:
Failed:
automatic calculation for subnets in given vnet - slicecidr
Request
{
"CloudProvider":"AZURE",
"Mask":24,
"ResourceName":"sample-project",
"Location":"europe-west3",
"VPCName":"sample-vpc",
"SupernetName":"1",
"CIDRHint":"10.0.6.0/24",
"Extend":false
}
{
"State":"Success",
"CIDR":"10.0.6.0/24",
}
{
"State":"Failed",
"Timestamp":"2022-05-18T15:21:25.153376",
"Function":"SetNetworkRange",
"ErrorMessage":"error message"
}
97/454
HTTP-Method: POST
Content-Type: application/json
uri: https://$ipamFunctionName.azurewebsites.net/api/SliceCIDR?code=$functionKey ipamFunctionName
− nameofthefunctionAppfunctionKey - master key for the functionApp
Body:
CIDR: Required, the CIDR block to slice
SubnetMasks: Required, the list of network masks separated by comma that need be sliced from the CIDR
parameter. The SliceCIDR function will try to allocate subnet in the order of provided SubnetMasks, the allocated
subnet will be put in the Subnets response attribute. If it cannot allocate a subnet for a mask, it will put the mask
in ErrorSubnetMasks response attribute, then try to allocate next subnet mask until the last one.
Response
Content-Type: application/json
{
"CIDR":"10.0.0.0/16",
"SubnetMasks":"24,23,25"
}
98/454
Body
Success:
Warning: For request:
The response is:
Failed:
deletion of the vnet allocation (vnet deletion in azure will not delete reservation) - deletenetwork
Request
HTTP-Method: POST
Content-Type: application/json
u r i : https://$ipamFunctionName.azurewebsites.net/api/DeleteNetwork?code=$functionKey
ipamFunctionName − nameofthefunctionAppfunctionKey - master key for the functionApp
{
"State":"Success",
"Subnets":[
"10.0.0.0/24",
"10.0.2.0/23",
"10.0.1.0/25"
]
}
{
"CIDR":"10.0.0.0/24",
"SubnetMasks":"25,24,25"
}
{
"State":"Warning",
"Subnets":[
"10.0.0.0/25",
"10.0.0.128/25"
],
"ErrorSubnetMasks":["24"]
}
{
"State":"Failed",
"Timestamp":"2022-05-18T15:21:25.153376",
"Function":"SliceCIDR",
"ErrorMessage":"error message"
}
99/454
Body:
CloudProvider: Required, must be one of AWS, AZURE, GCP
Identity: Required, contains the PartitionKey and RowKey of the table storage entity to delete > If the
Identity does not exist, an error will be raised
Response
Content-Type: application/json
Body:
Success:
Failed:
When a network is deleted, the deleted network CIDR is return back to its supernet.
get a list about all cidrs allocation - getnetworks
Request
HTTP-Method: GET or POST
Content-Type: application/json
Query Parameter(GET or POST):
u r i : https://$ipamFunctionName.azurewebsites.net/api/GetNetworks?code=$functionKey
ipamFunctionName − nameofthefunctionAppfunctionKey - master key for the functionApp
Body(POST Only):
CloudProvider: Required, must be one of AWS, AZURE, GCP > When invoke by HTTP POST, the CloudProvider
parameter can be set through either Query Parameter or Request Body. If set both, the Query Parameter will be used.
Response
{
"CloudProvider":"AZURE",
"Identity":{
"PartitionKey": "47161b28-8d30-450b-812a-a2aadd4b9d2c",
"RowKey": "29a83179-1a1c-49e6-ad34-19bd210eba45"
}
}
{
"State":"Success"
}
{
"State":"Failed",
"Timestamp":"2022-05-18T15:21:25.153376",
"Function":"DeleteNetwork",
"ErrorMessage":"error message"
}
{
"CloudProvider":"AZURE"
}
100/454
Content-Type: application/json
Body
Success:
Failed:
new subnet allocation - SetSubnetRange
Request
HTTP-Method: POST
Content-Type: application/json
{
"State":"Success",
"Networks":[
{
"Identity": {
"PartitionKey": "71f7f5f5-20cf-4c89-bbd8-a567cbb1ea9c",
"RowKey": "d3e9bc01-c09d-4ec9-88ae-a97527fc66ad"
},
"Location": "westeurope",
"CIDR": "10.0.1.0/24",
"ResourceName": "test-azure-2",
"Decommissioned": false,
"VPCName": null
},
{
"Identity": {
"PartitionKey": "a1d3c4b5-f0e0-42da-ba6e-49883df63728",
"RowKey": "aa62d57d-21bc-4af1-a0a4-d878738b8409"
},
"Location": "westeurope",
"CIDR": "10.0.2.0/24",
"ResourceName": "test-azure-3",
"Decommissioned": false,
"VPCName": null
}
]
}
{
"State":"Failed",
"Timestamp":"2022-05-18T15:21:25.153376",
"Function":"GetNetworks",
"ErrorMessage":"error message"
}
101/454
Body:
CloudProvider: Required, must be one of AWS, AZURE, GCP.
NetworkIdentities: Required, the list of network identities that used for allocating the CIDRs for the specified
Subnets. IPAM will try to allocate the CIDR from the first Network until it is exhausted, and then try the next
Network in the list.
Name: Required, the name of the subnet. Different subnets can have the same name, every subnet has an unique
identity.
Mask: Required, the mask of the subnet.
CIDRHint: Optional with default value null, the network CIDR which the subnet should belongs to. It can also be
used to force the allocation to be this exact subnet by making its prefix equal to the Mask parameter.
Response
Content-Type: application/json
{
"CloudProvider": "AZURE",
"NetworkIdentities": [
{
"PartitionKey": "47161b28-8d30-450b-812a-a2aadd4b9d2c",
"RowKey": "29a83179-1a1c-49e6-ad34-19bd210eba45"
},
{
"PartitionKey": "136b8a7c-0f22-4ca5-92b5-00fd3d5ef808",
"RowKey": "b30e7140-f042-4f76-a06f-15b68b589f89"
}
],
"Name": "vnet1-subnet-1",
"Mask": 24,
"CIDRHint": "10.0.1.0/24"
}
102/454
Body
Success:
Failed:
Retrieval of existing subnet allocations - GetSubnet
Request
HTTP-Method: POST
Content-Type: application/json
Body:
CloudProvider: Required, must be one of AWS, AZURE, GCP.
Identity: Required, the identity of the subnet. > If the identity does not exist, an error will be raised.
Response
Content-Type: application/json
{
"State": "Success",
"Subnet": {
"Identity": {
"PartitionKey": "c7c1bfed-a40c-4dbe-8347-518406ba0762",
"RowKey": "a7b7263f-8cfb-4bd1-a975-50156a599c55"
},
"NetworkIdentity": {
"PartitionKey": "47161b28-8d30-450b-812a-a2aadd4b9d2c",
"RowKey": "29a83179-1a1c-49e6-ad34-19bd210eba45"
},
"Name": "vent1-subnet-1",
"CIDR": "10.0.1.0/24"
}
}
{
"State": "Failed",
"Timestamp": "2024-05-18T15:21:25.153376",
"Function": "SetSubnetRange",
"Exception": "error message"
}
{
"CloudProvider": "AZURE",
"Identity":{
"PartitionKey": "c7c1bfed-a40c-4dbe-8347-518406ba0762",
"RowKey": "a7b7263f-8cfb-4bd1-a975-50156a599c55"
}
}
103/454
Body
Success:
Failed:
update of existing subnet allocation - UpdateSubnet
Request
HTTP-Method: POST
Content-Type: application/json
Body:
CloudProvider: Required, must be one of AWS, AZURE, GCP.
Identity: Required, the identity of the subnet.
Name: Required, the new name of the subnet.
Response
Content-Type: application/json
{
"State": "Success",
"Subnet": {
"Identity": {
"PartitionKey": "c7c1bfed-a40c-4dbe-8347-518406ba0762",
"RowKey": "a7b7263f-8cfb-4bd1-a975-50156a599c55"
},
"NetworkIdentity": {
"PartitionKey": "47161b28-8d30-450b-812a-a2aadd4b9d2c",
"RowKey": "29a83179-1a1c-49e6-ad34-19bd210eba45"
},
"Name": "vent1-subnet-1",
"CIDR": "10.0.1.0/24"
}
}
{
"State": "Failed",
"Timestamp": "2024-05-18T15:21:25.153376",
"Function": "GetSubnet",
"Exception": "error message"
}
{
"CloudProvider": "AZURE",
"Identity":{
"PartitionKey": "c7c1bfed-a40c-4dbe-8347-518406ba0762",
"RowKey": "a7b7263f-8cfb-4bd1-a975-50156a599c55"
},
"Name": "vent1-subnet-1-updated"
}
104/454
Body
Success:
Failed:
Removal of existing subnet allocation - DeleteSubnet
Request
HTTP-Method: POST
Content-Type: application/json
Body:
CloudProvider: Required, must be one of AWS, AZURE, GCP.
Identity: Required, the identity of the subnet to delete. > If the Identity does not exist, an error will be raised.
Response
Content-Type: application/json
{
"State": "Success",
"Subnet": {
"Identity": {
"PartitionKey": "c7c1bfed-a40c-4dbe-8347-518406ba0762",
"RowKey": "a7b7263f-8cfb-4bd1-a975-50156a599c55"
},
"NetworkIdentity": {
"PartitionKey": "47161b28-8d30-450b-812a-a2aadd4b9d2c",
"RowKey": "29a83179-1a1c-49e6-ad34-19bd210eba45"
},
"Name": "vent1-subnet-1-updated",
"CIDR": "10.0.1.0/24"
}
}
{
"State": "Failed",
"Timestamp": "2024-05-18T15:21:25.153376",
"Function": "UpdateSubnet",
"Exception": "error message"
}
{
"CloudProvider":"AZURE",
"Identity": {
"PartitionKey": "c7c1bfed-a40c-4dbe-8347-518406ba0762",
"RowKey": "a7b7263f-8cfb-4bd1-a975-50156a599c55"
}
}
105/454
Body
Success:
Failed:
light_house
The purpose of this module is to provide access for the Managed Cloud team to support the environment. Azure
Lighthouse provides this access in a scalable fashion.
how it’s used
In a nutshell, once the Azure Lighthouse is deployed, it will allow the Managed Cloud team - who are located in the
Nordcloud Tenant - to provide support with access to managed resources.
Managed resources are handled with tags. If there are no tags applied to subscriptions, then it will be automatically managed. In order to exclude management of a specific subscription, the Nordcloud-Managed tag, with the value set to
false must be applied.
how access is managed
In the Nordcloud tenant, an AAD group is created for the target environment. This AAD group is specified in the
parameter file for this modules’ deployment.
The members of the managed cloud team assigned to support the environment are added to this group. Once added, they
are granted contributor access to the subscriptions where the Nordcloud-Managed tag is applied.
This module is configured specifically for Nordcloud Managed Cloud. It is not compatible with other third-party
CSP’s.
Example of default light house deployment:
{
"State": "Success"
}
{
"State": "Failed",
"Timestamp": "2024-05-18T15:21:25.153376",
"Function": "DeleteSubnet",
"Exception": "error message"
}
light_house_settings :
instance_001 :
enabled : true
location : "northeurope"
location_short : "ne"
# rg_name : ""
# custom_service_name : ""
# service_plan_name : ""
# app_insights_name : ""
# vnet_name : ""
# nsg_name : ""
# snet_name : ""
# management_goup_id_scope : "mg-acf"
# cis_compliant : true
# msp_offer_name : "Nordcloud-Managed-Cloud"
# msp_offer_description : "Contributor Access for Nordcloud Managed Services"
106/454
log_analytics
The general purpose of this module is to store short term operational logs across the entire target environment.
These logs are derived from any module which have diagnostics configured via policies, as well as Activity logs for each
resource.
By default this workspace is centralised for the entire environment. Including multi-regional deployments.
Example of default log analytics deployment:
monitoring
The purpose of this module is to deploy data collection rules, including Security, Insights and customised logging. This is
configurable in the parameter file.
how it works
Using centralised DCRs (Data Collection Rules) and Azure Policies, this module will deploy the necessary DCR’s
according to parameters for data collection on virtual machines.
On top of this, the module will also deploy the Log Analytics Solutions for Security and VM Insights.
# managed_by_tenant_id : "f8407946-d2c1-4fcc-ae95-63723ace3665"
# principal_id : "687b48d7-a654-4ed6-a20b-830318245d63"
# role_definition_id : "b24988ac-6180-42a0-ab88-20f7382dd24c"
# principal_id_display_name : "Lighthouse-MCE-ALL"
# excluded_tag_name : "Nordcloud-Managed"
# excluded_tag_value : false
# vnet_address_space : ["10.0.0.0/23"]
# snet_address_space : "10.0.1.0/24"
# snet_endpoints : ["Microsoft.Storage"]
# server_farms :
# sku : "Y1"
# cis_sku : "S1"
# log_analytics_workspace_id : ""
# function_app :
# name : ""
# identity_type : "SystemAssigned"
# https_only : true
# client_certificate_enabled : true
# client_certificate_mode : "Optional"
# auth_settings : true
# http2_enabled : true
# ftps_state : "Disabled"
# minimum_tls_version : "1.2"
# scale_limit : 1
# functions_extension_version : "~4"
# storage_account :
# name : ""
# supports_https_traffic_only : true
# allow_blob_public_access : false
# tier : "Standard"
# replication_type : "LRS"
# network_acls_bypass : ["AzureServices"]
# network_acls_default_action : "Deny"
# network_acls_virtual_network_rules : []
# network_acls_ip_rules : []
log_analytics_enabled : true
## log_analytics_workspace_name : "log-sch-operational-ama-tst-ne-002"
## log_analytics_workspace_sku : "PerGB2018"
## log_analytics_retention_in_days : 180
## log_analytics_daily_quota_gb : 100
107/454
This replaces the previous monitoring solution that worked with the MMA (Microsoft Monitoring Agent) extension.
While on it’s own, this module does not enable logging on VMs, it works in conjunction with the Policy Baseline module
to ensure that VM’s are compliant with the logging requirements, specifically the dine-vm-insights, vm-security and
dine-vm-monitoring-dcr policies.
vm insights
If VM insights is required for logging, it can be enabled in the parameter file. This deploys the necessary log analytics
solution and DCR’s to collect that data.
The policy dine-vm-insights will then ensure that VMs have the association to the VM Insights DCR in order to collect
that data.
vm security
Like with VM insights, it’s also enabled in the parameter file. If enabled, the necessary security solution is deployed along
with the DCR’s to collect that data.
The policy vm-security will then ensure that VMs have the association to the Security DCR in order to collect that data.
custom logging
This works slightly differently. The parameter file allows you to build the necessary data collection rules for virtual machines. These can be fully customised to collect the data you require from VMs.
Example of such data is performance data. This can be collected and stored in Log Analytics for analysis.
This module will deploy the necessary DCR’s for these custom DCRs.
The next step is to ensure that VMs are associated with these DCR’s. This is done through tags.
The tag must be named vm-monitor and the value must be the full name of the DCR. For example Windows-nc-dcr-devwe-001.
The policy dine-vm-monitoring-dcr will then ensure that VMs have the association to the custom DCR in order to
collect that data. This is done by reading the tag value of the VM and creating the association to the DCR.
Example of default monitoring deployment:
monitoring_settings :
# rg_name_logging : "rg-sch-logging-tst-ne1-001"
# rg_name_dcr : "rg-sch-dcrmonitor-tst-ne1-001"
# service_plan_name : "plan-sch-dcr-tst-ne1-001"
# app_insights_name : "appi-sch-func-dcr-tst-ne1-001"
# vnet_name : "vnet-sch-dcr-tst-ne1-001"
# nsg_name : "nsg-sch-dcr-tst-ne1-001"
# snet_name : "snet-functions-tst-ne1-001"
# log_analytics_workspace_id : ""
# workspace_friendly_name : "operational"
# cis_compliant : true
# deploy_auto_dcr_assignment_function : true
# management_group_id_scope : "mg-acf"
# exclude_subscription_ids : ""
# server_farms :
# sku : "Y1"
# cis_sku : "S1"
# app_service :
# name : ""
108/454
# client_cert_enabled : true
# http2_enabled : true
# vm_insights :
# enabled : false
# vmi_dcr_suffix : ""
# vnet_address_prefixes : [ "10.0.0.0/23" ]
# snet_address_prefixes : "10.0.1.0/24"
# secure_storage_account :
# name : ""
# tier : "Standard"
# replication_type : "LRS"
# supports_https_traffic_only : true
# allow_blob_public_access : false
# network_acls_bypass : ["AzureServices"]
# network_acls_default_action : "Deny"
# network_acls_virtual_network_rules : []
# network_acls_ip_rules : []
# security_solution :
# enabled : true
# security_dcr_suffix : ""
# action_groups :
# group_short_name_critical : "Criticals"
# enabled_critical : true
# enabled_warning : true
# group_short_name_warning : "Warnings"
#######################################################################################################################################
#### If email_receivers_critical is left empty, email_receivers_default will be used for both
critical and warning action groups ###
#### If email_receivers_critical is non empty, email_receivers_critical will be used for critical
action group and ###
#### email_receivers_default will be used for warning action group
###
#######################################################################################################################################
email_receivers_default :
- email_address : "notExistingMail@nordcloud.com" ## REPLACE EMAIL ID WITH
ACTUAL ID
# name : "Notify_EmailActions"
# use_common_alert_schema : true
# email_receivers_critical :
# - email_address : "notExistingMail@nordcloud.com" ## REPLACE EMAIL ID WITH
ACTUAL ID
# name : "Notify_EmailActions"
# use_common_alert_schema : true
# webhook_receivers_criticial_enabled : false
# webhook_receivers_critical_properties :
# - service_uri : "https://events.pagerduty.com/integration/CHANGE_ME/enqueue"
# name : "Warning"
# use_common_alert_schema : true
# webhook_receivers_warning_enabled : false
# webhook_receivers_warning_properties :
# - service_uri : "https://events.pagerduty.com/integration/CHANGE_ME/enqueue"
# name : "Warning"
# use_common_alert_schema : true
# dcr_data_sources :
# windows :
# enabled : true
# name : "windows"
# kind : "Windows"
# data_sources :
# performance_counters :
# - sampling_frequency_in_seconds : 60
# counter_specifiers : [
# "\\LogicalDisk(*)\\% Free Space",
# "\\Memory(*)\\% Committed Bytes In Use",
# "\\Processor(_Total)\\% Processor Times"
# ]
# streams : ["Microsoft-Perf"]
# name : "WindowsPerformanceCounters"
# windows_event_logs :
109/454
platform_change_alerting
Log alerts that will send emails or webhooks whenever changes are detected in the platform management group performed
by a standard user account.
The general idea here is to alert Managed Cloud to changes being made in the platform management group that were not
performed by a service principal or managed identity.
query
This is a scheduled query resource that will run a query every 5 minutes against the log analytics workspace. The query
will check ActivityLogs where the caller_id contains @. As managed identities and service principals are listed as ID’s in
the workspace. Whenever a manual change in the portal happens by a user account, an email address is shown. The query
will scope to where the heirarchy contains the name of the management group from the parameter file, and finally exclude
any policy runs (as remediating policies in the portal is allowed, and will also show up as being called from a user
account).
Example of default platform_change_alerting deployment:
# - xpath_queries : ["System!*[System[(Level=1 or Level=2 or Level=3)]]"]
# streams : ["Microsoft-Event"]
# name : "WindowsEventLogs"
# syslogs : []
# streams : ["Microsoft-Perf","Microsoft-Event"]
# linux :
# enabled : false
# name : "linux"
# kind : "Linux"
# data_sources :
# performance_counters :
# - sampling_frequency_in_seconds : 60
# counter_specifiers : [
# "\\Logical Disk(*)\\% Free Space",
# "\\Memory(*)\\% Used Memory",
# "\\Processor(*)\\% Processor Time"
# ]
# streams : ["Microsoft-Perf"]
# name : "LinuxPerformanceCounters"
# windows_event_logs : []
# syslogs : []
# streams : ["Microsoft-Perf"]
platform_change_alert_settings :
# rg_name : "rg-sch-logging-tst-ne1-001"
# action_group_name : "ag-hub-email"
# platform_change_alert_name : "alert-platform-change-tst-001"
# evaluation_frequency : "PT5M"
# window_duration : "PT5M"
# severity : 3
# workspace_id : "/subscriptions/4d51b4a8-d7c2-4f8d-83d1-
4702b2862977/resourceGroups/rg-sch-logging-tst-ne001/providers/Microsoft.OperationalInsights/workspaces/log-sch-operational-logs-tst-ne001"
# scope_names : ["mg-platform"]
# email_receivers :
# - name : "testuser-EmailAction-"
# email_address : "notExistingMail@nordcloud.com"
# use_common_alert_schema : true
# webhook_receivers_warning_enabled : false
webhook_receivers_warning_properties :
- service_uri : "https://events.pagerduty.com/integration/CHANGE_ME/enqueue"
# name : "Warning"
# use_common_alert_schema : true
# exclusions :
110/454
sandbox_automation
This module is aimed at controlling the Sandbox management group environment.
Ensuring that VM’s are switched off at specific times, through to disabling subscriptions once they reach a certain age.
The following features can be applied:
Stop virtual machines daily at specified times
Start virtual machines daily at specified times
Delete resource groups after they reach a certain age (also purge the soft deleted KeyVaults)
Disable subscriptions after they reach a certain age
how it works
The function will automatically apply the following tags and values based on parameters:
VM Shutdown (value in params)
Resource Group Delete (value in params)
Subscription Delete (value in params)
If you wish to have VM startup automation, then the tag defined in the parameter file (by default it’s VMStart) must be
applied to the VM manually, along with a value of the hour of which the VM should startup again.
The function will be checking these tag values based on the cron job defined in the parameter file.
For example, in the parameter file the property vm_shutdown_cron is defined with a default value of 0 */15 * * * *. Which means, every 15 minutes the VM’s will be checked to ensure that they will be shutdown as per their tag value.
We can deploy multiple instances of sandbox automation for eg., in a different region by declaring a new instance of
sandbox automation such as instance_002 with related configuration in below.
Example of default sandbox_automation deployment:
# operation_name_values : [
# "MICROSOFT.STORAGE/STORAGEACCOUNTS/LISTKEYS/ACTION",
# "MICROSOFT.NETWORK/BASTIONHOSTS/GETACTIVESESSIONS/ACTION",
# "MICROSOFT.COMPUTE/VIRTUALMACHINES/RESTART/ACTION",
# "MICROSOFT.COMPUTE/VIRTUALMACHINES/DEALLOCATE/ACTION",
# "MICROSOFT.COMPUTE/VIRTUALMACHINES/START/ACTION",
# "MICROSOFT.CHANGEANALYSIS/RESOURCECHANGES/ACTION",
# "MICROSOFT.AUTHORIZATION/ROLEASSIGNMENTS/WRITE",
# "MICROSOFT.NETWORK/NETWORKWATCHERS/IPFLOWVERIFY/ACTION",
# "MICROSOFT.KEYVAULT/VAULTS/WRITE",
# "MICROSOFT.WEB/SITES/HOST/SYNC/ACTION",
# "MICROSOFT.NETWORK/VPNGATEWAYS/GETBGPPEERSTATUS/ACTION",
# "MICROSOFT.NETWORK/VIRTUALHUBS/EFFECTIVEROUTES/ACTION",
#
"MICROSOFT.NETWORK/NETWORKINTERFACES/EFFECTIVENETWORKSECURITYGROUPS/ACTION",
# "MICROSOFT.NETWORK/PRIVATEDNSZONES/A/WRITE",
# "MICROSOFT.NETWORK/PRIVATEDNSZONES/A/DELETE"
# ]
# subscription_ids : [""]
# resource_ids : [""]
# resource_groups : [""]
sandbox_automation_settings:
instance_001:
enabled : true
location : "northeurope"
location_short : "ne"
111/454
# rg_name : ""
# service_plan_name : ""
# app_insights_name : ""
# vnet_name : ""
# nsg_name : ""
# snet_name : ""
# cis_compliant : true
# log_analytics_workspace_id : ""
# default_properties :
# rg_delete_cron : "0 0 18 * * *"
# vm_shutdown_cron : "0 */15 * * * *"
# sub_disable_cron : "0 0 20 * * *"
# sub_auto_enabled : true
# vm_auto_enabled : true
# rg_auto_enabled : true
# decommissioned_mgmt_group_name : "mg-decommissioned"
# rg_delete_tag_name : "delete"
# rg_delete_days : 30
# vm_shutdown_default : "16"
# vm_shutdown_tag : "VMShutdown"
# vm_startup_tag : "VMStart"
# vm_disable_shutdown_tag : "NO-SHUTDOWN"
# hostile_delete_rg : "true"
# protected_rg_list : "NetworkWatcherRG"
# sub_disable_tag_name : "subDisable"
# sub_disable_days : 30
# protected_sub_list : "5959d188-3a85-4a68-98e0-af236b3c2cac"
# force_disable_sub : "true"
# properties :
# sub_auto_enabled : false
# sandbox_management_group_name : "mg-sandbox"
# vm_auto_enabled : true
# rg_auto_enabled : false
# rg_delete_tagName : "delete"
# rg_delete_days : 1
# rg_delete_cron : "0 0 18 * * *"
# vm_shutdown_cron : "0 */15 * * * *"
# vm_shutdown_default : "16"
# vm_shutdown_tag : "VMShutdown"
# vm_startup_tag : "VMStart"
# vm_disable_shutdown_tag : "NO-SHUTDOWN"
# hostile_delete_rg : "true"
# protected_rg_list : "NetworkWatcherRG"
# app_service :
# name : ""
# client_cert_enabled : true
# http2_enabled : true
# server_farms :
# sku : "Y1"
# cis_sku : "S1"
# vnet_address_prefixes : ["10.0.0.0/23"]
# snet_address_prefixes : "10.0.1.0/24"
# storage_account :
# name : ""
# supports_https_traffic_only : true
# allow_blob_public_access : false
# network_acls_bypass : ["AzureServices"]
# network_acls_default_action : "Deny"
# network_acls_virtual_network_rules : []
# network_acls_ip_rules : []
# queue_storage_account :
# name : ""
# supports_https_traffic_only : true
# allow_blob_public_access : false
# network_acls_bypass : ["AzureServices"]
# network_acls_default_action : "Deny"
# network_acls_virtual_network_rules : []
# network_acls_ip_rules : []
112/454
The Application Landing Zone automation will remove tags from resource groups and subscriptions if they are not defined
explicity in the app_vars.yaml payload of given Application LZ. Make sure to sandbox automation tags in input
parameter.
service_health_alerting
Log Alerts to cover Service Health of Azure regions.
Adding new Action Groups and Alerts related to Azure’s Service Health.
Example of default service_health_alerting deployment:
subscription_budget
The purpose of this module is to manage and control Azure resource cost usage.
how it’s used
The function app used in this module contains powershell cmdlet based on information from parameter file during initial
deployment or based on tags assigned to subscriptions or resource groups if any exist. The Azure function will scan
resources once per hour and update them if necessary.
If there are no tags applied to the subscription, values will be automatically assigned according to the parameter file.
Similarly, if no tags are assigned to the resource group, all required values will be inherited from the subscription level.
The parameter file contains 5 mandatory value like : subscription_id, contact, budget, threshold and delete. The
Subscription contains 3 tags: contact, budget, threshold The resource group may contains 2 tags: contact, budget The
tag names like contact, budget, threshold can be can be adjusted based on customer needs.
The subscription_id and delete value can only be modified within the parameter file. These values are specific to the
Azure Function’s configuration and are not directly editable through subscription tags. Other value like contact, budget
and threshold can be adjusted after initial deplyment by modifying the tags on subscription level.
If the usage cost exceeds declarated threshold tag, an email will be sent to contact tag, if the usage cost exceeds maximum budget tag, an email will be sent to contact tag, and the Delete(RG budget) or Cancel(Subscription budget)
action will be performed if the value of delete is set to “true”.
service_health_alerting_settings:
## management_group_id_scope : ["mg-platform", "mg-audit"]
## action_group_name : "ag-hub-email"
## monitored_regions : [
## "Global",
## "West Europe",
## "North Europe",
## "Central India"
## ]
## service_health_alert_name : ""
## resource_group : ""
## email_receivers :
## - email_address : "testuser-EmailAction-"
## name : "notExistingMail@nordcloud.com"
## use_common_alert_schema : true
## webhook_receivers_warning_enabled : false
webhook_receivers_warning_properties :
- service_uri :
"https://events.pagerduty.com/integration/c3343244324232/enqueue" ## REPLACE WITH ACTUAL
# name : "Warning"
# use_common_alert_schema : true
113/454
We can deploy multiple instances of subscription budget for eg., in a different region by declaring a new instance of
subscription budget such as instance_002 with related configuration in below.
Example of default subscription_budget deployment:
The Application Landing Zone automation will remove tags from resource groups and subscriptions if they are not defined
explicity in the app_vars.yaml payload of given Application LZ. Make sure to subscription budget automation tags in
input parameter.
vm_change_tracking
The purpose of this module is to deploy and configure platform resource to support Change Tracking on VM’s.
This replaces the Change Tracking solution that was previously deployed with the Automation Account.
how it works
The module deploys the following resources:
subscription_budget_settings :
instance_001 :
enabled : true
location : "northeurope"
location_short : "ne"
# custom_service_name : ""
# rg_name : ""
# service_plan_name : ""
# app_insights_name : ""
# vnet_name : ""
# nsg_name : ""
# snet_name : ""
# log_analytics_workspace_id : ""
# cis_compliant : true
# management_group_id_scope : "mg-acf"
# tenant_id : "a738da5b-465c-4cbd-a7de-1b64c889d37a"
# contact_tag_name : "contact"
# budget_tag_name : "budget"
# threshold_tag_name : "threshold"
# budgets :
# - contact : "nobody@nordcloud.com"
# subscription_id : "5959d188-3a85-4a68-98e0-af236b3c2cac"
# threshold : 70
# budget : 50
# delete : "True"
# server_farms :
# sku : "Y1"
# cis_sku : "S1"
# app_service :
# name : ""
# client_cert_enabled : true
# http2_enabled : true
# vnet_address_prefixes : [ "10.0.0.0/23" ]
# snet_address_prefixes : "10.0.1.0/24"
# secure_storage_account :
# name : ""
# tier : "Standard"
# replication_type : "GRS"
# supports_https_traffic_only : true
# allow_blob_public_access : false
# network_acls_bypass : ["AzureServices"]
# network_acls_default_action : "Deny"
# network_acls_virtual_network_rules : []
# network_acls_ip_rules : []
114/454
Log Analytics Workspace Solution for Change Tracking
Data Collection Rule for Change Tracking
The log analytics solution creates the necessary tables in the workspace to allow the DCR to log information from the
virtual machines in scope.
While the MMA agent was used, change tracking was only available through the automation account, with limited changes
being tracked.
With the new solution, it utilises the functionality of the AMA agent on VMs to not only track changes to software,
services and files, but also providing inventory overview of newly installed softwares.
This is viewed on a per-VM basis, and can be viewed in the Log Analytics Workspace.
The module is centralised and works cross region.
All options for tracking are configured in the parameter file. Where you can enable tracking of registry hives, files,
services and software.
Example of default vm_change_tracking deployment:
## vm_change_tracking_settings :
## rg_name : ""
## log_analytics_workspace_id : ""
## dcr_suffix : ""
## windows_change_tracking :
## extension_settings :
## enableFiles : true
## enableSoftware : true
## enableRegistry : true
## enableServices : true
## enableInventory : true
## registry_info :
## ShellIconOverlayIdentifiers_01 :
## name : "ShellIconOverlayIdentifiers"
## groupTag : "Recommended"
## enabled : true
## recurse : true
## description : ""
## keyName :
"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ShellIconOverlayIdentifiers"
## valueName : ""
## KnownDlls_02 :
## name : "KnownDlls"
## groupTag : "Recommended"
## enabled : true
## recurse : true
## description : ""
## keyName : "HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Control\\Session
Manager\\KnownDlls"
## valueName : ""
## Extensions_03 :
## name : "Extensions"
## groupTag : "Recommended"
## enabled : true
## recurse : true
## description : ""
## keyName : "HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Internet
Explorer\\Extensions"
## valueName : ""
## Browser_Helper_Objects_04 :
## name : "Browser_Helper_Objects"
## groupTag : "Recommended"
115/454
## enabled : true
## recurse : true
## description : ""
## keyName :
"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Browser
Helper Objects"
## valueName : ""
## ShellIconOverlayIdentifiers_05 :
## name : "ShellIconOverlayIdentifiers"
## groupTag : "Recommended"
## enabled : true
## recurse : true
## description : ""
## keyName :
"HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ShellIconOverlayIdentifiers"
## valueName : ""
## ContextMenuHandlers_06 :
## name : "ContextMenuHandlers"
## groupTag : "Recommended"
## enabled : true
## recurse : true
## description : ""
## keyName :
"HKEY_LOCAL_MACHINE\\Software\\Classes\\Directory\\ShellEx\\ContextMenuHandlers"
## valueName : ""
## ContextMenuHandlers_07 :
## name : "ContextMenuHandlers"
## groupTag : "Recommended"
## enabled : true
## recurse : true
## description : ""
## keyName :
"HKEY_LOCAL_MACHINE\\Software\\Classes\\Directory\\Background\\ShellEx\\ContextMenuHandlers"
## valueName : ""
## Shutdown_08 :
## name : "Shutdown"
## groupTag : "Recommended"
## enabled : true
## recurse : true
## description : ""
## keyName :
"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Group
Policy\\Scripts\\Shutdown"
## valueName : ""
## Startup_09 :
## name : "Startup"
## groupTag : "Recommended"
## enabled : true
## recurse : true
## description : ""
## keyName :
"HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Group
Policy\\Scripts\\Startup"
## valueName : ""
## Extensions_10 :
## name : "Extensions"
## groupTag : "Recommended"
## enabled : true
## recurse : true
## description : ""
## keyName : "HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Internet
Explorer\\Extensions"
## valueName : ""
## Drivers32_11 :
## name : "Drivers32"
## groupTag : "Recommended"
## enabled : true
## recurse : true
## description : ""
116/454
## keyName : "HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows
NT\\CurrentVersion\\Drivers32"
## valueName : ""
## CopyHookHandlers_12 :
## name : "CopyHookHandlers"
## groupTag : "Recommended"
## enabled : true
## recurse : true
## description : ""
## keyName :
"HKEY_LOCAL_MACHINE\\Software\\Classes\\Directory\\Shellex\\CopyHookHandlers"
## valueName : ""
## Run_13 :
## name : "Run"
## groupTag : "Recommended"
## enabled : true
## recurse : true
## description : ""
## keyName :
"HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run"
## valueName : ""
## Browser_Helper_Objects_x64_14 :
## name : "Browser_Helper_Objects_x64"
## groupTag : "Recommended"
## enabled : true
## recurse : true
## description : ""
## keyName :
"HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Browser
Helper Objects"
## valueName : ""
## Drivers32_x64_15 :
## name : "Drivers32_x64"
## groupTag : "Recommended"
## enabled : true
## recurse : true
## description : ""
## keyName : "HKEY_LOCAL_MACHINE\\Software\\Wow6432Node\\Microsoft\\Windows
NT\\CurrentVersion\\Drivers32"
## valueName : ""
## Installed_Components_16 :
## name : "Installed Components"
## groupTag : "Recommended"
## enabled : true
## recurse : true
## description : ""
## keyName : "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Active Setup\\Installed
Components"
## valueName : ""
## Notify_17 :
## name : "Notify"
## groupTag : "Recommended"
## enabled : true
## recurse : true
## description : ""
## keyName : "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows
NT\\CurrentVersion\\Winlogon\\Notify"
## valueName : ""
## file_info :
## Windows_hosts_file_01 :
## name : "Windows_hosts_file"
## enabled : true
## description : ""
## path : "C:\\Windows\\System32\\drivers\\etc\\hosts"
## recurse : false
## maxContentsReturnable : 5000000
## maxOutputSize : 500000
## checksum : "Md5"
## pathType : "File"
## groupTag : "Custom"
117/454
vm_management
The purpose of this module is to provide update management for VM’s. This uses the Azure Update Management (AUM)
solution within Azure.
The module deploys a number of maintenance schedules, but the assignment of these schedules will not occur until the
dine-aum policy has been remediated.
AUM provides an overview of all VM’s that are in scope for update management, and allows for the scheduling of updates
in a centralised location.
how it works
This modules’ parameter file contains configurations for maintainence schedules, and these are deployed through the module.
You can deploy as many maintenance schedules as required.
The module works alongside a Nordcloud custom policy called dine-aum. This policy will scope VMs that have the vmupdate tag. Any VM that does not have this tag will not be in scope of the policy.
When the policy is remediated, the VM will first have it’s patch orchestration mode set to AutomaticByPlatform, this
allows for the VM to be updated by customer managed schedules.
This is changing some values in the VM properties - osProfile.windowsConfiguration.patchSettings.patchMode
for Windows VM’s, and osProfile.linuxConfiguration.patchSettings.patchMode for Linux VM’s.
As well as osProfile.windowsConfiguration.patchSettings.assessmentMode and
osProfile.linuxConfiguration.patchSettings.assessmentMode respectively.
## linux_change_tracking :
## extension_settings :
## enableFiles : true
## enableSoftware : true
## enableServices : true
## enableInventory : true
## file_info :
## Linux_hosts_file_01 :
## name : "Linux_hosts_file"
## enabled : true
## destinationPath : "/etc/hosts"
## useSudo : true
## recurse : false
## maxContentsReturnable : 5000000
## pathType : "File"
## type : "File"
## links : "Follow"
## maxOutputSize : 5000000
## groupTag : "Custom"
## Linux_conf_files_02 :
## name : "Linux_conf_files"
## enabled : true
## destinationPath : "/etc/*.conf"
## useSudo : true
## recurse : true
## maxContentsReturnable : 100
## pathType : "File"
## type : "File"
## links : "Follow"
## maxOutputSize : 500000
## groupTag : "recommended"
118/454
These value changes are required to enable Customer Managed Schedules for updating.
The VM will then be assigned to the maintenance schedule that matches the vm-update tag value.
For example, the VM has the tag vm-update: app-3-tuesday-1200, the VM will be assigned to the maintenance
schedule app-3-tuesday-1200.
If VM’s do not have a tag applied, no such changes will be made, and the VM will not be in scope for update management.
If there’s a requirement to change the maintenance schedule, then the existing maintainence schedule must be removed
from the VM manually. You can then replace the tag value with the name of the new update schedule, and remediate the
policy.
In Azure Update Manager, you can see all the VMs that have schedules associated, and how many. From here, clicking on
the VM will direct you to the VM’s update management page, where you can disaocciate the VM from schedules.
Note: If the previous schedule is not removed from the VM, then the VM will have multiple schedules applied
when applying a new tag value and remediating. This is why it’s recommended to first remove the old schedule
before applying a new one. As long as the VM has a schedule aligned with the tag value (even including multiple
schedules), the policy will be compliant.
If VM’s do not have a tag applied, they will not be in scope for update management.
If VM’s have a tag applied for a schedule that doesn’t exist, the policy will report an error in remediation.
You can easily add additional maintenance schedules to the parameter file, and deploy them through the module.
vm_management_worker
The purpose of the VM Management Worker is to register the Microsoft.Maintenance provider for VMs that are in scope
for the VM Management module. The Microsoft.Maintenance provider is used to define maintenance windows. The maintenance configurations can be used to control when Azure resources, such as virtual machines, are updated and
patched as part of routine maintenance.
To configure the schedule of VM Management Worker, follow the steps below:
Open the yaml file located in .github\workflows\vm_managemnet_worker.yml
For a baseline deployment, the following configuration will need to be updated:
how this pipeline works
The pipeline will based on two parameters exclude_subscriptions and management_group_id_scope which are
defined in the parameter file. VM Management Worker will be scan every 1 hour scope from
management_group_id_scope parameter and will register Microsoft.Maintenance provider if needed for vms. To filter out
subscriptions that are not in scope for the VM Management module, the exclude_subscriptions parameter must be
used. Default value is [“mg-platform”, “mg-audit”]
Example of default vm_change_tracking deployment:
on:
schedule:
- cron: "0 */1 * * *" # Update this if job checking every 1 hour is not sufficient
management_group_id_scope : "mg-acf"
exclude_subscriptions : ""
119/454
## vm_management_settings :
## rg_name : "rg-sch-vm-management-tst-ne-001"
## service_plan_name : "plan-sch-vmupdate-tst-ne-001"
## app_insights_name : "appi-sch-func-vmupdate-tst-ne-001"
## vnet_name : "vnet-sch-vmupdate-tst-ne-001"
## nsg_name : "nsg-sch-vmupdate-tst-ne-001"
## snet_name : "snet-functions-tst-ne-001"
## log_analytics_workspace_id : ""
## cis_compliant : true
## deploy_auto_config_assignment_function : true
## management_group_id_scope : "mg-acf"
## exclude_subscriptions : ""
## server_farms :
## sku : "Y1"
## cis_sku : "S1"
## app_service :
## name : ""
## client_cert_enabled : true
## http2_enabled : true
## vnet_address_prefixes : [ "10.0.0.0/23" ]
## snet_address_prefixes : "10.0.1.0/24"
## secure_storage_account :
## name : ""
## tier : "Standard"
## replication_type : "LRS"
## supports_https_traffic_only : true
## allow_blob_public_access : false
## network_acls_bypass : ["AzureServices"]
## network_acls_default_action : "Deny"
## network_acls_virtual_network_rules : []
## network_acls_ip_rules : []
## maintenance_schedules:
## # This is an old schedule to match the previous template before the change
## 3-tuesday-0200:
## enabled: true
## name: 3-tuesday-0200
## maintenance_window:
## start_date_time: 2023-07-25 02:00
## duration: 02:00
## time_zone: UTC
## recur_every: 1Month Third Tuesday
## install_patches:
## reboot_setting: IfRequired
## windows_settings:
## include_kbs: []
## exclude_kbs: []
## windows_classifications:
## - Critical
## - Security
## - UpdateRollup
## - FeaturePack
## - ServicePack
## - Definition
## - Tools
## - Updates
## linux_settings:
## package_names_to_include: []
## package_names_to_exclude: []
## linux_classifications:
## - Critical
## - Security
## - Other
## # This is an old schedule to match the previous template before the change
## 3-tuesday-1200:
## enabled: true
## name: 3-tuesday-1200
## maintenance_window:
## start_date_time: 2023-07-25 12:00
## duration: 02:00
## time_zone: UTC
## recur_every: 1Month Third Tuesday
120/454
## install_patches:
## reboot_setting: IfRequired
## windows_settings:
## include_kbs: []
## exclude_kbs: []
## windows_classifications:
## - Critical
## - Security
## - UpdateRollup
## - FeaturePack
## - ServicePack
## - Definition
## - Tools
## - Updates
## linux_settings:
## package_names_to_include: []
## package_names_to_exclude: []
## linux_classifications:
## - Critical
## - Security
## - Other
## # This is an old schedule to match the previous template before the change
## 3-tuesday-1900:
## enabled: true
## name: 3-tuesday-1900
## maintenance_window:
## start_date_time: 2023-07-25 19:00
## duration: 02:00
## time_zone: UTC
## recur_every: 1Month Third Tuesday
## install_patches:
## reboot_setting: IfRequired
## windows_settings:
## include_kbs: []
## exclude_kbs: []
## windows_classifications:
## - Critical
## - Security
## - UpdateRollup
## - FeaturePack
## - ServicePack
## - Definition
## - Tools
## - Updates
## linux_settings:
## package_names_to_include: []
## package_names_to_exclude: []
## linux_classifications:
## - Critical
## - Security
## - Other
## # This is an old schedule to match the previous template before the change
## 4-tuesday-0200:
## enabled: true
## name: 4-tuesday-0200
## maintenance_window:
## start_date_time: 2023-07-25 02:00
## duration: 02:00
## time_zone: UTC
## recur_every: 1Month Fourth Tuesday
## install_patches:
## reboot_setting: IfRequired
## windows_settings:
## include_kbs: []
## exclude_kbs: []
## windows_classifications:
## - Critical
## - Security
## - UpdateRollup
## - FeaturePack
## - ServicePack
121/454
## - Definition
## - Tools
## - Updates
## linux_settings:
## package_names_to_include: []
## package_names_to_exclude: []
## linux_classifications:
## - Critical
## - Security
## - Other
## # This is an old schedule to match the previous template before the change
## 4-tuesday-1200:
## enabled: true
## name: 4-tuesday-1200
## maintenance_window:
## start_date_time: 2023-07-25 12:00
## duration: 02:00
## time_zone: UTC
## recur_every: 1Month Fourth Tuesday
## install_patches:
## reboot_setting: IfRequired
## windows_settings:
## include_kbs: []
## exclude_kbs: []
## windows_classifications:
## - Critical
## - Security
## - UpdateRollup
## - FeaturePack
## - ServicePack
## - Definition
## - Tools
## - Updates
## linux_settings:
## package_names_to_include: []
## package_names_to_exclude: []
## linux_classifications:
## - Critical
## - Security
## - Other
## # This is an old schedule to match the previous template before the change
## 4-tuesday-1900:
## enabled: true
## name: 4-tuesday-1900
## maintenance_window:
## start_date_time: 2023-07-25 19:00
## duration: 02:00
## time_zone: UTC
## recur_every: 1Month Fourth Tuesday
## install_patches:
## reboot_setting: IfRequired
## windows_settings:
## include_kbs: []
## exclude_kbs: []
## windows_classifications:
## - Critical
## - Security
## - UpdateRollup
## - FeaturePack
## - ServicePack
## - Definition
## - Tools
## - Updates
## linux_settings:
## package_names_to_include: []
## package_names_to_exclude: []
## linux_classifications:
## - Critical
## - Security
## - Other
## dc-3-tuesday-0200:
122/454
#
#
e
n
a
b
l
e
d: t
r
u
e
#
#
n
a
m
e: d
c
-
3
-
t
u
e
s
d
a
y
-
0
2
0
0
#
#
m
a
i
n
t
e
n
a
n
c
e_
w
i
n
d
o
w: ## start_date_time: 2
0
2
3
-
0
7
-
2
5
0
2:0
0
#
#
d
u
r
a
t
i
o
n: 0
2:0
0
#
#
t
i
m
e_
z
o
n
e: U
T
C
#
#
r
e
c
u
r_
e
v
e
ry: 1
M
o
n
t
h
T
h
i
r
d
T
u
e
s
d
a
y
#
#
i
n
s
t
a
l
l
_
p
a
t
c
h
e
s: ## reboot_setting: I
fR
e
q
u
i
r
e
d
#
#
w
i
n
d
o
w
s_
s
e
t
t
i
n
g
s: ## include_kbs: [] ## exclude_kbs: [] ## windows_classif
i
c
a
t
i
o
n
s: ## - Critical ## - Security ## - UpdateRollup ## - FeaturePack ## - ServicePack ## - Definition ## - Tools ## - Updates ## linux_settings: ## package_names_to_include: [
]
#
#
p
a
c
k
a
g
e_
n
a
m
e
s_
t
o_
e
x
c
l
u
d
e: [
]
#
#
l
i
n
u
x_
c
l
a
s
s
i
f
i
c
a
t
i
o
n
s: [
]
#
#
d
c
-
3
-
w
e
d
n
e
s
d
a
y
-
0
2
0
0: ## enabled: true ## name: dc-3-wednesd
a
y
-
0
2
0
0
#
#
m
a
i
n
t
e
n
a
n
c
e_
w
i
n
d
o
w: ## start_date_time: 2
0
2
3
-
0
7
-
2
6
0
2:0
0
#
#
d
u
r
a
t
i
o
n: 0
2:0
0
#
#
t
i
m
e_
z
o
n
e: U
T
C
#
#
r
e
c
u
r_
e
v
e
ry: 1
M
o
n
t
h
T
h
i
r
d
W
e
d
n
e
s
d
a
y
#
#
i
n
s
t
a
l
l
_
p
a
t
c
h
e
s: ## reboot_setting: I
fR
e
q
u
i
r
e
d
#
#
w
i
n
d
o
w
s_
s
e
t
t
i
n
g
s: ## include_kbs: [] ## exclude_kbs: [] ## windows_classif
i
c
a
t
i
o
n
s: ## - Critical ## - Security ## - UpdateRollup ## - FeaturePack ## - ServicePack ## - Definition ## - Tools ## - Updates ## linux_settings: ## package_names_to_include: [
]
#
#
p
a
c
k
a
g
e_
n
a
m
e
s_
t
o_
e
x
c
l
u
d
e: [
]
#
#
l
i
n
u
x_
c
l
a
s
s
i
f
i
c
a
t
i
o
n
s: [
]
#
#
s
h
a
r
e
d
s
e
r
v
i
c
e
s
-
3
-
t
u
e
s
d
a
y
-
0
2
0
0: ## enabled: true ## name: sharedservices-3-tuesd
a
y
-
0
2
0
0
#
#
m
a
i
n
t
e
n
a
n
c
e_
w
i
n
d
o
w: ## start_date_time: 2
0
2
3
-
0
7
-
2
5
0
2:0
0
#
#
d
u
r
a
t
i
o
n: 0
2:0
0
#
#
t
i
m
e_
z
o
n
e: U
T
C
#
#
r
e
c
u
r_
e
v
e
ry: 1
M
o
n
t
h
T
h
i
r
d
T
u
e
s
d
a
y
#
#
i
n
s
t
a
l
l
_
p
a
t
c
h
e
s: ## reboot_setting: I
fR
e
q
u
i
r
e
d
#
#
w
i
n
d
o
w
s_
s
e
t
t
i
n
g
s: ## include_kbs: [] ## exclude_kbs: [] ## windows_classif
i
c
a
t
i
o
n
s: ## - Critical ## - Security ## - UpdateRollup ## - FeaturePack ## - ServicePack ## - Definition
1
2
3
/
4
5
4
#
#
-
T
o
o
l
s
#
#
-
Up
d
a
t
e
s
#
#
l
i
n
u
x_
s
e
t
t
i
n
g
s: ## package_names_
t
o_
i
n
c
l
u
d
e: [
]
#
#
p
a
c
k
a
g
e_
n
a
m
e
s_
t
o_
e
x
c
l
u
d
e: [
]
#
#
l
i
n
u
x_
c
l
a
s
s
i
f
i
c
a
t
i
o
n
s: ## - Critical ## - Security ## - Other ## sharedservices-3-wednesday-0
2
0
0: ## enabled: true ## name: sharedservices-3-wednesd
a
y
-
0
2
0
0
#
#
m
a
i
n
t
e
n
a
n
c
e_
w
i
n
d
o
w: ## start_date_time: 2
0
2
3
-
0
7
-
2
6
0
2:0
0
#
#
d
u
r
a
t
i
o
n: 0
2:0
0
#
#
t
i
m
e_
z
o
n
e: U
T
C
#
#
r
e
c
u
r_
e
v
e
ry: 1
M
o
n
t
h
T
h
i
r
d
W
e
d
n
e
s
d
a
y
#
#
i
n
s
t
a
l
l
_
p
a
t
c
h
e
s: ## reboot_setting: I
fR
e
q
u
i
r
e
d
#
#
w
i
n
d
o
w
s_
s
e
t
t
i
n
g
s: ## include_kbs: [] ## exclude_kbs: [] ## windows_classif
i
c
a
t
i
o
n
s: ## - Critical ## - Security ## - UpdateRollup ## - FeaturePack ## - ServicePack ## - Definition ## - Tools ## - Updates ## linux_settings: ## package_names_to_include: [
]
#
#
p
a
c
k
a
g
e_
n
a
m
e
s_
t
o_
e
x
c
l
u
d
e: [
]
#
#
l
i
n
u
x_
c
l
a
s
s
i
f
i
c
a
t
i
o
n
s: ## - Critical ## - Security ## - Other ## app-3-tuesday-0200: ## enabled: true ## name: app-3-tuesday-0200 ## maintenance_window: ## start_date_time: 2023-07
-
2
5
0
2:0
0
#
#
d
u
r
a
t
i
o
n: 0
2:0
0
#
#
t
i
m
e_
z
o
n
e: U
T
C
#
#
r
e
c
u
r_
e
v
e
ry: 1
M
o
n
t
h
T
h
i
r
d
T
u
e
s
d
a
y
#
#
i
n
s
t
a
l
l
_
p
a
t
c
h
e
s: ## reboot_setting: I
fR
e
q
u
i
r
e
d
#
#
w
i
n
d
o
w
s_
s
e
t
t
i
n
g
s: ## include_kbs: [] ## exclude_kbs: [] ## windows_classif
i
c
a
t
i
o
n
s: ## - Critical ## - Security ## - UpdateRollup ## - FeaturePack ## - ServicePack ## - Definition ## - Tools ## - Updates ## linux_settings: ## package_names_to_include: [
]
#
#
p
a
c
k
a
g
e_
n
a
m
e
s_
t
o_
e
x
c
l
u
d
e: [
]
#
#
l
i
n
u
x_
c
l
a
s
s
i
f
i
c
a
t
i
o
n
s: ## - Critical ## - Security ## - Other ## app-3-tuesday-1200: ## enabled: true ## name: app-3-tuesday-1200 ## maintenance_window: 1
2
4
/
4
5
4
#
#
s
t
a
r
t_
d
a
t
e_
t
i
m
e: 2
0
2
3
-
0
7
-
2
5
1
2:0
0
#
#
d
u
r
a
t
i
o
n: 0
2:0
0
#
#
t
i
m
e_
z
o
n
e: U
T
C
#
#
r
e
c
u
r_
e
v
e
ry: 1
M
o
n
t
h
T
h
i
r
d
T
u
e
s
d
a
y
#
#
i
n
s
t
a
l
l
_
p
a
t
c
h
e
s: ## reboot_setting: I
fR
e
q
u
i
r
e
d
#
#
w
i
n
d
o
w
s_
s
e
t
t
i
n
g
s: ## include_kbs: [] ## exclude_kbs: [] ## windows_classif
i
c
a
t
i
o
n
s: ## - Critical ## - Security ## - UpdateRollup ## - FeaturePack ## - ServicePack ## - Definition ## - Tools ## - Updates ## linux_settings: ## package_names_to_include: [
]
#
#
p
a
c
k
a
g
e_
n
a
m
e
s_
t
o_
e
x
c
l
u
d
e: [
]
#
#
l
i
n
u
x_
c
l
a
s
s
i
f
i
c
a
t
i
o
n
s: ## - Critical ## - Security ## - Other ## app-3-tuesday-1900: ## enabled: true ## name: app-3-tuesday-1900 ## maintenance_window: ## start_date_time: 2023-07
-
2
5
1
9:0
0
#
#
d
u
r
a
t
i
o
n: 0
2:0
0
#
#
t
i
m
e_
z
o
n
e: U
T
C
#
#
r
e
c
u
r_
e
v
e
ry: 1
M
o
n
t
h
T
h
i
r
d
T
u
e
s
d
a
y
#
#
i
n
s
t
a
l
l
_
p
a
t
c
h
e
s: ## reboot_setting: I
fR
e
q
u
i
r
e
d
#
#
w
i
n
d
o
w
s_
s
e
t
t
i
n
g
s: ## include_kbs: [] ## exclude_kbs: [] ## windows_classif
i
c
a
t
i
o
n
s: ## - Critical ## - Security ## - UpdateRollup ## - FeaturePack ## - ServicePack ## - Definition ## - Tools ## - Updates ## linux_settings: ## package_names_to_include: [
]
#
#
p
a
c
k
a
g
e_
n
a
m
e
s_
t
o_
e
x
c
l
u
d
e: [
]
#
#
l
i
n
u
x_
c
l
a
s
s
i
f
i
c
a
t
i
o
n
s: ## - Critical ## - Security ## - Other ## app-4-tuesday-0200: ## enabled: true ## name: app-4-tuesday-0200 ## maintenance_window: ## start_date_time: 2023-07
-
2
5
0
2:0
0
#
#
d
u
r
a
t
i
o
n: 0
2:0
0
#
#
t
i
m
e_
z
o
n
e: U
T
C
#
#
r
e
c
u
r_
e
v
e
ry: 1
M
o
n
t
h
F
o
u
r
t
h
T
u
e
s
d
a
y
#
#
i
n
s
t
a
l
l
_
p
a
t
c
h
e
s: ## reboot_setting: I
fR
e
q
u
i
r
e
d
#
#
w
i
n
d
o
w
s_
s
e
t
t
i
n
g
s: ## include_kbs: [] ## exclude_kbs: [] ## windows_classif
i
c
a
t
i
o
n
s: ## - Critical ## - Security ## - UpdateRollup
1
2
5
/
4
5
4
#
#
-
F
e
a
t
u
r
e
P
a
c
k
#
#
-
S
e
r
v
i
c
e
P
a
c
k
#
#
-
D
e
f
i
n
i
t
i
o
n
#
#
-
T
o
o
l
s
#
#
-
Up
d
a
t
e
s
#
#
l
i
n
u
x_
s
e
t
t
i
n
g
s: ## package_names_
t
o_
i
n
c
l
u
d
e: [
]
#
#
p
a
c
k
a
g
e_
n
a
m
e
s_
t
o_
e
x
c
l
u
d
e: [
]
#
#
l
i
n
u
x_
c
l
a
s
s
i
f
i
c
a
t
i
o
n
s: ## - Critical ## - Security ## - Other ## app-4-tuesday-1200: ## enabled: true ## name: app-4-tuesday-1200 ## maintenance_window: ## start_date_time: 2023-07
-
2
5
1
2:0
0
#
#
d
u
r
a
t
i
o
n: 0
2:0
0
#
#
t
i
m
e_
z
o
n
e: U
T
C
#
#
r
e
c
u
r_
e
v
e
ry: 1
M
o
n
t
h
F
o
u
r
t
h
T
u
e
s
d
a
y
#
#
i
n
s
t
a
l
l
_
p
a
t
c
h
e
s: ## reboot_setting: I
fR
e
q
u
i
r
e
d
#
#
w
i
n
d
o
w
s_
s
e
t
t
i
n
g
s: ## include_kbs: [] ## exclude_kbs: [] ## windows_classif
i
c
a
t
i
o
n
s: ## - Critical ## - Security ## - UpdateRollup ## - FeaturePack ## - ServicePack ## - Definition ## - Tools ## - Updates ## linux_settings: ## package_names_to_include: [
]
#
#
p
a
c
k
a
g
e_
n
a
m
e
s_
t
o_
e
x
c
l
u
d
e: [
]
#
#
l
i
n
u
x_
c
l
a
s
s
i
f
i
c
a
t
i
o
n
s: ## - Critical ## - Security ## - Other ## app-4-tuesday-1900: ## enabled: true ## name: app-4-tuesday-1900 ## maintenance_window: ## start_date_time: 2023-07
-
2
5
1
9:0
0
#
#
d
u
r
a
t
i
o
n: 0
2:0
0
#
#
t
i
m
e_
z
o
n
e: U
T
C
#
#
r
e
c
u
r_
e
v
e
ry: 1
M
o
n
t
h
F
o
u
r
t
h
T
u
e
s
d
a
y
#
#
i
n
s
t
a
l
l
_
p
a
t
c
h
e
s: ## reboot_setting: I
fR
e
q
u
i
r
e
d
#
#
w
i
n
d
o
w
s_
s
e
t
t
i
n
g
s: ## include_kbs: [] ## exclude_kbs: [] ## windows_classif
i
c
a
t
i
o
n
s: ## - Critical ## - Security ## - UpdateRollup ## - FeaturePack ## - ServicePack ## - Definition ## - Tools ## - Updates ## linux_settings: ## package_names_to_include: [
]
#
#
p
a
c
k
a
g
e_
n
a
m
e
s_
t
o_
e
x
c
l
u
d
e: [
]
#
#
l
i
n
u
x_
c
l
a
s
s
i
f
i
c
a
t
i
o
n
s: ## - Critical ## - Security ## - Other
1
2
6
/
4
5
4
terraform documentation
The code used to deploy your core may be updated regularly. The following link describes some of the possible input
variables when creating your application. Terraform Documentation
firewall blueprint
The purpose of this module is to deploy firewall components for the Azure Cloud Foundation. The module is designed to
be used in a multi-regional environment based on Hub-Spoke and vWAN network architecture.
The Azure Firewall is a managed, cloud-based network security service that protects your Azure Virtual Network
resources. It is a fully stateful firewall as a service with built-in high availability and unrestricted cloud scalability.
The module will deploy the following components like firewall, firewall rules, firewall policies, ip groups, diagnostics.
The Azure Firewall with preconfigured rules and policies will be deployed in the hub region.
Azure Firewall is offered in two SKUs: Standard, Premium. The Standard SKU is recommended for most deployments.
This Sku is included in the default deployment. The Premium SKU includes all the features of the Standard SKU, plus TLS
Inspection, IDPS, URL Filtering, and Web Categories. The firewall architecture is best described by Microsoft in the
following link:
Azure Firewall solution in Azure
deployment
The module contains main settings required for the deployment of the Azure firewall. Some of the settings are
optional(marked) and can be used based on the customer’s requirement needs. The settings are divided into main mandatory parts like:
Networks
Firewall
Firewall Policies
IP Groups
Diagnostics
Policy Insights
Dns
Dns Resolver
Routing intent
Upgrade to Premium Sku
Firewall Rules
networks
In this section you can define the mandatory settings required for the deployment. The default deployment is set to use the
hubspoke topology in northeurope region and contains minimum settings required for the deployment. Default deployment
information about this section can be found in the Terraform Documentation
Example of default hubspoke topology deployment:
settings:
networks:
- enabled: true
topology: "hubspoke"
instance: "instance_001"
location: "northeurope"
127/454
Example of default vwan topology deployment
firewall
The firewall section contains the settings for the deployment. These settings can be utlized for parametised deployment of
the Azure Firewall based on the customer’s requirements. The marked parameters are optional, so values can remain as
they are in the default deployment. Any other settings can be adjusted based on the needs. Default deployment information
about this section can be found in the Terraform Documentation
Example of parametrised deployment of the Azure Firewall with Premium sku and two public IPs
firewall_policies
The firewall policy settings are used to define the services like threat intelligence, intrusion detection, bypass traffic
settings and snat. The settings are optional and can be used based on the customer’s requirements. It is worth mentioning
that most of the firewall policy settings are available only in the Premium sku which is not included in the default
deployment. Default deployment information about this section can be found in the Terraform Documentation
Example of parametrised deployment of the Azure Firewall with Premium sku and firewall policies
location_short: "ne"
settings:
networks:
- enabled: true
topology: "vwan"
vwan_is_main_region: true
vwan_name: "vwan-sch-tst-ne-001"
vwan_resource_group_name: "rg-sch-tst-ne-001"
instance: "instance_001"
location: "northeurope"
location_short: "ne"
settings:
networks:
- enabled: true
topology: "hubspoke"
instance: "instance_001"
location: "northeurope"
location_short: "ne"
firewall:
- availability_zones: ["1", "2", "3"]
public_ips_count: 2
sku:
- tier: "Premium"
settings:
networks:
- enabled: true
topology: "hubspoke"
instance: "instance_001"
location: "northeurope"
location_short: "ne"
firewall:
- availability_zones: ["1", "2", "3"]
public_ips_count: 2
sku:
- tier: "Premium"
firewall_policy:
- threat_intelligence:
- mode: "Alert"
# white_list:
# - fqdns: []
# ip_addresses: []
intrusion_detection:
128/454
ip_groups
The ip groups settings are used to define the ip groups that can be used in the firewall rules. The settings are optional and
can be used based on the customer’s requirements. Default deployment information about this section can be found in the
Terraform Documentation
Example of parametrised deployment of the Azure ip groups
diagnostics
The diagnostics settings are used to define the diagnostics settings for the Azure Firewall. The settings are included in the
default deployment to ensure that AFW logs are stored in the Azure Log Analytics workspace. Default deployment
information about this section can be found in the Terraform Documentation
Example of parametrised deployment of the Azure diagnostics
- mode: "Alert"
private_ranges: ["10.0.0.0/8"]
# signature_overrides:
# - id: ""
# state: ""
bypass_traffic_settings:
- name: "bypass-setting"
protocol: "TCP"
description: "bypass rule"
destination_addresses: ["10.0.0.0/8"]
destination_ip_groups: []
destination_ports: ["80"]
source_addresses: ["100.64.0.0/10"]
source_ip_groups: []
snat:
- enable_custom_SNAT: true
private_ranges: ["10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16",
"100.64.0.0/10"]
ip_groups:yes
- enabled: true
ip_groups:
- name: "ip-group-001"
ip_addresses: ["10.1.1.12", "172.168.12.12"]
diagnostics:
- enabled: true
name: "setByPolicy"
destination_type: "Dedicated"
partner_solution_id: null
enabled_log:
- category: "AZFWNetworkRule"
category_group: null
retention_policy:
- days: 0
enabled: false
- category: "AZFWApplicationRule"
category_group: null
retention_policy:
- days: 0
enabled: false
- category: "AZFWNatRule"
category_group: null
retention_policy:
- days: 0
enabled: false
- category: "AZFWThreatIntel"
category_group: null
retention_policy:
- days: 0
129/454
policy_insights
The policy insights settings are used to define the policy insights settings for the Azure Firewall. The settings are optional
and can be used based on the customer’s requirements. The feature is not included in the default deployment. The policy
insights are used to monitor the firewall rules and firewall policies. Default deployment information about this section can
be found in the Terraform Documentation
Example of parametrised deployment of the Azure policy insights
enabled: false
- category: "AZFWIdpsSignature"
category_group: null
retention_policy:
- days: 0
enabled: false
- category: "AZFWDnsQuery"
category_group: null
retention_policy:
- days: 0
enabled: false
- category: "AZFWFqdnResolveFailure"
category_group: null
retention_policy:
- days: 0
enabled: false
- category: "AZFWFatFlow"
category_group: null
retention_policy:
- days: 0
enabled: false
- category: "AZFWFlowTrace"
category_group: null
retention_policy:
- days: 0
enabled: false
- category: "AZFWApplicationRuleAggregation"
category_group: null
retention_policy:
- days: 0
enabled: false
- category: "AZFWNetworkRuleAggregation"
category_group: null
retention_policy:
- days: 0
enabled: false
- category: "AZFWNatRuleAggregation"
category_group: null
retention_policy:
- days: 0
enabled: false
metric:
- category: "AllMetrics"
enabled: true
retention_policy:
- days: 0
enabled: false
workspace_id: "/subscriptions/1111ad11-b527-437d-9d1b-be6a1527f76c/resourceGroups/rgsch-logging-tst-ne-001/providers/Microsoft.OperationalInsights/workspaces/log-sch-audittst-ne-001"
# storage_account_id: null
policy_insights:
- enabled: true
workspace_id: "/subscriptions/1fef1111-b527-437d-9d1b-be6a1527f76c/resourceGroups/rgsch-logging-tst-ne-001/providers/Microsoft.OperationalInsights/workspaces/log-sch-audittst-ne-001"
workspace_resource_group_name: "rg-sch-tst-ne-001"
workspace_name: "log-sch-tst-ne-001"
130/454
dns
The dns proxy configuration are used to define the dns settings for the Azure Firewall. The settings are optional and can be
used based on the customer’s requirements. Default deployment information about this section can be found in the
Terraform Documentation The Azure Firewall with DNS Proxy enabled to Azure DNS Service (168.63.129.16).
Example of parametrised deployment of the DNS
dns_resolver
The dns resolver settings are used to enable the DNS Resolver Firewall rules. This is the default configuration and
recommended for use. Default deployment information about this section can be found in the Terraform Documentation
All inbound and outbound requests (resolving private endpoints/ private dns in azure) will be routed through the firewall.
This allows for DNS logs to be registered in the Firewall. For on-premise DNS servers - Conditional forwarders for private
DNS zones must be configured to the Azure Firewall More information can be found in the Sharedservices DNS Resolver
Example of parametrised deployment of the DNS Resolver
routing_intent
The routing intent settings are used to define the routing intent settings for the Azure Firewall for the vWAN topology. The
settings are optional and can be used based on the customer’s requirements. By enabling this feature, you can specify how
different types of traffic (such as internet-bound or private traffic) are routed, potentially through specific network security
appliances like Azure Firewalls. This is particularly useful for ensuring that traffic complies with your organization’s
security and compliance requirements. The private_traffic typically refers to traffic that stays within your
organization’s network boundaries, such as traffic between virtual networks (VNets) or on-premises networks connected
via VPN or ExpressRoute. If internet_traffic set to true, this variable enables the routing of internet-bound traffic
through the specified routing intent policies. Internet traffic refers to any traffic that is destined for external networks
outside of your organization’s control, such as public websites or cloud services. The recommendation is not to enable
routing intent by default (set to: false). However, if needed due to multiregion requirements, network security can be
enhanced by setting both private and internet traffic to true by default. Disabling either of these settings requires careful
consideration and planning before deployment. Default deployment information about this section can be found in the
Terraform Documentation
Example of parametrised deployment of the Routing intent
upgrade_to_premium-sku
The optional settings used only in case of the upgrade of the Azure Firewall. Upgrade to Premium SKU is not included in
the default deployment. It is used only in case of the upgrade of the Azure Firewall with Standard SKU. Every upgrade of
the Azure Firewall to the Premium SKU requires outage.
dns:
- proxy_enabled: false
servers: ["168.63.129.16"]
dns_resolver:
- enabled: true
on_premises_address_space: ["192.168.0.1/32", "192.168.0.2/32"]
inbound_subnet_prefix: ["10.222.10.0/25"]
outbound_subnet_prefix: ["10.222.11.0/25"]
routing_intent: # Only vWAN
- enabled: true
private_traffic: true
internet_traffic: false
131/454
Example of parametrised deployment of upgrade Azure Firewall with Standard sku to Premium sku
firewall_rules
The list of default rules for the firewall are defined in the Terraform Documentation
The place where the custom rules are defined is in the [terragrunt/prod/CORE/FIREWALL/custom_rules] folder. The
custom rules are in the json format file. The json file name must start with the “instance_001-northeurope-rulesnumber”
where rulesnumber is the number of the custom rule. The custom rules can override the default rules if contains the same
name and priority.
_Example of parametrised deployment by adding new custom rule”
terraform documentation
upgrade_to_premium:
- enabled: true
{
"RuleCollectionGroups": [
{
"priority": 308,
"name": "DefaultNetworkRuleCollectionGroupCustom",
"ruleCollections": [
{
"name": "apprule-azure-custom-rule",
"priority": 2008,
"ruleCollectionType": "FirewallPolicyFilterRuleCollection",
"action": {
"type": "Allow"
},
"rules": [
{
"ruleType": "ApplicationRule",
"name": "azure-cm-to-google",
"protocols": [
{
"protocolType": "http",
"port": 80
},
{
"protocolType": "https",
"port": 443
}
],
"sourceAddresses": [
"10.222.8.192/27"
],
"targetFqdns": [
"google.com"
],
"destinationFqdns": [],
"webCategories": [],
"destinationAddresses": [],
"targetUrls": [],
"terminateTLS": false,
"sourceIpGroups": []
}
]
}
]
},
]
}
132/454
The code used to deploy your core may be updated regularly. The following link describes some of the possible input
variables when creating your application. Terraform Documentation
shared services blueprint (standard)
The purpose of this module is to deploy sharedservices components for the Azure Cloud Foundation.
The module contains all the necessary sharedservices components like connection testing, private dns and private resolver.
deployments
The module contains main settings required for the deployment of the sharedservices. The settings are divided into main mandatory parts listed as below:
Connection Testing
Private Dns
Private Resolver
connection_testing
The purpose of this module is to setup and configure VM’s that are used for connection testing.
Utilising Azure’s Network Watcher; different network tests can be performed to different endpoints, whether that be onpremise endpoints or cloud based endpoints.
It can also serve as a test between certain Azure endpoints, providing information on connectivity.
The connection monitor VM’s come fully pre-configured in ACF, with all necessary network watcher configs and
extensions installed.
how it works
When launching Network Watcher, specifying this VM as the source, you can set a destination endpoint. The network
watcher will perform a test over the protocol/port of your choosing and report back with information about the success or
failure of the test.
We can deploy multiple instances of connection testing for eg., in a different region by declaring a new instance of
connection testing with related configuration in below.
Example of default connection testing deployment:
connection_testing_settings :
instances :
- enabled : true
location : "northeurope"
location_short : "ne"
instance : "instance_001"
# custom_service_name : ""
# rg_name : ""
# key_vault :
# name : ""
# short_name : "conm"
# enable_purge_protection : true
# enabled_for_deployment : false
# enabled_for_template_deployment : true
# enabled_for_disk_encryption : true
# enable_rbac_authorization : true
# enable_soft_delete : true
133/454
# sku : "standard"
# url_suffix : "vault.azure.net"
# kek_expiry_days : 0
# setup_username_expiry_days : 0
# setup_password_expiry_days : 0
# permissions : {} # additional role assignments
# network_acls_bypass : "AzureServices"
# network_acls_default_action : "Deny"
# network_acls_ip_rules : []
# network_acls_virtual_network_rules : []
# access_policies : []
# disk_encryption_enabled : true
# create_vms :
# enabled : true
# rg_short_name : "conm"
# hardware_size : "Standard_B2ms"
# image_publisher : "Canonical"
# image_offer : "0001-com-ubuntu-server-focal"
# image_sku : "20_04-lts"
# vm_array :
# - vm_enabled : true
# new_vm_name : ""
# new_vm_subnet_association : ""
# update_management_enabled : true
# maintenance_config :
# vm-update : "sharedservices-3-tuesday-0200"
# connectionMonitors :
# - connectionMonitorEnabled : true
# connectionMonitorAlertEnabled : false
# connectionMonitorSubscriptionId : ""
# connectionMonitorName : "cm-example-azure-to-externaladdress-ne"
# logAnalyticsWorkspaceId : ""
# alertActionGroupId : ""
# endPoints : ### Changes in endpoints requires complete value of it to
be uncommented
# - name : "connectiomonitorVM"
# type : "azureVM"
# resourceId : ""
# - name : "ubuntuArchive"
# type : "ExternalAddress"
# address : "archive.ubuntu.com"
# testConfigurations :
# - name : "Http80"
# testFrequencySec : 30
# protocol : "Http"
# httpConfiguration :
# port : 80
# method : "Get"
# requestHeaders : []
# validStatusCodeRanges : []
# preferHTTPS : false
# successThreshold :
# checksFailedPercent : 20
# roundTripTimeMs : 90
# testGroups :
# - name : ""
# disable : false
# testConfigurations : ["Http80"]
# sources : ["connectiomonitorVM"]
# destinations : ["ubuntuArchive"]
- enabled : true
location : "westeurope"
location_short : "we"
instance : "instance_001"
# custom_service_name : ""
# rg_name : ""
# key_vault :
# name : ""
# short_name : "conm"
# enable_purge_protection : true
# enabled_for_deployment : false
134/454
# enabled_for_template_deployment : true
# enabled_for_disk_encryption : false
# enable_rbac_authorization : true
# enable_soft_delete : true
# sku : "standard"
# url_suffix : "vault.azure.net"
# kek_expiry_days : 0
# setup_username_expiry_days : 0
# setup_password_expiry_days : 0
# permissions : {} # additional role assignments
# network_acls_bypass : "AzureServices"
# network_acls_default_action : "Deny"
# network_acls_ip_rules : []
# network_acls_virtual_network_rules : []
# access_policies : []
# disk_encryption_enabled : true
# create_vms :
# enabled : true
# rg_short_name : "conm"
# hardware_size : "Standard_B2ms"
# image_publisher : "Canonical"
# image_offer : "0001-com-ubuntu-server-focal"
# image_sku : "20_04-lts"
# vm_array :
# - vm_enabled : true
# new_vm_name : ""
# new_vm_subnet_association : ""
# update_management_enabled : true
# maintenance_config :
# vm-update : "sharedservices-3-tuesday-0200"
# connectionMonitors :
# - connectionMonitorEnabled : true
# connectionMonitorAlertEnabled : false
# connectionMonitorSubscriptionId : ""
# connectionMonitorName : "cm-example-azure-to-externaladdress-we"
# logAnalyticsWorkspaceId : ""
# alertActionGroupId : ""
# endPoints : ### Changes in endpoints requires complete value of it
to be uncommented
# - name : "connectiomonitorVM"
# type : "azureVM"
# resourceId : ""
# - name : "ubuntuArchive"
# type : "ExternalAddress"
# address : "archive.ubuntu.com"
# testConfigurations :
# - name : "Http80"
# testFrequencySec : 30
# protocol : "Http"
# httpConfiguration :
# port : 80
# method : "Get"
# requestHeaders : []
# validStatusCodeRanges : []
# preferHTTPS : false
# successThreshold :
# checksFailedPercent : 20
# roundTripTimeMs : 90
# testGroups :
# - name : ""
# disable : false
# testConfigurations : ["Http80"]
# sources : ["connectiomonitorVM"]
# destinations : ["ubuntuArchive"]
- enabled : false
location : "centralindia"
location_short : "ci"
instance : "instance_001"
# custom_service_name : ""
# rg_name : ""
# key_vault :
135/454
private_dns
# name : ""
# short_name : "conm"
# enable_purge_protection : true
# enabled_for_deployment : false
# enabled_for_template_deployment : true
# enabled_for_disk_encryption : true
# enable_rbac_authorization : true
# enable_soft_delete : true
# sku : "standard"
# url_suffix : "vault.azure.net"
# kek_expiry_days : 0
# setup_username_expiry_days : 0
# setup_password_expiry_days : 0
# permissions : {} # additional role assignments
# network_acls_bypass : "AzureServices"
# network_acls_default_action : "Deny"
# network_acls_ip_rules : []
# network_acls_virtual_network_rules : []
# access_policies : []
# disk_encryption_enabled : true
# create_vms :
# enabled : true
# rg_short_name : "conm"
# hardware_size : "Standard_B2ms"
# image_publisher : "Canonical"
# image_offer : "0001-com-ubuntu-server-focal"
# image_sku : "20_04-lts"
# vm_array :
# - vm_enabled : true
# new_vm_name : ""
# new_vm_subnet_association : ""
# update_management_enabled : true
# maintenance_config :
# vm-update : "sharedservices-3-tuesday-0200"
# connectionMonitors :
# - connectionMonitorEnabled : true
# connectionMonitorAlertEnabled : false
# connectionMonitorSubscriptionId : ""
# connectionMonitorName : "cm-example-azure-to-externaladdress-ci"
# logAnalyticsWorkspaceId : ""
# alertActionGroupId : ""
# endPoints : ### Changes in endpoints requires complete value of
it to be uncommented
# - name : "connectiomonitorVM"
# type : "azureVM"
# resourceId : ""
# - name : "ubuntuArchive"
# type : "ExternalAddress"
# address : "archive.ubuntu.com"
# testConfigurations :
# - name : "Http80"
# testFrequencySec : 30
# protocol : "Http"
# httpConfiguration :
# port : 80
# method : "Get"
# requestHeaders : []
# validStatusCodeRanges : []
# preferHTTPS : false
# successThreshold :
# checksFailedPercent : 20
# roundTripTimeMs : 90
# testGroups :
# - name : ""
# disable : false
# testConfigurations : ["Http80"]
# sources : ["connectiomonitorVM"]
# destinations : ["ubuntuArchive"]
136/454
The purpose of this module is to provide centralised private DNS zones for private links as well as a primary custom
private DNS.
how it works
Microsoft explains how Private DNS Zones work: What is Azure Private DNS?
As well as Private Links: What is Azure Private Link?
In terms of ACF, it’s no different. While ACF does not deploy every resource type that supports private links, this
centralised Private DNS Zone module will pre-prepare private DNS Zones for numerous PaaS services that do support
private link usage.
Out of the box; ACF will also create a Virtual Network Links between each Private DNS Zone and the Shared Services
Virtual Network.
Additional Virtual Network Links can be created through the parameter file configuration.
For a Private DNS zone, with AutoRegistration set to True, this will allow VM’s that are on a Virtual Network linked to
the Private DNS to automatically register an A-record. By AutoRegistration set to True for primary dns zone.
Note that AutoRegistration does not work for PaaS Private Endpoints
This module coupled with the DNS Relay; allows for DNS resolution on private DNS. Whether the request comes from
Azure, or On-Premise.
Example of default private dns deployment:
## private_dns_settings :
## rg_name : "rg-sch-dnsprivatezone-tst-ne-001"
## private_dns_zone_vnet_links : []
## primary_private_dns_zone_vnet_links : []
## dns_private_zone :
## primary_name : "azure-we.nord.cloud"
## private_link_zones : [
## "privatelink.azure-automation.net",
## "privatelink.database.windows.net",
## "privatelink.blob.core.windows.net",
## "privatelink.table.core.windows.net",
## "privatelink.queue.core.windows.net",
## "privatelink.file.core.windows.net",
## "privatelink.web.core.windows.net",
## "privatelink.dfs.core.windows.net",
## "privatelink.documents.azure.com",
## "privatelink.mongo.cosmos.azure.com",
## "privatelink.cassandra.cosmos.azure.com",
## "privatelink.gremlin.cosmos.azure.com",
## "privatelink.table.cosmos.azure.com",
## "privatelink.postgres.database.azure.com",
## "privatelink.mysql.database.azure.com",
## "privatelink.mariadb.database.azure.com",
## "privatelink.vaultcore.azure.net",
## "privatelink.search.windows.net",
## "privatelink.azurecr.io",
## "#{location}#.privatelink.azurecr.io",
## "privatelink.azconfig.io",
## "privatelink.servicebus.windows.net",
## "privatelink.azure-devices.net",
## "privatelink.eventgrid.azure.net",
## "privatelink.azurewebsites.net",
## "privatelink.api.azureml.ms",
## "privatelink.service.signalr.net",
137/454
adding an A-record
A-Records are required to ensure that endpoints are registered to the Private DNS Zone.
For private DNS Zone with AutoRegistration set to Enabled, it will automatically create the A-Records for Virtual
Machines. By default AutoRegistration set to Enabled for primary dns zone. This does not work for PaaS Services.
VNETS having VMs have to be linked to the primary private DNS zone in order to allow for this record creation.
Additional Notes:
ACF does provide an optional policy called private-endpoint-dns to handle automatic private endpoint registration to
the corresponding PrviateDNS DNS Zones. This can be deployed as part of the ACF deployment. Note that not all
PaaS Services are supported here currently. The CLZ team is always updating such policies over time, and managed
environments can receive such updates as and when they are released.
Managed environments can request A-Record creations to the Nordcloud Managed Cloud as part of service request
Note that service requests for A-Record creation are handled manually, outside from the ACF code and there is no
pre-defined automated way for quick records recovery in a case of accidental deletion.
If the policy is not applied, and the environment is not managed by Nordcloud, then A-Record creations will need to be
handled separately, outside of the core ACF deployment.
private_resolver
The purpose of this module is to provide a Microsoft managed, Platform as a Service DNS relay. This service comes with
a 100% SLA, while being fully managed by Microsoft.
This Private Resolver service provides DNS relaying capabilities in both inbound and outbound directions.
how it works
## "privatelink.agentsvc.azure-automation.net",
## "#{location}#.privatelink.afs.azure.net",
## "privatelink.sql.azuresynapse.net",
## "privatelink.azuresynapse.net",
## "privatelink.managedhsm.azure.net",
## "privatelink.siterecovery.windowsazure.com",
## "privatelink.notebooks.azure.net",
## "privatelink.datafactory.azure.net",
## "privatelink.adf.azure.com",
## "privatelink.redis.cache.windows.net",
## "privatelink.redisenterprise.cache.azure.net",
## "privatelink.purview.azure.com",
## "privatelink.purviewstudio.azure.com",
## "privatelink.digitaltwins.azure.net",
## "privatelink.azurehdinsight.net",
## "privatelink.his.arc.azure.com",
## "privatelink.guestconfiguration.azure.com",
## "privatelink.media.azure.net",
## "privatelink.1.azurestaticapps.net",
## "privatelink.cognitiveservices.azure.com",
## "privatelink.openai.azure.com",
## "privatelink.batch.azure.com",
## "privatelink.azure-api.net",
## "privatelink.developer.azure-api.net",
## "privatelink.analysis.windows.net",
## "privatelink.azuredatabricks.net",
## "privatelink.#{location}#.azmk8s.io",
## "privatelink.#{location}#.kusto.windows.net"
## ]
138/454
We can deploy multiple instances of private resolver for eg., in a different region by declaring a new instance of private
resolver with related configuration in below.
Example of default private resolver deployment:
private_resolver_settings :
instances :
- enabled : true
location : "northeurope"
location_short : "ne"
instance : "instance_001"
# rg_name : ""
# hub_spoke_with_firewall_as_proxy : true
# private_dns_resolver_name : ""
# private_resolver_ruleset_name : ""
# network :
# inbound :
# enabled : false
# endpoint_name : "dnsprInbound"
# subnet_name : ""
# outbound :
# enabled : true
# endpoint_name : "dnsprOutbound"
# subnet_name : ""
# remote_virtual_networks :
# hub_spoke_network_vnet_id : ""
# shared_services_network_vnet_id : ""
# rules : ## SET THIS AS [] IF DEFAULT SAMPLE RULES
TO BE REMOVED
# - state : "Enabled"
# rule_name : "testRule"
# # domain_name property must end with a period '.', for example: 'nordcloud.com.'
# domain_name : "test.local."
# target_dns_servers :
# - ip_address : "192.168.0.7"
# port : 53
# - ip_address : "192.168.0.5"
# port : 53
- enabled : true
location : "westeurope"
location_short : "we"
instance : "instance_001"
# rg_name : ""
# hub_spoke_with_firewall_as_proxy : true
# private_dns_resolver_name : ""
# private_resolver_ruleset_name : ""
# network :
# inbound :
# enabled : false
# endpoint_name : "dnsprInbound"
# subnet_name : ""
# outbound :
# enabled : true
# endpoint_name : "dnsprOutbound"
# subnet_name : ""
# remote_virtual_networks :
# hub_spoke_network_vnet_id : ""
# shared_services_network_vnet_id : ""
# rules : ## SET THIS AS [] IF DEFAULT SAMPLE RULES
TO BE REMOVED
# - state : "Enabled"
# rule_name : "testRule"
# # domain_name property must end with a period '.', for example: 'nordcloud.com.'
# domain_name : "test.local."
# target_dns_servers :
# - ip_address : "192.168.0.4"
# port : 53
# - ip_address : "192.168.0.5"
# port : 53
139/454
parameter handling
The parameter file is used more akin to a configuration file. In the parameter file, the values for vnet links, domain names
will need to be configured. References to architecture will only be pulled through when the selected scenario is chosen.
The parameter file has a single parameter which is used to determine which scenario is selected. This parameter is called
hub_spoke_with_firewall_as_proxy. This parameter when enabled will configure the vnet links to the hub network.
If this option is set to false, the vnet links will be configured to the shared services network instead.
scenario - hub spoke with firewall proxy
This is the default configuration and recommended for use.
The Azure Firewall with DNS Proxy enabled to Azure DNS Service ( 168.63.129.16). All inbound and outbound requests
(resolving private endpoints/ private dns in azure) will be routed through the firewall.
This allows for DNS logs to be registered in the Firewall.
As the Firewall handles inbound requests, the private resolver will not deploy the inbound endpoint. As the inbound
endpoint serves the exact same purpose.
For outbound, the vnet link is established between Private Resolver DNS forwarding ruleset and the vnet where the
firewall sits (Connectivity Vnet). This allows for on-premise domain resolution requests to also be logged in the firewall.
For this scenario to work, the following pre-requisite configurations must be in place:
Shared Network - Private Resolver Inbound Endpoint must be Disabled
Shared Network - Private Resolver Outbound Endpoint must be Enabled
Azure Firewall - DNS Proxy must be Enabled
- enabled : false
location : "centralindia"
location_short : "ci"
instance : "instance_001"
# rg_name : ""
# hub_spoke_with_firewall_as_proxy : true
# private_dns_resolver_name : ""
# private_resolver_ruleset_name : ""
# network :
# inbound :
# enabled : false
# endpoint_name : "dnsprInbound"
# subnet_name : ""
# outbound :
# enabled : true
# endpoint_name : "dnsprOutbound"
# subnet_name : ""
# remote_virtual_networks :
# hub_spoke_network_vnet_id : ""
# shared_services_network_vnet_id : ""
# rules : ## SET THIS AS [] IF DEFAULT SAMPLE RULES
TO BE REMOVED
# - state : "Enabled"
# rule_name : "testRule"
# # domain_name property must end with a period '.', for example: 'nordcloud.com.'
# domain_name : "test.local."
# target_dns_servers :
# - ip_address : "192.168.0.4"
# port : 53
# - ip_address : "192.168.0.5"
# port : 53
140/454
Shared Network DNS - Must be set to Azure Firewall
Connectivity Network DNS - Must be set to Azure Firewall
Identity Network DNS - Must be set to Azure Firewall
For on-premise DNS servers - Conditional forwarders for private DNS zones must be configured to the Azure Firewall
scenario - hub spoke without firewall proxy
This scenario utilises the Private Resolver Inbound Endpoint to establish all inbound and outbound requests (resolving
private endpoints/ private dns in azure).
This scenario does not support Firewall logging for DNS requests. Currently, the private resolver does not have diagnostic
logs supported, as such no DNS requests will be logged.
For outbound, the vnet link is established between Private Resolver DNS forwarding ruleset and the vnet where the Private
Resolver Inbounds Endpoint sits (SharedServices Vnet). This allows for on-premise domain resolution requests.
For this scenario to work, the following pre-requisite configurations must be in place:
Shared Network - Private Resolver Inbound Endpoint must be Enabled
Shared Network - Private Resolver Outbound Endpoint must be Enabled
Azure Firewall - DNS Proxy must be Disabled
Shared Network DNS - Must be set to Azure Public DNS
Connectivity Network DNS - Must be set to Private DNS Resolver Inbound Endpoint IP
Identity Network DNS - Must be set to Private DNS Resolver Inbound Endpoint IP
For on-premise DNS servers - Conditional forwarders for private DNS zones must be configured to the Private DNS
Resolver Inbound Endpoint IP (usually ends in .4 but must be confirmed by checking in the portal).
scenario - vwan
This scenario is configured the same like Hub Spoke without Firewall Proxy with the exception due to the vWAN
architecture limitation, where Connectivity vnet cannot be set to the custom DNS of Private DNS Resolver Inbound
Endpoint IP (If needed Azure Firewall can be configured with the DNS proxy and next hop as Private DNS Resolver
Inbound Endpoint IP)
Shared Network - Private Resolver Inbound Endpoint must be Enabled
Shared Network - Private Resolver Outbound Endpoint must be Enabled
Azure Firewall - DNS Proxy can be used if needed when pointing to Private DNS Resolver Inbound Endpoint IP
Shared Network DNS - Must be set to Azure Public DNS
Connectivity Network DNS - There is no connectivity vnet in Vwan setup, as such, no additional configuration is
required.
Identity Network DNS - Must be set to Private DNS Resolver Inbound Endpoint IP (if using AFW Proxy to
Inbound Endpoint, then AFW IP)
Any Landing Zone requiring to use outbound: Must be set to Private DNS Resolver Inbound Endpoint IP (if using
AFW Proxy to Inbound Endpoint, then AFW IP)
Firewall rules must allow DNS requests if using secure hubs
The general rule of thumb when it comes to outbound resolution; if the vnet DNS is set to azure provided, then it
requires a link to the private dns resolver ruleset. If the vnet DNS is set directly to the inbound endpoint or the
AFW, then no link is required.
141/454
For on-premise DNS servers - Conditional forwarders for private DNS zones must be configured to the Private DNS
Resolver Inbound Endpoint IP (usually ends in .4 but must be confirmed by checking in the portal).
firewall info
With the exception of the Unsecured Vwan, DNS rules must be applied to the firewall, to allow DNS queries between
Azure and OnPremise.
inbound endpoint
Once the module is deployed, an endpoint is created on the shared services virtual network in the specified subnet (detailed
in parameter file).
Once the endpoint is created, a private IP will be generated.
Note: You will need to go into the portal and make a note of the endpoint IP address - this IP will be needed for
on-premise conditional forwarding.
This inbound endpoint serves as a DNS forwarder to Azure’s public DNS service, located at 168.63.129.16.
With the necessary conditional forwarder setup on-premise, all DNS queries that match the condition will be sent through
to this endpoint.
The endpoint will forward the request to Azure’s public DNS service, and return the IP of private endpoints for the
specified FQDN.
Allowing all on-premise endpoints connected to Azure and the on-premise domain, to be able to resolve IP addresses for
private endpoints in Azure.
Unlike the VM based DNS Relay, you do not need to specify Azure domains for inbound relaying. This happens
automatically.
outbound endpoint
Once the module is deployed, an endpoint is created on the shared services virtual network in the specified subnet (detailed
in parameter file).
On top of this, an additional resource is created for the forwarding rules.
These forwarding rules act as psuedo conditional forwarding. By specifying the on-premise domain(s) in the rule, and
providing an IP of a server on-premise that can resolve these domains; virtual network links are created between these
outbound endpoint(s) and remote virtual networks in Azure.
Once a virtual network link is created, all endpoints on the remote virtual network will be able to resolve domain names
detailed in the ruleset resource (provided that the configuration is correct).
Note: Outbound endpoint is optional in this scenario. This will only need to be deployed if Azure endpoints need
the ability to resolve on-premise domains.
known limitations - regional availability
While this service does work in a centralised capacity (i.e. global resource for all regional deployments to use), it can also
work as regionalised deployment.
How this will be configured is down to the requirements set out by the technical owner of the tenant.
142/454
If deploying this module as a centralised resource, it is important to be aware of cross-region network ingress/egress costs.
If deploying as a regionalised module (i.e. endpoints created for each region), it’s also important to note the general
availability of the DNS Private Resolver for regions.
Currently the list of available regions for this module are the following:
https://azure.microsoft.com/en-us/explore/global-infrastructure/products-by-region/?products=dns&regions=all
terraform documentation
The code used to deploy your core may be updated regularly. The following link describes some of the possible input
variables when creating your application. Terraform Documentation
policies blueprint (standard)
The ACF Policies blueprint aims to deploy a defined set of built-in and custom policy assignments to specific management
groups. This blueprint supports the following functionality:
Built-in Policies assignment - Policies that are managed by Microsoft and built-in to the Azure environment.
Custom Policies assignment - Custom built policies to achieve a level of governance otherwise unavailable through
built-in policies.
Non-Compliance Messages - Allows for custom non-compliance messages on each policy assignment on each management group
Automatic / Manual Exclusions - Support for exclusions to policies. Management Group Assignment - Target management group assignments (does not support subscription assignment).
Enable or Disable - Switching policies on/off by changing the input
Compliance Scan - Force a compliance scan on the environment through a pipeline.
Policy Remediation - Remediate DINE policies with a pipeline.
Descriptive Naming - Utilisation of Display Names to show what the policy does, instead of assignment names.
policy selection
Policy selection occurs during initiatial workshops. Customers are presented with a Baseline Policy file, in which they will
need to fill in prior to any policy deployment.
Policies parameters should be filled in based on Baseline policies excel file, prepared during/after the meeting
with customer.
support
The Central Landing Zone (CLZ) development team are active on the #azure-acf channel in Slack. This is an open
channel that anyone from Nordcloud can join for support with ACF.
It is important to note the following when requesting support of policy deployments:
The CLZ team does not support configuration or remediation of non-baseline custom policies Guidance is provided on
structure of custom policies according to documentation
The CLZ team does not support non-baseline built-in policies While they can be added per customer request,
remediation and general compliance is not supported
Baseline Policies are fully supported Baseline policies have been tested against ACF resources
143/454
The reason why the CLZ team cannot support non-baseline policies is because the team cannot test every possible
policy in ACF. The team cannot guarantee functionality of additional policies alongside baseline policies and ACF
resources.
azure policy limits
Please be aware about limits for Azure Policy objects. 200 assignmnets is maximum for any given scope. For more, please check Maximum count of Azure Policy objects
ACF - baseline policies
The purpose of this document is to outline all Baseline Recommended and Baseline Optional policies.
This page will be quite large. It is advisable to CTRL+F to search for specific policies if required.
Introduction
Baseline Recommended Policies
Baseline Optional Policies
introduction
The CLZ team are using the term ‘Baseline’ to recommend which policies should be deployed in an ESLZ (Enterprise
Scale Landing Zone).
They have been carefully selected, vetted and tested after numerous discussions.
The CLZ team have taken into account recommended governance from Microsoft, as well as professional experiences with
numerous deployments of ACF, on top of valuable feedback provided to the team from both our customers and our
Nordcloud Professional Services teams.
baseline_recommended_policies
When we say Baseline Recommended, these are the default OOB (Out-Of-The-Box) policies that will be enabled by
default on specific management groups.
We recommend to have these enabled in nearly all circumstances.
Keep in mind, that policy selection is handled by the customer. While we can recommend, it is up to the customer
to decide whether or not to go with these recommendations.
This tables below details the built-in Baseline Recommended policies.
More details about each of below policy assignments can be found in below technical document. Since the below page will
be quite large. It is advisable to use CTRL+F to search for specific policy assignment if required using the Assignment
Name. For eg: allow-location-rsc
policies technical document
baseline recommended - built-in
144/454
Assignment Name Scope Display Name Parameters Justification Notes
allowlocation-rsc mg-acf Allowed locations
listOfAllowedLocations: Array
Limit the location of resource deployments to only
approved locations, to ensure governance of location
usage
aine- webapp-wodebug
mglandingzones
App Service apps should
have remote debugging
turned off
effect: AuditIfNotExists General security of web apps, ensuring that remote
debug is turned off
audit- webapphttps
mglandingzones
App Service apps should
only be accessible over HTTPS
effect: Audit General security of web apps, ensuring that it’s only
accessible on HTTPS
aine- webapp-ftps
mglandingzones
App Service apps should
require FTPS only
effect: AuditIfNotExists General security of web apps, ensuring that only
FTPS is enabled
aine- webapp-lattls
mglandingzones
App Service apps should
use the latest TLS version
effect: AuditIfNotExists General security of web apps, ensuring that the latest TLS version is used
aine-fapp- wo-debug
mglandingzones
Function apps should have
remote debugging turned
off
effect: AuditIfNotExists General security of function apps, ensuring that
remote debug is turned off
audit-fapphttps
mglandingzones
Function apps should only
be accessible over HTTPS
effect: Audit General security of function apps, ensuring that it’s
only accessible on HTTPS
aine-fappftps
mglandingzones
Function apps should
require FTPS only
effect: AuditIfNotExists General security of function apps, ensuring that only
FTPS is enabled
aine-fapplat-tls
mglandingzones
Function apps should use
the latest TLS version
effect: AuditIfNotExists General security of function apps, ensuring that the
latest TLS version is used
modifyinht- TAGNAME
mglandingzones
Inherit a tag from the
subscription
tagName: String
Ensures that Resource Groups are inheriting tags
from the subscription, due to dedicated subscription model
TAGNAME should
be replaced with
name of tag
deny-nicpip mg-acf Network interfaces should
not have public IPs
NIC’s should not have public IP’s directly assigned,
following general best practices
audit-fspub-access mg-acf
Public network access
should be disabled for Azure File Sync
effect: Audit Fileshares should not allow public access, following
general best practices
audit-sa- wo-sectrans mg-acf Secure transfer to storage
accounts should be enabled
effect: Audit Secure transfer should be enabled on storage
accounts, fololowing general best practices
audit-sarestric-net mg-acf Storage accounts should
restrict network access
effect: Audit Restricting network access on Storage Accounts
ensures access only where it’s needed
This tables below details the custom Baseline Recommended policies.
More details about each of below policy assignments can be found in below technical document. Since the below page will
be quite large. It is advisable to use CTRL+F to search for specific policy assignment if required using the Assignment
Name. For eg: audit-nsg-pub-rdp
policies technical document
baseline recommended - custom
Assignment Name Scope Display Name Parameters Justification Notes
dine-alerting mg-acf
Enforce Azure Alerts for ACF
Resources
actionGroupNameWarningId: string,
actionGroupNameCriticalId: string, workspaceSubscriptionId: string, workspaceResourceGroupName: string, workspaceName: string
Deploys log alerts to
ensure relevant people
are alerted to specific
changes
145/454
append-kv-softdel mg-acf
Ensure soft delete
is enabled for Key
Vaults
Ensure all keyvaults
have soft delete
enabled, coincide with
best practices
dinesecuritycenter mg-acf Enforce Azure
Security Center
workspaceSubscriptionId: string, workspaceName:
string, pricingTier: string, mcasintegration: string,
autoProvision: string, wdatpintegration: string, workspaceResourceGroupName: string, emailContact:
string, securityPhoneNumber: string
Deploy Azure
Security Center
(Defender for Cloud)
to each subscription in
scope using Standard
pricing Tier
audit-nsg-pubrdp mg-acf
RDP access from
the Internet
should be blocked
In alignment with best
practices, ensure RDP
is not accessible over
the internet
audit-nsg-pubssh mg-acf
SSH access from
the Internet
should be blocked
In alignment with best
practices, ensure SSH
is not accessible over
the internet
audit-subnet- wo-nsg mg-acf
Subnets should be
associated with a Network Security
Group
excludedSubnets: Array
Ensures that all
subnets (bar those
excluded) have an
associated NSG for
security purposes
Global variables have
preset static subnet names
that usually don’t require
an exclusion
audit-subnet- wo-rt mg-acf
Subnets should be
associated with a Route Table
excludedSubnets: Array
Ensures that all
subnets (bar those
excluded) have an
associated Route Table for security
purposes
Global variables have
preset static subnet names
that usually don’t require
an exclusion
dine-cis-alerts mg-acf
Enforce CIS
compliant Azure Alerts for ACF
Resources
actionGroupNameWarningId: string, rgName: String,
rgLocation: String, workspaceSubscriptionId: string, workspaceResourceGroupName: string
Deploys CIS
compliant log alerts to
ensure relevant people
are alerted to specific
changes
deny-classic-res mg-acf
Deny creation of
Azure Classic Resources [ASM]
effect: string
Ensures that all
deployments are using
ARM, instead of
ASM.
deny-gw-er mg-acf
Deny Virtual
Network Gateway
Express Route
SKU
effect: string
Ensures that no Express Route Gateways can be
deployed
deny-gw-vpn mg-acf
Deny Virtual
Network Gateway
VPN SKU
effect: string
Ensures that no VPN
Gateways can be
deployed
deny-kv-allowall mg-acf
Deny Key Vaults
that use allow all
ACLs
effect: string
Ensures that Key
Vault firewalls are
secure by not
allowing all
connections
deny-nsgallow-all mg-acf
Deny creation of
NSG allow all
network rules
effect: string
Ensures that NSG
rules do not allow
everything through,
keeping rules on a asneeded basis
deny-public-ip mg-acf Deny deployment
of all Public Ips
effect: string
Do not allow Public
IPs to be deployed,
increasing security of
endpoints
deny-rt-wo-fw mg-acf
Deny routes that
are not default
route to Firewall
firewallIpAddresses: array, effect: string
Do not allow custom
UDRs. Only UDRs to
the firewall are
allowed, ensuring all
traffic is logged.
Assignment Name Scope Display Name Parameters Justification Notes
146/454
deny-stunecrypted mg-acf
Deny unencrypted
Storage Blob
Containers
effect: string
Ensures that blob
containers are
encrypted, increasing
general security of
storage accounts.
deny-vmnonman-disk mg-acf
Deny VM’s using
a non-managed
disk
effect: string
Ensures all VM Disks
are managed.
Inreasing availability.
deny-vnetpeering
mgsandbox, mgonline
Deny Virtual
Network Peering
effect: string
Do not allow peering
from sandbox/ online
environments,
significantly reducing
risks.
deny-peering- wo-hub mg-acf
Deny Virtual
Network Peering
not connected to
the Hub Virtual
Network
hubVnetResourceIds: array, effect: string
Only allow peering to
the hub virtual
network, ensuring all
traffic is logged
through the hub.
Only for Hub and Spoke Architecture, cannot be
assigned to mgconnectivity
dinediagnostics mg-acf
Enforce
diagnostic logs
and metrics for Azure Resources
to Log Analytics
StorageAccountDiagNosticsRead: boolean, workspaceName: string, workspaceResourceGroup:
string, workspaceSubscriptionId: string,
StorageAccountDiagNosticsWrite: boolean
Ensures resources
supported by ACF
have diagnostics
enabled for logging
purposes
dine-logstolawaudit mg-acf
Enforce shipping
of all subscription
level logs to Audit Log
Analytics Workspace
auditWorkspaceSubscriptionId: string,
auditWorkspaceResourceGroupName: string,
auditWorkspaceName: string
All subscription
activity logs will be
forwarded to longterm audit log
analytics
dine-logstolawoper mg-acf
Enforce shipping
of all subscription
level logs to Operational Log
Analytics Workspace
workspaceSubscriptionId: string, workspaceResourceGroupName: string, workspaceName: string
All subscription
activity logs will be
forwarded to shortterm operational log
analytics
dinenetworkwatcher mg-acf
Enforce Network
Watcher in
regions with
Virtual Networks
rgLocation: string
Ensures that network watcher is available
for all regional vnets,
allowing network
connectivity testing
dine-stsectransfer mg-acf
Enforce secure
transfer for
Storage Accounts
Ensures that secure
transfer is enabled, by
deploying if not
existing
dine-logstosaaudit mg-acf
Enforce shipping
of all subscription
level logs to Audit Storage Account
auditWorkspaceSubscriptionId: string,
auditWorkspaceResourceGroupName: string,
auditStorageName: string
All subscription
activity logs will be
forwarded to longterm audit storage
account
dine-vmbackup mg-acf
Deploy
decentralised VM
backup and
subsequent Recovery
Services Vaults
vaultDefaultRetentionWeeklyCount: String,
vaultScheduledRuntime: String,
vaultDefaultRetentionDailyCount: String
Ensures all VMs have
backups enabled for
availability purposes
Can not be used in
conjunction with dinevm-centralised-backup
dine-az-monagent mg-acf
Enforce Azure Monitor Agent
and Dependencies
on VMs
This initiative installs Azure Monitor Agents
and Dependency
Agents on Windows
and Linux VMs.
Replaces the Log
Analytics Agent
dine-vm-ct mg-acf
Enforce VM
Change Tracking with AMA
dcrSubscriptionId: string, dcrResourceGroupName:
string, dcrCTSuffix: string
Associates VM’s to Change Tracking
DCR’s and enables Change Tracking on
the VM’s
Replaces the
Infrastructure Insights
Solution / Requires Change Tracking to be
enabled and deployed in
the Monitoring Module
Assignment Name Scope Display Name Parameters Justification Notes
147/454
dine-msvmiassoc mg-acf
Enforce VM
Insights on Virtual Machines
dcrSubscriptionId: string, dcrResourceGroupName:
string, dcrVMISuffix: string
Associates VMs to the VM Insights DCR
Replaces the Service Map
Solution / Requires VM
Insights to be enabled and
deployed in the Monitoring Module
dine-az-secagent mg-acf
Enforce VM
Security Agent, MDE and DCR
Association
dcrSubscriptionId: string, dcrResourceGroupName:
string, dcrSecSuffix: string
This initiative deploys VM Security Agents, MDE and associates
them with a DCR
Auto Provisioning should
be switched OFF in ASC
initiative
dine-aum mg-acf
Configure Azure Update Management on Virtual Machines
vmUpdateSubscriptionId: string,
vmUpdateResourceGroupName: string,
Associates VMs to the Azure Update Management Maintainence Configurations
This should only be
deployed if VM
Management module is
enabled
dine-vm- monitor mg-acf
Enforce VM
Monitoring with
AMA
vmMonitoringSubscriptionId: string,
vmMonitoringResourceGroupName: string,
Associates VM’s to Monitoring DCR’s
according to their tags
VM requires AMA agent
for monitoring to work /
Only VMs with the vmmonitor tag will be
picked up in compliance
Assignment Name Scope Display Name Parameters Justification Notes
baseline_optional_policies
When we say Baseline Optional, these policies are also tested against the ACF environment but they are not switched
on by default. These policies are generally more resource-specific than Baseline Recommended, or are policies that
require additional configurations/ considerations.
Certain optional policies do require external configurations. These will be detailed later in the document.
This tables below details the built-in Baseline Optional policies.
More details about each of below policy assignments can be found in below technical document. Since the below page will
be quite large. It is advisable to use CTRL+F to search for specific policy assignment if required using the Assignment
Name. For eg: allow-approved-vm-ex
policies technical document
baseline optional - built-in
Assignment Name Scope Display Name Parameters Justification Notes
modifyinhrg- TAGNAME
mglandingzones
Inherit a tag from the resource group tagName: String
Ensure that tags that are applied to the RG also replicate to all resources within
the RG
Replace TAGNAME with name of tag
allowapprovedvm-ex
mg-acf Only approved VM extensions should
be installed
effect: Deny,
approvedExtensions: Array
Ensure only specified VM Extensions
can be installed
deny-rg-wo- TAGNAME
mglandingzones
Require a tag on resource groups tagName: String
Deployment of resource groups will be
denied if this tag is not defined
Replace TAGNAME with name of tag
modifyvnet-ddosplan
mg-acf Virtual networks should be protected
by Azure DDoS Protection Standard
effect: Modify,
ddosPlan: String
All Virtual Networks will be protected with Azure DDOS Protection Standard
Requires a DDOS Plan which is configured
outside of ACF
denyappgw-wo- waf
mg-acf
Web Application Firewall (WAF)
should be enabled for Application Gateway
effect: String
All Application Gateways will be
checked for Web Application Firewall
auditappgw-waf- mode
mg-acf
Web Application Firewall (WAF)
should use the specified mode for Application Gateway
effect: String, modeRequirement:
String
Check that all Application Gateway
WAFs use a specified mode
This tables below details the custom Baseline Optional policies.
148/454
More details about each of below policy assignments can be found in below technical document. Since the below page will
be quite large. It is advisable to use CTRL+F to search for specific policy assignment if required using the Assignment
Name. For eg: allow-vm-image
policies technical document
baseline optional - custom
Assignment Name Scope Display
Name Parameters Justification Notes
allow-vmimage mg-acf
Allow only
specified VM
images
imagePublisher: array, imageOffer: array, imageSku:
array
Control which
images can be
deployed in the
environment, maintaining a
level of image
consistency
allow-vm-sku mg-acf
Allow only
specified VM
SKUs
listOfAllowedSKUs: array
Control which
VM SKUs can be
deployed in the
environment, maintaining a
level of SKU
consistency
append-kvpurge mg-acf
Ensure purge
protection is
enabled for Key Vaults
Ensures that all
key vaults have
purge protection
enabled, allowing
recovery of
deleted vaults and
disallow purge
modifyblobbackuptag mg-acf
Enforce the
tags for
storage
account
backup
blobbackupTag: string
Used to add the
tag name
‘blobBackup’ as
enabled for
storage account
v2 need to be
backedup
BASELINE: Recommended / Add or
replace the tag value for ‘vm-backup’
for virtual machines in management
group
deny-privelevation
mglandingzones
Deny Role Assignment
for specified
role IDs
deniedRoleIds: array, effect: string
Deny the use of
specific role IDs
deny-subnet- wo-nsg mg-acf
Deny Subnet without a NSG
effect: string
Deny the
deployment of
subnets that do
not have an NSG
defined
Does not play well with portal
deployments and some IaC
deny-subnet- wo-rt mg-acf
Deny Subnet without a Route Table
effect: string
Deny the
deployment of
subnets that do
not have a Route Table defined
Does not play well with portal
deployments and some IaC
dine-nsgflowlogs mg-acf
Enforce NSG
flow logs and
traffic
analytics to
centralised
Storage Account
managementSubId: String, environment: String, workspaceSubscriptionId: string, workspaceName:
string, retention: Integer, saNamePrefix: String,
trafficAnalyticsInterval: Integer,
flowAnalyticsEnabled: Boolean,
saResourceGroupNamePrefix: string, locations: Object, workspaceResourceGroupName: string
All NSG flow
logs will be
recorded to
centralised
storage account
More NSG’s = higher ingestion costs
dinelogworkspace mg-acf
Enforce a Log
Analytics Workspace in
new
subscriptions
workspaceNamePrefix: String, rgName: String, workspaceLocation: String
Ensure that each
subscription has a
log analytics workspace
deployed
In case of decentralised log analytics
request
149/454
dinecentralizedrsv
mg-acf
Deploy
centralised
backup in VM
subscription
and assign
backup policy
to VM
environment: string, vaultScheduledRuntime: string,
vaultDefaultRetentionDailyCount: string,
vaultDefaultRetentionWeeklyCount: string,
rsvResourceGroupName: string, rsvName: string,
locations: object
Centralise the VM
backups into
regional based
recovery services
vaults
Cannot be used in conjunction with
dine-vm-backup
appendvmmonitortag
mg-acf
Enforce Azure Monitor Tagging for DCR
Association
dcrRuleResourceNameWindows: string,
dcrRuleResourceNameLinux: string
Used in
conjunction with
vm-ama initiative
to automatically
apply necessary
tags
Custom policies only support one
deployment, if wanting more than 1
DCR per OS version this policy will
need to be customised
modify-vmbackup-tag mg-acf
Add the tags
for vm
backup
vmBackupTag: string
Used to add the
tag name ‘vmbackup’ as
enabled for VMs
need to be
backedup
BASELINE: Recommended / Add or
replace the tag value for ‘vm-backup’
for virtual machines in management
group
modify-vmupdate-tag mg-acf
Add the tags
for vm update
for update management
vmUpdateTag: string
Used to add the
tag name ‘vmupdate’ as enabled
for VMs need to
be upgrade
BASELINE: Recommended / Add or
replace the tag value for ‘vm-update’
(f.e. "3-tuesday-0200", where 3
is a weekOfMonth, tuesday is a
weekday, 0200 is a hh-mm in a
startTime) for virtual machines in management group
dine-az-monagent mg-acf
Enforce Azure Monitor Agent and
Dependencies
on VMs
dcrSubscriptionId: string, dcrResourceGroupName:
string
Ensures VMs with
specified tags are
assigned AMA
agent and
assocated to Data Collection Rule
VM’s must have the tag name vmmonitor with a value of the DCR
resource name that the VM must be
assigned to
Assignment Name Scope Display
Name Parameters Justification Notes
initiatives
dine-cis-alerts
Policies:
Policy Name Type Description
dine-alerts-nsg-delete-activityLogs DINE Alert on NSG Delete
dine-alerts-nsg-update-activityLogs DINE Alert on NSG Create or Update
dine-alerts-nsgrule-delete-activityLogs DINE Alert on NSG Rule Delete
dine-alerts-nsgrule-update-activityLogs DINE Alert on NSG Rule Create or Update
dine-alerts-policy-delete-activityLogs DINE Alert on Policy Delete
dine-alerts-policy-update-activityLogs DINE Alert on Policy Create or Update
dine-alerts-sec-solution-delete-activityLogs DINE Alert on Security Solution Delete
dine-alerts-sec-policy-update-activityLogs DINE Alert on Security Policy Create or Update
dine-alerts-sec-solution-update-activityLogs DINE Alert on Security Policy Create or Update
dine-alerts-sql-fwrule-delete-activityLogs DINE Alert on SQL Firewall Rule Delete
dine-alerts-sql-fwrule-update-activityLogs DINE Alert on SQL Firewall Rule Create or Update
dine-alerting
Policies:
150/454
Policy Name Type Description
dine-alerts-change-tracking-linux-file-hosts-query DINE Sending email on Linux hosts file change
dine-alerts-change-tracking-windows-file-hosts-query DINE Sending email on Windows hosts file change
dine-alerts-connection-monitor-metric DINE Alert on Connection Monitor outage
dine-alerts-firewall-delete-activityLogs DINE Alert on Azure Firewall Delete
dine-alerts-firewall-health-metric DINE Alert on Azure Firewall outage
dine-alerts-gateway-disconnection-activityLogs DINE Alert on Virtual Network Gateway VPN Tunnel disconnect
dine-alerts-gateway-disconnection-query DINE Sending email on Virtual Network Gateway VPN Tunnel disconnect
dine-alerts-la-daily-cap-limit-query DINE Sending email on Log Analytics Daily Limit Cap
dine-alerts-vhub-delete-activityLogs DINE Alert on Virtual Hub Delete
dine-alerts-vm-cpu-critical-metric DINE CPU Critical Alert for all VMs
dine-alerts-vm-disk-critical-metric DINE VM disk free space critical alert
dine-alerts-vm-disk-warning-metric DINE VM disk free space warning alert
dine-alerts-vm-heartbeat-query DINE Sending email on that have not reported a heartbeat in the last 5 minutes
dine-alerts-vm-linux-ram-critical-metric DINE Windows RAM critical alert
dine-alerts-vm-linux-ram-warning-metric DINE Windows RAM warning alert
dine-alerts-vm-windows-ram-critical-metric DINE Windows RAM critical alert
dine-alerts-vm-windows-ram-warning-metric DINE Windows RAM warning alert
dine-alerts-vnet-delete-activityLogs DINE Alert on Virtual Network Delete
dine-alerts-vnet-peer-delete-activityLogs DINE Alert on Virtual Network Peerings Delete
dine-alerts-vwan-delete-activityLogs DINE Alert on Virtual WAN Delete
dine-diagnostics
Policies:
Policy Name Type Description
dine-diagnostics-aa DINE Forward Automation Account diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-aci DINE Forward Container Instances (ACI) diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-acr DINE Forward Container Registry diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-aks DINE Forward AKS diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-analysisService DINE Forward Analysis Service diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-apimgmt DINE Forward API Managements diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-appgw DINE Forward Application Gateway diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-azureBastion DINE Forward Azure Bastion diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-backup DINE Forward Azure Backup diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-batch DINE Forward Azure Batch diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-cdn DINE Forward Azure CDN diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-cognitive DINE Forward Azure Cognitive Services diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-cosmosDb DINE Forward CosmosDB diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-dataBricks DINE Forward Azure DataBricks diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-dataFactory DINE Forward Azure DataFactory diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-DataLakeStore DINE Forward Azure Data Lake Store accounts diagnostic logs and metrics to an Azure Log Analytics workspace
151/454
dine-diagnostics-dlAnalysis DINE Forward Azure Data Lake Analytics accounts diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-eventgridSub DINE Forward Event Grid subscription diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-eventgridTopic DINE Forward Event Grid topics diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-eventhub DINE Forward Event Hub diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-expressroute DINE Forward Express Route diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-Function DINE Forward Azure Function App diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-hdInsight DINE Forward HDInsight diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-iotHub DINE Forward IoT Hub diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-keyvault DINE Forward Key Vault diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-keyvaultHsm DINE Forward Key Vault HSM diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-lb DINE Forward Azure Load Balancers diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-logicappIAccounts DINE
Forward Azure Logic Apps integration accounts diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-logicappWorkflow DINE Forward Azure Logic Apps workspaces diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics- MachineLearningWorkspace DINE Forward Azure Machine Learning accounts diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-mysql DINE Forward Azure MySQL server diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-nic DINE Forward Azure Network Interfaces diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-nsg DINE Forward Azure NSG diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-pip DINE Currently is not in use
dine-diagnostics-postgresql DINE Forward Azure PostgreSQL server diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-powerbi DINE Forward Azure Power BI Embedded diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-redis DINE Forward Azure Cache for Redis diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-relay DINE Forward Azure Relay Service Namespace diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-search DINE Forward Azure Search Services diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-servicebus DINE Forward Azure Service Bus namespaces diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-signalR DINE Forward Azure SignalR diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-sqldb DINE Forward Azure SQL server databases diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-sqlmi DINE Forward Azure SQL managed instances diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-sqlpools DINE Forward Azure SQL Database elastic pools diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-storageAccount DINE Forward Azure Storage Accounts diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-streamAnalytics DINE
Forward Azure Stream Analytics streaming jobs diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-timeseriesInsights DINE
Forward Azure Time Series Insights environments diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-trafficManager DINE Forward Azure Traffic Manager Profiles diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-vm DINE Forward Azure Virtual Machines diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-vmss DINE Forward Azure Virtual Machines scale sets logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-vnet DINE Forward Azure Virtual Network diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-vnetGw DINE Forward Azure Virtual Network Gateways diagnostic logs and metrics to an Azure Log Analytics workspace
dine-diagnostics-webServerfarm DINE
Forward Azure App Service Plans (Microsoft.Web/serverfarms) diagnostic logs and metrics to an Azure Log
Analytics workspace
dine-diagnostics-webSite DINE
Forward Azure Web Applications (Microsoft.Web/sites) diagnostic logs and metrics to an Azure Log Analytics workspace
Policy Name Type Description
152/454
dine-az-mon-agent
Policies:
Policy Name Type Description
dine-vm-ama-lin DINE Deploys the AMA agent to Linux VMs
dine-vm-ama-win DINE Deploys the AMA agent to Windows VMs
dine-vm-dependencyagent-lin DINE Deploys the Dependency Agent to Linux VMs
dine-vm-dependencyagent-win DINE Deploys the Dependency Agent to Windows VMs
dine-vm-id-assoc DINE Ensures VM’s have a system assigned identity
dine-vm-ct
Policies:
Policy Name Type Description
dine-vm-change-tracking-lin DINE Associates the Change Tracking DCR to Linux VMs
dine-vm-change-tracking-win DINE Associates the Change Tracking DCR to Windows VMs
dine-az-sec-agent
Policies:
Policy Name Type Description
dine-vm-mde-lin DINE Onboards Linux VM’s to Microsoft Defender Endpoint
dine-vm-mde-win DINE Onboards Windows VM’s to Microsoft Defender Endpoint
dine-vm-sec-association DINE Associates VM’s to the Security DCR
dine-vm-securityagent-lin DINE Deploys the Security Agent to Linux VMs
dine-vm-securityagent-win DINE Deploys the Security Agent to Windows VMs
dine-nsg-flowlogs
Policies:
Policy Name Type Description
dine-nsg-flowlogs-rg DINE Deploys resource group in Management Subscription for housing storage account in specified region
dine-nsg-flowlogs-sa DINE Deploys storage account in above resource group for storing flowlogs
dine-nsg-flowlogs-logs DINE Configures flow logs on target NSG’s associating to above storage account
153/454
Note: For the above initiative the parameters in link contain an object for supported regions.
It is important to ensure that all regions that will be supported for deployment are declared in the parameter
object.
If an NSG is deployed in a non-declared region, the policy will fail.
Linked scope to the acf root level defined in org hcl file is required for the policy to have permissions
across management grorups to deploy the centralised NSG flow logs
Note: For a successful remediation, the "dine-nsg-flowlogs-rg" definition must be remediated first,
followed by "dine-nsg-flowlogs-sa" for each region. After which the "dine-nsg-flowlogs-logs" can be
remediated.
If the resource group and storage account already exists for the region,
then only the remediation of "dine-nsg-flowlogs-logs" is required
(remediating this will show compliance for the other two definitions as well).
append-vmmonitor-tag
Policies:
Policy Name Type Description
modify-vm-monitor-tag-linux Modify Applies vm-monitor tag to Linux VMs with specified DCR reference value
modify-vm-monitor-tag-windows Modify Applies vm-monitor tag to Windows VMs with specified DCR reference value
modify-vmss-monitor-tag-linux Modify Applies vm-monitor tag to Linux VMSSs with specified DCR reference value
modify-vmss-monitor-tag-windows Modify Applies vm-monitor tag to Windows VMSSs with specified DCR reference value
It is important to note that by default, the monitoring module will deploy 2 standard DCRs
The optional policy of vm-dcr-tag can be used with the standard 2 DCR deployments
If there are more DCR’s added that need to have more complicated associations, then this policy will need to be
updated to support it in a customisation.
Alternatively, the tags can be handled manually.
dine-centralized-rsv
Policies:
Policy Name Type Description
dine-backupvault-rg DINE Deploys resource group in specific region for housing RSV
dine-rsv-and-vm-backup DINE Deploys RSV in above resource group, and configures VM’s found in scope with specified backup policy
Note: For the above initiative the parameters in link contain an object for supported regions.
It is important to ensure that all regions that will be supported for deployment are declared in the parameter
object.
If an NSG is deployed in a non-declared region, the policy will fail.
Note: For a successful remediation, the "dine-backupvault-rg" definition must be remediated first, followed by
"dine-rsv-and-vm-backup" To switch on the backup for the VM, the VM must contain a tag called vm-backup
with the value of enabled
other intiatives
private-endpoint-dns
Policies:
154/454
Policy Name Type Parameter Name Parameter Options Description
deny-privatelink-dnszones DENY denyPrivatelinkDNSZonesEffect Disabled, Deny
Deny Private DNS Zones which start with privatelink* from being
created anywhere except
dine-privatelink-sablob-dns-record DINE storageAccountBlobEffect Disabled,
deployIfNotExists
Resource Type: Storage Account. GroupId: blob - Use private DNS
zones to override the DNS resolution for a private endpoint
dine-privatelink-satable-dns-record DINE storageAccountTableEffect Disabled,
deployIfNotExists
Resource Type: Storage Account. GroupId: table - Use private DNS
zones to override the DNS resolution for a private endpoint
dine-privatelink-saqueue-dns-record DINE storageAccountQueueEffect Disabled,
deployIfNotExists
Resource Type: Storage Account. GroupId: queue - Use private DNS
zones to override the DNS resolution for a private endpoint
dine-privatelink-safile-dns-record DINE storageAccountFileEffect Disabled,
deployIfNotExists
Resource Type: Storage Account. GroupId: file - Use private DNS
zones to override the DNS resolution for a private endpoint
dine-privatelink-sa- web-dns-record DINE storageAccountWebEffect Disabled,
deployIfNotExists
Resource Type: Storage Account. GroupId: web - Use private DNS
zones to override the DNS resolution for a private endpoint
dine-privatelink-datalake-fs-dns-record DINE dataLakeFileSystemEffect Disabled,
deployIfNotExists
Resource Type: Storage Account. GroupId: dfs - Use private DNS
zones to override the DNS resolution for a private endpoint
dine-privatelink-adfdatafactory-dns-record DINE adfDataFactoryEffect Disabled,
deployIfNotExists
Resource Type: Azure Data Factory. GroupId: dataFactory - Use
private DNS zones to override the DNS resolution for a private
endpoint
dine-privatelink-sqlsqlserver-dns-record DINE azureSQLSqlServerEffect Disabled,
deployIfNotExists
Resource Type: Azure SQL Database Server. GroupId: sqlServer - Use private DNS zones to override the DNS resolution for a private
endpoint
dine-privatelink-kvvault-dns-record DINE keyvaultVaultEffect Disabled,
deployIfNotExists
Resource Type: Azure Key Vault. GroupId: vault - Use private DNS
zones to override the DNS resolution for a private endpoint
dine-privatelinkautomation-accountsdns-record
DINE automationAccountsEffect Disabled,
deployIfNotExists
Resource Type: Automation Account. GroupId: Webhook, DSCAndHybridWorker - Use private DNS zones to override the DNS resolution for a private endpoint
dine-privatelink-appsites-record DINE AppServiceSitesEffect Disabled,
deployIfNotExists
Resource Type: Azure Web App. GroupId: sites - Use private DNS
zones to override the DNS resolution for a private endpoint
dine-privatelink-adfportal-dns-record DINE portalDataFactoryEffect Disabled,
deployIfNotExists
Resource Type: Azure Data Factory. GroupId: dataFactory - Use
private DNS zones to override the DNS resolution for a private
endpoint
dine-privatelink-afsdns-record DINE storageSyncServicesEffect Disabled,
deployIfNotExists
Resource Type: Azure File Sync. GroupId: afs - Use private DNS
zones to override the DNS resolution for a private endpoint
dine-privatelinkamlworkspace-dnsrecord
DINE amlworkspaceNotebooksEffect Disabled,
deployIfNotExists
Resource Type: Azure Machine Learning. GroupId: amlworkspace - Use private DNS zones to override the DNS resolution for a private
endpoint
dine-privatelink-appconfiguration-dnsrecord
DINE configurationStoresEffect Disabled,
deployIfNotExists
Resource Type: Azure App Configuration. GroupId:
configurationStores - Use private DNS zones to override the DNS
resolution for a private endpoint
dine-privatelinkcognitive-servicesdns-record
DINE cognitiveServicesEffect Disabled,
deployIfNotExists
Resource Type: Azure Cognitive Services. GroupId: account - Use
private DNS zones to override the DNS resolution for a private
endpoint
dine-privatelinkcontainer-registry-dnsrecord
DINE containerRegistryEffect Disabled,
deployIfNotExists
Resource Type: Azure Container Registry. GroupId: registry - Use
private DNS zones to override the DNS resolution for a private
endpoint
dine-privatelinkcosmosdb-cassandradns-record
DINE cosmosdbCassandraEffect Disabled,
deployIfNotExists
Resource Type: Azure Cosmos DB. GroupId: Cassandra - Use
private DNS zones to override the DNS resolution for a private
endpoint
dine-privatelinkcosmosdb-gremlindns-record
DINE cosmosdbGremlinEffect Disabled,
deployIfNotExists
Resource Type: Azure Cosmos DB. GroupId: Gremlin - Use private DNS zones to override the DNS resolution for a private endpoint
dine-privatelinkcosmosdb-mongo-dnsrecord
DINE cosmosdbMongoEffect Disabled,
deployIfNotExists
Resource Type: Azure Cosmos DB. GroupId: MongoDB - Use
private DNS zones to override the DNS resolution for a private
endpoint
dine-privatelinkcosmosdb-sql-dnsrecord
DINE cosmosdbSqlEffect Disabled,
deployIfNotExists
Resource Type: Azure Cosmos DB. GroupId: Sql - Use private DNS
zones to override the DNS resolution for a private endpoint
155/454
dine-privatelinkcosmosdb-table-dnsrecord
DINE cosmosdbTableEffect Disabled,
deployIfNotExists
Resource Type: Azure Cosmos DB. GroupId: Table - Use private DNS zones to override the DNS resolution for a private endpoint
dine-privatelink-k8sapi-dns-record DINE managementEffect Disabled,
deployIfNotExists
Resource Type: Azure Kubernetes Service. GroupId: management - Use private DNS zones to override the DNS resolution for a private
endpoint
dine-privatelink- mariadbserver-dnsrecord
DINE mariadbServerEffect Disabled,
deployIfNotExists
Resource Type: Azure MariaDB Server. GroupId: mariadbServer - Use private DNS zones to override the DNS resolution for a private
endpoint
dine-privatelinkpostgresqlerver-dnsrecord
DINE postgresqlServerEffect Disabled,
deployIfNotExists
Resource Type: Azure PostgreSQL Server. GroupId:
postgresqlServer - Use private DNS zones to override the DNS
resolution for a private endpoint
dine-privatelink-redisdns-record DINE redisCacheEffect Disabled,
deployIfNotExists
Resource Type: Azure Redis Cache. GroupId: redisCache - Use
private DNS zones to override the DNS resolution for a private
endpoint
dine-privatelink-redisenterprise-dns-record DINE redisEnterpriseEffect Disabled,
deployIfNotExists
Resource Type: Azure Redis Enterprise. GroupId: redisEnterprise - Use private DNS zones to override the DNS resolution for a private
endpoint
dine-privatelinksearch-services-dnsrecord
DINE searchServicesEffect Disabled,
deployIfNotExists
Resource Type: Azure Search. GroupId: searchServices - Use
private DNS zones to override the DNS resolution for a private
endpoint
dine-privatelinkservicebus-dns-record DINE servicebusEffect Disabled,
deployIfNotExists
Resource Type: Azure Service Bus. GroupId: namespace - Use
private DNS zones to override the DNS resolution for a private
endpoint
dine-privatelinksignalr-dns-record DINE signalREffect Disabled,
deployIfNotExists
Resource Type: Azure SignalR. GroupId: signalR - Use private DNS
zones to override the DNS resolution for a private endpoint
Policy Name Type Parameter Name Parameter Options Description
Deploys policies to support Private Endpoint DNS, including denying private DNS zones in resource groups other
than those deployed by modules DCInfra and ShareServices-PrivateDns
Parameter Names are listed in the above table, each parameter controls whether the policy is enabled or disabled
via the Policy Effect. When selecting Disabled the policy is still deployed into the inititive but is in disabled
state so not evaluated.
Linked Scope: If deploying this initiative to any mg other than root then a linked scope needs to be added with
value: private_dns_zone_resource_group_id
deprecated/ preview policies
Microsoft is constantly updating built-in policies.
Part of this process may also include deprecating policies, or introducing new policies in Preview state.
It is important to note that the CLZ team will not support [Deprecated] or [Preview] policies in ACF.
Part of the release cycle for ACF will also include a check for deprecation of policies in use.
If a built-in policy in use by ACF has since become deprecated, one of two things will happen:
1. The policy will be removed in the next release.
2. The policy will be converted to a custom policy, and managed by the CLZ team.
Option 2 is selected if the team seems that the policy has value for ACF.
Preview policies will not be introduced until they become Generally Available.
156/454
Note: While the CLZ team has no input towards which policies become deprecated, these policies will still
continue to function in the environment. The display name will say [Deprecated], but it is important to know that
the functionality of the policy remains.
For managed service cases, a client may see that one of the ACF policies becomes Deprecated. They may request for the
policy to be removed. This can be achieved by setting the policy to enabled = false for the given policy assignment as mentioned here
important notes
When policies are deployed to the target environment, the acf policies blueprint will automatically append the ACF version
to the following properties:
Assignment Name (Custom and BuiltIn)
Definition Name (Custom)
Initiative Name (Custom)
Managed Identity Names (Custom and BuiltIn)
Display Name (Custom and BuiltIn)
For the Assignment Names, Definition Names, Managed Identities and Initiative Names, the ACF Version is appended to
the end of the name.
For example: policyName1.0
For the Display Name, the ACF Version is appended as a prefix. This is to make the names more visually pleasing.
For example… before:
Ensure soft delete is enabled for Key Vaults
After:
[1.0] Ensure soft delete is enabled for Key Vaults
Because Assignment Names have limited characters of 24, it’s important to note that all assignment names being
used for both custom and builtin policies MUST be 20 character or less. This is to allow symantic version
numbers to be appended to policies.
Why this change?
This is to allow for better upgradability of Azure Policies for managed environments. Upgrading policies (especially
custom policies with adjusted rule files) require a full removal from the Azure portal before redeployment.
Azure custom policies can’t be upgraded in place when parameters change. As such, before it was required to remove all
policies, then deploy the new ones. This process causes downtime in governance (such as deny policies), and is not ideal.
With this change, it allows the process to update policies without requiring downtime of governance. By uploading
duplicate policies, old policies can be removed, leaving new ones already in place.
Please Note: This does NOT affect regulatory compliance initiatives. These are handled outside of the policies
blueprint and have their own update methods.
how to use
The purpose of this section is to provide some examples on updating an existing policy assignment.
157/454
This serves as a step-by-step that will aim to help with managing your policies.
steps_for_making_changes
In all the examples mentioned below in this document, to make any changes related to policy assignments, please ensure
management_group_name property is also updated with right value if the acf environment is deployed with different management group names instead of ACF default names.
For eg. in below sample yaml if environment is deployed with acf root level management group as mg-acf-custom instead
of mg-acf, then this value also needs to be updated along with any other change in the policies_vars.yaml file
The following steps are common for making any changes in policies. Please review these before proceeding further.
Create a new feature branch for the change in the repo.
Check out the newly created branch (i.e. in Visual Studio Code).
A d j u s t terragrunt\prod\CORE\AZUREPOLICIES\policies_vars.yaml or
terraform\prod\custom_tf\blueprint-policies-standard (where prod is sample environment name ) if needed
to add new custom policy definitions etc.,
Sample change below:
Commit and push the code.
Create pull request.
Make a comment on the pull request as /AZUREPOLICIES_PLAN_PROD or /AZUREPOLICIES_PLAN_TEST based on the
environment
Terraform would create a plan with the changes
...
managementGroups:
management_group_name: mg-acf-custom
...
default_acf_policy_assignments_changes: #THIS LINE MUST REMAIN UNCOMMENTED
policy_assignments:
- definitionId: /providers/Microsoft.Authorization/policyDefinitions/e56962a6-4747-49cd-b67bbf8b01975c4c
# assignmentName: allow-location-rsc
# description: This policy enables you to restrict the locations your organization
# can specify when deploying resources. Use to enforce your geo-compliance requirements.
# Excludes resource groups, Microsoft.AzureActiveDirectory/b2cDirectories, and resources
# that use the 'global' region.
# displayName: Allowed locations
# identity:
# type: None
managementGroups:
- management_group_name: mg-acf
# enabled: true
# linkedScopes: []
# notScopes: []
parameters:
listOfAllowedLocations:
- centralindia
- northeurope
- westeurope
- global
- uksouth
# nonComplianceMsg: Deployments should only occur in allowed locations
158/454
Verfiy the changes and again make a comment on the pull request as /AZUREPOLICIES_APPLY_PROD or
/AZUREPOLICIES_APPLY_TEST based on the environment to apply the changes
acf_policy_parameters changes
This section describes how to change default acf_policy_parameters. It is possible to override various acf policy
parameters.
Open the file \terragrunt\prod\CORE\AZUREPOLICIES\policies_vars.yaml where prod is sample environment
name
Define the new value for any given parameter under the input acf_policy_parameters.defaults
Locate the parameter and uncomment the key and entire value of this parameter.
Note: The entire value of the parameter should be uncommented, and make the additions or removal. In below eg.
to add an additional value to imagePublisher parameter, the entire value should be uncommented.
ORIGINAL:
UPDATED :
acf_policy_parameters: #THIS LINE MUST REMAIN UNCOMMENTED
defaults: #THIS LINE MUST REMAIN UNCOMMENTED
# # default for allow-vm-image policy parameter
# imagePublisher: [
# "Redhat",
# "OpenLogic",
# "Canonical",
# "MicrosoftWindowsServer"
# ]
#
# #default for allow-vm-image policy parameter
# imageOffer: [
# "RHEL",
# "rhel-byos",
# "SLES",
# "UbuntuServer",
# "0001-com-ubuntu-server-focal",
# "Windows-10",
# "WindowsServer"
# ]
#
acf_policy_parameters: #THIS LINE MUST REMAIN UNCOMMENTED
defaults: #THIS LINE MUST REMAIN UNCOMMENTED
# # default for allow-vm-image policy parameter
imagePublisher: [
"Redhat",
"OpenLogic",
"Canonical",
"MicrosoftWindowsServer",
"NEW-VALUE"
]
#
# #default for allow-vm-image policy parameter
# imageOffer: [
# "RHEL",
# "rhel-byos",
# "SLES",
# "UbuntuServer",
# "0001-com-ubuntu-server-focal",
# "Windows-10",
# "WindowsServer"
# ]
#
159/454
default policy assignment changes
The below sections explains how to make any changes for default policy assignments ( both default built-in and custom
policy assignments)
Default custom policy assignments are the ones deployed by ACF, using default custom policy definitions or custom
policy set defintions present in the location terraform\.modules\acf\modules\blueprint-policiesstandard\acf_policy_definitions or terraform\.modules\acf\modules\blueprint-policiesstandard\acf_policy_set_definitions
Default built-in policy assignments are the ones deployed by ACF, using built-in policy definitions defined by
Microsoft
In the \terragrunt\prod\CORE\AZUREPOLICIES\policies_vars.yaml (where prod is sample environment name),
under default_acf_policy_assignments_changes.policy_assignments
The assignments with the property name are called custom policy assignments
The assignments with the property definitionId are called built-in policy assignments
Also, the assignments with the property isInitiative equal to true are default policy assignments created using
initiatives.
The process for making changes for both of these assignments (default built-in and default custom) are mostly similar.
Except, in case of built-in we need to uncomment definitionId and for custom policy assignment uncomment name
property.
Before performing any changes, please go through the steps on how to apply the changes mentioned here
The below sections explains on how to make changes in default policy assignments during various scenarios:
Parameters For Policy Assignments
Define Exclusions
Re-assign a policy assignment
Deleting a policy assignment
Custom non compliance message
Define a linked scope for a policy assignment
parameters_for_policy_assignments
scenario : updating parameters of a policy assignment
In this example, we have a built in policy assignment deployed in Azure with existing parameter values shown as below in
\terragrunt\prod\CORE\AZUREPOLICIES\policies_vars.yaml where prod is sample environment name
The current configuration of the policy looks like this:
default_acf_policy_assignments_changes: #THIS LINE MUST REMAIN UNCOMMENTED
policy_assignments:
# - definitionId: /providers/Microsoft.Authorization/policyDefinitions/e56962a6-4747-49cd-b67bbf8b01975c4c
# assignmentName: allow-location-rsc
# description: This policy enables you to restrict the locations your organization
# can specify when deploying resources. Use to enforce your geo-compliance requirements.
# Excludes resource groups, Microsoft.AzureActiveDirectory/b2cDirectories, and resources
# that use the 'global' region.
# displayName: Allowed locations
# identity:
# type: None
160/454
In a scenario, to add a new region - uksouth. Perform the following steps:
Search for the respective policy assigment in the file
\terragrunt\prod\CORE\AZUREPOLICIES\policies_vars.yaml where prod is sample environment name. For eg.
in this case allow-location-rsc
Uncomment definitionId (in case of custom policy uncomment name), managementGroups, management_group_name, parameters,listOfAllowedLocations (also the values for it)
Add the new location to listOfAllowedLocationsparameter
The updated config looks as below:
exclusions
scenario : define exclusions for a policy assignment
In this example, we have a default custom policy assignment deployed in Azure with existing parameter values shown as
below in \terragrunt\prod\CORE\AZUREPOLICIES\policies_vars.yaml where prod is sample environment name
In order to define exclusions for the below policy assignemnt
Uncomment name (or definitionId in case of built-in policy assignment), managementGroups,management_group_name and notScopes.
Add new value for notScopes property.
Below are various examples
# managementGroups:
# - management_group_name: mg-acf
# enabled: true
# linkedScopes: []
# notScopes: []
# parameters:
# listOfAllowedLocations:
# - centralindia
# - northeurope
# - westeurope
# - global
# nonComplianceMsg: Deployments should only occur in allowed locations
default_acf_policy_assignments_changes: #THIS LINE MUST REMAIN UNCOMMENTED
policy_assignments:
- definitionId: /providers/Microsoft.Authorization/policyDefinitions/e56962a6-4747-49cd-b67bbf8b01975c4c
# assignmentName: allow-location-rsc
# description: This policy enables you to restrict the locations your organization
# can specify when deploying resources. Use to enforce your geo-compliance requirements.
# Excludes resource groups, Microsoft.AzureActiveDirectory/b2cDirectories, and resources
# that use the 'global' region.
# displayName: Allowed locations
# identity:
# type: None
managementGroups:
- management_group_name: mg-acf
# enabled: true
# linkedScopes: []
# notScopes: []
parameters:
listOfAllowedLocations:
- centralindia
- northeurope
- westeurope
- global
- uksouth
# nonComplianceMsg: Deployments should only occur in allowed locations
161/454
A. Excluding a Management Group
B. Excluding a Subscription
C. Excluding a Resource Groups
re_assign_policy
scenario : re-assign a policy assignment
The purpose of this section is to provide some examples on re-assigning a default policy assignment that’s already
deployed with ACF.
Before performing any changes, please go through the steps on how to apply the changes mentioned here
A. re-assign from one management group scope to another
In order to re-assign a default policy assignment to another management group scope, following needs to be done
default_acf_policy_assignments_changes: #THIS LINE MUST REMAIN UNCOMMENTED
policy_assignments:
- name: append-keyvault-soft-delete
# assignmentName: append-kv-soft-del
# description: This policy appends soft delete to key vaults
# displayName: Ensure soft delete is enabled for Key Vaults
# identity:
# type: None
managementGroups:
- management_group_name: mg-acf
# enabled: true
# linkedScopes: []
notScopes: ["/providers/Microsoft.Management/managementGroups/mg-sandbox"]
# parameters: {}
# nonComplianceMsg: Keyvaults should have soft delete enabled
default_acf_policy_assignments_changes: #THIS LINE MUST REMAIN UNCOMMENTED
policy_assignments:
- name: append-keyvault-soft-delete
# assignmentName: append-kv-soft-del
# description: This policy appends soft delete to key vaults
# displayName: Ensure soft delete is enabled for Key Vaults
# identity:
# type: None
managementGroups:
- management_group_name: mg-acf
# enabled: true
# linkedScopes: []
notScopes: ["/subscription/xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx" ]
# parameters: {}
# nonComplianceMsg: Keyvaults should have soft delete enabled
default_acf_policy_assignments_changes: #THIS LINE MUST REMAIN UNCOMMENTED
policy_assignments:
- name: append-keyvault-soft-delete
# assignmentName: append-kv-soft-del
# description: This policy appends soft delete to key vaults
# displayName: Ensure soft delete is enabled for Key Vaults
# identity:
# type: None
managementGroups:
- management_group_name: mg-acf
# enabled: true
# linkedScopes: []
notScopes: ["/subscription/xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx/resourceGroups/xxx-xxx" ]
# parameters: {}
# nonComplianceMsg: Keyvaults should have soft delete enabled
162/454
Step - 1: - Disable existing policy assignment for given management group scope under
default_acf_policy_assignments_changes.policy_assignments - Uncomment name (or definitionId in case of
built-in policy assignment),managementGroups, management_group_name, enabled - Update enabled property to false
to disable this assignment - Below is an example
Step - 2: - Create a new policy assignment to the new management group scope under
additional_policy_assignments.policy_assignments - Copy the above yaml content, and add to the
additional_policy_assignments.policy_assignments - All the lines must be uncommented as shown below and
update new value for management_group_name which would be the new scope - enabled property should be true -
Below is an example
B. assinging to additional management group scope
In order to assign a default policy assignment to another management group scope, following needs to be done
We need to create an additional policy assignment with same settings to the addtional management group scope under
additional_policy_assignments.policy_assignments
Copy the existing policy assignment yaml snippet from
default_acf_policy_assignments_changes.policy_assignments and add to the
additional_policy_assignments.policy_assignments
All the lines must be uncommented as shown below and just update new value for management_group_name which
would be the additional scope
enabled property should be true
Below is an example
default_acf_policy_assignments_changes: #THIS LINE MUST REMAIN UNCOMMENTED
policy_assignments:
- name: append-keyvault-soft-delete
# assignmentName: append-kv-soft-del
# description: This policy appends soft delete to key vaults
# displayName: Ensure soft delete is enabled for Key Vaults
# identity:
# type: None
managementGroups:
- management_group_name: mg-acf
enabled: false
# linkedScopes: []
# notScopes: []
# parameters: {}
# nonComplianceMsg: Keyvaults should have soft delete enabled
additional_policy_assignments: #THIS LINE MUST REMAIN UNCOMMENTED
policy_assignments:
- name: append-keyvault-soft-delete
assignmentName: append-kv-soft-del
description: This policy appends soft delete to key vaults
displayName: Ensure soft delete is enabled for Key Vaults
identity:
type: None
managementGroups:
- management_group_name: <NEW-MANAGEMENT-GROUP-NAME> # UPDATE THE NEW MANAGEMENT
GROUP HERE
enabled: true
linkedScopes: []
notScopes: []
parameters: {}
nonComplianceMsg: Keyvaults should have soft delete enabled
additional_policy_assignments: #THIS LINE MUST REMAIN UNCOMMENTED
policy_assignments:
- name: append-keyvault-soft-delete
assignmentName: append-kv-soft-del
163/454
delete_policy
scenario : deleting a policy assignment
The purpose of this section is to provide some examples on deleting/removing a policy assignment that’s already deployed
with ACF.
Before performing any changes, please go through the steps on how to apply the changes mentioned here
In order to delete below default policy assignment
Uncomment name (or definitionId in case of built-in policy
assignment),managementGroups,management_group_name,enabled
Add additional management_group_name under managementGroups and related properties
On deleting a policy assingment, terraform will perform following:
1. If it’s a built-in policy, it will remove the assignment
2. If it’s a custom definition, it will remove the assignment and policy definition
3. If it’s a custom initiative, it will remove the assignment, then the initiative, then all associated policy definitions within
the initiative.
custom_non_compliance_message
scenario : custom non compliance message
The purpose of this section is to provide some examples on setting a custom non compliance message for a policy
assignment that’s already deployed with ACF.
Before performing any changes, please go through the steps on how to apply the changes mentioned here
In order to create a custom non compliance message in below default policy assignment
description: This policy appends soft delete to key vaults
displayName: Ensure soft delete is enabled for Key Vaults
identity:
type: None
managementGroups:
- management_group_name: <ADDITIONAL-MANAGEMENT-GROUP-NAME> # UPDATE THE ADDITIONAL
MANAGEMENT GROUP HERE
enabled: true
linkedScopes: []
notScopes: []
parameters: {}
nonComplianceMsg: Keyvaults should have soft delete enabled
default_acf_policy_assignments_changes: #THIS LINE MUST REMAIN UNCOMMENTED
policy_assignments:
- name: append-keyvault-soft-delete
# assignmentName: append-kv-soft-del
# description: This policy appends soft delete to key vaults
# displayName: Ensure soft delete is enabled for Key Vaults
# identity:
# type: None
managementGroups:
- management_group_name: mg-acf
enabled: false # SET THIS TO FALSE IF POLICY ASSIGNMENT NEEDS TO BE DELETED
# linkedScopes: []
# notScopes: []
# parameters: {}
# nonComplianceMsg: Keyvaults should have soft delete enabled
164/454
Uncomment name (or definitionId in case of built-in policy assignment), nonComplianceMsg
Add the custom message to the nonComplianceMsg property
linked_scope_for_policy_assignment
scenario : define a linked scope for a policy assignment
Linked Scopes are only required if the policy requires access to a resource outside of the current assignment scope.
Most of the assignments are on the root level (mg-acf) so linked scopes are not required.
If you still want to assign to the assignment to a lower level management group, but need access elsewhere, you can still
add the linked scope
Linkedscope is needed only for policy assignments being dine type and with having identity of type
systemAssigned.
Before performing any changes, please go through the steps on how to apply the changes mentioned here
In order to create a linked scope in below default policy assignment
Uncomment name (or definitionId in case of built-in policy assignment), managementGroups, management_group_name and linkedScopes
Add the linked scopes to the linkedScopes property
additional policy assignments
The purpose of this section is to provide some examples on adding a new additional policy assignment, apart from the acf
default policy assignments.
default_acf_policy_assignments_changes: #THIS LINE MUST REMAIN UNCOMMENTED
policy_assignments:
- name: append-keyvault-soft-delete
# assignmentName: append-kv-soft-del
# description: This policy appends soft delete to key vaults
# displayName: Ensure soft delete is enabled for Key Vaults
# identity:
# type: None
managementGroups:
- management_group_name: mg-acf
# enabled: true
# linkedScopes: []
# notScopes: []
# parameters: {}
nonComplianceMsg: <ADD CUSTOM COMPLIANCE MESSAGE HERE>
default_acf_policy_assignments_changes: #THIS LINE MUST REMAIN UNCOMMENTED
policy_assignments:
- name: dine-sql-firewall-vnet
# assignmentName: dine-sql-vnet-rule
# description: Deploy vnet rule to Azure SQL Servers.
# displayName: Enforce specified Virtual Network rule for SQL servers
# identity:
# type: systemAssigned
managementGroups:
- management_group_name: mg-landing-zones
# enabled: false
linkedScopes: [DEFINE THE LINKED SCOPES HERE]
# notScopes: []
# parameters:
# subnetId: CHANGE-ME
# vnetRuleName: CHANGE-ME
# nonComplianceMsg: PaaS SQL should have specific virtual network rule enabled
165/454
This blueprint allows to add additional policy assignments for any built-in or any pre-defined ACF custom policy or
custom policy set. To create these additional policys assignments, update the inputs for
additional_policy_assignments.policy_assignments in the file
terragrunt\prod\CORE\AZUREPOLICIES\policies_vars.yaml where prod is sample environment name
The following sub sections explains in detail, how to create new additional policy assignments for built-in and pre-defined
ACF custom policy or custom policy set
Before performing any changes, please go through the steps on how to apply the changes mentioned here
built-in policy assignment
1. identify the built-in policy definition
First step is to go to the Azure Portal and find the policy that you want.
You may not know the ID of the policy, but know the description and/ or name.
For this example, we’ll search for a policy that will audit key vaults without Azure Defender enabled.
1. Go to the Azure Portal
2. Go to Policies
3. Click on Definitions
4. Search for the policy by name/ description/ ID
Once you have found the policy, click on it.
This new overview gives you all the information you need. Take a note of the following information:
1. Policy Definition ID
2. Description
3. Category
4. Click on the Parameters tab, and take note of the Parameters used
It’s also important to take note of allowed values
So in this case, search for Key Vault and find the policy called
Azure Defender for Key Vault should be enabled
with the Definition ID of /providers/Microsoft.Authorization/policyDefinitions/0e6763cc-5078-4e64-889dff4d9a839047
The description is: Azure Defender for Key Vault provides an additional layer of protection and
security intelligence by detecting unusual and potentially harmful attempts to access or exploit
key vault accounts.
The category is: Security Center
The parameters for this are:
Name: Effect
Type: String
Default Value: AuditIfNotExists
Allowed Values: AuditIfNotExists; Disabled
166/454
Now you’re ready to add the new built in policy assignment to the
terragrunt\prod\CORE\AZUREPOLICIES\policies_vars.yaml (where prod is sample environment name) file.
2. identify the built-in policy set definition (initiative)
The process for built-in Initiatives are the exact same as above built-in policy definitions.
Except there will be a lot more parameters in most cases.
Just make sure that the policy definition ID includes the /policySetDefinitions/ namespace.
3. add to terragrunt input file
Add the additional new built-in policy assignment as input to the
additional_policy_assignments.policy_assignments in the file
terragrunt\prod\CORE\AZUREPOLICIES\policies_vars.yaml where prod is sample environment name
pre-defined custom policy assignment
The below section describes, how to create a new policy assignment using the custom policy definitions or policy set
defintions pre-defined by ACF.
Identify the name of the custom policy definition or policy set definition pre-defined by ACF and all the parameters needs
to be provided. The name should be exactly same as custom policy definition or policy set definition pre-defined by ACF.
Below is a sample and this needs to be added as a input to the additional_policy_assignments.policy_assignments
in the file terragrunt\prod\CORE\AZUREPOLICIES\policies_vars.yaml where prod is sample environment name
## All mandatory fields must be provided: name, assignmentName, management_group_name, enabled and
parameters have to be
## specified too if policy requires them
##
## The pair of name/definitionId and management_group_name must be unique and must not be the same
like default policy assignments
##
## Please note that for custom policy set assignment isInitiative must be set to true
additional_policy_assignments: #THIS LINE MUST REMAIN UNCOMMENTED
policy_assignments: #THIS LINE MUST REMAIN UNCOMMENTED
- definitionId: /providers/Microsoft.Authorization/policyDefinitions/96670d01-0a4d-4649-9c89-
2d3abc0a5025
assignmentName: deny-rg-wo-TAGNAME
displayName: Require a tag on resource groups
description: Enforces existence of a tag on resource groups.
nonComplianceMsg: Resource Groups should have specified tags on deployment
identity:
type: None
managementGroups:
- management_group_name: mg-landing-zones
enabled: true
parameters:
tagName: CHANGE_ME
notScopes: []
linkedScopes: []
## All mandatory fields must be provided: name, assignmentName, management_group_name, enabled and
parameters have to be
## specified too if policy requires them
##
## The pair of name/definitionId and management_group_name must be unique and must not be the same
like default policy assignments
##
## Please note that for custom policy set assignment isInitiative must be set to true
additional_policy_assignments: #THIS LINE MUST REMAIN UNCOMMENTED
167/454
new custom policy definitions and assignments
Apart from making changes to default policy assignments and creating new policy assignments using ACF pre-defined
custom policy definition or policy set definition, using this blueprint it also possible to create
New Custom Policy Definitions
New Custom Policy Set Definitions (initiative)
New Custom Policy Assignments
pre-requisites
1. Some knowledge on custom policy creation
2. Some knowledge on how initiatives and definitions work
This document will not explain the differences between initiatives and definitions, rules and parameters. Some
knowledge is required here. Azure Policy Initiatives vs Azure Policies
structure
A custom policy definition is made up of 2 parts:
1. General information (metadata, displayname, description)
2. Parameters
3. Rules
In ACF Terraform, these needs to be defined in a single json file.
A custom policy initiative is made up of 3 parts:
1. General information (metadata, displayname, description)
2. Parameters
3. Policy Definitions (aka Initiative settings)
In ACF Terraform, these needs to be defined in a single json file.
We will go into detail on how to setup these files in below sections.
Before performing any changes, please go through the steps on how to apply the changes mentioned here
dynamic_and_static_reference
dynamic and static parameters in custom policies (also initiatives) and custom policy assignments
policy_assignments: #THIS LINE MUST REMAIN UNCOMMENTED
- name: allow-vm-sku
assignmentName: allow-vm-sku
description: This policy allows you to specify what skus are allowed for storage accounts
and virtual machines.
displayName: Allow only specified VM SKUs
nonComplianceMsg: Only VM SKU's in allow list should be deployed
identity:
type: systemAssigned
managementGroups:
- management_group_name: mg-landing-zones
enabled: true
parameters:
listOfAllowedSKUs: ["Standard_B2ms","Standard_B2ms"]
notScopes: []
linkedScope: []
168/454
To create custom policy definitions, initiatives and assignments, we will be creating json files, explained sub-sequent
sections. In these json files, it is possible to populate certain values (eg. policy assignment parameters etc.,) dynamically
from the pre-defined acf parameters or set them statically.
Below are some parameters pre-defined in this blueprint, which can be used
Note : Below values cannot be overriden
Name Type Value Description
acf_root_level string acf_root_level defined in org hcl file ACF Root Level Management Group
Name
mg_landing_zones string mg-landing-zones value from outputs of core Management group Name for the Landing Zone environment
mg_online string mg-online value from outputs of core Management group Name for the Online environment
mg_sandbox string mg-sandbox value from outputs of core Management group Name for the
Sandbox environment
acf_version string acf version computed from tags.nc-cf-version from global_vars.yaml file ACF Version
location string location defined in org hcl file Default location of ACF
environment string environment_name defined in org hcl file Environment Name
audit_storage_enabled bool storage_enabled from audit_outputs
storage_enabled output from audit module
hub_spoke_topology bool true if selected_topology from network output is HubSpoke, else false
trueif network topology is
HubSpoke, else false
Note: Values for parameters listed in below link can be overriden as explained here. A change of a parameter will
reflect in all the policies which consumes the parameter.
The complete list of acf pre-defined parameters are available here
Below are various cases, explaining how to reference above variables/parameters while creating json files of custom
policies/initiatives/assignments
A. using parameters from above table - dynamic
The parameters listed in the above table are mostly primitive data type i.e string, bool etc.,
These can be used in the json files as shown in below examples
Example 1:
{
"definitionId": "/providers/Microsoft.Authorization/policyDefinitions/c0e996f8-39cf-4af9-9f45-
83fbde810432",
"description": "Some description",
"displayName": "Some Display Name",
"nonComplianceMsg": "Non Compliance Message",
"identity": {
"type": "None"
},
"assignmentName": "some assignment name",
"managementGroups": {
"${acf_root_level}": { # HERE acf_root_level PARAMETER IS USED TO
DYNAMICALLY SET ACF ROOT LEVEL MANAGEMENT GROUP NAME
"enabled": false,
"parameters": {},
"notScopes": [],
"linkedScopes": []
}
169/454
Example 2:
B. using parameters from above link - dynamic
The parameters listed in the above link are of different types string,bool, list(string), map(string) etc.,
Lets see how we can use these different parameter types in the json files with below examples
Note: All these parameters from the link are available under parent parameter called
policy_default_parameters, so these parameters needs to be referenced as childs of
policy_default_parameters when being used. Please see in below example, to use vaultScheduledRuntime
parameter it is being referred as policy_default_parameters.vaultScheduledRuntime The same convention
applies to any other parameter from the link
Example 1: string and bool type
}
}
{
"name": "name of the policy",
"assignmentName": "some assignment name",
"displayName": "Some Display Name",
"description": "Some description",
"nonComplianceMsg": "Non Compliance Message",
"isInitiative": true,
"identity": {
"type": "systemAssigned"
},
"managementGroups": {
"${acf_root_level}": {
"enabled": true,
"parameters": {
"rgLocation": {"value": "${location}"} # HERE location PARAMETER IS USED TO
DYNAMICALLY SET VALUE FOR rgLocation
},
"notScopes": [],
"linkedScopes": []
}
}
}
{
"name": "name of the policy",
"assignmentName": "some assignment name",
"displayName": "Some Display Name",
"description": "Some description",
"nonComplianceMsg": "Non Compliance Message",
"isInitiative": true,
"identity": {
"type": "systemAssigned"
},
"managementGroups": {
"${acf_root_level}": {
"enabled": true,
"parameters": {
"vaultScheduledRuntime": {"value":
"${policy_default_parameters.vaultScheduledRuntime}"}, # HERE vaultScheduledRuntime
PARAMETER (string type) IS USED TO DYNAMICALLY SET VALUE FOR vaultScheduledRuntime
"StorageAccountDiagNosticsWrite": {"value":
"${policy_default_parameters.StorageAccountDiagNosticsWrite}"}, # HERE
StorageAccountDiagNosticsWrite (bool type) PARAMETER IS USED TO DYNAMICALLY SET VALUE FOR
StorageAccountDiagNosticsWrite
},
"notScopes": [],
"linkedScopes": []
170/454
Example 2 : list data type
In below imageOffer parameter which is a list, is being expanded using for loop and if
Example 2 : map data type
In below acf_locations parameter which is a map, is being expanded and set to locations policy parameter using for
loop and if
C. static parameters
}
}
}
{
"name": "name of the policy",
"assignmentName": "some assignment name",
"displayName": "Some Display Name",
"description": "Some description",
"nonComplianceMsg": "Non Compliance Message",
"isInitiative": true,
"identity": {
"type": "systemAssigned"
},
"managementGroups": {
"${acf_root_level}": {
"enabled": false,
"parameters": {
"imageOffer": {"value": [%{ for value in policy_default_parameters.imageOffer
~}"${value}"%{ if element(policy_default_parameters.imageOffer,
length(policy_default_parameters.imageOffer)-1) != value },%{ endif } %{ endfor ~}]},
},
"notScopes": [],
"linkedScopes": []
}
}
}
{
"name": "name of the policy",
"assignmentName": "some assignment name",
"displayName": "Some Display Name",
"description": "Some description",
"nonComplianceMsg": "Non Compliance Message",
"isInitiative": true,
"identity": {
"type": "systemAssigned"
},
"managementGroups": {
"${acf_root_level}": {
"enabled": false,
"parameters": {
"locations": {"value": {
%{ for location-key, location-value in policy_default_parameters.acf_locations ~}
"${location-key}": {
"short": "${location-value}"
}%{ if element(keys(policy_default_parameters.acf_locations),
length(keys(policy_default_parameters.acf_locations))-1) != location-key },%{ endif }
%{ endfor }
}},
},
"notScopes": [],
"linkedScopes": []
}
}
}
171/454
It is always possible to statically set values. Below is an example
new_custom_policy_definition
create a new custom policy definition
Navigate to the terraform\prod\custom_tf\blueprint-policies-standard\customised_policy_definitions
where prod is sample environment name
Create new file in above path dine-my-custom-policy.json. (The name of the file would be used as name of the
custom policy. It is recommended to use prefix aine, allow, deny, dine, audit, append, modify to understand
what the policy action is going to perform)
The name of the file should be as name of the custom policy being defined.
This file should sit along side all the other custom definition files. They must not be in their own separate folder.
Structure should look like this:
terraform
├── prod
│ ├── custom_tf
│ │ ├── blueprint-policies-standard
│ │ | |── customised_policy_definitions
│ │ | | |── dine-my-custom-policy.json
In the following example, we will create a very basic custom policy definition.
Open the dine-my-custom-policy.json
Copy and paste the below base template:
{
"definitionId": "/providers/Microsoft.Authorization/policyDefinitions/c0e996f8-39cf-4af9-9f45-
83fbde810432",
"description": "Some description",
"displayName": "Some Display Name",
"nonComplianceMsg": "Non Compliance Message",
"identity": {
"type": "None"
},
"assignmentName": "some assignment name",
"managementGroups": {
"${acf_root_level}": {
"enabled": false,
"parameters": {
"retention": {"value": 2} # HERE static value of 2 is being assigned to
retention parameter
},
"notScopes": [],
"linkedScopes": []
}
}
}
{
"displayName": "My Custom Policy Display Name", #will be viewable on the policy overview page
in the portal
"description": "My Custom Policy Description", #will be viewable in the policy definition page
in the portal
"metadata":
{
"category": "ACF-Network" # Define the category of the definition
},
"parameters": { # Define any parameters which are required for the
policyRule
"gatewayType": {
"type": "string",
"metadata": {
172/454
In the above sample, we have a basic deny rule, which is using a paramter called gatewayType
In the above, I also added "AllowedValues" to ensure that only two types of entries can be used. As I know these are
the two gateway types available.
Your custom policy definition file is now complete
It is highly advisable to review Create a Custom Policy Definition provided by Microsoft to give you all the
information you need to create a custom rule.
You can use the above template for creating the custom policy definition file. Just remove the comments. And
obviously adjust the values.
To create a custom policy assignment using this custom policy definition, please check here
new_custom_initiative
create a new custom initiative
This section will cover how to create a new custom initiative with custom definitions.
The process for creating an initiative is somewhat similar to creating a definition. But with some added extra requirements.
Navigate to the terraform\prod\custom_tf\blueprint-policiesstandard\customised_policy_set_definitions where prod is sample environment name
Create new file in above path dine-my-custom-initiative.json.(The name of the file would be used as name of the
custom policy. It is recommended to use prefix aine, allow, deny, dine, audit, append, modify to understand
what the policy action is going to perform)
The name of the file should be as name of the custom initiative being defined.
This file should sit along side all the other custom initiative files. They must not be in their own separate folder.
Structure should look like this:
terraform
├── prod
"displayName": "Gateway Type",
"allowedValues": [
"Vpn",
"ExpressRoute"
]
}
}
},
"policyRule": {
"if": {
"allOf": [
{
"field": "type",
"equals": "Microsoft.Network/virtualNetworkGateways"
},
{
"field": "Microsoft.Network/virtualNetworkGateways/gatewayType",
"equals": "[parameters('gatewayType')]"
}
]
},
"then": {
"effect": "Deny"
}
}
}
173/454
│ ├── custom_tf
│ │ ├── blueprint-policies-standard
│ │ | |── customised_policy_set_definitions
│ │ | | |── dine-my-custom-initiative.json
In the following example, we will create a very basic custom initiative.
* Open the `dine-my-custom-initiative.json`
* Copy and paste the below base template:
To create a custom policy assignment using this custom policy definition, please check here
create a new custom initiative - builtin policy references
It is also possible to have Builtin policy References in a initiative.
It is now also possible to include built-in definition ID’s in a custom initiative.
{
"displayName": "My Custom Initiative", #will be viewable on the policy overview page in the
portal
"description": "This is my first custom initiative", #will be viewable in the policy
definition page in the portal
"metadata":
{
"category": "ACF-Monitoring" # Define the category of the initiative
},
"parameters": { # Define any parameters which are required for the
policies included in this initiative
"gatewayType": {
"type": "string",
"metadata": {
"displayName": "Gateway Type",
"allowedValues": [
"Vpn",
"ExpressRoute"
]
}
}
},
"policyDefinitions": [
{
"policyDefinitionReferenceId": "dine-my-custom-policy", # Name of Custom
Policy Defintition created in previous section
"policyDefinitionId":
"/providers/Microsoft.Management/managementGroups/${acf_root_level}/providers/Microsoft.Authorization/policyDefinitions/dinemy-custom-policy",
"parameters": {
"gatewayType": {
"value": "[parameters('gatewayType')]"
}
}
},
{
"policyDefinitionReferenceId": "dine-my-custom-policy_2", # Name of some other
custom Policy Defintition created similar to described in previous section
"policyDefinitionId":
"/providers/Microsoft.Management/managementGroups/${acf_root_level}/providers/Microsoft.Authorization/policyDefinitions/dinemy-custom-policy_2",
"parameters": {}
}
],
"policyDefinitionGroups": null
}
174/454
Most of the process here is the same as when adding custom defintions, albeit with some minor changes to the structure of
the initiative.
You do not need to convert built-ins into custom definitions anymore
As mentioned in the previous section create the file for intiative in the location terraform\prod\custom_tf\blueprintpolicies-standard\customised_policy_set_definitions where prod is sample environment name
Below is a sample initiative having built-in policy reference
As you can see, we have some slightly different properties being used for referencing built-in policies.
{
"displayName": "My Custom Initiative", #will be viewable on the policy overview page in the
portal
"description": "This is my first custom initiative", #will be viewable in the policy
definition page in the portal
"metadata":
{
"category": "ACF-Monitoring" # Define the category of the initiative
},
"parameters": { # Define any parameters which are required for the
policies included in this initiative
"gatewayType": {
"type": "string",
"metadata": {
"displayName": "Gateway Type",
"allowedValues": [
"Vpn",
"ExpressRoute"
]
}
},
"listOfResourceTypes": {
"type": "array"
}
}
},
"policyDefinitions": [
{
"policyDefinitionReferenceId": "dine-my-custom-policy", # Name of Custom
Policy Defintition created in previous section
"policyDefinitionId":
"/providers/Microsoft.Management/managementGroups/${acf_root_level}/providers/Microsoft.Authorization/policyDefinitions/dinemy-custom-policy",
"parameters": {
"gatewayType": {
"value": "[parameters('gatewayType')]"
}
}
},
{
"policyDefinitionReferenceId": "Audit diagnostic setting",
"policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/7f89b1eb583c-429a-8828-af049802c1d9", # built-in policy id
"parameters": { # Parameters required for
built-in policy
"listOfResourceTypes": {
"value": "[parameters('listOfResourceTypes')]"
}
}
}
],
"policyDefinitionGroups": null
}
175/454
policyDefinitionReferenceId - This is a reference ID used for the initiative. This can also be added to custom
definition references as well.
If no policyDefinitionReferenceId is provided, then it will be automatically generated by Azure.
One reason to utilise this policyDefinitionReferenceId is when requiring multiple of the same built-in policy.
If you wish to assign 2 or more policies with the same ID (perhaps with different parameters), then you must use
the custom policyDefinitionReferenceId to provide a unique reference ID.
To create a custom policy assignment using this custom policy definition, please check here
new_custom_assignments
create a new custom assignments
Using the custom policy definitions and custom policy set definitions created in previous sections, we can now create
custom assignments.
Navigate to the terraform\prod\custom_tf\blueprint-policies-standard\customised_policy_assignments
where prod is sample environment name
Create new file in above path dine-my-custom-assignment.tmpl.json.
This file should sit along side all the other custom policy assignments files. They must not be in their own separate
folder.
Structure should look like this:
terraform
├── prod
│ ├── custom_tf
│ │ ├── blueprint-policies-standard
│ │ | |── customised_policy_set_definitions
│ │ | | |── dine-my-custom-assignment.tmpl.json
In the following example, we will create a very basic custom policy assignment, using the custom policy initiative created
in previous section.
Open the dine-my-custom-assignment.tmpl.json
Copy and paste the below base template:
{
"name": "dine-my-custom-initiative", # Name of the custom initiative, i.e name of
the custom initiative file
"assignmentName": "dine-custom-assignment-name", # Name of the custom assignment.
"displayName": "Display Name", # Appropriate display name.
"description": "Description", # Description for the policy assignment
"nonComplianceMsg": "Appropriate non-compliance message for the assignment", # Non
compliance message
"identity": { # Identity to be created for the assignment
"type": "SystemAssigned" # type : SystemAssigned (Needed when the
associated policies requires some rbac roles for remediation tasks) # type : None (Enough
when no roles required for policy and no identity needs to be created)
},
"isInitiative": true, # Required only in case of assignment of
initiative.
"managementGroups": {
"${acf_root_level}": { # Name of the management group, which is scope
of assignemnt. Value will be populated from org.hcl
"enabled": true, # Indicates this assignment is enabled for the
given scope
"parameters": { # Possible parameters to be passsed to the
custom initiative
176/454
Note: Populating certain values dynamically, in above custom assignment file is explained here
compliance scan
The purpose of this section is to detail the new Azure Policies Compliance Scan pipeline.
why have this pipeline?
Azure performs an automated scan of policy compliancy in specific circumstances.
They are:
1. Every day in the morning UTC (exact time seems variable) - Full Scan
2. When a new policy is assigned - Partial Scan only for new policy
3. When selecting Re-evaluate resource compliance before remediating in the portal - Partial Scan only for
remediated policy
As such, when attempting to update/ deploy policies, the compliancy status is often out of date.
This makes it difficult to establish if a policy is functioning correctly.
So the CLZ team developed this pipeline to run at any time, which forces compliance scans.
limitations
The powershell cmdlet used for this is limited in its scope. The highest level to run a scan is at the subscription level. You
cannot define a subscription as a parameter.
how this pipeline works
The pipeline Azure Policies Compliance Scan is having workflow_dispatch as a trigger and hence runs on demand.
The pipeline invokes a powershell script scan-policies.ps1which will loop through each defined subscriptions in
the file terragrunt\prod\global_vars.yaml (where prod is sample environment name) for the key subscription
Set the context for each subscription and run the compliancy scan as a background job.
By default, the script is configured to finish after triggering a scan.
"gatewayType": {"value": "ExpressRoute"}, # Parameter with Static Value
"listOfResourceTypes": {"value" : ["Microsoft.something/someResource",
"Microsoft.somethingElse/someOtherResource"] } # Parameter with Static Value
},
"notScopes": [], # Exclusions. Could be a dynamic value similar
to parameters
"linkedScopes": [] # Linked scopes. Could be a dynamic value
similar to parameters
}
### We can specifiy additional scopes by creating additional objects for each management group
scope
### Below is a sample
// "${mg_landing_zones}" : {
// "enabled": true,
// "parameters": {
// "param1": {"value": "value1"}
// "param2": {"value": "value2"}
// },
// "notScopes": [],
// "linkedScopes": []
// }
}
}
177/454
process for checking compliancy
The User Interface for Azure Policies in the Azure Portal is limited and cumbersome.
After triggering a compliancy scan, you can check when the scan has completed for specific policies.
To do this, follow the steps:
1. Navigate to the Azure Portal
2. Select Management Groups and select the root level (mg-acfdev) for ACF
3. In the side blade, select Policy
4. In the side blade, select Compliance
5. Select the policy that has resources in scope that you want to check
6. In the list of resources provided, the last column on the right side is called Last Evaluated - this shows when the scan
last happened.
There are a few scenarios to consider when reviewing these values.
1. The scan time coincides with the recent push of the pipeline.
This means that the scan has completed, if the resources is still not compliant, then run a remediation
2. The scan time does not coincide with the recent push of the pipeline
This can mean one of two things:
You need to wait longer for the scan to complete
Changes were made to the policy to set the resource out of scope
If the latter (where changes were made to make a resource out of scope), then the scan time will not be updated. The
resource will continue sitting in the list for 24-48 hours.
This is an Azure limitation.
If you cannot wait that long for the resource to be removed, it is advisable to remove the assignment and delete any custom
policy definition/ initiative (if built-in, only assignment removal is required).
You can set the policy parameter to false to automatically handle this for you.
After a redeploy of the policy, the out of scope resources should be removed. If not, then remove the policy and wait 30 minutes before redeploy.
remediation
The purpose of this section is to detail the policy remediation script.
how this pipeline works
This section is for informational purposes only. It is not recommended to alter this script in any way.
The pipeline Azure Policies Remediation is having trigger workflow_dispatch and also cron trigger 0 */12 * * *
So it is possible to run on demand and also it runs automatically every 12 hours.
The pipeline can be scheduled to run on different cron schedule by changing the cron expression.
The pipeline invokes a powershell script remediate-policies.ps1
The first step of the script is to retrieve all management groups under scope acf root level defined in org hcl file.
178/454
It will then read each management group, gets their policies, and checks if the policy is a DINE or MODIFY policy.
Once it has the list of policies, it will trigger remediation of each of them.
running the pipeline
Run the Policy Remediate pipeline to trigger remediation. The pipeline will not validate remediated policies, it will just
trigger the remediation and finish.
checking remediation status
To check the status of the remediation jobs, you will need to navigate to the Azure Portal.
1. Navigate to the Azure Portal
2. Select Management Groups and select the root level (mg-acfdev) for ACF
3. In the side blade, select Policy
4. In the side blade, select Remediation
5. Once loaded (can take a while), click the tab Remediation Tasks
6. Here you can see all remediation status for the selected management group
7. To change the management group scope, in the top left, under Scope you can change the management group.
If you do not see any remediation tasks, it’s likely the wrong scope is selected. The remediation happens only on
the defined scope of the policies.
For example, if you have a policy only assigned to mg-landing-zones, then you will not be able to see the
remediation task under the scope mg-acf. You must change the scope to mg-landing-zones.
special remediation procedures
There are a few custom policies that require remediation in a specific order. If remediating the entire initiative, it may
cause failures, so it’s best to remediate according to the instructions below.
dine-vm-backup-centralised-rsv
This initiative is made up of 2 rules, which need to be remediated in order.
1. dine-backupvault-rg - This should be remediated first (only needs to run once)
2. dine-rsv-and-vm-backup - This should be remediated second, and will need to be remediated for each VM once the
RG is in place.
dine-nsg-flowlogs
This initiative is made up of 3 rules, which need to be remediated in order.
1. dine-nsg-flowlogs-rg - This should be remediated first (only needs to run once)
2. dine-nsg-flowlogs-sa - This should be remediated second (only needs to run once)
3. dine-nsg-flowlogs-logs - This should be remediated third, and will need to be remediated for each NSG once the RG
and SA are in place.
dine-az-mon-agent
This initiative is made up of 6 rules, which need to be remediated in order.
1. dine-vm-ama-linux, dine-vm-ama-windows, dine-vmss-ama-linux, dine-vmss-ama-windows - These must be
remediated first, but in any order.
179/454
2. dine-vm-dcrassoc-linux, dine-vm-dcrassoc-windows - these must be remediated second, but in any order.
Terraform documentation
The code used to deploy your core may be updated regularly. The following link describes some of the possible input
variables when creating your application. Terraform Documentation
Application Landing Zone
The purpose of the blueprint is to kickstart the Application Landing Zones basic and standardized configuration to the
target environment. Deployment can be performed to the existing subscription or create new subscriptions (for EA and
MCA only - specific rights must be delegated upfront). Given application landing zone deployment might be scoped to
single or to multiple environments (e.g. dev, test, prod) and can be deployed to the same or different subscriptions.
The module contains main settings required for the deployment of the new Application Landing Zone.
Project Space Provisioner
New Landing Zone deployment
Integration with IPAM
New route
New subnet
project_space_provisioner
The PSP (Project Space Provisioner) module (driven by app_vars.yaml config file) works as a bootstrapper which
configures all the baseline connectivity information as well as any baseline resources required to support new application
deployments into the ACF environment.
It is recommended to review the Application Landing Zone technical documentation for information on deployment
configuration. The referenced page provides all necessary information to deploy the PSP.
how it works
The blueprint is designed for creation and keeping the control over baseline/infrastructure Application Landing Zone
resources’ configuration. PSP can create new subscriptions under EA or MCA model, so sufficient access
(SubscriptionCreator role on the Enterprise Agreement enrollment or SubscriptionCreator role under the Invoice Section)
is needed. Role assignment for EA can currently only be done via PUT operation to relevant API. More in the Microsoft
documentation.
Standardised new Application Landing Zone can be:
Subscription with peered network. Includes:
new subscription if chosen (see parameters below),
virtual network(s) with peering(s) or virtual hub connection(s),
resource group(s) if chosen (see parameters below),
network security group(s), route table(s), DNS private zone if chosen (see parameters below)
Subscription with non-peered network. Includes:
new subscription if chosen (see parameters below),
virtual network(s),
resource group(s) if chosen (see parameters below),
network security group(s), DNS private zone if chosen (see parameters below)
180/454
Subscription without network. Includes:
new subscription if chosen (see parameters below),
resource group(s) if chosen (see parameters below)
Resource group(s) in existing subscription with combination of the listed network choises. Includes:
virtual network(s) with peering(s) or virtual hub connection(s),
resource group(s) if chosen (see parameters below),
network security group(s), route table(s), DNS private zone if chosen (see parameters below)
Above options can also be enhanced with these capabilities:
rights delegation (rg or/and subscription level)
new SPN creation
new Entra ID group creation
providers registration
linkage towards Azure Private DNS Resolver
registration towards central primary PrivateDNS zone with auto-register capability
Azure Bastion creation (especially usefull for disconnected vnets)
advisory alerts tailored to the resource group level
taging on subscription and/or resource group level
landingzone deployment
In order to deploy a new landing zone, the following steps must be taken:
Create a new feature branch for the change in the repo.
Check out the newly created branch (i.e. in Visual Studio Code).
Create new folder under the terragrunt\prod\APPLZ (where prod is the environment name) directory.
Name of the new folder must be unique, for instance it might be subscription ID (if known) or subscription
Name (if newly created) followed by the Application Name. Below are some examples - yyyyyyyy-yyyy-yyyyyyyy-yyyyyyyyyyyy_APP1, - yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy_APP2, -
NEW_SUBSCRIPTION_NAME1_APP3, - NEW_SUBSCRIPTION_NAME2_APP4
From the .templates\application copy the app_vars.yaml and terragrunt file terragrunt.hcl to the newly
created folder.
Adjust the app_vars.yaml file to match the new landing zone details.
Commit and push the code.
Create a pull request. Make a comment on the pull request as /APP_PLAN_PROD/(SUB_NAME/SUB_ID)_APPLICATION_NAME (for instance
/APP_PLAN_PROD/NEW_SUBSCRIPTION_NAME1_APP3) where PROD is a given environment or
/APP_PLAN_TEST/(SUB_NAME/SUB_ID)_APPLICATION_NAME where TEST is a given environment. In other words
/APP_PLAN_PROD/ followed by the folder name.
Terraform would create a plan with the changes.
Verify the changes and again make a comment on the pull request as
/APP_APPLY_PROD/(SUB_NAME/SUB_ID)_APPLICATION_NAME where PROD is a given environment or
/APP_APPLY_TEST/(SUB_NAME/SUB_ID)_APPLICATION_NAME where TEST is a given environment
Validate the pipeline status, check from the portal that resources were created as requested.
Example of parametrised new landingzone:
---
##Copyright 2024 Nordcloud Oy or its affiliates. All Rights Reserved.
## This YAML file contains variables for the application.
application:
181/454
name: app3 # MANDATORY - Name of the application
location: northeurope # MANDATORY - Full namne of the Azure region location where application
resources will be created
location_short: ne # MANDATORY - Short name of the Azure region location where application
resources will be created
environment: # MANDATORY
- dev # Sample environment of the application
# advisory_alerts: # OPTIONAL, enabled by default
# dev: # Environment of the application (must match one of the environments in the
application.environment)
# enabled: true # OPTIONAL, default is true
# resource_group_name: rg-advisor-alerts #OPTIONAL, default rg-advisor-alerts
resource_group: # OPTIONAL, allows to create a new resource group or use an existing one and set
IAM or tags on it
dev: # Environment of the application (must match one of the environments in the
application.environment)
- name: rg-app3-network-dev-ne-001 # OPTIONAL - Free text, name of the resource group (must be
unique within the subscription).
#location: northeurope # OPTIONAL - allow to overwrite the default application.location of
the given resource group
iam: # OPTIONAL, IAM on rg level
- Owner: [xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx, SampleAadApp] # OPTIONAL - If name is specified
it must be the same as the one used for aad_spn or aad_group (for existing groups and/or
SPN use object_id instead)
- Contributor: [xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx, SampleContributor] # OPTIONAL - If name
is specified it must be the same as the one used for aad_spn or aad_group (for existing
groups and/or SPN use object_id instead)
- Reader: [xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx] # OPTIONAL - If name is specified it must be
the same as the one used for aad_spn or aad_group (for existing groups and/or SPN use
object_id instead)
# tags: # OPTIONAL, tags on rg level (if empty resource group tags will be wiped out to the
ACF default one)
# CostCenter: 1A2B3C
# Owner: slawchod@nordcloud.com
subscription: # MANDATORY
dev: # Environment of the application (must match one of the environments in the
application.environment)
name_or_id: ACFDemo - AppLz2 # MANDATORY
# create_new: false # OPTIONAL, default is false
# enrollment_account: # MANDATORY if subscription.create_new is true &
subscription.purchasing_model is EA -> Enrollment account on the EA agreement where
subscription should be created.
# billing_account: # MANDATORY if subscription.create_new is true -> Billing account on
the EA or MCA agreement where subscription should be created.
# billing_profile: # MANDATORY if subscription.create_new is true &
subscription.purchasing_model is MCA -> Billing Profile on the MCA agreement where
subscription should be created.
# invoice_section: # MANDATORY if subscription.create_new is true &
subscription.purchasing_model is MCA -> Invoice Section on the MCA agreement where
subscription should be created.
# purchasing_model: EA # MANDATORY if subscription.create_new is true -> either MCA or EA
# workload_type: Production # MANDATORY if subscription.create_new is true -> either
Production or DevTest
iam: # OPTIONAL, IAM on subscription level
- Owner: [xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx, SampleOwner] # OPTIONAL - If name is specified
it must be the same as the one used for aad_spn or aad_group (for existing groups and/or
SPN use object_id instead). Order matters!
- Contributor: [xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx] # OPTIONAL - If name is specified it must
be the same as the one used for aad_spn or aad_group (for existing groups and/or SPN use
object_id instead). Order matters!
- Reader: [xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx, SampleOwner] # OPTIONAL - If name is specified
it must be the same as the one used for aad_spn or aad_group (for existing groups and/or
SPN use object_id instead). Order matters!
# management_group_id: mg-corp # MANDATORY if subscription.create_new is true -> Management
Group ID where subscription should be placed after creation. Management Group must exist
before the subscription creation.
# resource_providers: # OPTIONAL, if subscription.create_new is true uncomment to modify the
default resource providers registrations
# - Microsoft.PolicyInsights
182/454
# - microsoft.insights
# - Microsoft.OperationalInsights
# - Microsoft.ManagedServices
# tags: # OPTIONAL, tags on subscription level (if empty subscription tags will be wiped out
to the ACF default one)
# Environment: Dev
# PlannedDeleteDate: 15/12/2024
aad_spn: # OPTIONAL, Creates a NEW SPN (names must be different than for aad_group)
- name: SampleAadApp # MANDATORY - Name of the SPN (if new SPN supposed to be created)
owner: [xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx] # OPTIONAL
aad_group: # OPTIONAL, Creates a NEW Entra ID Groups (names must be different than for aad_spn)
- name: SampleOwner # MANDATORY - Name of the group (if new group supposed to be created)
description: Sample Owner Group # OPTIONAL
owner: [xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx] # OPTIONAL
- name: SampleContributor # MANDATORY - Name of the group (if new group supposed to be created)
owner: [xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx] # OPTIONAL
description: Sample Contributor Group # OPTIONAL
- name: SampleReader # MANDATORY - Name of the group (if new group supposed to be created)
owner: [xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx] # OPTIONAL
description: Sample Reader Group # OPTIONAL
virtual_networks: # OPTIONAL, allows to create new virtual networks and subnets
dev: # Environment of the application (must match one of the environments in the
application.environment)
- vnet: default # Must be unique across (use a reference for NSG and Route Table to the subnet
name)
# custom_vnet_name: vnet-dev-001 #OPTIONAL, to replace the entire default virtual network
name: vnet-$application.name-$application.environment-$application.location_short-001.
Must be unique across resource group
# resource_group_name: rg-name-custom #OPTIONAL, to replace the entire default resource
group name: rg-$application.name-network-$application.environment-
$application.location_short-001
# resource_group_lock: false #OPTIONAL, default to lock the network resource group
# environment: prod #OPTIONAL, to replace default environment: $application.environment
(being part of the default vnet, subnet, and resource group name)
# location: northeurope #OPTIONAL, to replace default location: $application.location for
the virtual network resource creation. For the resource group location make change under
resource_group object.
# location_short: ne #OPTIONAL, to replace default location_short:
$application.location_short for the virtual network, subnet resource creation. For the
resource group location make change under resource_group object.
ipam_network_mask: [24, 23] #Mandatory if IPAM is in use.
ipam_supernet_name: mg-corp-ne-2 #Mandatory if IPAM is in use.
# network_prefixes: [10.244.16.0/24] #Mandatory if IPAM is not in use. With IPAM, if not
provided, the network_prefixes will be calculated based on the ipam_network_mask. If
provided IPAM will try to satisfy the provided network_prefixes.
# dns_servers: [192.168.1.1] #Optional, by default DNS being set in Network Module will be
used
# private_dns_name: [myapp1.local, myapp2.local] #Optional, to create private DNS zones for
the application and link it to the vnet
# private_dns_custom_resource_group: rg-app3-network-dev-ne-001 #Optional, to create private
DNS zones in another resource group than the vnet
# peering: #Optional
# enabled: true # Optional - default is true
# peering_name_overwrite: custom_name # Optional - default is hub-to-$application.namvnet-peering & vnet-$application.nam-to-hub-vnet-peering
# peering_use_remote_gateways: false #By default if Hub network contains a gateway, the
spoke network will use it. By uncommenting this line, you can steer it to use the remote
gateway or not.
# auto_register_in_primary_private_dns: false #Optional, if set to true, the vnet will be
registered in the primary private DNS zone (if defined) having auto_registration enabled
# azure_bastion: OPTIONAL, not enabled by default. If enabled, subnet named must be
configured
# enabled: false # Optional, default is false
# sku: Standard # Optional - default is Standard
# scale_units: 2 # Optional - default is 2
# copy_paste_enabled: true # Optional - default is true
# file_copy_enabled: false # Optional - default is false
# ip_connect_enabled: false # Optional - default is false
183/454
# tunneling_enabled: false # Optional - default is false
subnets:
- subnet: default # Must be unique across given vnet (use a reference for NSG and Route
Table to the subnet name)
# custom_subnet_name: snet-dev-001 #OPTIONAL, to replace the entire default subnet name:
snet-$application.name-$application.environment-$application.location_short-001. Must be
unique within given vnet
ipam_subnet_mask: 24
# subnet_prefix: 10.244.16.0/24 #Mandatory if IPAM is not in use. With IPAM, if not
provided, the subnet_prefixes will be calculated based on the ipam_subnet_mask. If
provided IPAM will try to satisfy the provided subnet_prefixes.
# deploy_route_table: true # Optional - default is true for HubSpoke and false for the
vWAN
# deploy_service_endpoints: true # Optional - default is true
# deploy_network_security_group: true # Optional - default is true
# service_endpoints:
# - Microsoft.AzureActiveDirectory
# - Microsoft.AzureCosmosDB
# - Microsoft.ContainerRegistry
# - Microsoft.EventHub
# - Microsoft.KeyVault
# - Microsoft.ServiceBus
# - Microsoft.Sql
# - Microsoft.Storage
# - Microsoft.Web
# network_security_group:
# #custom_nsg_name: nsg-app3-dev-we-001 #OPTIONAL, to replace the entire default subnet
name: nsg-$application.name-$application.environment-$application.location_short-001. Must
be unique within given resource groupe
# security_rules: # Optional - default is a security group with no rules
# - name: in-allow-onprem-dc-traffic-azure-dc # JUST
SAMPLE, REPLACE WITH YOUR OWN
# protocol: * # JUST
SAMPLE, REPLACE WITH YOUR OWN
# sourcePortRange: * # JUST
SAMPLE, REPLACE WITH YOUR OWN
# destinationPortRanges: [49152-65535, 53] # JUST
SAMPLE, REPLACE WITH YOUR OWN
# sourceAddressPrefixes: [172.16.0.0/16, 10.0.0.0/8] # JUST
SAMPLE, REPLACE WITH YOUR OWN
# destinationAddressPrefixes: [10.200.12.0/26] # JUST
SAMPLE, REPLACE WITH YOUR OWN
# access: Allow # JUST
SAMPLE, REPLACE WITH YOUR OWN
# priority: 110 # JUST
SAMPLE, REPLACE WITH YOUR OWN
# direction: Inbound # JUST
SAMPLE, REPLACE WITH YOUR OWN
# description: Default allow rule, blocks allow inbound traffic # JUST
SAMPLE, REPLACE WITH YOUR OWN
# route_table: # Optional - default is a route table towards Azure Firewall (for HubSpoke)
# # custom_route_table_name: route-app3-dev-we-001 #OPTIONAL, to replace the entire
default route table name: route-$application.name-$application.environment-
$application.location_short-001. Must be unique within given resource group
# # disable_bgp_route_propagation: true # Optional - default is true
# routes:
# - name: REPLACE_WITH_ROUTE_NAME
# address_prefix: REPLACE_WITH_ADDRESS_PREFIX_CIDR
# next_hop_type: REPLACE_WITH_NEXT_HOP_TYPE # VirtualNetworkGateway, VnetLocal,
Internet, VirtualAppliance, None
# next_hop_in_ip_address: REPLACE_WITH_NEXT_HOP_IP_ADDRESS
- subnet: bastion # For Azure Bastion must be named bastion!
custom_subnet_name: AzureBastionSubnet # For Azure Bastion must be named
AzureBastionSubnet!
ipam_subnet_mask: 26
# subnet_prefix: 10.244.16.0/24 #Mandatory if IPAM is not in use. With IPAM, if not
provided, the subnet_prefixes will be calculated based on the ipam_subnet_mask. If
provided IPAM will try to satisfy the provided subnet_prefixes.
deploy_route_table: false # Optional - default is true for HubSpoke and false for the vWAN
# deploy_service_endpoints: true # Optional - default is true
# deploy_network_security_group: true # Optional - default is true
184/454
Note * New subscription creation is only supported in EA model and MCA * The subscription name should not include
whitespaces. * Check if you have enough parameters in the request/task/email in order to continue with a subscription
creation
integration_with_ipam
The blueprint is integrated with the IPAM module. The IPAM module is responsible for managing the IP address space
and subnets in the environment. If within the PSP the IPAM module will be laveraged, then prior first new project creation,
the IPAM module must be deployed with configured supernets.
More information about the IPAM module can be found here.
# service_endpoints:
# - Microsoft.AzureActiveDirectory
# - Microsoft.AzureCosmosDB
# - Microsoft.ContainerRegistry
# - Microsoft.EventHub
# - Microsoft.KeyVault
# - Microsoft.ServiceBus
# - Microsoft.Sql
# - Microsoft.Storage
# - Microsoft.Web
# network_security_group: #For Azure Bastion default required NSG will be created, to
overwrite, uncomment and provide own security rules
# # #custom_nsg_name: nsg-app3-dev-we-001 #OPTIONAL, to replace the entire default
subnet name: nsg-$application.name-$application.environment-$application.location_short001. Must be unique within given resource groupe
# security_rules: # Optional - default is a security group with no rules
# - name: in-allow-onprem-dc-traffic-azure-dc # JUST
SAMPLE, REPLACE WITH YOUR OWN
# protocol: * # JUST
SAMPLE, REPLACE WITH YOUR OWN
# sourcePortRange: * # JUST
SAMPLE, REPLACE WITH YOUR OWN
# destinationPortRanges: [49152-65535, 53] # JUST
SAMPLE, REPLACE WITH YOUR OWN
# sourceAddressPrefixes: [172.16.0.0/16, 10.0.0.0/8] # JUST
SAMPLE, REPLACE WITH YOUR OWN
# destinationAddressPrefixes: [10.200.12.0/26] # JUST
SAMPLE, REPLACE WITH YOUR OWN
# access: Allow # JUST
SAMPLE, REPLACE WITH YOUR OWN
# priority: 110 # JUST
SAMPLE, REPLACE WITH YOUR OWN
# direction: Inbound # JUST
SAMPLE, REPLACE WITH YOUR OWN
# description: Default allow rule, blocks allow inbound traffic # JUST
SAMPLE, REPLACE WITH YOUR OWN
# route_table: # Optional - default is a route table towards Azure Firewall (for HubSpoke)
# # custom_route_table_name: route-app3-dev-we-001 #OPTIONAL, to replace the entire
default route table name: route-$application.name-$application.environment-
$application.location_short-001. Must be unique within given resource group
# # disable_bgp_route_propagation: true # Optional - default is true
# routes:
# - name: REPLACE_WITH_ROUTE_NAME
# address_prefix: REPLACE_WITH_ADDRESS_PREFIX_CIDR
# next_hop_type: REPLACE_WITH_NEXT_HOP_TYPE # VirtualNetworkGateway, VnetLocal,
Internet, VirtualAppliance, None
# next_hop_in_ip_address: REPLACE_WITH_NEXT_HOP_IP_ADDRESS
185/454
As a consequence instead of finding next free VNET and providing it explicity in the network_prefixes, it’s possible to
define ipam_network_mask and the ipam_supernet_name from which given CIDR will be allocated. Similarly, for the
subnets, instead of subnet_prefix, the ipam_subnet_mask can be only considered. If network_prefixes (for vnet) or
subnet_prefix (for subnet) are provided, the IPAM will try to satisfy the provided CIDR(s) as a hint. However it must match the ipam_network_mask and ipam_subnet_mask and be from the supernet range (for vnet) and from vnet range (for
subnet).
Example of parametrised IPAM intergration:
Example of parametrised without IPAM:
virtual_networks:
dev: # Environment of the application (must match one of the environments in the
application.environment)
- vnet: default # Must be unique across (use a reference for NSG and Route Table to the subnet
name)
ipam_network_mask: [24] #Mandatory if IPAM is in use.
ipam_supernet_name: mg-corp-ne-2 #Mandatory if IPAM is in use.
# network_prefixes: [10.244.16.0/24] #Mandatory if IPAM is not in use. With IPAM, if not
provided, the network_prefixes will be calculated based on the ipam_network_mask. If
provided IPAM will try to satisfy the provided network_prefixes.
subnets:
- subnet: default # Must be unique across given vnet (use a reference for NSG and Route
Table to the subnet name)
ipam_subnet_mask: 25
# subnet_prefix: 10.244.16.0/25 #Mandatory if IPAM is not in use. With IPAM, if not
provided, the subnet_prefixes will be calculated based on the ipam_subnet_mask. If
provided IPAM will try to satisfy the provided subnet_prefixes.
virtual_networks:
dev: # Environment of the application (must match one of the environments in the
application.environment)
- vnet: default # Must be unique across (use a reference for NSG and Route Table to the subnet
name)
network_prefixes: [10.244.16.0/24] #Mandatory if IPAM is not in use. With IPAM, if not
provided, the network_prefixes will be calculated based on the ipam_network_mask. If
provided IPAM will try to satisfy the provided network_prefixes.
subnets:
- subnet: default # Must be unique across given vnet (use a reference for NSG and Route
Table to the subnet name)
subnet_prefix: 10.244.16.0/25 #Mandatory if IPAM is not in use. With IPAM, if not
provided, the subnet_prefixes will be calculated based on the ipam_subnet_mask. If
provided IPAM will try to satisfy the provided subnet_prefixes.
186/454
Note * IPAM must be turned on or off for all new Application Landing Zones executed within given supernet (preallocated for the IPAM) - to ensure availability of CIDRs from the supernet. It’s related to the fact that IPAM just checks
allocations in storage account and does not query real environment. It must be set in a file
terragrunt/prod/APPLZ/group_vars.yaml by setting true or false for ipam_automation_enabled. More information can
be found here * network_prefixes can be used to provide exact CIDR (aka allocation hint) for the allocation in the IPAM
for the particular VNET. network_prefixes must be from the given ipam_supernet_name range and must not be allocate
already. * the order of network_prefixes (allocation hints) must match the order of ipam_network_mask in the
virtualNetworks object. If not all mask requires the hint, then adjust the ipam_network_mask order to fit allocation hints. > WARNING: Mixed network_prefixes and ipam_network_mask network resources creation for the same supernet may
cause the network_prefixes hint network fail to create as request will be handled in parallel. Workaround: The IPAM
will try to allocate the CIDR with required mask size from lower address space, when mix the network_prefixes network
with non-cidr_hint network resources, you can give a higher address space for the network_prefixes hint to reduce the
failure rate. * with IPAM, subnet_prefix is optional, and will work as allocation hint, so IPAM will try to allocate within
vnet the exact specified CIRD. If it won’t be possible the failure will be returned. Without subnet_prefix, based on
provided mask (ipam_subnet_mask) the CIDR will be calculated automatically from the allocated VNET CIDR(s)
(lookup is from the top to the bottom of ipam_network_mask order). If the first VNET CIDR (if vnet has more than one
address space) is not able to allocate the subnet mask, next one will be checked. * information about allocated address
spaces for vnets can be fetched from multiple locations: * pipeline logs, * Azure itself, * storage account Network table
storing all allocations * IPAM function - GetNetworks functions (details in the IPAM used docs) * PSP handle automatic
IPAM reservations removal or update (ie. due to project deletion or correction), so in a case of project decomission
comment out completely the virtual_networks and run deployment again to remove the allocations (and not needed any
longer resources) * all supernets defined in the IPAM must not overlaps, that’s why it’s recommended no to use IPAM for
disconnected vnets (peering.enabled = false) as they can get any network_prefixes because of the isolation * sample errors
from PSP execution with IPAM integration: * [Wrong network data - vnet-dev-ipam-001] - 2022-10-
12T11:02:24 - error meesage: Failed to satisfy provided hint - some possible reasons: address spaces
overlaps with already allocated, does not fit in the supernet, wrong supernet name) * Unable to allocate subnet from
the specifed vnet and subnet size - some possible reasons: networkMask for subet is lower (allocates more IPs)
than networkMask for vnet, two many subnets to fit in given vnet * The existing allocated CIDR 10.222.34.48/29
has different mask from the request mask 25 - some possible reasons: PSP file was executed again and addition
networkMask for the VNET was added not being at the end of the array
route
The module allows to define new routes for the route table. The routes are defined in the route_table object. By default
in HubSpoke topology routes are created automatically towards Azure Firewall. For vWAN routes are not created and
usually not required.
Example of parametrised new route:
Note * This is applicable only for Hub&Spoke architecture. For vWAN architecture, routes are assigned dynamically. *
For any of the below parameters which is having multi level structure, if its required to define custom value, then all the
parents also must be uncommented.
route_table: # Optional - default is a route table towards Azure Firewall (for HubSpoke)
# custom_route_table_name: route-app3-dev-we-001 #OPTIONAL, to replace the entire default
route table name: route-$application.name-$application.environment-
$application.location_short-001. Must be unique within given resource group
# disable_bgp_route_propagation: true # Optional - default is true
routes:
- name: REPLACE_WITH_ROUTE_NAME
address_prefix: REPLACE_WITH_ADDRESS_PREFIX_CIDR
next_hop_type: REPLACE_WITH_NEXT_HOP_TYPE # VirtualNetworkGateway, VnetLocal, Internet,
VirtualAppliance, None
next_hop_in_ip_address: REPLACE_WITH_NEXT_HOP_IP_ADDRESS
187/454
subnet
The module allows to define new subnets for the subnet object. The subnets are defined in the subnets object.
Example of parametrised new subnet:
virtual_networks:
dev: # Environment of the application (must match one of the environments in the
application.environment)
- vnet: default # Must be unique across (use a reference for NSG and Route Table to the subnet
name)
network_prefixes: [10.244.16.0/24] #Mandatory if IPAM is not in use. With IPAM, if not
provided, the network_prefixes will be calculated based on the ipam_network_mask. If
provided IPAM will try to satisfy the provided network_prefixes.
subnets:
- subnet: default # Must be unique across given vnet (use a reference for NSG and Route
Table to the subnet name)
subnet_prefix: 10.244.16.0/24 #Mandatory if IPAM is not in use. With IPAM value is ignored
and subnet is sliced dynamically using ipam_subnet_mask
# deploy_route_table: true # Optional - default is true for HubSpoke and false for the
vWAN
# deploy_service_endpoints: true # Optional - default is true
# deploy_network_security_group: true # Optional - default is true
# service_endpoints:
# - Microsoft.AzureActiveDirectory
# - Microsoft.AzureCosmosDB
# - Microsoft.ContainerRegistry
# - Microsoft.EventHub
# - Microsoft.KeyVault
# - Microsoft.ServiceBus
# - Microsoft.Sql
# - Microsoft.Storage
# - Microsoft.Web
# network_security_group:
# #custom_nsg_name: nsg-app3-dev-we-001 #OPTIONAL, to replace the entire default subnet
name: nsg-$application.name-$application.environment-$application.location_short-001. Must
be unique within given resource groupe
# security_rules: # Optional - default is a security group with no rules
# - name: in-allow-onprem-dc-traffic-azure-dc # JUST
SAMPLE, REPLACE WITH YOUR OWN
# protocol: * # JUST
SAMPLE, REPLACE WITH YOUR OWN
# sourcePortRange: * # JUST
SAMPLE, REPLACE WITH YOUR OWN
# destinationPortRanges: [49152-65535, 53] # JUST
SAMPLE, REPLACE WITH YOUR OWN
# sourceAddressPrefixes: [172.16.0.0/16, 10.0.0.0/8] # JUST
SAMPLE, REPLACE WITH YOUR OWN
# destinationAddressPrefixes: [10.200.12.0/26] # JUST
SAMPLE, REPLACE WITH YOUR OWN
# access: Allow # JUST
SAMPLE, REPLACE WITH YOUR OWN
# priority: 110 # JUST
SAMPLE, REPLACE WITH YOUR OWN
# direction: Inbound # JUST
SAMPLE, REPLACE WITH YOUR OWN
# description: Default allow rule, blocks allow inbound traffic # JUST
SAMPLE, REPLACE WITH YOUR OWN
# route_table: # Optional - default is a route table towards Azure Firewall (for HubSpoke)
# # custom_route_table_name: route-app3-dev-we-001 #OPTIONAL, to replace the entire
default route table name: route-$application.name-$application.environment-
$application.location_short-001. Must be unique within given resource group
# # disable_bgp_route_propagation: true # Optional - default is true
# routes:
# - name: REPLACE_WITH_ROUTE_NAME
# address_prefix: REPLACE_WITH_ADDRESS_PREFIX_CIDR
# next_hop_type: REPLACE_WITH_NEXT_HOP_TYPE # VirtualNetworkGateway, VnetLocal,
Internet, VirtualAppliance, None
# next_hop_in_ip_address: REPLACE_WITH_NEXT_HOP_IP_ADDRESS
188/454
Note * For any of the below parameters which is having multi level structure, if its required to define custom value, then
all the parents also must be uncommented.
terraform documentation
The code used to deploy your core may be updated regularly. The following link describes some of the possible input
variables when creating your application. Terraform Documentation
189/454
ACF Modules - Technical Docs
Cloud Foundation functional parts
Intro
This section describes functional parts of your Cloud Foundation (LZ). Normally the information in this section isn’t
required to operate your LZ, we take care of it. However it’s great for orientation and knowledge if you custom
requirements.
Boostrapper and Provisioner
The first action Nordcloud runs on an organisation that will recieve a Cloud Foundation. IT will deploy a folder with a
project inside. The project have very few resources, where the main ones are a Service account “Provisioner” that gains many administrative roles on the organisation level. This service account is used for anything related to Nordclouds
acticities. The project also contains a storage bucket with the organisations terraform state files.
org_hcl
The file is used in the boostrapper and contains basic informations about the Cloud Foundation. Contains global parameters
(f.e. service_name, location, type of environment, acf_root_level etc.) which by default are used in all bootprint modules if
not overwritten in the module itself ##### customer The name of the customer that will be deployed in the Cloud
Foundation. The customer name is used for state file path grouping. ##### tenant_id The tenant_id of the customer that
will be deployed in the Cloud Foundation. ##### subscription_id The backend subscription where provisioner and CICD
resources will be placed. ##### environment The environment name to distinguish ACF Prod platform from the ACF Test
platform. Must be equal to the respective folder name under terragrunt folder (the parent folder for the org.hcl). #####
acf_root_level The root level of the Cloud Foundation. ##### service_request_url The service request url of the Cloud
Foundation. ##### runbook_url The runbook url of the Cloud Foundation. ##### customer_lz_documentation_url The
customer lz documentation url of the Cloud Foundation. ##### repository_url The repository url of the Cloud Foundation.
##### location The location of the Cloud Foundation. ##### location_short The short location is a part of the Azure
resource name in the Cloud Foundation. It is constructed as follows: rg-sch-network-prod-001, where sch - service name,
network - resource name, prod - environment, 001 - instance number ##### managed_lz The managed lz of the Landing
Zone. The boolean value to specify if given Cloud Foundation is Managed by Nordcloud or not. ##### spn_with_secret
The boolean value to specify if the SPN used for the Cloud Foundation is using secret for authenthication. If false, it means
that federated authenthication will be laveraged. ##### customer_spn_object_id The SPN Object Id being used for the
Cloud Foundation container triggering (might be created on Nordcloud or Customer side, depends if this is managed
service or not). ##### service_name The service name is a part of the Azure resource name in the Cloud Foundation. It is
constructed as follows: rg-sch-network-prod-001, where sch - service name, network - resource name, prod - environment,
001 - instance number ##### environment_name The environment name is a part of the Azure resource name in the Cloud
Foundation. It is constructed as follows: rg-sch-network-prod-001, where sch - service name, network - resource name,
prod - environment, 001 - instance number ##### image_version The image version of container used to deploy the Cloud
Foundation. ##### customer_spn_client_id The SPN Client Id being used for the Cloud Foundation container triggering
(might be created on Nordcloud or Customer side, depends if this is managed service or not)
example_1
## STATIC VALUE ARE FOR MVP WILL BE REPLACED WITH THE REAL RESOURCE REFERENCE
locals {
customer = "customer-testing"
tenant_id = "xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx"
subscription_id = "yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy"
environment = "prod" #Take/pre-fill value of parent folder name
acf_root_level = "mg-acf"
190/454
service_request_url = "{CUSTOMER_SERVICE_REQUEST_FORM_URL}"
runbook_url = "{CUSTOMER_RUNBOOK_URL}"
customer_lz_documentation_url = "{CUSTOMER_LZ_DOCUMENTATION_URL}"
repository_url = "https://github.com/Azure-Cloud-Foundation/template-acf-customer"
location = "northeurope"
location_short = "ne"
managed_lz = true
spn_with_secret = false
service_name = "nc"
environment_name = "dev"
image_version = "v1.36"
customer_spn_object_id = "zzzzzzzz-zzzz-zzzz-zzzz-zzzzzzzzzzz"
customer_spn_client_id = "aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaa"
}
provisioner_details
The file is used in the boostrapper and contains information about storage account id containing the terraform state file
storage
storage_account_id
The storage account id containing the terraform state file of the Cloud Foundation.
example_2
locals {
storage_account_id = "/subscriptions/yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy/resourceGroups/rg-schtst-ne-001/providers/Microsoft.Storage/storageAccounts/stschkzeqpschtstne001"
}
CI/CD
The second action Nordcloud needs to establish is the CI/CD functionality in your own organisation. For this purpose the
Provisioner project will be used and hosts the resources required to make changes on your Azure Platform.
CORE
The core functionality of the LZ. This builds out a folder structure with all LZ related functions separated by folders and
projects. This part of the LZ is updated regularly on new LZ releases.
Network
This is a folder and project oriented below the CORE deployment and folder. Depending on your configuration it will
deploy a project with three separate VPC’s apply default rules and access and share the VPC’s as a network host project.
By default there are no subnets created when the network deployment is run. - Subnets are created on demand when
initiating new Applications.
Tools
Tools contains several non workload critical functions such as documentation front end
Organizational Units
An Organisation Unit (OU) is the LZ’s way to structure and organise different applications and workloads across your
organisaion. Our practice is to apply roles and access on folders, an OU make it easy to separate access on a very high
level, lets’ say between e.g. Marketing and Finance or between Original Corp, and Aquired. Ltd.
Application
191/454
Applications are constructed of one or more different environmnets each enviroment have one or more project where you
create your resources to run your workloads. Each environment may be fully isloated or have common network
connections. There is also a possibility to adapt access and devide it per environment. — id: blueprint-bootstrap-tf title:
Bootstrapper sidebar_position: 5 —
modules
List modules which are within given blueprint : - Bootstrap
inputs
Make sure you read the descriptions of the variables.
bootstrap
Name Description Type Default Required
append_tags bootstrap map(string) { nc-cf-deployment-name = blueprint.bootstrap } yes
custom_service_name bootstrap string “” no
resource_group_name bootstrap string rg-sch-tst-ne-001 no
storage_account_name bootstrap string stsch<RANDOM>tstne001 no
storage_enabled bootstrap bool true no
storage_byok_enabled bootstrap bool false no
storage_storageaccount_tier bootstrap string “Standard” no
storage_storageaccount_replication_type bootstrap string “GRS” no
storage_supports_https_traffic_only bootstrap bool true no
storage_allow_blob_public_access bootstrap bool false no
storage_min_tls_version bootstrap string “TLS1_1” no
LAST APPLIED CONFIGURATION
TEMP Comment: Leave as is for now, will be used later to dynamically update with customer specific config.
outputs
Since state sharing is not recommended due to security the outputs are important if any resources need to be referenced
terragrunt_provisioner_environment
Name Description
storage_account_id bootstrap_output
input descriptions
bootstrap
append_tags
Additional tags to be applied to the resources along with globally defined tags.
custom_service_name
192/454
Custom service name to use in name constructions of resource group, storage account etc., instead of service_name
resource_group_name
Custom resource group name.If empty terraform will be constructing it
storage_account_name
Custom storage account name.If empty terraform will be constructing it
storage_enabled
If false, Storage Account will not be deployed
storage_byok_enabled
If true, Storage Account will be configured with Customer Managed Keys and additionally a Key Vault will be deployed.
Used in cases where customers want to use their own keys
storage_storageaccount_tier
The Tier of the storage account
storage_storageaccount_replication_type
The Replication Type of the storage account
storage_supports_https_traffic_only
Allows https traffic only to storage service if sets to true
storage_allow_blob_public_access
Allow or disallow public access to all blobs or containers in the storage account
storage_min_tls_version
The version of the TLS for storage account
output descriptions
terragrunt_provisioner_environment
Output of bootstrap module
storage_account_id
Resource ID of storage account created.
modules
List modules which are within given blueprint : - CICD
inputs
Make sure you read the descriptions of the variables.
193/454
cicd
Name Description Type Default Required
append_tags cicd map(string) { nc-cf-deployment-name =
blueprint.cloud_container } yes
custom_service_name cicd string “” no
resource_group_name cicd string rg-aci-sch-tst-ne-001 no
route_table_name cicd string rt-sch-tst-ne-001 no
vnet_name cicd string vnet-sch-tst-ne-001 no
subnet_name cicd string snet-sch-tst-ne-001 no
nsg_name cicd string nsg-sch-tst-ne-001 no
msi_name cicd string msi-sch-tst-ne-001 no
container_registry_name cicd container_registry_name acrschtstne-001 no
msi_ad_roles_enabled cicd bool true no
msi_ad_roles cicd list(string)
[“Application Administrator”, “Groups Administrator”, “Directory Readers”] no
key_vault_name cicd string kv-sch-tst-ne-001 no
key_vault_kek_expiry_days cicd number 1825 no
key_vault_enable_purge_protection cicd bool true no
key_vault_enabled_for_deployment cicd bool false no
key_vault_enabled_for_template_deployment cicd bool true no
key_vault_enabled_for_disk_encryption cicd bool true no
key_vault_enable_rbac_authorization cicd bool true no
key_vault_key_vault_sku cicd string “standard” no
key_vault_access_policies cicd list(any) [] no
key_vault_network_acls_bypass cicd string “AzureServices” no
key_vault_network_acls_default_action cicd string “Deny” no
key_vault_network_acls_virtual_network_rules cicd list(any) [] no
key_vault_network_acls_ip_rules cicd list(string) [] no
storage_network_acls_bypass cicd list(string) [“AzureServices”] no
storage_network_acls_default_action cicd string “Deny” no
storage_network_acls_virtual_network_rules cicd list(any) [] no
storage_network_acls_ip_rules cicd list(string) [] no
LAST APPLIED CONFIGURATION
TEMP Comment: Leave as is for now, will be used later to dynamically update with customer specific config.
outputs
Since state sharing is not recommended due to security the outputs are important if any resources need to be referenced
terragrunt_cicd_environment
194/454
Name Description
key_vault_id cicd_outputs
acr_name cicd_outputs
rg_name cicd_outputs
image cicd_outputs
user_assigned_id cicd_outputs
vnet_id cicd_outputs
subnet_name cicd_outputs
msi_client_id cicd_outputs
input descriptions
cicd
append_tags
Additional tags to be applied to the resources along with globally defined tags. Common for all resources in this blueprint
custom_service_name
Custom service name used in construction of names of resource group, acr, keyvault etc.,
resource_group_name
Resource group name of ACI. If left empty, terraform will construct this
route_table_name
Name of the Route table. If left empty, terraform will construct this
vnet_name
Name of the Vnet. If left empty, terraform will construct this
nsg_name
Name of the NSG. If left empty, terraform will construct this
msi_name
Name of the MSI. If left empty, terraform will construct this
container_registry_name
Name of the Container registry. If left empty, terraform will construct this
msi_ad_roles_enabled
Indicates if MSI needs to be assigned any AD roles
msi_ad_roles
List of AD Roles to be assigned to the MSI ID
195/454
key_vault_name
Name of the keyvault. If left empty, terraform will construct this
key_vault_kek_expiry_days
Specifies the expiration time, 0 for non expiring key
key_vault_enable_purge_protection
If true, protection against purge is enabled for this vault
key_vault_enabled_for_deployment
If true, Azure Virtual Machines are permitted to retrieve certificates stored as secrets from the key vault
key_vault_enabled_for_template_deployment
If true, Azure Resource Manager is permitted to retrieve secrets from the key vault
key_vault_enabled_for_disk_encryption
If true, Azure Disk Encryption is permitted to retrieve secrets from the vault and unwrap keys
key_vault_enable_rbac_authorization
If true, the key vault will use Role Based Access Control (RBAC) for authorization of data actions, and the access policies
specified in vault properties will be ignored
key_vault_key_vault_sku
The Name of the SKU used for the key vault. Possible values are ‘standard’ and ‘premium’
key_vault_access_policies
Rights should be specified here if enableRbacAuthorization is set to false. An array of 0 to 1024 identities that have access
to the key vault. All identities in the array must use the same tenant ID as the key vault’s tenant ID
key_vault_network_acls_bypass
Specifies which traffic can bypass the network rules. Possible values are AzureServices and None
key_vault_network_acls_default_action
The Default Action to use when no rules match from keyVault-networkAclsIpRules / keyVaultnetworkAclsVirtualNetworkRules. Possible values are Allow and Deny
key_vault_network_acls_virtual_network_rules
One or more Subnet IDs which should be able to access this Key Vault
key_vault_network_acls_ip_rules
One or more IP Addresses, or CIDR Blocks which should be able to access the Key Vault
storage_network_acls_bypass
196/454
Specifies whether traffic is bypassed. Possible values are any combination of Logging,Metrics,AzureServices or None to
bypass none of those traffics
storage_network_acls_default_action
Specifies the default action of allow or deny when no other rules match
storage_network_acls_virtual_network_rules
Sets the allowed Subnets, list of subnet resource ids
storage_network_acls_ip_rules
Sets the IP ACL rules, public IP or IP ranges in CIDR Format
output descriptions
key_vault_id
ID of keyvault
acr_name
Name of Azure container registry
rg_name
Resource group name of ACI
image
Full path to the ACR image (including version)
user_assigned_id
ID of MSI
vnet_id
ID of Vnet
subnet_name
Name of Subnet
msi_client_id
Client ID of MSI
modules
List modules which are within given blueprint, i.e. management groups, spn and partner link. - Management Groups - SPN
- Partner Link
inputs
197/454
Make sure you read the descriptions of the variables.
Note: For any of the below parameters which is having multi level structure, if its required to define custom value, then all
the parents also must be uncommented. The schema of how management groups hierarchy should be created in Azure,
along with associated subscriptions under each management group.
Note: If subscription_id key-value is not defined under a given management group then existing subscriptions for the management group would be unchanged by terraform
Example of management_groups_schema
{
management_group_root = {
name = ""
parent = ""
subscription_id = []
childs = {
management_groups = [
{
name = "mg-platform"
subscription_id = []
childs = {
management_groups = [
{
name = "mg-identity"
acf_reference_name = "mg-identity"
subscription_id = ["xxxxx-xxxxx-xxxx-xxxxx"]
childs = {
management_groups = []
}
},
{
name = "mg-management"
acf_reference_name = "mg-management"
subscription_id = ["xxxxx-xxxxx-xxxx-xxxxx"]
childs = {
management_groups = []
}
},
{
name = "mg-connectivity"
acf_reference_name = "mg-connectivity"
subscription_id = ["xxxxx-xxxxx-xxxx-xxxxx"]
childs = {
management_groups = []
}
},
{
name = "mg-shared-services"
acf_reference_name = "mg-shared-services"
subscription_id = ["xxxxx-xxxxx-xxxx-xxxxx"]
childs = {
management_groups = []
}
}
]
}
},
{
name = "mg-landing-zones"
subscription_id = []
childs = {
management_groups = [
{
name = "mg-corp"
},
{
name = "mg-online"
198/454
inputs
Name Description Type Default Required
management_groups_enabled management_groups bool true no
management_groups_schema management_groups map {} no
spn_enabled spn bool false no
is_devops_project spn bool false no
spn_parameters spn map {} no
partner_link_enabled partner_link bool true no
partner_details partner_link map {} no
management_groups_schema
management_groups_schema.management_group_root
Name Description Type Default Required
name management_groups string outputs from global_vars.yaml no
parent management_groups string outputs from global_vars.yaml no
subscription_id management_groups list(string) value of subscription_id from global_vars.yaml no
childs management_groups map {} no
management_groups_root_childs
management_groups_schema.management_group_root.childs.management_groups
},
{
name = "mg-hybrid"
}
]
}
},
{
name = "mg-decommissioned"
},
{
name = "mg-sandbox"
acf_reference_name = "mg-sandbox"
},
{
name = "mg-audit"
acf_reference_name: "mg-audit"
subscription_id = ["xxxxx-xxxxx-xxxx-xxxxx"]
},
{
name = "mg-backend"
acf_reference_name: "mg-backend"
subscription_id = ["xxxxx-xxxxx-xxxx-xxxxx"]
}
]
}
}
}
199/454
Name Description Type Default Required
name mg-platform map {} no
name mg-landing-zones map {} no
name mg-decommissioned map {} no
name mg-sandbox map {} no
name mg-audit map {} no
name mg-backend map {} no
mg-platform
management_groups_schema.management_group_root.childs.management_groups[0]
Name Description Type Default Required
name management_groups string mg-platform no
subscription_id management_groups list(string) value of subscription_id from global_vars.yaml no
childs management_groups map {} no
management_groups_mg-platform_childs
management_groups_schema.management_group_root.childs.management_groups[0].childs.management_groups[0]
Name Description Type Default Required
name management_groups string mg-identity no
acf_reference_name management_groups string mg-identity no
subscription_id management_groups list(string) value of subscription_id from global_vars.yaml no
childs management_groups map {} no
management_groups_schema.management_group_root.childs.management_groups[0].childs.management_groups[1]
Name Description Type Default Required
name management_groups string mg-management no
acf_reference_name management_groups string mg-management no
subscription_id management_groups list(string) value of subscription_id from global_vars.yaml no
childs management_groups map {} no
management_groups_schema.management_group_root.childs.management_groups[0].childs.management_groups[2]
Name Description Type Default Required
name management_groups string mg-connectivity no
acf_reference_name management_groups string mg-connectivity no
subscription_id management_groups list(string) value of subscription_id from global_vars.yaml no
childs management_groups map {} no
management_groups_schema.management_group_root.childs.management_groups[0].childs.management_groups[3]
200/454
Name Description Type Default Required
name management_groups string mg-shared-services no
acf_reference_name management_groups string mg-shared-services no
subscription_id management_groups list(string) value of subscription_id from global_vars.yaml no
childs management_groups map {} no
mg-landing-zones
management_groups_schema.management_group_root.childs.management_groups[1]
Name Description Type Default Required
name management_groups string mg-landing-zones no
subscription_id management_groups list(string) value of subscription_id from global_vars.yaml no
childs management_groups map {} no
management_groups_mg-landing-zones_childs
management_groups_schema.management_group_root.childs.management_groups[1].childs.management_groups[0]
Name Description Type Default Required
name management_groups string mg-corp no
acf_reference_name management_groups string mg-corp no
subscription_id management_groups list(string) value of subscription_id from global_vars.yaml no
childs management_groups map {} no
management_groups_schema.management_group_root.childs.management_groups[1].childs.management_groups[1]
Name Description Type Default Required
name management_groups string mg-online no
acf_reference_name management_groups string mg-online no
subscription_id management_groups list(string) value of subscription_id from global_vars.yaml no
childs management_groups map {} no
management_groups_schema.management_group_root.childs.management_groups[1].childs.management_groups[2]
Name Description Type Default Required
name management_groups string mg-hybrid no
acf_reference_name management_groups string mg-hybrid no
subscription_id management_groups list(string) value of subscription_id from global_vars.yaml no
childs management_groups map {} no
mg-decommissioned
management_groups_schema.management_group_root.childs.management_groups[2]
Name Description Type Default Required
name management_groups string mg-decommissioned no
201/454
mg-sandbox
management_groups_schema.management_group_root.childs.management_groups[3]
Name Description Type Default Required
name management_groups string mg-sandbox no
acf_reference_name management_groups string mg-sandbox no
subscription_id management_groups list(string) value of subscription_id from global_vars.yaml no
mg-audit
management_groups_schema.management_group_root.childs.management_groups[4]
Name Description Type Default Required
name management_groups string mg-audit no
acf_reference_name management_groups string mg-audit no
subscription_id management_groups list(string) value of subscription_id from global_vars.yaml no
mg-backend
management_groups_schema.management_group_root.childs.management_groups[5]
Name Description Type Default Required
name management_groups string mg-backend no
acf_reference_name management_groups string mg-backend no
subscription_id management_groups list(string) value of subscription_id from global_vars.yaml no
partner_details
partner_details.azure_partner_link.properties
Name Description Type Default Required
partner_id partner_link string 4356841 no
customer partner_link string ACFDevelopment no
added_by partner_link string email.address@company.com no
spn_parameters
spn_parameters.devops
Name Description Type Default Required
organization_url spn string https://dev.azure.com/nc-azure-core-infra/ no
project_name spn string ACF3.0 - ESLZ and ACF no
last applied configuration
> TEMP Comment: Leave as is for now, will be used later to dynamically update with customer
specific config.
```hcl
input descriptions
202/454
management_groups_enabled
Indicates if this blueprint needs to be deployed. #### management_groups_root_name Name of the root management
group. If ACF root level is already created as a part of prerequesites, keep this value as ““. Provide value when rigts are
granted on the Tenant Root Level only, so new ACF root level will be created #### management_groups_root_parent The
parent management group ID. Usually ACF Root Level is created under Tenant Root Level (which is presented as”” in
this case). It it’s not the case, specify the parent management group ID. #### management_groups_name Name of the management group. #### management_groups_subscription_id The subscription ID to be associated with the management
group. Even when empty, corresponding subscription ID will be automatically populated (if defined in global_vars.yaml)
#### management_groups_reference_name This is the reference name used in the ACF. Do not change this value as it is
used to match subscription ID with modified management group name #### management_groups_childs Azure management groups support up to six levels of nesting which can be defined in this schema like below. This means you
can create a hierarchy of up to six levels deep, with each level containing child management groups or Azure
subscriptions.
Example of management_groups_childs
spn_enabled
SPN expiration feature will be enabled if set to true. #### is_devops_project Indicates if the project is in DevOps portal.
#### spn_organization_url DevOps Organization URL #### spn_project_name Project name in DevOps portal.
partner_link_enabled
Indicates if partner link needs to be created. #### partner_link_id Microsoft Cloud Partner Program ID for the organization
#### partner_link_customer Customer name. #### partner_link_added_by Email address of the person who added the
partner link.
outputs
management_group_names
childs = {
management_groups = [
{
name = "mg-identity"
acf_reference_name = "mg-identity"
subscription_id = ["xxxxx-xxxxx-xxxx-xxxxx"]
childs = {
management_groups = []
}
}]
}
203/454
Name Description
mg-acf Map of management group name mg-acf
mg-audit Map of management group name mg-audit
mg-connectivity Map of management group name mg-connectivity
mg-corp Map of management group name mg-corp
mg-decommissioned Map of management group name mg-decommissioned
mg-hybrid Map of management group name mg-hybrid
mg-identity Map of management group name mg-identity
mg-landing-zones Map of management group name mg-landing-zones
mg-management Map of management group name mg-management
mg-online Map of management group name mg-online
mg-platform Map of management group name mg-platform
mg-sandbox Map of management group name mg-sandbox
mg-shared-services Map of management group name mg-shared-services
output descriptions
Example of output
management_group_names = {
+ mg-acf = "mg-acf"
+ mg-audit = "mg-audit"
+ mg-connectivity = "mg-connectivity"
+ mg-corp = "mg-corp"
+ mg-decommissioned = "mg-decommissioned"
+ mg-hybrid = "mg-hybrid"
+ mg-identity = "mg-identity"
+ mg-landing-zones = "mg-landing-zones"
+ mg-management = "mg-management"
+ mg-online = "mg-online"
+ mg-platform = "mg-platform"
+ mg-sandbox = "mg-sandbox"
+ mg-shared-services = "mg-shared-services"
}
dependency
/PROVISIONER/CICD
id: blueprint-audit-standard-tf title: Audit sidebar_position: 4 —
modules
List modules which are within given blueprint : - Logging
inputs
Make sure you read the descriptions of the variables.
Note: For any of the below parameters which is having multi level structure, if its required to define custom value, then all
the parents also must be uncommented. In this way, all the related parents of a parameter needs to be uncommented to
define custom values
common parameters
204/454
Name Description Type Default Required
append_tags append_tags map(string) { nc-cf-deployment-name = blueprint.audit.standard } yes
logging
Name Description Type Default Required
log_analytics_enabled logging bool true no
log_analytics_workspace_name logging string
“log-schaudit-tst-we-001” no
log_analytics_workspace_sku logging string “PerGB2018” no
log_analytics_retention_in_days logging number 365 no
log_analytics_daily_quota_gb logging number 10 no
storage_enabled logging bool true no
storage_byok_enabled logging bool true no
storage_storageaccount_tier logging string “Standard” no
storage_storageaccount_replication_type logging string “RAGRS” no
storage_supports_https_traffic_only logging bool true no
storage_allow_blob_public_access logging bool false no
storage_network_acls_bypass logging list(string) [“AzureServices”] no
storage_network_acls_default_action logging string “Deny” no
storage_network_acls_virtual_network_rules logging list(any) [] no
storage_network_acls_ip_rules logging list(string) [] no
storage_min_tls_version logging string “TLS1_1” no
storage_worm_policy_immutability_period logging number 1095 no
storage_tier_to_cool_in_days logging number 30 no
storage_tier_to_archive_in_days logging number 90 no
storage_delete_in_days logging number 1095 no
key_vault_short_name logging string “log” no
key_vault_kek_expiry_days logging number 1825 no
key_vault_enable_purge_protection logging bool true no
key_vault_enabled_for_deployment logging bool false no
key_vault_enabled_for_template_deployment logging bool true no
key_vault_enabled_for_disk_encryption logging bool true no
key_vault_enable_rbac_authorization logging bool true no
key_vault_key_vault_sku logging string “standard” no
key_vault_permissions logging map(any) {} no
key_vault_network_acls_bypass logging string “AzureServices” no
key_vault_network_acls_default_action logging string “Deny” no
key_vault_network_acls_virtual_network_rules logging list(any) [] no
key_vault_network_acls_ip_rules logging list(string) [] no
key_vault_access_policies logging list(any) [] no
LAST APPLIED CONFIGURATION
205/454
TEMP Comment: Leave as is for now, will be used later to dynamically update with customer specific config.
outputs
Since state sharing is not recommended due to security the outputs are important if any resources need to be referenced
audit_outputs
Name Description
workspace_resource_id audit_outputs
workspace_resource_name audit_outputs
workspace_resource_group_name audit_outputs
storage_account_name audit_outputs
storage_enabled audit_outputs
input descriptions
append_tags
Additional tags to be applied to the resources along with globally defined tags. Common for all resources in this blueprint
logging
log_analytics_enabled
Enable or disable log analytics module.If false, Log Analytics module will not be deployed
log_analytics_workspace_name
The name of a workspace
log_analytics_workspace_sku
The SKU (tier) of a workspace
log_analytics_retention_in_days
The workspace data retention in days. -1 means Unlimited retention for the Unlimited Sku. 730 days is the maximum
allowed for all other Skus
log_analytics_daily_quota_gb
The workspace daily quota for ingestion. -1 means unlimited
storage_enabled
If false, Storage Account (standard and -byok) will not be deployed
storage_byok_enabled
If true, Storage Account will be configured with Customer Managed Keys and additionally a Key Vault will be deployed.
Used in cases where customers want to use their own keys”
storage_storageaccount_tier
206/454
The Tier of the storage account
storage_storageaccount_replication_type
The Replication Type of the storage account
storage_supports_https_traffic_only
Allows https traffic only to storage service if sets to true
storage_allow_blob_public_access
Allow or disallow public access to all blobs or containers in the storage account
storage_network_acls_bypass
Specifies whether traffic is bypassed. Possible values are any combination of Logging,Metrics,AzureServices or None to
bypass none of those traffics
storage_network_acls_default_action
Specifies the default action of allow or deny when no other rules match
storage_network_acls_virtual_network_rules
Sets the allowed Subnets, list of subnet resource ids
storage_network_acls_ip_rules
Sets the IP ACL rules, public IP or IP ranges in CIDR Format
storage_min_tls_version
The version of the TLS version for storage account
storage_worm_policy_immutability_period
Immutability period since creation in days used in Set-WORMPolicy.ps1.While in a WORM state, data cannot be modified
or deleted for interval specified
storage_tier_to_cool_in_days
Part of Storage Account Management Policies for base blob. Value indicating the age in days after last modification Blob’s
tier will be changed to Cool when the number of days specified in the variable passes
storage_tier_to_archive_in_days
Part of Storage Account Management Policies for base blob. Value indicating the age in days after last modification Blob’s
tier will be changed to Archive when the number of days specified in the variable passes
storage_delete_in_days
Part of Storage Account Management Policies for base blob. Value indicating the age in days after last modification Blob
will be deleted when the number of days specified in the variable passes
key_vault_short_name
207/454
Short name of the Key Vault, used in as part of Key Vault name
key_vault_kek_expiry_days
Specifies the expiration time, 0 for non expiring key
key_vault_enable_purge_protection
If true, protection against purge is enabled for this vault
key_vault_enabled_for_deployment
If true, Azure Virtual Machines are permitted to retrieve certificates stored as secrets from the key vault
key_vault_enabled_for_template_deployment
If true, Azure Resource Manager is permitted to retrieve secrets from the key vault
key_vault_enabled_for_disk_encryption
If true, Azure Disk Encryption is permitted to retrieve secrets from the vault and unwrap keys
key_vault_enable_rbac_authorization
If true, the key vault will use Role Based Access Control (RBAC) for authorization of data actions, and the access policies
specified in vault properties will be ignored
key_vault_key_vault_sku
The Name of the SKU used for the key vault. Possible values are ‘standard’ and ‘premium’
key_vault_permissions
An object giving access to the key vault. All identities must use the same tenantID as the key vault’s tenant ID. Any
RBAC role can be specified
key_vault_network_acls_bypass
Specifies which traffic can bypass the network rules. Possible values are AzureServices and None
key_vault_network_acls_default_action
The Default Action to use when no rules match from keyVault-networkAclsIpRules / keyVaultnetworkAclsVirtualNetworkRules. Possible values are Allow and Deny
key_vault_network_acls_virtual_network_rules
One or more Subnet IDs which should be able to access this Key Vault
key_vault_network_acls_ip_rules
One or more IP Addresses, or CIDR Blocks which should be able to access the Key Vault
key_vault_access_policies
208/454
Rights should be specified here if enableRbacAuthorization is set to false. An array of 0 to 1024 identities that have access
to the key vault. All identities in the array must use the same tenant ID as the key vault’s tenant ID
Output descriptions
audit_outputs
Contains outputs from audit module.
workspace_resource_id
ID of log analytics work space created
workspace_resource_name
Name of log analytics work space created
workspace_resource_group_name
Resource group of log analytics work space
storage_account_name
Name of storage account created, if storage account is enabled
storage_enabled
Indicates if storage account is enabled
Below is a sample output for audit_outputs
"audit_outputs": {
"value": {
"storage_account_name": "stschy4kw0tstne001",
"storage_enabled": true,
"workspace_resource_group_name": "rg-sch-logging-tst-ne-001",
"workspace_resource_id": "/subscriptions/777fffaaa-5555-777d-9999-
bbbbaaacccdc/resourceGroups/rg-sch-logging-tst-ne001/providers/Microsoft.OperationalInsights/workspaces/log-sch-audit-tst-ne-001",
"workspace_resource_name": "log-sch-audit-tst-ne-001"
}
}
dependency
The Audit module is dependent on the following modules: - /CORE - /PROVISIONER/CICD — id: blueprint-governancetf title: Governance sidebar_position: 5 —
modules
List modules which are within given blueprint :
Rbac
Regulatory Compliance
inputs
Make sure you read the descriptions of the variables.
209/454
Note: For any of the below parameters which is having multi level structure, if its required to define custom value, then all
the parents also must be uncommented. For eg. in case of regulatory compliance, if its requried to define custom value for
display_name, then both policy_assignment_config, policy_name, regulatory_initiatives & governance_settings (parent)
and display_name must be uncommented and then custom value needs to be added for display_name.
In this way, all the related parents of a parameter needs to be uncommented to define custom values
rbac
Name Description Type Default Required
rbac_enabled rbac bool true no
acf_root_level rbac string acf root level defined in org hcl file no
custom_role_definitions rbac list(object) [{}] no
additional_custom_role_definitions rbac list(object) [] no
custom_role_definitions
custom_role_definitions[0]
Name Description Type Default Required
name custom_role_definitions string “Custom - Application owner”
description custom_role_definitions string “Application owner with reduced access to network and key vault”
actions custom_role_definitions list(string) [“*”]
not_actions custom_role_definitions list(string)
[ “Microsoft.Authorization/*/write”, “Microsoft.Network/publicIPAddresses/write”,
“Microsoft.Network/virtualNetworks/write”,“Microsoft.KeyVault/locations/deletedVaults/purge/action”
]
custom_role_definitions[1]
Name Description Type Default Required
name custom_role_definitions string “Custom - KeyVault reader” no
description custom_role_definitions string “Can read key vault secrets if access policies are set.” no
actions custom_role_definitions list(string) [“Microsoft.KeyVault/vaults/deploy/action”] no
not_actions custom_role_definitions list(string) [] no
custom_role_definitions[2]
Name Description Type Default
name custom_role_definitions string “Custom - Network manager”
description custom_role_definitions string “Platform-wide global connectivity management”
actions custom_role_definitions list(string) [“/read”,”Microsoft.Network/”,“Microsoft.Resources/deployments/”,”Microsoft.Support/”,“Microsoft.Authorization/*/write”]
not_actions custom_role_definitions list(string) []
regulatory_initiatives:
governance_settings:
- policy_name: "612b5213-9160-4969-8578-1518bd2a000c"
# initiative_active: true
# management_groups: ["mg-acf"]
policy_assignment_config:
# assignment_name: "CIS1.3"
display_name: "CUSTOM NAME"
210/454
custom_role_definitions[3]
Name Description Type
name custom_role_definitions string
description custom_role_definitions string
actions custom_role_definitions list(string)
not_actions custom_role_definitions list(string) [“Microsoft.Authorization/classicAdministrators/write”,“Microsoft.Authorization/elevateAccess/action”,“Microsoft.Authorization/policyDefinitions/write”,“Microsoft.Authorization/policyDefinitions/delete”,“Microsoft.Authorization/policyAssignments/write”,“Microsoft.Authorization/policyAssignments/delete”,“Microsoft.Authorization/policySetDefinitions/write”,“Microsoft.Authorization/policySetDefinitions/delete”,“Microsoft.Authorization/roleDefinitions/delete”,“Microsoft.Authorization/roleDefinitions/write”,“Microsoft.Management/managementGroups/subscriptions/delete”,“Microsoft.Management/managementGroups/subscriptions/write”,“Microsoft.Management/managementGroups/write”]
custom_role_definitions[4]
Name Description Type Default Required
name custom_role_definitions string “Custom - Reader Without Bastion” no
description custom_role_definitions string “Reader role without Azure Bastion.” no
actions custom_role_definitions list(string) [“*/read”] no
not_actions custom_role_definitions list(string) [“Microsoft.Network/bastionHosts/read”] no
custom_role_definitions[5]
Name Description Type
name custom_role_definitions string
description custom_role_definitions string
actions custom_role_definitions list(string) [“/read”,”/register/action”,“Microsoft.KeyVault/locations/deletedVaults/purge/action”,“Microsoft.PolicyInsights/
not_actions custom_role_definitions list(string)
custom_role_definitions[5]
Name Description Type Default Required
name custom_role_definitions string “Custom - Storage account connection string reader” no
description custom_role_definitions string “Can read storage account connection strings.” no
actions custom_role_definitions list(string) [“Microsoft.Storage/storageAccounts/listKeys/action”] no
not_actions custom_role_definitions list(string) [] no
custom_role_definitions[6]
Name Description Type Default
name custom_role_definitions string “Custom - Subscription owner”
description custom_role_definitions string “Subscription owner with reduced access to network”
actions custom_role_definitions list(string) [“*”]
not_actions custom_role_definitions list(string) [“Microsoft.Authorization//write”,”Microsoft.Network/vpnGateways/”,“Microsoft.Network/expressRouteCircuits/
custom_role_definitions[7]
Name Description Type Default
name custom_role_definitions string “Custom - Virtual network user”
description custom_role_definitions string “Can join VMs (NICs) to a Virtual Network.”
actions custom_role_definitions list(string) [“*”]
not_actions custom_role_definitions list(string) [“Microsoft.Network/virtualNetworks/read”,“Microsoft.Network/virtualNetworks/subnets/read”,“Microsoft.Network/virtualNetworks/subnets/join/action”]
211/454
regulatory_compliance
Name Description Type Default Required
regulatory_initiatives_enabled regulatory_compliance bool true no
regulatory_initiatives regulatory_compliance any [{}] no
regulatory_initiatives
regulatory_initiatives[0]
Name Description Type Default Required
initiative_active regulatory_initiatives bool true no
management_groups regulatory_initiatives list(string)
[“mgacf”] no
policy_assignment_config regulatory_initiatives object() {} no
policy_exemption_config regulatory_initiatives object() {} no
policy_assignment_config_default_0
regulatory_initiatives[0].policy_assignment_config
Name Description Type Default Required
assignment_name policy_assignment_config string “CIS1.3” no
policy_name policy_assignment_config string “612b5213-9160-4969-8578-1518bd2a000c” no
display_name policy_assignment_config string “Nordcloud CIS Benchmark v1.3.0” no
description policy_assignment_config string
“This initiative includes policies that address a subset of CIS Microsoft Azure
Foundations Benchmark recommendations. Additional policies will be added in
upcoming releases. For more information, visit https://aka.ms/cisazure130-
initiative.”
no
metadata policy_assignment_config map(string) { assignedBy = “NC Architects” } no
not_scopes policy_assignment_config list(string) [] no
parameters policy_assignment_config object() link no
policy_exemption_config_default_0
regulatory_initiatives[0].policy_exemption_config
Name Description Type Default Required
exemptions_name policy_exemption_config string “CIS1.3” no
display_name policy_exemption_config string
“Exemptions for Nordcloud CIS Benchmark
v1.3.0” no
description policy_exemption_config string
“Exemptions for Nordcloud CIS Benchmark
v1.3.0” no
metadata policy_exemption_config map(string) { requestedBy = “Nordcloud Architects”,
approvedBy = “Nordcloud Architects” } no
policy_definition_reference_ids policy_exemption_config list(string) link no
exemption_category policy_exemption_config string “Waiver” no
regulatory_initiatives[1]
212/454
Name Description Type Default Required
initiative_active regulatory_initiatives bool true no
management_groups regulatory_initiatives list(string)
[“mgacf”] no
policy_assignment_config regulatory_initiatives object() {} no
policy_exemption_config regulatory_initiatives object() {} no
policy_assignment_config_default_1
regulatory_initiatives[1].policy_assignment_config
Name Description Type Default Required
assignment_name policy_assignment_config string “ISO27001.2013” no
policy_name policy_assignment_config string “89c6cddc-1c73-4ac1-b19c-54d1a15a42f2” no
location policy_assignment_config string “westeurope” no
identity policy_assignment_config map(string) {type = “SystemAssigned”} no
display_name policy_assignment_config string “Nordcloud ISO 27001-2013 Benchmark v7” no
description policy_assignment_config string
“This initiative includes policies that address a subset of ISO 27001:2013
controls. Additional policies will be added in upcoming releases. For more
information, visit https://aka.ms/iso27001-init.”
no
metadata policy_assignment_config map(string) { assignedBy = “NC Architects” } no
not_scopes policy_assignment_config list(string) [] no
parameters policy_assignment_config object() {} no
enforce policy_assignment_config bool true no
policy_exemption_config_default_1
regulatory_initiatives[1].policy_exemption_config
Name Description Type Default Required
exemptions_name policy_exemption_config string “ISO27001.2013” no
display_name policy_exemption_config string
“Exemptions for Nordcloud ISO27001:2013
Benchmark v7” no
description policy_exemption_config string
“Exemptions for Nordcloud ISO27001:2013
Benchmark v7” no
metadata policy_exemption_config map(string) { requestedBy = “Nordcloud Architects”,
approvedBy = “Nordcloud Architects” } no
policy_definition_reference_ids policy_exemption_config list(string) link no
exemption_category policy_exemption_config string “Waiver” no
regulatory_initiatives[2]
Name Description Type Default Required
initiative_active regulatory_initiatives bool true no
management_groups regulatory_initiatives list(string)
[“mgacf”] no
policy_assignment_config regulatory_initiatives object() {} no
policy_exemption_config regulatory_initiatives object() {} no
policy_assignment_config_default_2
213/454
regulatory_initiatives[2].policy_assignment_config
Name Description Type Default Required
assignment_name policy_assignment_config string “ASBv3” no
policy_name policy_assignment_config string “1f3afdf9-d0c9-4c3d-847f-89da613e70a8” no
location policy_assignment_config string “westeurope” no
identity policy_assignment_config map(string) {type = “SystemAssigned”} no
display_name policy_assignment_config string “Nordcloud Azure Security Benchmark v3” no
description policy_assignment_config string
“The Azure Security Benchmark initiative represents the policies and controls
implementing security recommendations defined in Azure Security Benchmark v2,
see https://aka.ms/azsecbm. This also serves as the Azure Security Center default
policy initiative. You can directly assign this initiative, or manage its policies and
compliance results within Azure Security Center.”
no
metadata policy_assignment_config map(string) { assignedBy = “NC Architects” } no
not_scopes policy_assignment_config list(string) [] no
parameters policy_assignment_config object() {} no
enforce policy_assignment_config bool true no
policy_exemption_config_default_2
regulatory_initiatives[2].policy_exemption_config
Name Description Type Default Required
exemptions_name policy_exemption_config string “ASBv3” no
display_name policy_exemption_config string
“Exemptions for Nordcloud Azure Security
Benchmark v3” no
description policy_exemption_config string
“Exemptions for Nordcloud Azure Security
Benchmark v3” no
metadata policy_exemption_config map(string) { requestedBy = “Nordcloud Architects”,
approvedBy = “Nordcloud Architects” } no
policy_definition_reference_ids policy_exemption_config list(string) link no
exemption_category policy_exemption_config string “Waiver” no
LAST APPLIED CONFIGURATION
TEMP Comment: Leave as is for now, will be used later to dynamically update with customer specific config.
input descriptions
rbac
rbac_enabled
Indicates whether role definitions are to be deployed or not. If false, role definitions would not be deployed
acf_root_level
Name of ACF Root level Management Group to set as scope of role definitions
custom_role_definitions
custom_role_definitions_name
214/454
Name of custom role definition
custom_role_definitions_description
Description of custom role definition
custom_role_definitions_actions
List of Allowed actions
custom_role_definitions_not_actions
List of Disallowed Actions
additional_custom_role_definitions
Additional list of maps with custom role definitions which needs to be created
This list appends to custom_role_definitions defined above. This helps to create additional custom role definitions in
addition to default role definitions
Each custom role definition map has below parameters
name : Name of the Role Definition
description : Description of the Role Definition
role_definition_id : Unique UUID/GUID which identifies this role - one will be generated if not specified
scope : Scope at which the Role Definition applies to
actions : List of Allowed Actions
not_actions : List of Disallowed Actions
data_actions : List of Allowed Data Actions
not_data_actions: List of Disallowed Data Actions
regulatory_compliance
regulatory_initiatives_enabled
Indicates whether regulatory initiative are to be deployed or not. If false, regulatory initiative would not be deployed
regulatory_initiatives
list of objects with regulatory initiatives to be created. Each object supports the following parameters:
initiative_active
Indicates whether the initiative is active and needs to be deployed or not
initiative_management_groups
List of management groups, for which the initiative needs to be deployed. List should not contains, groups under same
hierarchy
policy_assignment_config_descr
policy_assignment_name
215/454
The name to be used for Policy Assignment
policy_assignment_policy_name
The name of the policy
policy_assignment_location
Azure Region where the Policy Assignment should exist
policy_assignment_identity
Config related to identity to be assigned for the policy assignment.
policy_assignment_display_name
Display Name for this Policy Assignment
policy_assignment_description
Description which should be used for this Policy Assignment
policy_assignment_metadata
Map of metadata to be added to the policy assignment
policy_assignment_not_scopes
list of Resource Scopes (for example a Subscription, or a Resource Group) within this Management Group which are
excluded from this Policy
policy_assignment_parameters
Map of any Parameters for this Policy
policy_assignment_parameters_value_0
parameters = {
approvedExtensions-c0e996f8-39cf-4af9-9f45-83fbde810432 = {
value = [
"AzureDiskEncryption",
"AzureDiskEncryptionForLinux",
"DependencyAgentWindows",
"DependencyAgentLinux",
"IaaSAntimalware",
"IaaSDiagnostics",
"LinuxDiagnostic",
"MicrosoftMonitoringAgent",
"NetworkWatcherAgentLinux",
"NetworkWatcherAgentWindows",
"OmsAgentForLinux",
"VMSnapshot",
"VMSnapshotLinux",
"DSC",
"CustomScriptExtension",
"OmsAgentForWindows",
"DatadogLinuxAgent",
"DatadogWindowsAgent",
"VMAccessAgent",
"ConfigurationforWindows",
216/454
policy_assignment_enforce
Specifies if this Policy should be enforced or not?
policy_exemption_config_descr
policy_exemption_name
Name of the Policy Exemption
policy_exemption_display_name
Display name to use for this Policy Exemption
policy_exemption_description
Description to use for this Policy Exemption
policy_exemption_metadata
Map of metadata to be added to the policy assignment exemption
policy_exemption_policy_definition_reference_ids
List of policy reference ids to be exempted
policy_exemption_config_policy_definition_reference_ids_0
Nordcloud CIS Benchmark v1.3.0
Nordcloud provides an expanded list of allowed virtual machine extensions, and some of the policies have been granted a
waiver as they simply don’t make sense in the default Nordcloud ACF product. The standard list of VM extensions for
example is simply far too restrictive to even be practical.
Additionally the Nordcloud CIS Benchmark v1.3.0 initiative waivers the following policies from the the built-in CIS
1.3 initiative out of the box:
"ConfigurationforLinux",
"MDE.Windows",
"MDE.Linux",
"AADLoginForWindows",
"InstalldcFeatures",
"VMAccessForLinux",
"CloudSyncAgent",
"AzurePolicyForWindows",
"AzurePolicyForLinux",
"AzureMonitorWindowsAgent",
"AzureMonitorLinuxAgent",
"azuresecuritylinuxagent",
"changetracking-linux",
"azuresecuritywindowsagent",
"changetracking-windows"
]
}
}
217/454
GUID Policy
6fac406b-40ca-413b-bf8e0bf964659c25 Storage accounts should use customer-managed key for encryption
fbb99e8e-e444-4da0-9ff1-
75c92f5a85b2 Storage account containing the container with activity logs must be encrypted with BYOK
2a1a9cdf-e04d-429a-8416-
3bfb72a1b26f Storage accounts should restrict network access using virtual network rules
c75248c1-ea1d-4a9c-8fc9-
29a6aabd5da8 Function apps should have authentication enabled
4fa4b6c0-31ca-4c0d-b10d24b96f62a751 Storage account public access should be disallowed
98728c90-32c7-4049-8429-
847dc0f4fe37 Key Vault secrets should have an expiration date
475aae12-b88a-4572-8b36-
9b712b2b3a17 Auto provisioning of the Log analytics agent should be enabled on your subscription
640d2586-54d2-465f-877f9ffc1d2109f4 Defender should be enabled for Storage Accounts
The three storage account policies below need to be exempted because out-of-the-box Nordcloud’s implementation of
Azure Storage Accounts requires these:
For the policy “6fac406b-40ca-413b-bf8e-0bf964659c25” Nordcloud doesn’t currently use CMK for encryption
because this would require additional complexity beyond the current scope of deployment. CMK is beyond our scope. We have alternative key management solutions supporting key management and cryptographic controls.
For the policy “fbb99e8e-e444-4da0-9ff1-75c92f5a85b2” Nordcloud doesn’t currently use BYOK (bring your own
key) for Storage Account containers, as this wpould require additrional processes for the deployment which could
unreasonably extend deployment times. if customer wants to bring their own key then they would have to pay
additionally for additional services. Our current teams are able to do this but it requires additional resources and
extends the timeline for deployment. Generally customers are not really happy with this additional cost plus extension
of timeline hence NordcLoud decided to waiver this.
For the policy “2a1a9cdf-e04d-429a-8416-3bfb72a1b26f”, Nordcloud doesn’t restrict network access using virtual
network rules because of a required specific network implementation for the PSP API and Sandbox automation modules. This is due to a technical implentation of a procedure for connecting Azure Storage Accounts using their
firewall feature.
The policy ‘c75248c1-ea1d-4a9c-8fc9-29a6aabd5da8’ is exempted because enabling authentication for function apps
is currently beyond the scope of the ACF.
The policy ‘4fa4b6c0-31ca-4c0d-b10d-24b96f62a751’ is exempted as this is a PREVIEW policy and these are
unsupported.
The policy ‘98728c90-32c7-4049-8429-847dc0f4fe37’ is exempted as it does not seem to be working correctly. Where
compliant resources were being marked as non-compliant.
The policy ‘475aae12-b88a-4572-8b36-9b712b2b3a17’ is exempted as the MMA agent will be deprecated in 2024,
and replaced with AMA agent
The policy ‘640d2586-54d2-465f-877f-9ffc1d2109f4’ is exempted as this is regarding a new subscription plan for
storage defender, which requires analysis prior to providing it as an option. This analysis is ongoing and will be
determined in a future update to ACF. Note: Defender for storage is enabled, but at the billing per transaction level.
policy_definition_reference_ids = [
"6fac406b-40ca-413b-bf8e-0bf964659c25",
218/454
policy_exemption_config_policy_definition_reference_ids_1
Nordcloud ISO 27001-2013 Benchmark v7
The Nordcloud ISO 27001-2013 Benchmark v7 initiative waivers the following policies from the the built-in ISO
27001-2013 initiative out of the box:
"fbb99e8e-e444-4da0-9ff1-75c92f5a85b2",
"2a1a9cdf-e04d-429a-8416-3bfb72a1b26f",
"c75248c1-ea1d-4a9c-8fc9-29a6aabd5da8",
"4fa4b6c0-31ca-4c0d-b10d-24b96f62a751",
"98728c90-32c7-4049-8429-847dc0f4fe37",
"475aae12-b88a-4572-8b36-9b712b2b3a17",
"640d2586-54d2-465f-877f-9ffc1d2109f4"
]
219/454
Identifier Policy
PreviewAuditExternalAccountsWithOwnerPermissionsOnASubscription External accounts with owner permissions should be removed from
your subscription
AuditUsageOfCustomRBACRules
Audit built-in roles such as ‘Owner, Contributer, Reader’ instead of
custom RBAC roles, which are error prone. Using custom roles is
treated as an exception and requires a rigorous review and threat modeling
PreviewAuditLinuxVmPasswdFilePermissions
Requires that prerequisites are deployed to the policy assignment scope.
For details, visit https://aka.ms/gcpol. Machines are non-compliant if
Linux machines that do not have the passwd file permissions set to
0644
PreviewAuditWindowsVmEnforcesPasswordComplexityRequirements
Requires that prerequisites are deployed to the policy assignment scope.
For details, visit https://aka.ms/gcpol. Machines are non-compliant if
Windows machines that do not have the password complexity setting
enabled
PreviewAuditWindowsVmMaximumPasswordAge70Days
This policy should only be used along with its corresponding deploy
policy in an initiative. This definition allows Azure Policy to process
the results of auditing Windows virtual machines that do not have a maximum password age of 70 days. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol
PreviewAuditWindowsVmShouldNotAllowPrevious24Passwords
Requires that prerequisites are deployed to the policy assignment scope.
For details, visit https://aka.ms/gcpol. Machines are non-compliant if
Windows machines that allow re-use of the previous 24 passwords
PreviewAuditWindowsVmMinimumPasswordAge1Day
Requires that prerequisites are deployed to the policy assignment scope.
For details, visit https://aka.ms/gcpol. Machines are non-compliant if
Windows machines that do not have a minimum password age of 1 day
PreviewAuditWindowsVmPasswordsMustBeAtLeast14Characters
Requires that prerequisites are deployed to the policy assignment scope.
For details, visit https://aka.ms/gcpol. Machines are non-compliant if
Windows machines that do not restrict the minimum password length to
14 characters
PreviewAuditWindowsVmShouldNotStorePasswordsUsingReversibleEncryption
Requires that prerequisites are deployed to the policy assignment scope.
For details, visit https://aka.ms/gcpol. Machines are non-compliant if
Windows machines that do not store passwords using reversible
encryption
PreviewAuditLinuxVmAccountsWithNoPasswords
Requires that prerequisites are deployed to the policy assignment scope.
For details, visit https://aka.ms/gcpol. Machines are non-compliant if
Linux machines that have accounts without passwords
PreviewAuditLinuxVmAllowingRemoteConnectionsFromAccountsWithNoPasswords
Requires that prerequisites are deployed to the policy assignment scope.
For details, visit https://aka.ms/gcpol. Machines are non-compliant if
Linux machines that allow remote connections from accounts without
passwords
Prerequisite_DeployExtensionWindows Deploy the Windows Guest Configuration extension to enable Guest Configuration assignments on Windows VMs
Prerequisite_DeployExtensionLinux Deploy the Linux Guest Configuration extension to enable Guest Configuration assignments on Linux VMs
AuditDiagnosticSetting Audit diagnostic setting for selected resource types
PreviewAuditLogAnalyticsAgentDeploymentVmImageOSUnlisted
(Preview) Log Analytics Extension should be enabled for listed virtual machine images
PreviewMonitorVmVulnerabilitiesInAzureSecurityCenter
(Preview) A vulnerability assessment solution should be enabled on
your virtual machines
PreviewMonitorOSVulnerabilitiesInAzureSecurityCenter
(Preview) Vulnerabilities in security configuration on your machines
should be remediated
The policy “PreviewAuditExternalAccountsWithOwnerPermissionsOnASubscription” is necessary because out-of-the-box
Nordcloud uses external accounts with owner permissions.
The following VM password complexity policies are exempted since controlling the password complexity of VMs is
exceeding the scope for the ACF platform landing zone:
PreviewAuditWindowsVmEnforcesPasswordComplexityRequirements
PreviewAuditWindowsVmMaximumPasswordAge70Days
220/454
PreviewAuditWindowsVmShouldNotAllowPrevious24Passwords
PreviewAuditWindowsVmMinimumPasswordAge1Day
PreviewAuditWindowsVmPasswordsMustBeAtLeast14Characters
The following OS system configuration policies are exempted since they are exceeding the scope for the ACF platform
landing zone:
PreviewAuditLinuxVmPasswdFilePermissions
PreviewAuditWindowsVmShouldNotStorePasswordsUsingReversibleEncryption
PreviewAuditLinuxVmAccountsWithNoPasswords
PreviewAuditLinuxVmAllowingRemoteConnectionsFromAccountsWithNoPasswords
The policies “Prerequisite_DeployExtensionWindows” and “Prerequisite_DeployExtensionLinux” are waivered because
Azure Cloud Foundation does not deploy guest configuration.
The policy “AuditDiagnosticSetting” is waivered because ACF has a custom policy that handles diagnostic configuration,
which is configured only for resources supported by ACF.
The policy ‘PreviewAuditLogAnalyticsAgentDeploymentVmImageOSUnlisted’,
‘PreviewMonitorVmVulnerabilitiesInAzureSecurityCenter’ and
‘PreviewMonitorOSVulnerabilitiesInAzureSecurityCenter’ are exempted as this is a PREVIEW policy and these are
unsupported.
policy_exemption_config_policy_definition_reference_ids_2
Nordcloud Cloud Security Benchmark v3
The Nordcloud Cloud Security Benchmark v3 initiative waivers the following policies from the the built-in Cloud
Security Benchmark initiative out of the box:
Identifier Policy
authenticationToLinuxMachinesShouldRequireSSHKeysMonitoringEffect Authentication to Linux machines should
require SSH keys
serverSqlDbVulnerabilityAssesmentMonitoring
SQL servers on machines should have
vulnerability findings resolved
windowsWebServersShouldBeConfiguredToUseSecureCommunicationProtocolsMonitoringEffect Windows web servers should be configured to
use secure communication protocols
gcExtOnVMMonitoring Azure policy for Windows monitoring
policy_definition_reference_ids = [
"PreviewAuditExternalAccountsWithOwnerPermissionsOnASubscription",
"AuditUsageOfCustomRBACRules",
"PreviewAuditLinuxVmPasswdFilePermissions",
"PreviewAuditWindowsVmEnforcesPasswordComplexityRequirements",
"PreviewAuditWindowsVmMaximumPasswordAge70Days",
"PreviewAuditWindowsVmShouldNotAllowPrevious24Passwords",
"PreviewAuditWindowsVmMinimumPasswordAge1Day",
"PreviewAuditWindowsVmPasswordsMustBeAtLeast14Characters",
"PreviewAuditWindowsVmShouldNotStorePasswordsUsingReversibleEncryption",
"PreviewAuditLinuxVmAccountsWithNoPasswords",
"PreviewAuditLinuxVmAllowingRemoteConnectionsFromAccountsWithNoPasswords",
"Prerequisite_DeployExtensionWindows",
"Prerequisite_DeployExtensionLinux",
"AuditDiagnosticSetting",
"PreviewAuditLogAnalyticsAgentDeploymentVmImageOSUnlisted",
"PreviewMonitorVmVulnerabilitiesInAzureSecurityCenter",
"PreviewMonitorOSVulnerabilitiesInAzureSecurityCenter"
]
221/454
privateEndpointShouldBeConfiguredForKeyVaultMonitoringEffect Private endpoint should be configured for Key
Vault
vnetEnableDDoSProtectionMonitoring
Azure DDoS Protection Standard should be
enabled
windowsDefenderExploitGuardMonitoring
Windows Defender Exploit Guard should be
enabled on your Windows virtual machines
windowsGuestConfigBaselinesMonitoring
Vulnerabilities in security configuration on
your Windows machines should be remediated
(powered by Guest Config)
linuxGuestConfigBaselinesMonitoring
Vulnerabilities in security configuration on
your Linux machines should be remediated
(powered by Guest Config)
serverVulnerabilityAssessment A vulnerability assessment solution should be
enabled on your virtual machines
gcLinuxDiskEncryptionMonitoring
(Preview): Linux virtual machines should
enable Azure Disk Encryption or EncryptionAtHost.
gcWindowsDiskEncryptionMonitoring
(Preview): Windows virtual machines should
enable Azure Disk Encryption or EncryptionAtHost.
systemUpdatesAutoAssessmentMode
(Preview): Machines should be configured to
periodically check for missing system updates
endpointProtectionHealthIssuesMonitoringEffect Endpoint protection health issues should be
resolved on your machines
installEndpointProtection Endpoint protection should be installed on
your machines
systemConfigurationsMonitoring
Vulnerabilities in security configuration on
your machines should be remediated
useRbacRulesMonitoring Audit usage of custom RBAC roles
certificatesValidityPeriodMonitoring
[Preview]: Certificates should have the
specified maximum validity period
systemUpdatesV2Monitoring
[Preview]: System updates should be installed
on your machines (powered by Update Center)
enableDefenderForApis
[Preview]: Microsoft Defender for APIs
should be enabled
ASCDependencyAgentAuditWindowsEffect
[Preview]: Network traffic data collection
agent should be installed on Windows virtual machines
ASCDependencyAgentAuditLinuxEffect
[Preview]: Network traffic data collection
agent should be installed on Linux virtual machines
AzureFirewallEffect
[Preview]: All Internet traffic should be routed
via your deployed Azure Firewall
ArcWindowsMonitoring
[Preview]: Log Analytics extension should be
installed on your Windows Azure Arc machines
ArcLinuxMonitoring
[Preview]: Log Analytics extension should be
installed on your Linux Azure Arc machines
arcEnabledKubernetesClustersShouldHaveAzureDefendersExtensionInstalled
[Preview]: Azure Arc enabled Kubernetes
clusters should have Microsoft Defender for Cloud extension installed
StorageDisallowPublicAccess
[Preview]: Storage account public access
should be disallowed
VtpmShouldBeEnabledOnSupportedVirtualMachinesMonitoringEffect
[Preview]: vTPM should be enabled on
supported virtual machines
previewSecureBootShouldBeEnabledOnSupportedWindowsVirtualMachinesMonitoringEffect
[Preview]: Secure Boot should be enabled on
supported Windows virtual machines
Identifier Policy
222/454
GuestAttestationExtensionShouldBeInstalledOnSupportedLinuxVirtualMachinesMonitoringEffect
[Preview]: Guest Attestation extension should
be installed on supported Linux virtual machines
GuestAttestationExtensionShouldBeInstalledOnSupportedLinuxVirtualMachinesScaleSetsMonitoringEffect
[Preview]: Guest Attestation extension should
be installed on supported Linux virtual machines scale sets
GuestAttestationExtensionShouldBeInstalledOnSupportedWindowsVirtualMachinesMonitoringEffect
[Preview]: Guest Attestation extension should
be installed on supported Windows virtual machines
GuestAttestationExtensionShouldBeInstalledOnSupportedWindowsVirtualMachinesScaleSetsMonitoringEffect
[Preview]: Guest Attestation extension should
be installed on supported Windows virtual machines scale sets
LinuxVirtualMachineShouldUseSignedAndTrustedBootComponentEffect
[Preview]: Linux virtual machines should use
only signed and trusted boot components
autoProvisioningOfTheLogAnalyticsAgentShouldBeEnabledOnYourSubscriptionMonitoringEffect Auto provisioning of the Log analytics agent
should be enabled on your subscription
storageAccountsShouldPreventSharedKeyAccess Storage accounts should prevent shared key
access
storageAccountShouldUseAPrivateLinkConnectionMonitoringEffect Storage account should use a private link
connection
virtualMachinesAndVirtualMachineScaleSetsShouldHaveEncryptionAtHostEnabled Virtual machines and virtual machine scale
sets should have encryption at host enabled
defenderForStorageShouldBeEnabledMonitoring Defender for Storage should be enabled
SQLServerTargetedAutoprovisioningShouldBeEnabledForSQLServersOnMachinesPlan SQL Server targeted autoprovisioning should
be enabled for SQL servers on machines plan
azureContainerRegistryVulnerabilityAssessment
Azure registry container images should have
vulnerabilities resolved (powered by
Microsoft Defender Vulnerability
Management)
containerRegistriesShouldUsePrivateLinkMonitoringEffect Container registries should use private link
containerRegistriesShouldNotAllowUnrestrictedNetworkAccessMonitoringEffect Container registries should not allow
unrestricted network access
adaptiveNetworkHardeningsMonitoring
Adaptive network hardening
recommendations should be applied on
internet facing virtual machines
Identifier Policy
The policy “authenticationToLinuxMachinesShouldRequireSSHKeysMonitoringEffect” is exempted because ACF for now
only supports passwords to login to linux machines, SSH authentication may be a future feature.
The policy “vnetEnableDDoSProtectionMonitoring” is exempted as ACF doesn’t deploy DDOS Protection as a module,
only an optional policy to support plans created by the customer.
Below policies are exempted because it requires the use of the Guest configuration extension which is not deployed as part
of ACF:
serverSqlDbVulnerabilityAssesmentMonitoring
windowsWebServersShouldBeConfiguredToUseSecureCommunicationProtocolsMonitoringEffect
gcExtOnVMMonitoring
windowsDefenderExploitGuardMonitoring
windowsGuestConfigBaselinesMonitoring
linuxGuestConfigBaselinesMonitoring
endpointProtectionHealthIssuesMonitoringEffect
installEndpointProtection
systemConfigurationsMonitoring
223/454
The policy ‘privateEndpointShouldBeConfiguredForKeyVaultMonitoringEffect’ is exempted as this is a PREVIEW policy
and these are unsupported.
The policy ‘serverVulnerabilityAssessment’ is exempted because remediation requires ‘Defender for endpoint Plan 2’ and
not all customer decides for it.
The preview controls are excluded by default: “gcLinuxDiskEncryptionMonitoring”,
“gcWindowsDiskEncryptionMonitoring”. “systemUpdatesAutoAssessmentMode”.
The policy “useRbacRulesMonitoring” exemption is necessary because Azure Cloud Foundation offers modules with
custom roles which are filling missing functionality in Azure built-in roles.
The below policies are excluded as they are in preview state
“certificatesValidityPeriodMonitoring”
“systemUpdatesV2Monitoring”
“enableDefenderForApis”
“ASCDependencyAgentAuditWindowsEffect”
“ASCDependencyAgentAuditLinuxEffect”
“AzureFirewallEffect”
“ArcWindowsMonitoring”
“ArcLinuxMonitoring”
“arcEnabledKubernetesClustersShouldHaveAzureDefendersExtensionInstalled”
“StorageDisallowPublicAccess”
“VtpmShouldBeEnabledOnSupportedVirtualMachinesMonitoringEffect”
“previewSecureBootShouldBeEnabledOnSupportedWindowsVirtualMachinesMonitoringEffect”
“GuestAttestationExtensionShouldBeInstalledOnSupportedLinuxVirtualMachinesMonitoringEffect”
“GuestAttestationExtensionShouldBeInstalledOnSupportedLinuxVirtualMachinesScaleSetsMonitoringEffect”
“GuestAttestationExtensionShouldBeInstalledOnSupportedWindowsVirtualMachinesMonitoringEffect”
“GuestAttestationExtensionShouldBeInstalledOnSupportedWindowsVirtualMachinesScaleSetsMonitoringEffect”
“LinuxVirtualMachineShouldUseSignedAndTrustedBootComponentEffect”
The policy “autoProvisioningOfTheLogAnalyticsAgentShouldBeEnabledOnYourSubscriptionMonitoringEffect” is
exempted because the MMA agent will be deprecated in 2024, and replaced with AMA agent
The policy “storageAccountsShouldPreventSharedKeyAccess” is exempted as shared key access is a supported method of
access to Storage Accounts in ACF.
The policy “storageAccountShouldUseAPrivateLinkConnectionMonitoringEffect” is exempted as ACF does not use
private link for storage accounts at this stage.
The policy “virtualMachinesAndVirtualMachineScaleSetsShouldHaveEncryptionAtHostEnabled” is exempted as ACF
deploys VMs with ADE (Azure Disk Encryption) which is not compatable with Encryption at Host.
The policy “defenderForStorageShouldBeEnabledMonitoring” is exempted as this is regarding a new subscription plan for
storage defender, which requires analysis prior to providing it as an option. This analysis is ongoing and will be determined
in a future update to ACF. Note: Defender for storage is enabled, but at the billing per transaction level.
The policy “SQLServerTargetedAutoprovisioningShouldBeEnabledForSQLServersOnMachinesPlan” is exempted because
ACF does not deploy SQL servers, and this policy requires an initiative to be deployed for SQL servers. Note: This policy
can be overridden by removing it from the exemptions list, and adding the required intiiative to the policy parameter file.
224/454
The three policies “azureContainerRegistryVulnerabilityAssessment”,
“containerRegistriesShouldUsePrivateLinkMonitoringEffect” and
“containerRegistriesShouldNotAllowUnrestrictedNetworkAccessMonitoringEffect” are exempted because they require a
higher SKU on the container registry than what is currently in use for the TF backend deployments. The higher SKU is
around 10x the cost of the current SKU, while the current SKU serves the purpose for the backend configuration of TF
deployments.
For the policy “adaptiveNetworkHardeningsMonitoring”, only VMs being used in the Cloud Foundation do not face
Internet directly and traffic is filtered through the Azure Firewall and NSG. NSG rules for inbound are very restrictive and
only management traffic on TCP 22/3389 from Azure Bastion is allowed. That’s why in our opinion “Adaptive network
hardening” is not required and it would bring unnecessary complexity to the IaC solution.
policy_definition_reference_ids = [
"authenticationToLinuxMachinesShouldRequireSSHKeysMonitoringEffect",
"serverSqlDbVulnerabilityAssesmentMonitoring",
"windowsWebServersShouldBeConfiguredToUseSecureCommunicationProtocolsMonitoringEffect",
"gcExtOnVMMonitoring",
"privateEndpointShouldBeConfiguredForKeyVaultMonitoringEffect",
"vnetEnableDDoSProtectionMonitoring",
"windowsDefenderExploitGuardMonitoring",
"windowsGuestConfigBaselinesMonitoring",
"linuxGuestConfigBaselinesMonitoring",
"serverVulnerabilityAssessment",
"gcLinuxDiskEncryptionMonitoring",
"gcWindowsDiskEncryptionMonitoring",
"systemUpdatesAutoAssessmentMode",
"endpointProtectionHealthIssuesMonitoringEffect",
"installEndpointProtection",
"systemConfigurationsMonitoring",
"useRbacRulesMonitoring",
"certificatesValidityPeriodMonitoring",
"systemUpdatesV2Monitoring",
"enableDefenderForApis",
"ASCDependencyAgentAuditWindowsEffect",
"ASCDependencyAgentAuditLinuxEffect",
"AzureFirewallEffect",
"ArcWindowsMonitoring",
"ArcLinuxMonitoring",
"arcEnabledKubernetesClustersShouldHaveAzureDefendersExtensionInstalled",
"StorageDisallowPublicAccess",
"VtpmShouldBeEnabledOnSupportedVirtualMachinesMonitoringEffect",
"previewSecureBootShouldBeEnabledOnSupportedWindowsVirtualMachinesMonitoringEffect",
"GuestAttestationExtensionShouldBeInstalledOnSupportedLinuxVirtualMachinesMonitoringEffect",
"GuestAttestationExtensionShouldBeInstalledOnSupportedLinuxVirtualMachinesScaleSetsMonitoringEffect"
"GuestAttestationExtensionShouldBeInstalledOnSupportedWindowsVirtualMachinesMonitoringEffect"
"GuestAttestationExtensionShouldBeInstalledOnSupportedWindowsVirtualMachinesScaleSetsMonitoringEffect"
"LinuxVirtualMachineShouldUseSignedAndTrustedBootComponentEffect",
"autoProvisioningOfTheLogAnalyticsAgentShouldBeEnabledOnYourSubscriptionMonitoringEffect",
"storageAccountsShouldPreventSharedKeyAccess",
"storageAccountShouldUseAPrivateLinkConnectionMonitoringEffect",
"virtualMachinesAndVirtualMachineScaleSetsShouldHaveEncryptionAtHostEnabled",
"defenderForStorageShouldBeEnabledMonitoring",
"SQLServerTargetedAutoprovisioningShouldBeEnabledForSQLServersOnMachinesPlan",
"azureContainerRegistryVulnerabilityAssessment",
"containerRegistriesShouldUsePrivateLinkMonitoringEffect",
"containerRegistriesShouldNotAllowUnrestrictedNetworkAccessMonitoringEffect"
]
225/454
policy_exemption_exemption_category
The category of this policy exemption. Possible values are Waiver and Mitigated
dependency
The Governance module is dependent on the following modules: - /CORE - /PROVISIONER/CICD — id: blueprintnetwork-standard-tf title: Network sidebar_position: 5 —
modules
List modules which are within given blueprint : - Tags - KeyVault - Network - Connectivity network - Sharedservices
network - Identity network - Multiregion - VPN - ExpressRoute - GlobalReach - Bastion - Dependency
inputs
Make sure you read the descriptions of the variables.
tags
Name Description Type Default Required
append_tags append_tags map { nc-cf-deployment-name: blueprint.firewall.standard } yes
keyvault_services
Name Description Type Default Required
key_vault_short_name keyvault string conn no
key_vault_kek_expiry_days keyvault number 1825 no
key_vault_enable_purge_protection keyvault bool true no
key_vault_enabled_for_deployment keyvault bool true no
key_vault_enabled_for_template_deployment keyvault bool false no
key_vault_enabled_for_disk_encryption keyvault bool false no
key_vault_enable_rbac_authorization keyvault bool true no
key_vault_key_vault_sku keyvault string standard no
key_vault_permissions keyvault map {} no
key_vault_network_acls_default_action keyvault string Deny no
key_vault_network_acls_virtual_network_rules keyvault list(string) [] no
key_vault_network_acls_ip_rules keyvault list(string) [] no
key_vault_access_policies keyvault list(string) [] no
key_vault_network_acls_bypass keyvault string AzureServices no
network_services
settings.networks
226/454
Name Description Type Default Required
enabled networks_enabled bool false yes
topology topology string hubspoke yes
vwan_is_main_region vwan_main_region bool true
yes
(vwan
only)
vwan_name vwan_name string vwan-sch-tst-ne-001
yes
(vwan
only)
vwan_resource_group_name vwan_rg string rg-sch-tst-ne-001
yes
(vwan
only)
instance instance string instance_001 yes
location location string northeurope yes
location_short location_short string ne yes
base_network_prefix base_network_prefix list(string) [“10.222.0.0/16”] yes
connectivity connectivity list(object) [{}] yes
sharedservices sharedservices list(object) [{}] yes
identity identity list(object) [{}] yes
connectivity_services
settings.networks.connectivity
Name Description Type Default Required
config config list(object) [{}] yes
azure_bastion bastion list(object) [{}] no
multi_region_hub_peering multi_region_hub_peering list(object) [{}] no
vpn vpn list(object) [{}] no
express_route express_route list(object) [{}] no
subnets subnets list(object) [{}] no
service_endpoints service_endpoints list(object) [{}] no
network_security_groups network_security_groups list(object) [{}] no
route_tables route_tables list(object) [{}] no
connectivity_config_services
settings.networks.connectivity.config
Name Description Type Default Required
address_space config list(string) [“10.222.4.0/22”] yes
custom_dns_enabled config bool false no
custom_dns_ip_address config list(string)
[“10.222.4.196”,
“10.222.4.197”] no
connectivity_bastion_services
settings.networks.connectivity.azure_bastion
227/454
Name Description Type Default Required
enabled bastion bool false no
sku bastion string Standard no
scaleUnits bastion number 2 no
copy_paste_enabled bastion bool true no
file_copy_enabled bastion bool false no
ip_connect_enabled bastion bool false no
tunneling_enabled bastion bool false no
connectivity_multiregion_hub_peering_services
settings.networks.connectivity.multi_region_hub_peering
Name Description Type Default Required
vnet_id multiregion string “” yes
use_remote_gateways multiregion bool false yes
allow_gateway_transit multiregion bool true yes
allow_forwarded_traffic multiregion bool true yes
allow_virtual_network_access multiregion bool true yes
remote_location_short multiregion string ne yes
remote_instance multiregion string instance_001 yes
connectivity_vpn_services
settings.networks.connectivity.vpn
Name Description Type Default Required
enabled vpn bool false no
network_gateway_sku vpn string VpnGw2AZ no
vpn_type vpn string RouteBased no
active_active vpn bool true no
vpn_gateway_generation vpn string Generation2 no
gateway_public_ip_name1 vpn string pip-vgw-sch-tst-ne-001 no
gateway_public_ip_name2 vpn string pip-vgw-sch-tst-ne-002 no
availability_zones vpn list(string) [“1”, “2”, “3”] no
enable_bgp vpn bool true no
bgp_settings bgp_settings list(object) [{}] no
connections connections list(object) [{}] no
local_network_gateways local_network_gateways list(object) [{}] no
vpn_sites vpn_sites list(object) [{}] no
connectivity_vpn_bgp_settings_services
settings.networks.connectivity.vpn.bgp_settings
228/454
Name Description Type Default Required
asn bgp_settings number 10 no
peer_weight bgp_settings number 1 no
peering_addresses bgp_settings list(object) [{}] no
connectivity_vpn_connections_bgp_settings_peering_addresses
settings.networks.connectivity.vpn.bgp_settings.peering_addresses
Name Description Type Default Required
ip_configuration_name bgp_settings string vpnGatewayConfig1 no
apipa_addresses bgp_settings list(string) [“169.254.21.3”] no
connectivity_vpn_connections_services
settings.networks.connectivity.vpn.connections
Name Description Type Default Required
name connections string cn-sch-tst-ne-001 no
local_network_gateways_name connections string lgw-sch-tst-ne-001 no
type connections string IPsec no
protocol connections string IKEv2 no
mode connections string Default no
routing_weight connections number 0 no
use_policy_based_traffic_selectors connections bool false no
enable_bgp connections bool false no
vpn_ipsec_policies ipsec list(object) [{}] no
connectivity_vpn_connections_vpn_ipsec_policies_services
settings.networks.connectivity.vpn.connections.vpn_ipsec_policies
Name Description Type Default Required
sa_life_time_seconds ipsec number 27000 no
sa_data_size_kilobytes ipsec number 10240000 no
ipsec_encryption ipsec string AES256 no
ipsec_integrity ipsec string SHA256 no
ike_encryption ipsec string AES256 no
ike_integrity ipsec string SHA1 no
dh_group ipsec string DHGroup2 no
pfs_group ipsec string None no
connectivity_vpn_local_network_gateways_services
settings.networks.connectivity.vpn.local_network_gateways
229/454
Name Description Type Default Required
name local_network_gateways string lgw-sch-tst-ne-001 no
gateway_ip_address local_network_gateways number 185.116.30.44 no
address_space local_network_gateways string [“10.255.0.0/16”,“10.228.0.0/16”] no
bgp_settings bgp_settings list(object) [{}] no
connectivity_vpn_local_network_gateways_bgp_settings_services
settings.networks.connectivity.vpn.local_network_gateways.bgp_settings
Name Description Type Default Required
asn bgp_settings number 10 no
bgp_peering_address bgp_settings string 10.1.1.0 no
peer_weight bgp_settings number 0 no
connectivity_vpn_vpn_sites_services
settings.networks.connectivity.vpn.vpn_sites
Name Description Type Default Required
name vpn_sites string cn-sch-tst-ne-001 no
device_vendor vpn_sites string vendor no
enable_bgp vpn_sites bool false no
address_prefix vpn_sites list(string) [“192.168.1.0/24”] no
links links list(object) [{}] no
connectivity_vpn_vpn_sites_name_links_services
settings.networks.connectivity.vpn.vpn_sites.links
Name Description Type Default Required
name links string link1 no
ip_address links string 192.168.1.6 no
provider_name links string provider no
link_speed links number 50 no
bgp_properties bgp_settings list(object) [{}] no
vpn_ipsec_policies ipsec list(object) [{}] no
connectivity_vpn_vpn_sites_name_links_services_bgp_properties
settings.networks.connectivity.vpn.vpn_sites.links.bgp_properties
Name Description Type Default Required
asn bgp_settings number 10 no
bgp_peering_address bgp_settings string 10.1.1.0 no
connectivity_vpn_vpn_sites_name_links_vpn_ipsec_policies_services
230/454
settings.networks.connectivity.vpn.vpn_sites.links.vpn_ipsec_policies
Name Description Type Default Required
sa_life_time_seconds ipsec number 27000 no
sa_data_size_kilobytes ipsec number 10240000 no
ipsec_encryption ipsec string AES256 no
ipsec_integrity ipsec string SHA256 no
ike_encryption ipsec string AES256 no
ike_integrity ipsec string SHA1 no
dh_group ipsec string DHGroup24 no
pfs_group ipsec string None no
connectivity_expressroute_services
settings.networks.connectivity.express_route
Name Description Type Default Required
enabled expressroute bool false no
network_gateway_sku expressroute string ErGw3AZ no
vpn_type expressroute string PolicyBased no
pip_sku expressroute string Standard no
gateway_public_ip_name1 expressroute string pip-vgw-sch-tst-ne-001 no
availability_zones expressroute list(string) [“1”, “2”, “3”] no
bgp_settings bgp_settings list(object) [{}] no
circuit circuits list(object) [{}] no
global_reach globalreach list(object) [{}] no
connectivity_expressroute_bgp_settings_services
settings.networks.connectivity.express_route.bgp_settings
Name Description Type Default Required
asn bgp_settings number 10 no
peer_weight bgp_settings number 1 no
peering_addresses bgp_settings list(object) [{}] no
connectivity_expressroute_bgp_settings_peering_addresses
settings.networks.connectivity.express_route.bgp_settings.peering_addresses
Name Description Type Default Required
ip_configuration_name bgp_settings string vpnGatewayConfig-0 no
apipa_addresses bgp_settings list(string) [“169.254.21.3”] no
connectivity_expressroute_circuits_services
settings.networks.connectivity.express_route.circuit
231/454
Name Description Type Default Required
circuit_name circuits string erc-sch-tst-ne-001 no
connection_name circuits string cn-ergw-sch-tst-ne-001 no
provisioned circuits bool false no
existing_circuit_id circuits string “” no
authorization_key circuits string null no
sku_name circuits string Standard_MeteredData no
sku_tier circuits string Standard no
sku_family circuits string MeteredData no
provider_name circuits string Equinix no
peering_location circuits string Amsterdam no
bandwidth circuits number 50 no
peer_asn circuits number 111 no
use_policy_based_traffic_selectors circuits bool false no
express_route_gateway_bypass circuits bool false no
primary_peer_address_prefix circuits string 10.0.0.0/30 no
secondary_peer_address_prefix circuits string 10.0.1.0/30 no
vlan_id circuits number 123 no
enable_internet_security circuits bool false no
shared_key circuits string “” no
connectivity_expressroute_global_reach_services
settings.networks.connectivity.express_route.global_reach
Name Description Type Default Required
name globalreach string ergr-sch-tst-ne-001 no
enabled globalreach bool false no
existing_peering_id1 globalreach string “” no
existing_peering_id2 globalreach string “” no
address_prefix globalreach string “” no
auth_key globalreach string “” no
connectivity_subnets_services
settings.networks.connectivity.subnets.gateway
Name Description Type Default Required
subnet subnet string gateway no
enabled subnet bool true (false if topology: “vwan” ) no
name subnet string GatewaySubnet no
address_prefixes subnet list(string) [“10.244.4.0/26”] no
deploy_route_table subnet bool true (false if topology: “vwan” ) no
deploy_service_endpoints subnet bool false no
deploy_network_security_group subnet bool false no
232/454
settings.networks.connectivity.subnets.bastion
Name Description Type Default Required
subnet subnet string bastion no
enabled subnet bool true no
name subnet string AzureBastionSubnet no
address_prefixes subnet list(string)
[“10.244.4.128/26”] ([“10.244.3.0/26”] if topology:
“vwan” ) no
deploy_route_table subnet bool false no
deploy_service_endpoints subnet bool false no
deploy_network_security_group subnet bool true no
settings.networks.connectivity.subnets.azurefirewall
Name Description Type Default Required
subnet subnet string azurefirewall no
enabled subnet bool true (false if topology: “vwan” ) no
name subnet string AzureFirewallSubnet no
address_prefixes subnet list(string) [“10.244.4.64/26”] no
deploy_route_table subnet bool true (false if topology: “vwan” ) no
deploy_service_endpoints subnet bool false no
deploy_network_security_group subnet bool false no
settings.networks.connectivity.subnets.nvalan
Name Description Type Default Required
subnet subnet string nvalan no
enabled subnet bool false no
name subnet string snet-nvalan-tst-ne-001 no
address_prefixes subnet list(string) [“10.244.5.0/27”] no
deploy_route_table subnet bool true (false if topology: “vwan” ) no
deploy_service_endpoints subnet bool false no
deploy_network_security_group subnet bool true no
settings.networks.connectivity.subnets.nvawan
Name Description Type Default Required
subnet subnet string nvawan no
enabled subnet bool false no
name subnet string snet-nvawan-tst-ne-001 no
address_prefixes subnet list(string) [“10.244.5.32/27”] no
deploy_route_table subnet bool true (false if topology: “vwan” ) no
deploy_service_endpoints subnet bool false no
deploy_network_security_group subnet bool true no
settings.networks.connectivity.subnets.nvamgmt
233/454
Name Description Type Default Required
subnet subnet string nvamgmt no
enabled subnet bool false no
name subnet string snet-nvamgmt-tst-ne-001 no
address_prefixes subnet list(string) [“10.244.5.64/27”] no
deploy_route_table subnet bool true (false if topology: “vwan” ) no
deploy_service_endpoints subnet bool false no
deploy_network_security_group subnet bool true no
connectivity_service_endpoints_services
settings.networks.connectivity.service_endpoints
Name Description Type Default Required
service service endpoints string Microsoft.AzureActiveDirectory no
service service endpoints string Microsoft.AzureCosmosDB no
service service endpoints string Microsoft.ContainerRegistry no
service service endpoints string Microsoft.EventHub no
service service endpoints string Microsoft.KeyVault no
service service endpoints string Microsoft.ServiceBus no
service service endpoints string Microsoft.Sql no
service service endpoints string Microsoft.Storage no
service service endpoints string Microsoft.Web no
connectivity_network_security_groups_services
settings.networks.connectivity.network_security_groups
Name Description Type Default Required
subnet network_security_groups string “REPLACE_ME_WITH_SUBNET_NAME” no
security_rules network_security_groups_rules list(object) [{}] no
connectivity_network_security_groups_rules_services
settings.networks.connectivity.network_security_groups.security_rules
234/454
Name Description Type Default Required
name network_security_groups string “” yes
priority network_security_groups number n/a yes
direction network_security_groups string “” yes
access network_security_groups string “” yes
protocol network_security_groups string “” yes
sourcePortRange network_security_groups string “” no
sourcePortRanges network_security_groups list(string) [“”] yes
destinationPortRange network_security_groups string “” no
destinationPortRanges network_security_groups list(string) [“”] yes
sourceAddressPrefixes network_security_groups list(string) [“”] no
sourceAddressPrefix network_security_groups string “” no
destinationAddressPrefix network_security_groups string “” no
source_application_security_group_ids network_security_groups list(string) [“”] no
description network_security_groups string “” no
connectivity_route_tables_services
settings.networks.connectivity.route_tables
Name Description Type Default Required
subnet route tables string “REPLACE_ME_WITH_SUBNET_NAME” no
disable_bgp_route_propagation route tables bool true no
routes route tables list(object) [{}] no
connectivity_route_tables_routes_services
settings.networks.connectivity.route_tables.routes
Name Description Type Default Required
name route tables string “REPLACE_ME_WITH_ROUTE_NAME” yes
address_prefix route tables string “” yes
next_hop_type route tables string string yes
next_hop_in_ip_address route tables string string yes
sharedservices_services
settings.networks.sharedservices
Name Description Type Default Required
config config list(object) [{}] yes
subnets subnets list(object) [{}] no
service_endpoints service_endpoints list(object) [{}] no
network_security_groups network_security_groups list(object) [{}] no
route_tables route_tables list(object) [{}] no
sharedservices_config_services
235/454
settings.networks.sharedservices.config
Name Description Type Default Required
address_space config list(string) [“10.222.4.0/22”] yes
enabled config bool true no
custom_dns_enabled config bool false no
custom_dns_ip_address config list(string)
[“10.222.4.196”,
“10.222.4.197”] no
azure_bastion_enabled bastion bool true no
sharedservices_subnets_services
settings.networks.sharedservices.subnets.connectionmonitor
Name Description Type Default Required
subnet subnet string connectionmonitor no
enabled subnet bool true no
name subnet string snet-monitor-tst-ne-001 no
address_prefixes subnet list(string) [“10.222.8.32/29”] no
deploy_route_table subnet bool true (false if topology: “vwan” ) no
deploy_service_endpoints subnet bool true no
deploy_network_security_group subnet bool true no
settings.networks.sharedservices.subnets.applicationgateway
Name Description Type Default Required
subnet subnet string applicationgateway no
enabled subnet bool true no
name subnet string ApplicationGatewaySubnet no
address_prefixes subnet list(string) [“10.222.8.128/26”] no
deploy_route_table subnet bool true no
deploy_service_endpoints subnet bool true no
deploy_network_security_group subnet bool true no
settings.networks.sharedservices.subnets.dnsprinbound
Name Description Type Default Required
subnet subnet string dnsprinbound no
enabled subnet bool false no
name subnet string snet-dnsprinbound-tst-ne-001 no
address_prefixes subnet list(string) [“10.222.10.0/25”] no
deploy_route_table subnet bool true (false if topology: “vwan” ) no
deploy_service_endpoints subnet bool false no
deploy_network_security_group subnet bool true no
settings.networks.sharedservices.subnets.dnsproutbound
236/454
Name Description Type Default Required
subnet subnet string dnsproutbound no
enabled subnet bool true no
name subnet string snet-dnsproutbound-tst-ne-001 no
address_prefixes subnet list(string) [“10.222.11.0/25”] no
deploy_route_table subnet bool true (false if topology: “vwan” ) no
deploy_service_endpoints subnet bool false no
deploy_network_security_group subnet bool true no
sharedservices_service_endpoints_services
settings.networks.sharedservices.service_endpoints
Name Description Type Default Required
service service endpoints string Microsoft.AzureActiveDirectory no
service service endpoints string Microsoft.AzureCosmosDB no
service service endpoints string Microsoft.ContainerRegistry no
service service endpoints string Microsoft.EventHub no
service service endpoints string Microsoft.KeyVault no
service service endpoints string Microsoft.ServiceBus no
service service endpoints string Microsoft.Sql no
service service endpoints string Microsoft.Storage no
service service endpoints string Microsoft.Web no
sharedservices_network_security_groups_services
settings.networks.sharedservices.network_security_groups
Name Description Type Default Required
subnet network_security_groups string “REPLACE_ME_WITH_SUBNET_NAME” no
security_rules network_security_groups_rules list(object) [{}] no
sharedservices_network_security_groups_rules_services
settings.networks.sharedservices.network_security_groups.security_rules
237/454
Name Description Type Default Required
name network_security_groups string “” yes
priority network_security_groups number n/a yes
direction network_security_groups string “” yes
access network_security_groups string “” yes
protocol network_security_groups string “” yes
sourcePortRange network_security_groups string “” no
sourcePortRanges network_security_groups list(string) [“”] yes
destinationPortRange network_security_groups string “” no
destinationPortRanges network_security_groups list(string) [“”] yes
sourceAddressPrefixes network_security_groups list(string) [“”] no
sourceAddressPrefix network_security_groups string “” no
destinationAddressPrefix network_security_groups string “” no
source_application_security_group_ids network_security_groups list(string) [“”] no
description network_security_groups string “” no
sharedservices_route_tables_services
settings.networks.sharedservices.route_tables
Name Description Type Default Required
subnet route tables string “REPLACE_ME_WITH_SUBNET_NAME” no
disable_bgp_route_propagation route tables bool true no
routes route tables list(object) [{}] no
sharedservices_route_tables_routes_services
settings.networks.sharedservices.route_tables.routes
Name Description Type Default Required
name route tables string “REPLACE_ME_WITH_ROUTE_NAME” yes
address_prefix route tables string “” yes
next_hop_type route tables string string yes
next_hop_in_ip_address route tables string string yes
identity_services
settings.networks.identity
Name Description Type Default Required
config identity list(object) [{}] yes
subnets subnets list(object) [{}] no
service_endpoints service_endpoints list(object) [{}] no
network_security_groups network_security_groups list(object) [{}] no
route_tables route_tables list(object) [{}] no
identity_config_services
238/454
settings.networks.identity.config
Name Description Type Default Required
address_space config list(string) [“10.222.12.0/24”] yes
enabled config bool true no
custom_dns_enabled config bool false no
custom_dns_ip_address config list(string)
[“10.222.4.196”,
“10.222.4.197”] no
whitelist_network_ranges config list(string) [“10.0.0.0/8”, “172.16.0.0/16”] no
azure_bastion_enabled bastion bool true no
identity_subnets_services
settings.networks.identity.subnets.dcs
Name Description Type Default Required
subnet subnet string dcs no
enabled subnet bool true no
name subnet string snet-dc-tst-ne-001 no
address_prefixes subnet list(string) [“10.222.12.0/26”] no
deploy_route_table subnet bool true (false if topology: “vwan” ) no
deploy_service_endpoints subnet bool false no
deploy_network_security_group subnet bool true no
identity_service_endpoints_services
settings.networks.identity.service_endpoints
Name Description Type Default Required
service service endpoints string Microsoft.AzureActiveDirectory no
service service endpoints string Microsoft.AzureCosmosDB no
service service endpoints string Microsoft.ContainerRegistry no
service service endpoints string Microsoft.EventHub no
service service endpoints string Microsoft.KeyVault no
service service endpoints string Microsoft.ServiceBus no
service service endpoints string Microsoft.Sql no
service service endpoints string Microsoft.Storage no
service service endpoints string Microsoft.Web no
identity_network_security_groups_services
settings.networks.identity.network_security_groups
Name Description Type Default Required
subnet network_security_groups string “REPLACE_ME_WITH_SUBNET_NAME” no
security_rules network_security_groups_rules list(object) [{}] no
identity_network_security_groups_rules_services
239/454
settings.networks.identity.network_security_groups.security_rules
Name Description Type Default Required
name network_security_groups string “” yes
priority network_security_groups number n/a yes
direction network_security_groups string “” yes
access network_security_groups string “” yes
protocol network_security_groups string “” yes
sourcePortRange network_security_groups string “” no
sourcePortRanges network_security_groups list(string) [“”] yes
destinationPortRange network_security_groups string “” no
destinationPortRanges network_security_groups list(string) [“”] yes
sourceAddressPrefixes network_security_groups list(string) [“”] no
sourceAddressPrefix network_security_groups string “” no
destinationAddressPrefix network_security_groups string “” no
source_application_security_group_ids network_security_groups list(string) [“”] no
description network_security_groups string “” no
identity_route_tables_services
settings.networks.identity.route_tables
Name Description Type Default Required
subnet route tables string “REPLACE_ME_WITH_SUBNET_NAME” no
disable_bgp_route_propagation route tables bool true no
routes route tables list(object) [{}] no
identity_route_tables_routes_services
settings.networks.identity.route_tables.routes
Name Description Type Default Required
name route tables string “REPLACE_ME_WITH_ROUTE_NAME” yes
address_prefix route tables string “” yes
next_hop_type route tables string string yes
next_hop_in_ip_address route tables string string yes
last applied configuration
TEMP Comment: Leave as is for now, will be used later to dynamically update with customer specific config.
input descriptions
The comments #madatory means that the parameter is always required for the resource to be created if parametrised
deployment is used. If the default deployment is used, the most parameters can be left as is (marked), as the default values
are provided.
append_tags
240/454
Additional tags to be applied to the resources along with globally defined tags. Common for all resources in this blueprint
networks
Example of the hubspoke network default deployment:
Example of the vwan network default deployment:
networks_enabled
If true, new Hub will be deployed in dedicated location. ##### topology The topology of the network. Possible values are
hubspoke and vwan. ##### vwan_is_main_region if true, and topology is vwan then the vhub will be deployed in the
current region. if false, the vhub will be deployed in the selected vwan resource group. ##### vwan_name The name of the
existing/new vwan name. ##### vwan_resource_group_name The name of the existing vwan resource group where new
hub will be deployed. ##### instance The instance number of the network. The number must be unique for each of location
and contains 3 digits. ##### location The location of the network. ##### location_short The short name of the location of
the network. ##### base_network_prefix The base network prefix of the network.
connectivity
The connectivity module of the network with the submodules below. ##### connectivity_config Example of the config
parametrised deployment (mark/unmarked fields if needed):
settings:
networks:
- enabled: true #mandatory
topology: "hubspoke" #mandatory
instance: "instance_001" #mandatory
location: "westeurope" #mandatory
location_short: "we" #mandatory
base_network_prefix: ["10.222.0.0/16"] #mandatory
connectivity: #mandatory
config: #mandatory
- address_space: ["10.222.4.0/22"] #mandatory
settings:
networks:
- enabled: true #mandatory
topology: "vwan" #mandatory
vwan_is_main_region: true #mandatory
vwan_name: "vwan-sch-tst-we-001" #mandatory
vwan_resource_group_name: "rg-sch-tst-we-001" #mandatory
instance: "instance_001" #mandatory
location: "westeurope" #mandatory
location_short: "we" #mandatory
base_network_prefix: ["10.222.0.0/16"] #mandatory
connectivity: #mandatory
config: #mandatory
- address_space: ["10.222.4.0/22"] #mandatory
config: #mandatory
- address_space: ["10.222.4.0/22"] #mandatory
custom_dns_enabled: true
custom_dns_ip_address: ["10.222.4.19", "10.222.4.20"]
241/454
The connectivity config module of the network contains settings below: ###### connectivity_config_address_space The
address space prefix of the connectivity configuration. ###### connectivity_config_custom_dns_enabled If
connectivity_config_custom_dns_enabled = true and custom_dns_ip_address are provided, the Virtual Network will be
created with the custom DNS servers If connectivity_config_custom_dns_enabled = true and custom_dns_ip_address are
not provided, the Virtual Network will be created with the default DNS servers which is Azure firewall If false, Virtual
Network will be created with the default DNS servers which is Azure firewall and identity_config_custom_dns_ip_address
is ignored. The default Ip of Azure firewall for hubspoke topology is x.x.x.68 and for vwan topology is x.x.x.4 ######
connectivity_config_custom_dns_ip_address The custom DNS IP address of the connectivity configuration. Activated only
if custom_dns_enabled is true.
connectivity_bastion
Example of the bastion parametrised deployment (mark/unmarked fields if needed):
The connectivity bastion module of the network contains settings below: ###### connectivity_bastion_enabled If true,
Azure Bastion will be deployed in the subnet. If topology is vwan then the bastion will be deployed in the rg-schbastion-ne-001. ###### connectivity_bastion_sku The sku of the Azure Bastion. Possible values are Standard and Basic.
###### connectivity_bastion_scaleunits The scale units of the Azure Bastion. ######
connectivity_bastion_copy_paste_enabled If true, copy paste will be enabled in the Azure Bastion. ######
connectivity_bastion_file_copy_enabled If true, file copy will be enabled in the Azure Bastion. ######
connectivity_bastion_ip_connect_enabled If true, IP connect will be enabled in the Azure Bastion. ######
connectivity_bastion_tunneling_enabled If true, tunneling will be enabled in the Azure Bastion.
connectivity_multi_region_hub_peering
If section multi_region_hub_peering is used then all parameters must be defined like below :
Example of the multi-region parametrised deployment(mark/unmarked fields if needed):
azure_bastion: #mandatory
- enabled: false #mandatory
sku: "Standard"
scaleUnits: 2
copy_paste_enabled: false
file_copy_enabled: false
ip_connect_enabled: false
tunneling_enabled: false
multi_region_hub_peering: #mandatory
- vnet_id: "/subscriptions/1111ce11-1111-1111-111b-d1111111111/resourceGroups/rg-schnetwork-tst-ci-005/providers/Microsoft.Network/virtualNetworks/vnet-sch-hub-tst-ci-005"
#mandatory
use_remote_gateways: false #mandatory
allow_gateway_transit: true #mandatory
allow_forwarded_traffic: true #mandatory
allow_virtual_network_access: true #mandatory
remote_location_short: "we" #mandatory
remote_instance: "instance_005" #mandatory
242/454
The connectivity mulit region module of the network contains settings below: ######
connectivity_multi_region_hub_peering_vnet_id The vnet id of the remote hub. ######
connectivity_multi_region_hub_peering_use_remote_gateways The use remote gateways of the multi region hub peering.
Applicable only for HubSpoke. ###### connectivity_multi_region_hub_peering_allow_gateway_transit If true, the
gateway transit will be allowed in the multi region hub peering. Applicable only for HubSpoke. ######
connectivity_multi_region_hub_peering_allow_forwarded_traffic If true, the forwarded traffic will be allowed in the multi
region hub peering. Applicable only for HubSpoke. ######
connectivity_multi_region_hub_peering_allow_virtual_network_access If true, the virtual network access will be allowed
in the multi region hub peering. Applicable only for HubSpoke. ######
connectivity_multi_region_hub_peering_remote_location_short The remote location short of peered hub. ######
connectivity_multi_region_hub_peering_remote_instance The remote instance of peered hub.
connectivity_vpn
Example of the vpn parametrised deployment (mark/unmarked fields if needed):
connectivity_vpn_enabled
If true, the vpn will be enabled. ###### connectivity_vpn_network_gateway_sku The network gateway sku of the vpn.
###### connectivity_vpn_vpn_type The vpn type of the vpn. Possible values are RouteBased and PolicyBased. ######
connectivity_vpn_active_active If true, the active active will be enabled in the vpn. ######
connectivity_vpn_vpn_gateway_generation The vpn gateway generation of the vpn. Possible values are Generation1 and
Generation2. ###### connectivity_vpn_gateway_public_ip_name1 The first gateway public ip name of the vpn. By
default will be generated automatically. ###### connectivity_vpn_gateway_public_ip_name2 The second gateway public
ip name of the vpn. By default will be generated automatically. ###### connectivity_vpn_availability_zones The
availability zones of the vpn. ###### connectivity_vpn_enable_bgp If true, the BGP will be enabled in the vpn. ######
connectivity_vpn_bgp_settings Example of the vpn BGP parametrised deployment(similar for expressroute)
(mark/unmarked fields if needed):
The BGP settings of the vpn with the settings below. ####### connectivity_vpn_connections_bgp_settings_asn The ASN
of the BGP settings. ####### connectivity_vpn_connections_bgp_settings_peer_weight The peer weight of the BGP
settings. ####### connectivity_vpn_connections_bgp_settings_ip_configuration_name The IP configuration name of the
BGP settings. ####### connectivity_vpn_connections_bgp_settings_apipa_addresses The APIPA addresses of the BGP
settings. ###### connectivity_vpn_connections Example of the vpn connections custom (mark/unmarked fields if needed) :
vpn: #mandatory
- enabled: true #mandatory
network_gateway_sku: "VpnGw2AZ"
vpn_type: "RouteBased"
active_active: false
vpn_gateway_generation: "Generation2"
gateway_public_ip_name1: "pip-vgw-sch-tst-we-001"
gateway_public_ip_name2: "pip-vgw-sch-tst-we-002"
availability_zones: ["1", "2", "3"]
enable_bgp: false
bgp_settings: #mandatory
- asn: 11 #mandatory
peer_weight: 2
peering_addresses:
- ip_configuration_name: "vpnGatewayConfig1"
apipa_addresses: ["169.254.21.3"]
connections: #mandatory
- name: "cn-sch-tst-we-001" #mandatory
local_network_gateways_name : "lgw-sch-tst-we-001"
type: "IPsec"
protocol: "IKEv2"
243/454
The BGP settings of the vpn with the settings below: ###### connectivity_vpn_connections_name The name of the
connections. ###### connectivity_vpn_connections_local_network_gateways_name The local network gateways name of
the connections. ###### connectivity_vpn_connections_type The type of the connections. Possible values are IPsec and
Vnet2Vnet. ###### connectivity_vpn_connections_protocol The protocol of the connections. Possible values are IKEv2
and IKEv1. ###### connectivity_vpn_connections_mode The mode of the connections. Possible values are Default and
HighPerformance. ###### connectivity_vpn_connections_routing_weight The routing weight of the connections. ######
connectivity_vpn_connections_use_policy_based_traffic_selectors If true, the policy based traffic selectors will be used in
the connections. ###### connectivity_vpn_connections_enable_bgp If true, the BGP will be enabled in the connections.
###### connectivity_vpn_connections_vpn_ipsec_policies Example of the vpn connections custom (mark/unmarked fields
if needed) :
The vpn IPsec policies of the connections with the settings below: #######
connectivity_vpn_connections_vpn_sa_life_time_seconds The SA life time seconds of the vpn IPsec policies. #######
connectivity_vpn_connections_vpn_sa_data_size_kilobytes The SA data size kilobytes of the vpn IPsec policies. #######
connectivity_vpn_connections_vpn_ipsec_encryption The IPsec encryption of the vpn IPsec policies. #######
connectivity_vpn_connections_vpn_ipsec_integrity The IPsec integrity of the vpn IPsec policies. #######
connectivity_vpn_connections_vpn_ike_encryption The IKE encryption of the vpn IPsec policies. #######
connectivity_vpn_connections_vpn_ike_integrity The IKE integrity of the vpn IPsec policies. #######
connectivity_vpn_connections_vpn_dh_group The DH group of the vpn IPsec policies. #######
connectivity_vpn_connections_vpn_pfs_group The PFS group of the vpn IPsec policies. ######
connectivity_vpn_local_network_gateways Example of the vpn local network gateways custom (mark/unmarked fields if
needed) :
mode: "Default"
routing_weight: 0
use_policy_based_traffic_selectors: true
enable_bgp: false
vpn_ipsec_policies: #mandatory
- sa_life_time_seconds: 27000 #mandatory
sa_data_size_kilobytes: 102400000
ipsec_encryption: "AES256"
ipsec_integrity: "SHA256"
ike_encryption: "AES256"
ike_integrity: "SHA1"
dh_group: "DHGroup2"
pfs_group: "None"
local_network_gateways: #mandatory
- name: "lgw-sch-tst-we-001" #mandatory
gateway_ip_address: "185.116.30.44"
address_space:
[
"10.255.0.0/16",
"10.220.0.0/16",
"10.241.32.0/19",
"10.243.0.0/16",
]
244/454
The local network gateways of the vpn with the settings below. ####### connectivity_vpn_local_network_gateways_name
The name of the local network gateways. ####### connectivity_vpn_local_network_gateways_gateway_ip_address The
gateway IP address of the local network gateways. ####### connectivity_vpn_local_network_gateways_address_space
The address space of the local network gateways. ####### connectivity_vpn_local_network_gateways_bgp_settings The
BGP settings of the local network gateways with the settings below. #######
connectivity_vpn_local_network_gateways_bgp_settings_asn The ASN of the BGP settings of the local network gateways.
####### connectivity_vpn_local_network_gateways_bgp_settings_peer_weight The peer weight of the BGP settings of the
local network gateways. ####### connectivity_vpn_local_network_gateways_bgp_settings_bgp_peering_address The
BGP peering address of the BGP settings of the local network gateways. ###### connectivity_vpn_vpn_sites Example of
the vpn sites (vWAN) custom (mark/unmarked fields if needed) :
The vpn sites of the vpn with the submodules with the settings below. The vWAN topology only. #######
connectivity_vpn_vpn_sites_name The name of the vpn sites. ####### connectivity_vpn_vpn_sites_name_device_vendor
The device vendor of the vpn sites. ####### connectivity_vpn_vpn_sites_name_enable_bgp If true, the BGP will be
enabled in the vpn sites. ####### connectivity_vpn_vpn_sites_name_address_prefix The address prefix of the vpn sites.
###### connectivity_vpn_vpn_sites_name_links Example of the vpn sites link(vWAN) custom (mark/unmarked fields if
needed) :
vpn_sites: #mandatory
- name: "cn-nc-dev-we-001" #mandatory
device_vendor: "vendor"
enable_bgp: true
address_prefix: ["192.168.1.0/24"]
links: #mandatory
- name: "link1" #mandatory
ip_address: "192.168.1.6"
provider_name: "provider"
link_speed: 50
bgp_properties:
- asn: 11
bgp_peering_address: "10.1.1.0"
245/454
The links of the vpn sites with the settings below. The vWAN topology only. #######
connectivity_vpn_vpn_sites_name_links_name The name of the links. #######
connectivity_vpn_vpn_sites_name_links_ip_address The IP address of the links. Usually the first public IP address shown
under the (VPN Gateway) virtual network gateway properties or the public IP address of the VPN device. #######
connectivity_vpn_vpn_sites_name_links_provider_name The provider name of the links. #######
connectivity_vpn_vpn_sites_name_links_link_speed The link speed of the links. #######
connectivity_vpn_vpn_sites_name_links_bgp_properties The BGP properties of the links with the settings below. #######
connectivity_vpn_vpn_sites_name_links_bgp_properties_asn The ASN of the BGP properties of the links. #######
connectivity_vpn_vpn_sites_name_links_bgp_properties_bgp_peering_address The BGP peering address of the BGP
properties of the links. The address spaces that you’re going to advertise from the virtual network gateway side. Make sure
that the ranges you specify here don’t overlap with ranges of other networks that you want to connect to. ######
connectivity_vpn_vpn_sites_name_links_vpn_ipsec_policies The vpn IPsec policies of the links with the settings below.
####### connectivity_vpn_vpn_sites_name_links_vpn_ipsec_policies_sa_life_time_seconds The SA life time seconds of
the vpn IPsec policies. ####### connectivity_vpn_vpn_sites_name_links_vpn_ipsec_policies_sa_data_size_kilobytes The
SA data size kilobytes of the vpn IPsec policies. #######
connectivity_vpn_vpn_sites_name_links_vpn_ipsec_policies_ipsec_encryption The IPsec encryption of the vpn IPsec
policies. ####### connectivity_vpn_vpn_sites_name_links_vpn_ipsec_policies_ipsec_integrity The IPsec integrity of the
vpn IPsec policies. ####### connectivity_vpn_vpn_sites_name_links_vpn_ipsec_policies_ike_encryption The IKE
encryption of the vpn IPsec policies. ####### connectivity_vpn_vpn_sites_name_links_vpn_ipsec_policies_ike_integrity
The IKE integrity of the vpn IPsec policies. #######
connectivity_vpn_vpn_sites_name_links_vpn_ipsec_policies_dh_group The DH group of the vpn IPsec policies. #######
connectivity_vpn_vpn_sites_name_links_vpn_ipsec_policies_pfs_group The PFS group of the vpn IPsec policies.
connectivity_expressroute
Example of the expressroute custom (mark/unmarked fields if needed) :
The connectivity expressroute module of the network contains settings below: ###### connectivity_expressroute_enabled
If true, the Express Route will be enabled. ###### connectivity_expressroute_network_gateway_sku The network gateway
sku of the Express Route. ###### connectivity_expressroute_vpn_type The vpn type of the Express Route. Possible values
are RouteBased and PolicyBased. ###### connectivity_expressroute_pip_sku The PIP sku of the Express Route. Possible
values are Standard and Basic. ###### connectivity_expressroute_gateway_public_ip_name1 The gateway public ip name
of the Express Route. By default the name will be generated automatically. ######
connectivity_expressroute_availability_zones The availability zones of the Express Route. ######
connectivity_expressroute_enable_bgp If true, the BGP will be enabled in the Express Route. ######
connectivity_expressroute_bgp_settings The BGP settings of the Express Route with the settings below: #######
connectivity_expressroute_bgp_settings_asn The ASN of the BGP settings of the Express Route. #######
connectivity_expressroute_bgp_settings_peer_weight The peer weight of the BGP settings of the Express Route. #######
connectivity_expressroute_bgp_settings_ip_configuration_name The IP configuration name of the BGP settings of the
Express Route. ####### connectivity_expressroute_bgp_settings_apipa_addresses The APIPA addresses of the BGP
settings of the Express Route. ###### connectivity_expressroute_circuits Example of the expressroute custom
(mark/unmarked fields if needed) :
express_route: #mandatory
- enabled: true #mandatory
network_gateway_sku: "ErGw3AZ"
vpn_type: "PolicyBased"
pip_sku: "Standard"
gateway_public_ip_name1: "pip-vgw-sch-tst-we-001"
availability_zones: ["1", "2", "3"]
enable_bgp: false
circuit: #mandatory
246/454
The circuits of the Express Route with the settings below: ####### connectivity_expressroute_circuits_circuit_name The
circuit name of the circuits. ####### connectivity_expressroute_circuits_connection_name The connection name of the
circuits. ####### connectivity_expressroute_circuits_provisioned If false, the expressroute circuit has not been yet
created and/or provisioned. If true, the expressroute circuit has been already provisioned and the peering connection will
be created. ####### connectivity_expressroute_circuits_existing_circuit_id The existing circuit id of the circuits. A new
expressroute circuit will not be deploy and the existing circuit will be used instead. #######
connectivity_expressroute_circuits_authorization_key Authorisation key allowing to peer with existing expressroute
circuit. For new expressroute circuit default value might be used as it’s going to be skipped. #######
connectivity_expressroute_circuits_sku_name The sku name of the circuits. #######
connectivity_expressroute_circuits_sku_tier The sku tier of the circuits. #######
connectivity_expressroute_circuits_sku_family The sku family of the circuits. #######
connectivity_expressroute_circuits_provider_name The provider name of the circuits. #######
connectivity_expressroute_circuits_peering_location The peering location of the circuits. #######
connectivity_expressroute_circuits_bandwidth The bandwidth of the circuits in Mbps. #######
connectivity_expressroute_circuits_peer_asn The peer ASN of the circuits. #######
connectivity_expressroute_circuits_use_policy_based_traffic_selectors If true, the policy based traffic selectors will be
used in the circuits. ####### connectivity_expressroute_circuits_express_route_gateway_bypass If true, the Express Route
gateway bypass will be enabled in the circuits. ####### connectivity_expressroute_circuits_primary_peer_address_prefix
The primary peer address prefix of the circuits. #######
connectivity_expressroute_circuits_secondary_peer_address_prefix The secondary peer address prefix of the circuits.
####### connectivity_expressroute_circuits_vlan_id The VLAN ID of the circuits. #######
connectivity_expressroute_circuits_enable_internet_security If true, the internet security will be enabled in the circuits.
####### connectivity_expressroute_circuits_shared_key The shared key of the circuits. If false, the shared key for
expressroute circuit peerings will not be set, if set to true, the shared key will be generated as new secret from key vault.
connectivity_expressroute_global_reach
Example of the globalreach custom (mark/unmarked fields if needed) :
- circuit_name: "erc-nc-dev-we-001" #mandatory
connection_name: "cn-ergw-sch-tst-we-001"
provisioned: true
existing_circuit_id: "/subscriptions/1111ce11-1111-1111-111bd1111111111/resourceGroups/rg-sch-network-tst-ci005/providers/Microsoft.Network/expressRoutecircuits/erc-sch-tst-we-001"
authorization_key: "cd8fa55f-7dbe-4e5a-a386-c76b1cd63077"
sku_name: "Standard_MeteredData"
sku_tier: "Standard"
sku_family: "MeteredData"
provider_name: "Equinix"
peering_location: "Amsterdam"
bandwidth: 50
peer_asn: 111
use_policy_based_traffic_selectors: false
express_route_gateway_bypass: false
primary_peer_address_prefix: "10.0.0.0/30"
secondary_peer_address_prefix: "10.0.1.0/30"
vlan_id: 123
enable_internet_security: false
shared_key: true
global_reach: #mandatory
- name: "ergr-sch-tst-we-001" #mandatory
enabled: false #mandatory
existing_peering_id1: "/subscriptions/1111ce11-1111-1111-111bd1111111111/resourceGroups/rg-sch-network-tst-we001/providers/Microsoft.Network/expressRoutecircuits/erc-sch-tst-we-001" #mandatory
247/454
The global reach of the Express Route with the settings below: ####### connectivity_expressroute_global_reach_name
The name of the global reach. ####### connectivity_expressroute_global_reach_enabled If true, the global reach will be
enabled. ####### connectivity_expressroute_global_reach_existing_circuit_id1 Resource Id of existing expressroute
circuit.The existing expressroute circuit ID must have status provisioned. #######
connectivity_expressroute_global_reach_existing_circuit_id2 Resource Id of existing expressroute circuit.The existing
expressroute circuit ID must have status provisioned. ####### connectivity_expressroute_global_reach_address_prefix
Primary address prefix. ####### connectivity_expressroute_global_reach_auth_key Authorisation key allowing to peer
with existing expressroute circuit. Required only if existingcircuitId2 is from different subscription.
subnets
Example of the default subnet parametrised deployment(mark/unmarked fields if needed) :
Example of the not dafault subnet parametrised deployment (mark/unmarked fields if needed) :
subnets_subnet
The unique property of subnet name for the Network interfaces. Used as part of subnet, route table names, network security
group names, etc. ###### subnets_enabled If true, the subnet will be enabled. ###### subnets_name The name of the
subnet. ###### subnets_address_prefixes The address prefixes of the subnet. ###### subnets_deploy_route_table If true,
the route table will be deployed in the subnet. If true for custom subnet, route table must be defined in section route_tables.
###### subnets_deploy_service_endpoints If true, the service endpoints will be deployed in the subnet. The service
endpoints are defined globally for all subnets in dedicated section service_endpoints. ######
subnets_deploy_network_security_group If true, the network security group will be deployed in the subnet. If true for
custom subnet, network security group must be defined in section network_security_groups.
service_endpoints
Example of the service_endpoints parametrised deployment (mark/unmarked fields if needed) :
existing_peering_id2: /subscriptions/1111ce11-1111-1111-111bd1111111111/resourceGroups/rg-sch-network-tst-ci002/providers/Microsoft.Network/expressRoutecircuits/erc-sch-tst-ci-002" #mandatory
address_prefix: "10.10.0.0/24" #mandatory
auth_key: "cd8fa55f-7dbe-4e5a-a386-c76b1cd63077" #mandatory
subnets: #mandatory
- subnet: gateway #mandatory
enabled: true
name: "GatewaySubnet"
address_prefixes: ["10.222.6.0/26"]
deploy_route_table: false
deploy_service_endpoints: false
deploy_network_security_group: false
subnets: #mandatory
- subnet: test #mandatory
enabled: true #mandatory
name: "testowySubnet" #mandatory
address_prefixes: ["10.222.6.0/26"] #mandatory
deploy_route_table: true #mandatory, if true, route table must be
defined in section route_tables
deploy_service_endpoints: true #mandatory
deploy_network_security_group: true #mandatory, if true, network security group
must be defined in section network_security_groups
service_endpoints: #mandatory
- service: Microsoft.AzureActiveDirectory #at least one service is required
- service: Microsoft.AzureCosmosDB
- service: Microsoft.ContainerRegistry
- service: Microsoft.EventHub
248/454
service_endpoints_service
The service endpoints of the service endpoints. The values can be applied to the all subnets in the dedicated subscription.
network_security_groups
Example of the custom nsg parametrised deployment (mark/unmarked fields if needed) :
network_security_groups_subnet
The unique property of subnet name for the Network interfaces. ###### network_security_groups_security_rules The
security rules of the network security groups.
route_tables
Example of the custom route parametrised deployment (mark/unmarked fields if needed) :
route_tables_subnet
The unique property of subnet name for the Network interfaces. ###### route_tables_disable_bgp_route_propagation If
true, the BGP route propagation will be disabled in the route tables. ###### route_tables_routes The routes of the route
tables.
sharedservices
Example of the sharedservices custom (mark/unmarked fields if needed) :
- service: Microsoft.KeyVault
- service: Microsoft.ServiceBus
- service: Microsoft.Sql
- service: Microsoft.Storage
- service: Microsoft.Web
network_security_groups: #mandatory
- subnet: test #mandatory
security_rules: #mandatory
- name: "in-allow-traffic" #mandatory
protocol: "*" #mandatory
sourcePortRange: "*" #mandatory
destinationPortRanges: ["49152-65535", "53"] #mandatory
sourceAddressPrefixes: ["172.16.0.0/16", "10.0.0.0/8"] #mandatory
destinationAddressPrefixes: ["10.222.12.0/26"] #mandatory
access: "Allow" #mandatory
priority: 110 #mandatory
direction: "Inbound" #mandatory
description: "Default allow rule" #mandatory
route_tables: #mandatory
- subnet: test #mandatory
disable_bgp_route_propagation: true #mandatory
routes: #mandatory
- name: "default-route-internet" #mandatory
address_prefix: "0.0.0.0/0" #mandatory
next_hop_type : "VirtualAppliance" #mandatory
next_hop_in_ip_address : "10.10.10.1" #mandatory
sharedservices: #mandatory
config: #mandatory
- address_space: ["10.244.8.0/22"] #mandatory
enabled: true
custom_dns_enabled: true
custom_dns_ip_address: ["10.244.4.196", "10.244.4.197"]
azure_bastion_enabled: true
249/454
The shared services module of the network with the submodules below: ##### sharedservices_config The connectivity
configuration with the settings below: ###### sharedservices_config_address_space The address space prefix of the
connectivity configuration. ###### sharedservices_config_enabled If true, Azure Virtual Network with the predefined
subnets, route tables, NSGs for the shared services will be deployed. ###### sharedservices_config_custom_dns_enabled
If sharedservices_config_custom_dns_enabled = true and custom_dns_ip_address are provided, the Virtual Network will
be created with the custom DNS servers If sharedservices_config_custom_dns_enabled = true and custom_dns_ip_address
are not provided, the Virtual Network will be created with the default DNS servers which is Azure firewall If false, Virtual
Network will be created with the default DNS servers which is Azure firewall and identity_config_custom_dns_ip_address
is ignored. The default Ip of Azure firewall for hubspoke topology is x.x.x.68 and for vwan topology is x.x.x.4 ######
sharedservices_config_custom_dns_ip_address The custom DNS IP address of the sharedservices configuration. Activated
only if custom_dns_enabled is true. ###### sharedservices_config_azure_bastion_enabled If true, Azure Bastion NSG
rules will be added to the shared services subnets.
identity
Example of the identity parametrised deployment (mark/unmarked fields if needed) :
identity_config
The connectivity configuration with the settings below: ###### identity_config_address_space The address space prefix of
the connectivity configuration. ###### identity_config_enabled If true, Azure Virtual Network with the predefined
subnets, route tables, NSGs for the identity services will be deployed. ###### identity_config_custom_dns_enabled If
identity_config_custom_dns_enabled = true and custom_dns_ip_address are provided, the Virtual Network will be created
with the custom DNS servers If identity_config_custom_dns_enabled = true and custom_dns_ip_address are not provided,
the Virtual Network will be created with the default DNS servers which is Azure firewall If false, Virtual Network will be
created with the default DNS servers which is Azure firewall and identity_config_custom_dns_ip_address is ignored. The
default Ip of Azure firewall for hubspoke topology is x.x.x.68 and for vwan topology is x.x.x.4 ######
identity_config_custom_dns_ip_address The custom DNS IP address of the identity configuration. Activated only if
custom_dns_enabled is true. ###### identity_config_whitelist_network_ranges The whitelist network ranges of the
connectivity configuration. ###### identity_config_azure_bastion_enabled If true, Azure Bastion NSG rules will be added
to the identity subnets.
keyvault
key_vault_short_name
identity: #mandatory
config: #mandatory
- address_space: ["10.244.8.0/22"] #mandatory
enabled: true
custom_dns_enabled: true
whitelist_network_ranges: ["10.0.0.0/8", "172.16.0.0/16"]
azure_bastion_enabled: true
250/454
The short name of the key vault. ##### key_vault_kek_expiry_days The key vault kek expiry days. #####
key_vault_enable_purge_protection If true, protection against purge is enabled for this vault. The setting is effective only
if soft delete is also enabled. Enabling this functionality is irreversible - that is, the property does not accept false as its
value. ##### key_vault_enabled_for_deployment If true, Azure Virtual Machines are permitted to retrieve certificates
stored as secrets from the key vault. ##### key_vault_enabled_for_template_deployment If true, Azure Resource Manager is permitted to retrieve secrets from the key vault. ##### key_vault_enabled_for_disk_encryption If true, Azure
Disk Encryption is permitted to retrieve secrets from the vault and unwrap keys. #####
key_vault_enable_rbac_authorization If true, the key vault will use Role Based Access Control (RBAC) for authorization
of data actions, and the access policies specified in vault properties will be ignored. ##### key_vault_key_vault_sku Key
Vault SKU name to specify whether the key vault is a standard vault or a premium vault. ##### key_vault_permissions
Rights should be specified here if enableRbacAuthorization is set to true. An array of 0 to 1024 identities that have access
to the key vault. All identities in the array must use the same tenant ID as the key vault’s tenant ID. #####
key_vault_network_acls_default_action The default action of the network ACLs. Possible values are Allow and Deny.
##### key_vault_network_acls_virtual_network_rules The virtual network rules of the network ACLs. #####
key_vault_network_acls_ip_rules The IP rules of the network ACLs. ##### key_vault_access_policies Rights should be
specified here if enableRbacAuthorization is set to false. An array of 0 to 1024 identities that have access to the key vault.
All identities in the array must use the same tenant ID as the key vault’s tenant ID. #####
key_vault_key_vault_network_acls_bypass The bypass of the network ACLs. Possible values are AzureServices and None.
outputs
Since state sharing is not recommended due to security the outputs are important if any resources need to be referenced
network
251/454
Name Description
location location name
instance instance number
selected_topology topology type
subnet_wo_rt_not_scope subnet bastion, application gateway id
er_gw_not_scope express route
vpn_gw_not_scope virtual private network
default_route_internet_not_scope default internet route table
hub_vnet_resource_ids hub vnet id
hub_resource_group_ids hub rouource group id
vhub_resource_ids virtual hub id
sharedservices_vnet_resource_ids shared services vnet id
identity_vnet_resource_ids identity vnet id
firewall_subnet_cidr firewall subnet cidr
firewall_subnet_ids firewall subnet id
subnet_wo_nsg_not_scope subnet application gateway, firewall, gateway id
pip_not_scope public ip id
applicationgateway_subnet subnet application gateway id
applicationgateway_subnet_cidr subnet application gateway cidr
connectionmonitor_subnet subnet connection monitor id
bastion_subnet_cidr subnet bastion cidr
dns_resolver_inbound_subnet_cidr subnet dns resolver inboynd cidr
dns_resolver_outbound_subnet_cidr subnet dns resolver outband cidr
shared_services_vnet_prefix sharedservices vnet prefix
dns_server_address dns server vnet prefix
base_network_prefixes
Name Description
location location name
location_short location shart name
base_network_prefix base network prefix
output descriptions
Example of output description for each hub
Outputs:
base_network_prefixes = {
instance_001-westeurope = {
base_network_prefix = [
"10.222.0.0/16",
]
location = "westeurope"
location_short = "we"
}
}
network = {
network = {
252/454
instance_001-westeurope = {
applicationgateway_subnet = [
"/subscriptions/11b11c11-111e-45f3-a012-204ce5618821/resourceGroups/rg-nc-networkdev-we-001/providers/Microsoft.Network/virtualNetworks/vnet-nc-sharedservices-dev-we001/subnets/ApplicationGatewaySubnet",
]
applicationgateway_subnet_cidr = [
"10.222.8.128/26",
]
bastion_subnet_cidr = [
"10.222.4.128/26",
]
connectionmonitor_subnet = [
"/subscriptions/11b11c11-111e-45f3-a012-204ce5618821/resourceGroups/rg-nc-networkdev-we-001/providers/Microsoft.Network/virtualNetworks/vnet-nc-sharedservices-dev-we001/subnets/snet-monitor-dev-we-001",
]
default_route_internet_not_scope = [
"/subscriptions/11b11c11-111e-4144-935b-d78ecf566f0e/resourceGroups/rg-nc-networkdev-we-001",
"/subscriptions/11b11c11-111e-45f3-a012-204ce5618821/resourceGroups/rg-nc-networkdev-we-001/providers/Microsoft.Network/routeTables/route-ApplicationGatewaySubnet",
]
dns_resolver_inbound_subnet_cidr = []
dns_resolver_outbound_subnet_cidr = [
"10.222.11.0/25",
]
dns_server_address = [
"10.222.4.68",
]
firewall_subnet_cidr = [
"10.222.4.64/26",
]
firewall_subnet_ids = [
"/subscriptions/11b11c11-111e-4144-935b-d78ecf566f0e/resourceGroups/rg-nc-networkdev-we-001/providers/Microsoft.Network/virtualNetworks/vnet-nc-hub-dev-we001/subnets/AzureFirewallSubnet",
]
hub_resource_group_ids = [
"/subscriptions/11b11c11-111e-4144-935b-d78ecf566f0e/resourceGroups/rg-nc-networkdev-we-001",
]
hub_vnet_resource_ids = [
"/subscriptions/11b11c11-111e-4144-935b-d78ecf566f0e/resourceGroups/rg-nc-networkdev-we-001/providers/Microsoft.Network/virtualNetworks/vnet-nc-hub-dev-we-001",
]
identity_vnet_resource_ids = [
"/subscriptions/11b11c11-111e-4901-ac54-7c321354ee2e/resourceGroups/rg-nc-networkdev-we-001/providers/Microsoft.Network/virtualNetworks/vnet-nc-dc-dev-we-001",
]
pip_not_scope = [
"/subscriptions/11b11c11-111e-4144-935b-d78ecf566f0e/resourceGroups/rg-nc-networkdev-we-001/providers/Microsoft.Network/publicIPAddresses/pip-vgw-nc-dev-we-001",
"/subscriptions/11b11c11-111e-4144-935b-d78ecf566f0e/resourceGroups/rg-nc-networkdev-we-001/providers/Microsoft.Network/publicIPAddresses/pip-vgw-nc-dev-we-002",
]
shared_services_vnet_prefix = [
"10.222.8.0/22",
]
sharedservices_vnet_resource_ids = [
"/subscriptions/11b11c11-111e-45f3-a012-204ce5618821/resourceGroups/rg-nc-networkdev-we-001/providers/Microsoft.Network/virtualNetworks/vnet-nc-sharedservices-dev-we-001",
]
subnet_wo_nsg_not_scope = [
"/subscriptions/11b11c11-111e-45f3-a012-204ce5618821/resourceGroups/rg-nc-networkdev-we-001/providers/Microsoft.Network/virtualNetworks/vnet-nc-sharedservices-dev-we001/subnets/ApplicationGatewaySubnet",
"/subscriptions/11b11c11-111e-4144-935b-d78ecf566f0e/resourceGroups/rg-nc-networkdev-we-001/providers/Microsoft.Network/virtualNetworks/vnet-nc-hub-dev-we001/subnets/AzureFirewallSubnet",
"/subscriptions/11b11c11-111e-4144-935b-d78ecf566f0e/resourceGroups/rg-nc-networkdev-we-001/providers/Microsoft.Network/virtualNetworks/vnet-nc-hub-dev-we001/subnets/GatewaySubnet",
]
subnet_wo_rt_not_scope = [
"/subscriptions/11b11c11-111e-4144-935b-d78ecf566f0e/resourceGroups/rg-nc-networkdev-we-001/providers/Microsoft.Network/virtualNetworks/vnet-nc-hub-dev-we253/454
001/subnets/AzureBastionSubnet",
"/subscriptions/11b11c11-111e-45f3-a012-204ce5618821/resourceGroups/rg-nc-networkdev-we-001/providers/Microsoft.Network/virtualNetworks/vnet-nc-sharedservices-dev-we001/subnets/ApplicationGatewaySubnet",
]
vpn_gw_not_scope = [
"/subscriptions/11b11c11-111e-4144-935b-d78ecf566f0e/resourceGroups/rg-nc-networkdev-we-001/providers/Microsoft.Network/virtualNetworkGateways/vgw-nc-dev-we-001",
]
}
}
}
dependency
The Network module is dependent on the following modules: - /CORE - /PROVISIONER/CICD — id: blueprint-identitystandard-tf title: DC Infra sidebar_position: 6 —
modules
List modules which are within given blueprint : - DC Infra Settings
common parameters
Name Description Type Default Required
append_tags append_tags map(string) { nc-cf-deployment-name = blueprint.identity.standard } yes
dc_infra
Name Description Type Default Required
dc_infra_enabled dc_infra_enabled bool true no
dc_infra_settings.dc_infra[0]
Name Description Type Default Required
enabled dc_infra bool true yes
instance dc_infra string instance_001 yes
custom_service_name dc_infra string “” no
resource_group_name dc_infra string rg-sch-tst-ne-001 no
location dc_infra string northeurope yes
location_short dc_infra string ne yes
key_vaults keyvault list(object) [{}] no
key_vaults
dc_infra_settings.dc_infra.key_vaults[0]
254/454
Name Description Type Default Required
name keyvault string dc no
key_vault_enable_purge_protection keyvault bool true no
key_vault_enabled_for_deployment keyvault bool true no
key_vault_enabled_for_template_deployment keyvault bool false no
key_vault_enabled_for_disk_encryption keyvault bool true no
key_vault_enable_rbac_authorization keyvault bool true no
key_vault_key_vault_sku keyvault string standard no
key_vault_permissions keyvault map {} no
key_vault_access_policies keyvault list(object) [{}] no
key_vault_network_acls_bypass keyvault string AzureServices no
key_vault_network_acls_default_action keyvault string Deny no
key_vault_network_acls_ip_rules keyvault list(string) [] no
key_vault_network_acls_virtual_network_rules keyvault list(string) [] no
LAST APPLIED CONFIGURATION
TEMP Comment: Leave as is for now, will be used later to dynamically update with customer specific config.
inputs
Make sure you read the descriptions of the variables.
Note: For any of the below parameters which is having multi level structure, if its required to define parametrised value,
then all the parents also must be uncommented. The comments #mandatory means that the parameter is always required
for the resource to be created if parametrised deployment is used. If the default deployment is used, the most parameters
can be left as is (marked), as the default values are provided.
Example of the default deployment:
dc_infra_enabled: true
dc_infra_settings:
dc_infra:
- enabled: true
instance: "instance_001"
# custom_service_name: "cust"
# resource_group_name: "rg-name-custom"
location: "northeurope"
location_short: "ne"
# key_vaults:
# - key_vault: "default"
# key_vault_enable_purge_protection: false
# key_vault_enabled_for_deployment: false
# key_vault_enabled_for_template_deployment: false
# key_vault_enabled_for_disk_encryption: false
# key_vault_enable_rbac_authorization: true
# key_vault_key_vault_sku: standard
# key_vault_permissions:
# key Vault Administrator: ["fa1d194e-1166-4026-81de-5a21dd817f9f"]
# key Vault Reader: ["fa1d194e-1166-4026-81de-5a21dd817f9f"]
# key_vault_access_policies:
# - tenant_id: "xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx"
# object_id: "fa1d194e-1166-4026-81de-5a21dd817f9f"
# key_permissions: ["Get"]
# secret_permissions: ["Get"]
# storage_permissions: ["Get"]
# certificate_permissions: ["Get"]
255/454
append_tags
Additional tags to be applied to the resources along with globally defined tags. Common for all resources in this blueprint
dc_infra_enabled
Indicates if DC Infra module to be deployed #### dc_infra_settings_enabled Enable or disable DC Infra settings ####
instance The instance number of the deployed module. The number must be unique for each of location and contains 3
digits. #### custom_service_name Custom service name to be used in construction of rg name etc., ####
resource_group_name Name of the Resource Group #### location The Azure Region where the resources will be deployed
#### location_short Short name of the Azure Region where the resources will be deployed
key_vault_name
The name of the key vault. ##### key_vault_kek_expiry_days The key vault kek expiry days. #####
key_vault_enable_purge_protection If true, protection against purge is enabled for this vault. The setting is effective only
if soft delete is also enabled. Enabling this functionality is irreversible - that is, the property does not accept false as its
value. ##### key_vault_enabled_for_deployment If true, Azure Virtual Machines are permitted to retrieve certificates
stored as secrets from the key vault. ##### key_vault_enabled_for_template_deployment If true, Azure Resource Manager is permitted to retrieve secrets from the key vault. ##### key_vault_enabled_for_disk_encryption If true, Azure
Disk Encryption is permitted to retrieve secrets from the vault and unwrap keys. #####
key_vault_enable_rbac_authorization If true, the key vault will use Role Based Access Control (RBAC) for authorization
of data actions, and the access policies specified in vault properties will be ignored. ##### key_vault_key_vault_sku Key
Vault SKU name to specify whether the key vault is a standard vault or a premium vault. ##### key_vault_permissions
Rights should be specified here if enableRbacAuthorization is set to true. An array of 0 to 1024 identities that have access
to the key vault. All identities in the array must use the same tenant ID as the key vault’s tenant ID.
Example of the parametrised deployment:
key_vault_network_acls_default_action
The default action of the network ACLs. Possible values are Allow and Deny. #####
key_vault_network_acls_virtual_network_rules The virtual network rules of the network ACLs. #####
key_vault_network_acls_ip_rules The IP rules of the network ACLs. ##### key_vault_access_policies Rights should be
specified here if enableRbacAuthorization is set to false. An array of 0 to 1024 identities that have access to the key vault.
All identities in the array must use the same tenant ID as the key vault’s tenant ID.
Example of the parametrised deployment:
# key_vault_network_acls_bypass: "AzureServices"
# key_vault_network_acls_default_action: "Deny"
# key_vault_network_acls_ip_rules: []
# key_vault_network_acls_virtual_network_rules: []
# - key_vault: "AnotherKeyVault"
# name: "kv-name-custom"
# key_vault_enable_purge_protection: false
key_vault_permissions: #mandatory
key Vault Administrator: ["1111194e-1166-4026-81de-5a21dd817f9f"] #mandatory
key_vault_access_policies: #mandatory
- tenant_id: "xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx" #mandatory
object_id: "1111194e-1166-4026-81de-5a21dd817f9f" #mandatory
key_permissions: ["Get"] #mandatory
secret_permissions: ["Get"] #mandatory
storage_permissions: ["Get"] #mandatory
certificate_permissions: ["Get"] #mandatory
256/454
key_vault_key_vault_network_acls_bypass
The bypass of the network ACLs. Possible values are AzureServices and None.
outputs
Since state sharing is not recommended due to security the outputs are important if any resources need to be referenced
#### key_vault | Name | Description | |———————————————-|———————————————| |
key_vault_id | KeyVault ResourceID | | key_vault_name | KeyVault Name | | key_vault_uri | KeyVault URI |
output descriptions
Example of output description
key_vault = {
instance_001-northeurope-default = {
key_vault_id = "/subscriptions/xxxxx-xxxxxx-xxxxxxxxxxxxx/resourceGroups/rg-sch-keyvault-tst-ne-001/providers/Microsoft.KeyVault/vaults/kv-sch-dctst-ne-001"
key_vault_name = "kv-sch-dc-tst-ne-001"
key_vault_uri = "https://kv-sch-dc-tst-ne-001.vault.azure.net/"
}
}
dependency
The Identity module is dependent on the following modules: - /CORE - /PROVISIONER/CICD - /CORE/NETWORK —
id: blueprint-applicationgateway-standard-tf title: Application Gateway sidebar_position: 7 —
modules
List modules which are within given blueprint :
Application Gateway
inputs
Make sure you read the descriptions of the variables.
Note: For any of the below parameters which is having multi level structure, if its required to define parametrised value,
then all the parents also must be uncommented. The comments #mandatory means that the parameter is always required
for the resource to be created if parametrised deployment is used. If the default deployment is used, the most parameters
can be left as is (marked), as the default values are provided.
Example of the default deployment:
tag
applicationgateway_enabled: true
applicationgateway_settings:
applicationgateway:
- enabled: true
instance: "instance_001"
location: "westeurope"
location_short: "we"
appgws:
- appgw: default
257/454
Name Description Type Default Required
append_tags append_tags map(string) { nc-cf-deployment-name = blueprint.applicationgateway.standard } yes
application_gateway
Name Description Type Default Required
applicationgateway_enabled applicationgateway bool true yes
applicationgateway_settings applicationgateway_settings list(object) [{ }] yes
applicationgateway_settings
applicationgateway_settings.applicationgateway[0]
Name Description Type Default Required
enabled applicationgateway_settings bool true yes
instance applicationgateway_settings object instance_001 yes
custom_service_name applicationgateway_settings object null no
resource_group_name applicationgateway_settings object rg-sch-tst-we-001 no
location applicationgateway_settings object westeurope yes
location_short applicationgateway_settings object we yes
key_vaults applicationgateway_settings list(object) [{ }] no
appgws applicationgateway_settings list(object) [{ }] yes
applicationgateway_settings_key_vaults
applicationgateway_settings.applicationgateway[0].key_vaults[0]
Name Description Type Default Required
key_vault key_vaults string default no
name key_vaults string kv-agw-tst-we-001 no
key_vault_enable_purge_protection key_vaults bool true no
key_vault_enabled_for_deployment key_vaults bool false no
key_vault_enabled_for_template_deployment key_vaults bool true no
key_vault_enabled_for_disk_encryption key_vaults bool false no
key_vault_enable_rbac_authorization key_vaults bool true no
key_vault_key_vault_sku key_vaults string standard no
key_vault_permissions key_vaults list(string) { } no
key_vault_network_acls_bypass key_vaults string AzureServices no
key_vault_network_acls_default_action key_vaults string Deny no
key_vault_network_acls_ip_rules key_vaults list(string) [] no
key_vault_network_acls_virtual_network_rules key_vaults list(string) [] no
key_vault_access_policies key_vaults list(object) [{ }] no
key_vaults_access_policies
applicationgateway_settings.applicationgateway[0].key_vaults[0].key_vault_access_policies[0]
258/454
Name Description Type Default Required
tenant_id key_vaults string xxxxx-xxxxxx-xxxxxxx-xxxxxx no
object_id key_vaults string xxxxx-xxxxxx-xxxxxxx-xxxxxx no
certificate_permissions key_vaults list(string)
[“Backup”, “Create”, “Delete”, “DeleteIssuers”, “Get”, “GetIssuers”, “Import”,
“List”, “ListIssuers”, “ManageContacts”, “ManageIssuers”, “Purge”, “Recover”,
“Restore”, “SetIssuers”, “Update”]
no
secret_permissions key_vaults list(string) [“Backup”, “Delete”, “Get”, “List”, “Purge”, “Recover”, “Restore”, “Set”] no
key_permissions key_vaults list(string)
[“Backup”, “Delete”, “DeleteSAS”, “Get”, “GetSAS”, “List”, “ListSAS”, “Purge”,
“Recover”, “RegenerateKey”, “Restore”, “Set”, “SetSAS”, “Update”] no
storage_permissions key_vaults list(string)
[“Backup”, “Create”, “Decrypt”, “Delete”, “Encrypt”, “Get”, “Import”, “List”,
“Purge”, “Recover”, “Restore”, “Sign”, “UnwrapKey”, “Update”, “Verify”,
“WrapKey”, “Release”, “Rotate”, “GetRotationPolicy”, “SetRotationPolicy”]
no
applicationgateway_settings_appgws
applicationgateway_settings.applicationgateway[0].appgws[0]
259/454
Name Description Type Default Required
appgw appgws string default yes
version appgws number 2 no
appgw_name appgws string appw-sch-tst-we-001 no
availabililty_zones appgws list(string) [“1”, “2”, “3”] no
private_ip_address appgws string IP from applicationgateway_subnet_cidr output network no
autoscale_configuration appgws object { } no
sku_name appgws string WAF_v2 no
sku_tier appgws string WAF_v2 no
enable_http2 appgws bool false no
delegate_control appgws bool false no
gateway_ip_configuration_name appgws string appGatewayIpConfig no
gateway_ip_configuration_subnet_id appgws string applicationgateway_subnet from network no
frontend_ip_configuration appgws list(object) [{ }] no
frontend_port appgws list(object) [{ }] no
backend_address_pool appgws list(object) [{ }] no
backend_http_settings appgws list(object) [{ }] no
http_listener appgws list(object) [{ }] no
request_routing_rule appgws list(object) [{ }] no
probe appgws list(object) [{ }] no
url_path_map appgws list(object) [{ }] no
waf_configuration appgws list(object) [{ }] no
force_firewall_policy_association appgws bool true no
firewall_policy_id appgws string waf_policy.id output from
module.sharedservices_applicationgateway_waf_policy
no
waf_policy appgws list(object) [{ }] no
rewrite_rule_set appgws list(any) [] no
redirect_configuration appgws list(any) [] no
ssl_certificate appgws list(any) [] no
ssl_profile appgws list(any) [] no
trusted_root_certificate appgws list(any) [] no
trusted_client_certificate appgws list(any) [] no
authentication_certificate appgws list(any) [] no
custom_error_configuration appgws list(any) [] no
appgws_autoscale_configuration
applicationgateway_settings.applicationgateway[0].appgws[0].autoscale_configuration
Name Description Type Default Required
minCapacity autoscale_configuration number 1 no
maxCapacity autoscale_configuration number 10 no
appgws_frontend_ip_configuration
260/454
applicationgateway_settings.applicationgateway[0].appgws[0].frontend_ip_configuration[0]
Name Description Type Default Required
name frontend_ip_configuration string appGwPrivateFrontendIp no
public_ip_address_id frontend_ip_configuration string null no
private_ip_address frontend_ip_configuration string IP from applicationgateway_subnet_cidr network no
private_ip_address_allocation frontend_ip_configuration string Static no
subnet_id frontend_ip_configuration string applicationgateway_subnet from network no
private_link_configuration_name frontend_ip_configuration string null no
applicationgateway_settings.applicationgateway[0].appgws[0].frontend_ip_configuration[1]
Name Description Type Default Required
name frontend_ip_configuration string default-frontendIpConfiguration no
public_ip_address_id frontend_ip_configuration string pubic_ip no
private_ip_address frontend_ip_configuration string null no
private_ip_address_allocation frontend_ip_configuration string null no
subnet_id frontend_ip_configuration string null no
private_link_configuration_name frontend_ip_configuration string null no
appgws_frontend_port
applicationgateway_settings.applicationgateway[0].appgws[0].frontend_port[0]
Name Description Type Default Required
name frontend_port string default-port80 no
port frontend_port number 80 no
appgws_backend_address_pool
applicationgateway_settings.applicationgateway[0].appgws[0].backend_address_pool[0]
Name Description Type Default Required
name backend_address_pool string default-backendAddressPool no
ip_addresses backend_address_pool list(string) null no
fqdns backend_address_pool list(string) [“nordcloud.com”] no
appgws_backend_http_settings
applicationgateway_settings.applicationgateway[0].appgws[0].backend_http_settings[0]
261/454
Name Description Type Default Required
name backend_http_settings string default-backendHttpSettings no
port backend_http_settings number 80 no
protocol backend_http_settings string Http no
cookie_based_affinity backend_http_settings string Enabled no
host_name backend_http_settings string nordcloud.com no
pick_host_name_from_backend_address backend_http_settings bool false no
affinity_cookie_name backend_http_settings string ApplicationGatewayAffinity no
request_timeout backend_http_settings number 20 no
path backend_http_settings string / no
probe_name backend_http_settings string default-probe no
authentication_certificate backend_http_settings map { } no
trusted_root_certificate_names backend_http_settings list(string) null no
connection_draining backend_http_settings map { } no
backend_http_settings_connection_draining
applicationgateway_settings.applicationgateway[0].appgws[0].backend_http_settings[0].connection_draining
Name Description Type Default Required
enabled connection_draining bool null no
drain_timeout_in_sec connection_draining number null no
appgws_http_listener
applicationgateway_settings.applicationgateway[0].appgws[0].http_listener[0]
Name Description Type Default Required
name http_listener string default-httpListener no
frontend_port_name http_listener string default-port80 no
frontend_ip_configuration_name http_listener string appGwPrivateFrontendIp no
protocol http_listener string Http no
host_names http_listener list(string) [“nordcloud.com”] no
require_sni http_listener bool bool no
ssl_certificate_name http_listener string null no
ssl_profile_name http_listener string null no
custom_error_configuration http_listener list(object) [{ }] no
firewall_policy_id http_listener string null no
http_listener_custom_error_configuration
applicationgateway_settings.applicationgateway[0].appgws[0].http_listener[0].custom_error_configuration[0]
Name Description Type Default Required
custom_error_page_url custom_error_configuration number 404 no
status_code_range custom_error_configuration string null no
262/454
appgws_request_routing_rule
applicationgateway_settings.applicationgateway[0].appgws[0].request_routing_rule[0]
Name Description Type Default Required
name request_routing_rule string default-routingRule no
http_listener_name request_routing_rule string default-httpListener no
backend_address_pool_name request_routing_rule string default-backendAddressPool no
backend_http_settings_name request_routing_rule string default-backendHttpSettings no
rule_type request_routing_rule string Basic no
priority request_routing_rule number 10 no
redirect_configuration_name request_routing_rule string null no
url_path_map_name request_routing_rule string null no
rewrite_rule_set_name request_routing_rule string null no
appgws_probe
applicationgateway_settings.applicationgateway[0].appgws[0].probe[0]
Name Description Type Default Required
name probe string default-probe no
protocol probe string Http no
port probe string null no
host probe string nordcloud.com no
path probe string / no
interval probe number 30 no
timeout probe number 30 no
unhealthy_threshold probe number 3 no
pick_host_name_from_backend_http_settings probe bool false no
minimum_servers probe number 0 no
match probe list(object) [{ }] no
probe_match
applicationgateway_settings.applicationgateway[0].appgws[0].probe[0].match[0]
Name Description Type Default Required
status_code match list(string) [“200-399”] no
body match string null no
appgws_url_path_map
applicationgateway_settings.applicationgateway[0].appgws[0].url_path_map[0]
263/454
Name Description Type Default Required
name url_path_map string sample-routing-rule no
default_backend_address_pool_name url_path_map string default-backendAddressPool no
default_backend_http_settings_name url_path_map string default-backendHttpSettings no
default_redirect_configuration_name url_path_map string null no
default_rewrite_rule_set_name url_path_map string null no
path_rule url_path_map list(object) [{ }] no
url_path_map_path_rule
applicationgateway_settings.applicationgateway[0].appgws[0].url_path_map[0].path_rule[0]
Name Description Type Default Required
name path_rule string apps no
paths path_rule list(string) [“/apps/*”] no
backend_address_pool_name path_rule string default-backendAddressPool no
backend_http_settings_name path_rule string default-backendHttpSettings no
redirect_configuration_name path_rule string null no
rewrite_rule_set_name path_rule string null no
firewall_policy_id path_rule string null no
appgws_waf_configuration
applicationgateway_settings.applicationgateway[0].appgws[0].waf_configuration[0]
Name Description Type Default Required
enabled waf_configuration bool true no
firewall_mode waf_configuration string Detection no
rule_set_type waf_configuration string OWASP no
rule_set_version waf_configuration string 3.2 no
file_upload_limit_mb waf_configuration number 100 no
max_request_body_size_kb waf_configuration number 128 no
request_body_check waf_configuration bool true no
disabled_rule_group waf_configuration list(any) [] no
exclusion waf_configuration list(any) [] no
appgws_waf_policy
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0]
264/454
Name Description Type Default Required
name waf_policy string waf-sch-tst-we-001 no
global waf_policy bool true no
policy_settings waf_policy map { } no
managed_rule_set waf_policy map { } no
exclusion waf_policy map { } no
custom_rules waf_policy map { } no
waf_policy_policy_settings
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0].policy_settings[0]
Name Description Type Default Required
enabled policy_settings bool true no
mode policy_settings string Detection no
request_body_check policy_settings bool true no
max_request_body_size_in_kb policy_settings number 128 no
file_upload_limit_in_mb policy_settings number 100 no
waf_policy_managed_rule_set
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0].managed_rule_set[0]
Name Description Type Default Required
rule_set_type managed_rule_set string OWASP no
rule_set_version managed_rule_set string 3.2 no
rule_group_override managed_rule_set list(object) [{ }] no
managed_rule_set_rule_group_override
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0].managed_rule_set[0].rule_group_override[0]
Name Description Type Default Required
rule_group_name rule_group_override string
REQUEST-920-PROTOCOL- ENFORCEMENT
no
rule rule_group_override list(object) [{ }] no
rule_group_override_rule
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0].managed_rule_set[0].rule_group_override[0].rule[0]
Name Description Type Default Required
action rule_group_override string Block no
enabled rule_group_override bool true no
id rule_group_override string 920350 no
waf_policy_exclusion
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0].exclusion[0]
265/454
Name Description Type Default Required
match_variable exclusion string RequestHeaderNames no
selector_match_operator exclusion string EqualsAny no
selector exclusion string User-Agent no
excluded_rule_set exclusion list(object) [{ }] no
exclusion_excluded_rule_set
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0].exclusion[0].excluded_rule_set[0]
Name Description Type Default Required
type excluded_rule_set string OWASP no
version excluded_rule_set string 3.2 no
rule_group excluded_rule_set list(object) [{ }] no
excluded_rule_rule_group
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0].exclusion[0].excluded_rule_set[0].rule_group[0]
Name Description Type Default Required
rule_group_name rule_group string
REQUEST-920-PROTOCOL- ENFORCEMENT
no
excluded_rule rule_group list(string) [“920350”] no
waf_policy_custom_rules
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0].custom_rules[0]
Name Description Type Default Required
name custom_rules string allowipaddress no
priority custom_rules number 5 no
rule_type custom_rules string MatchRule no
action custom_rules string Allow no
match_conditions custom_rules list(object) [{ }] no
custom_rules_match_conditions
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0].custom_rules[0].match_conditions[0]
Name Description Type Default Required
match_variable match_conditions list(object) [{ }] no
operator match_conditions string IPMatch no
negation match_conditions bool false no
match_values match_conditions list(string) [“10.222.8.24”] no
match_conditions_match_variable
applicationgateway_settings.applicationgateway[0].appgws[0].waf_policy[0].custom_rules[0].match_conditions[0].match_variables[0]
266/454
Name Description Type Default Required
variable_name match_variables string RemoteAddr no
appgws_rewrite_rule_set
applicationgateway_settings.applicationgateway[0].appgws[0].rewrite_rule_set[0]
Name Description Type Default Required
name rewrite_rule_set string test-ruleset no
rewrite_rule rewrite_rule_set list(object) [{ }] no
rewrite_rule_set_rewrite_rule
applicationgateway_settings.applicationgateway[0].appgws[0].rewrite_rule_set[0].rewrite_rule[0]
Name Description Type Default Required
name rewrite_rules string “” no
rule_sequence rewrite_rules number null no
conditions rewrite_rules list(string) [] no
request_header_configuration rewrite_rules list(object) [{ }] no
response_header_configuration rewrite_rules list(string) [] no
url rewrite_rules list(string) [] no
rewrite_rules_request_header_configuration
applicationgateway_settings.applicationgateway[0].appgws[0].rewrite_rule_set[0].rewrite_rule[0].request_header_configuration[0]
Name Description Type Default Required
header_name request_header_configuration string Accept no
header_value request_header_configuration string foo no
appgws_redirect_configuration
applicationgateway_settings.applicationgateway[0].appgws[0].redirect_configuration[0]
Name Description Type Default Required
name redirect_configuration string “” no
redirect_type redirect_configuration string “” no
target_listener_name redirect_configuration string null no
target_url redirect_configuration string null no
include_path redirect_configuration bool null no
include_query_string redirect_configuration bool null no
appgws_ssl_certificate
applicationgateway_settings.applicationgateway[0].appgws[0].ssl_certificate[0]
267/454
Name Description Type Default Required
name ssl_certificate string “” no
key_vault_secret_id ssl_certificate string “” no
appgws_ssl_profile
applicationgateway_settings.applicationgateway[0].appgws[0].ssl_profile[0]
Name Description Type Default Required
name ssl_profile string “” no
trusted_root_certificate_names ssl_profile list(string) [] no
verify_client_cert_issuer_dn ssl_profile string null no
verify_client_certificate_revocation ssl_profile string “” no
ssl_policy ssl_profile list(object) [{ }] no
applicationgateway_settings.applicationgateway[0].appgws[0].ssl_profile[0].ssl_policy[0]
Name Description Type Default Required
policy_type ssl_policy string “” no
policy_name ssl_policy string “” no
cipher_suites ssl_policy list(string) [] no
min_protocol_version ssl_policy string “” no
disabled_protocols ssl_policy list(string) [] no
appgws_trusted_root_certificate
applicationgateway_settings.applicationgateway[0].appgws[0].trusted_root_certificate[0]
Name Description Type Default Required
name trusted_root_certificate string “” no
key_vault_secret_id trusted_root_certificate string “” no
data trusted_root_certificate string “” no
appgws_trusted_client_certificate
applicationgateway_settings.applicationgateway[0].appgws[0].trusted_client_certificate[0]
Name Description Type Default Required
name trusted_client_certificate string “” no
data trusted_client_certificate string “” no
appgws_authentication_certificate
applicationgateway_settings.applicationgateway[0].appgws[0].authentication_certificate[0]
Name Description Type Default Required
name authentication_certificate string “” no
data authentication_certificate string “” no
268/454
applicationgateway_settings.applicationgateway[0].appgws[0].custom_error_configuration[0]
Name Description Type Default Required
status_code custom_error_configuration string “” no
custom_error_page_url custom_error_configuration string “” no
last applied configuration
TEMP Comment: Leave as is for now, will be used later to dynamically update with customer specific config.
Input descriptions
append_tags
Additional tags to be applied to the resources along with globally defined tags.
applicationgateway_enabled
Flag to enable/disable the application gateway
applicationgateway_settings_enabled
Indicates if this instance of applicationgateway needs to be deployed
applicationgateway_settings_instance
The instance number of the deployed module. The number must be unique for each of location and contains 3 digits.
applicationgateway_settings_custom_service_name
Custom service name to be used in construction of rg name etc.,
applicationgateway_settings_resource_group_name
Name of the Resource Group
applicationgateway_settings_location
The Azure Region where the resources will be deployed
applicationgateway_settings_location_short
Short name of the Azure Region where the resources will be deployed
key_vaults
If default is used, the key vault will be created with the default settings.
key_vaults_name
The name of the key vault.
key_vaults_enable_purge_protection
269/454
I f true, protection against purge is enabled for this vault. The setting is effective only if soft delete is also enabled.
Enabling this functionality is irreversible - that is, the property does not accept false as its value.
key_vaults_enabled_for_deployment
If true, Azure Virtual Machines are permitted to retrieve certificates stored as secrets from the key vault.
key_vaults_enabled_for_template_deployment
If true, Azure Resource Manager is permitted to retrieve secrets from the key vault.
key_vaults_enabled_for_disk_encryption
If true, Azure Disk Encryption is permitted to retrieve secrets from the vault and unwrap keys
key_vaults_enable_rbac_authorization
If true, the key vault will use Role Based Access Control (RBAC) for authorization of data actions, and the access policies
specified in vault properties will be ignored.
key_vaults_key_vault_sku
Key Vault SKU name to specify whether the key vault is a standard vault or a premium vault.
key_vaults_permissions
Rights should be specified here if enableRbacAuthorization is set to true. An array of 0 to 1024 identities that have access
to the key vault. All identities in the array must use the same tenant ID as the key vault’s tenant ID.
key_vaults_network_acls_bypass
The bypass of the network ACLs. Possible values are AzureServices and None.
key_vaults_network_acls_default_action
The default action of the network ACLs. Possible values are Allow and Deny.
key_vaults_network_acls_ip_rules
The IP rules of the network ACLs.
key_vaults_network_acls_virtual_network_rules
The bypass of the network ACLs. Possible values are AzureServices and None.
access_policies_tenant_id
The Azure Active Directory tenant ID that should be used for authenticating requests to the key vault.
access_policies_object_id
The object ID of a user, service principal or security group in the Azure Active Directory tenant for the vault.
access_policies_certificate_permissions
270/454
The permissions the identity has for certificates. Possible values are get, list, delete, create, import, update,
managecontacts, getissuers, listissuers, setissuers, deleteissuers, manageissuers, recover, purge.
access_policies_secret_permissions
The permissions the identity has for secrets. Possible values are get, list, delete, set, backup, restore, recover, purge.
access_policies_key_permissions
The permissions the identity has for keys. Possible values are encrypt, decrypt, wrapKey, unwrapKey, sign, verify, get, list,
create, update, import, delete, backup, restore, recover, purge.
access_policies_storage_permissions
The permissions the identity has for storage. Possible values are get, list, delete, set, backup, restore, recover, purge.
appgws
The default config of application gateways to be created. Must not be changed for the first instance
appgws_version
The version of the application gateway. Only version 2 is supported.
appgws_appgw_name
Name of the application gateway.
appgws_availabililty_zones
The availability zones for the application gateway.
appgws_private_ip_address
The private IP address of the application gateway.
appgws_autoscale_configuration
The autoscale configuration of the application gateway.
appgws_sku_name
The SKU name of the application gateway.
appgws_sku_tier
The SKU tier of the application gateway.
appgws_enable_http2
Indicates whether HTTP2 is enabled.
appgws_delegate_control
Indicates whether the application gateway is delegated to the user.
271/454
appgws_gateway_ip_configuration_name
The name of the gateway IP configuration.
appgws_gateway_ip_configuration_subnet_id
The subnet ID of the gateway IP configuration.
appgws_force_firewall_policy_association
Indicates whether the firewall policy association is forced.
appgws_firewall_policy_id
The firewall policy ID.
appgws_rewrite_rule_set
The rewrite rule set of the application gateway.
appgws_redirect_configuration
The redirect configuration of the application gateway.
appgws_ssl_certificate
The SSL certificate of the application gateway.
appgws_ssl_profile
The SSL profile of the application gateway.
appgws_trusted_root_certificate
The trusted root certificate of the application gateway.
appgws_trusted_client_certificate
The trusted client certificate of the application gateway.
appgws_authentication_certificate
The authentication certificate of the application gateway.
appgws_custom_error_configuration
The custom error configuration of the application gateway.
autoscale_configuration_mincapacity
The minimum capacity of the autoscale configuration.
autoscale_configuration_maxcapacity
The maximum capacity of the autoscale configuration.
272/454
frontend_ip_configuration_name
The name of the frontend IP configuration.
frontend_ip_configuration_private_ip_address
The private IP address of the frontend IP configuration.
frontend_ip_configuration_public_ip_address_id
The public IP address ID of the frontend IP configuration.
frontend_ip_configuration_private_ip_address_allocation
The private IP address allocation of the frontend IP configuration.
frontend_ip_configuration_subnet_id
The subnet ID of the frontend IP configuration.
frontend_ip_configuration_private_link_configuration_name
The name of the private link configuration.
frontend_port_name
The name of the frontend port.
frontend_port_port
The port of the frontend port.
backend_address_pool_name
The name of the backend address pool.
backend_address_pool_ip_addresses
The IP addresses of the backend address pool.
backend_address_pool_fqdns
The FQDNs of the backend address pool.
backend_http_settings_name
The name of the backend HTTP settings.
backend_http_settings_port
The port of the backend HTTP settings.
backend_http_settings_protocol
The protocol of the backend HTTP settings.
273/454
backend_http_settings_cookie_based_affinity
Indicates whether cookie based affinity is enabled.
backend_http_settings_host_name
The host name of the backend HTTP settings.
backend_http_settings_pick_host_name_from_backend_address
Indicates whether the host name is picked from the backend address.
backend_http_settings_affinity_cookie_name
The name of the affinity cookie.
backend_http_settings_request_timeout
The request timeout of the backend HTTP settings.
backend_http_settings_path
The path of the backend HTTP settings.
backend_http_settings_probe_name
The name of the probe.
backend_http_settings_authentication_certificate
The authentication certificate of the backend HTTP settings.
backend_http_settings_trusted_root_certificate_names
The trusted root certificate names of the backend HTTP settings.
connection_draining_enabled
Indicates whether connection draining is enabled.
connection_draining_drain_timeout
The drain timeout of the connection draining.
http_listener_name
The name of the HTTP listener.
http_listener_frontend_port_name
The name of the frontend port.
http_listener_frontend_ip_configuration_name
The name of the frontend IP configuration.
274/454
http_listener_protocol
The protocol of the HTTP listener.
http_listener_host_names
The host names of the HTTP listener.
http_listener_require_sni
Indicates whether SNI is required.
http_listener_ssl_certificate_name
The name of the SSL certificate.
http_listener_ssl_profile_name
The name of the SSL profile.
http_listener_firewall_policy_id
The firewall policy ID.
custom_error_configuration_custom_error_page_url
The custom error page URL of the custom error configuration.
custom_error_configuration_status_code_range
The status code range of the custom error configuration.
request_routing_rule_name
The name of the request routing rule.
request_routing_rule_http_listener_name
The name of the HTTP listener.
request_routing_rule_backend_address_pool_name
The name of the backend address pool.
request_routing_rule_backend_http_settings_name
The name of the backend HTTP settings.
request_routing_rule_rule_type
The type of the rule.
request_routing_rule_priority
The priority of the rule.
275/454
request_routing_rule_redirect_configuration_name
The name of the redirect configuration.
request_routing_rule_url_path_map_name
The name of the URL path map.
request_routing_rule_rewrite_rule_set_name
The name of the rewrite rule set.
probe_name
The name of the probe.
probe_protocol
The protocol of the probe.
probe_port
The port of the probe.
probe_host
The host of the probe.
probe_path
The path of the probe.
probe_interval
The interval of the probe.
probe_timeout
The timeout of the probe.
probe_unhealthy_threshold
The unhealthy threshold of the probe.
probe_pick_host_name_from_backend_http_settings
Indicates whether the host name is picked from the backend HTTP settings.
probe_minimum_servers
The minimum servers of the probe.
match_status_code
The status code of the match.
276/454
match_body
The body of the match.
url_path_map_name
The name of the URL path map.
url_path_map_default_backend_address_pool_name
The name of the default backend address pool.
url_path_map_default_backend_http_settings_name
The name of the default backend HTTP settings.
url_path_map_default_redirect_configuration_name
The name of the default redirect configuration.
url_path_map_default_rewrite_rule_set_name
The name of the default rewrite rule set.
path_rule_name
The name of the path rule.
path_rule_paths
The paths of the path rule.
path_rule_backend_address_pool_name
The name of the backend address pool. Cannot be set if redirect_configuration_name is set.
path_rule_backend_http_settings_name
The name of the backend HTTP settings. Cannot be set if redirect_configuration_name is set
path_rule_redirect_configuration_name
The name of the redirect configuration. Cannot be set if backend_address_pool_name or backend_http_settings_name is
set.
path_rule_rewrite_rule_set_name
The name of the rewrite rule set. Only valid for v2 SKUs
path_rule_firewall_policy_id
The firewall policy ID.
waf_configuration_enabled
Indicates whether the WAF configuration is enabled.
277/454
waf_configuration_firewal_mode
The firewall mode of the WAF configuration.
waf_configuration_rule_set_type
The rule set type of the WAF configuration.
waf_configuration_rule_set_version
The rule set version of the WAF configuration.
waf_configuration_file_upload_limit_mb
The file upload limit of the WAF configuration.
waf_configuration_file_max_request_body_size_kb
The maximum request body size of the WAF configuration.
waf_configuration_file_request_body_check
Indicates whether the request body is checked.
waf_configuration_file_disabled_rule_group
The disabled rule group of the WAF configuration.
waf_configuration_file_exclusion
The exclusion of the WAF configuration.
waf_policy_name
The name of the WAF policy.
waf_policy_global
Indicates whether the WAF policy is global. true if global policy for the entire AppGW.
policy_settings_enabled
Indicates whether the policy settings are enabled.
policy_settings_mode
The mode of the policy settings.
policy_settings_request_body_check
Indicates whether the request body is checked.
policy_settings_max_request_body_size_in_kb
The maximum request body size of the policy settings.
278/454
policy_settings_file_upload_limit_in_mb
The file upload limit of the policy settings.
managed_rule_set_rule_set_type
The rule set type of the managed rule set.
managed_rule_set_rule_set_version
The rule set version of the managed rule set.
managed_rule_set_rule_group_override
The rule group override of the managed rule set.
rule_group_override_rule_group_name
The rule group name of the rule group override.
rule_group_override_rule_group_name
The rule group name of the rule group override.
rule_group_override_action
The action of the rule group override.
rule_group_override_enabled
Indicates whether the rule group override is enabled.
rule_group_override_id
The ID of the rule group override.
exclusion_match_variable
The match variable of the exclusion.
exclusion_selector_match_operator
The selector match operator of the exclusion.
exclusion_selector
The selector of the exclusion.
excluded_rule_set_type
The type of the excluded rule set.
excluded_rule_set_version
The version of the excluded rule set.
279/454
rule_group_rule_group_name
The rule group name of the rule group.
rule_group_excluded_rule
The excluded rule of the rule group.
custom_rules_name
The name of the custom rules.
custom_rules_priority
The priority of the custom rules.
custom_rules_rule_type
The type of the custom rules.
custom_rules_action
The action of the custom rules.
match_conditions_operator
The operator of the match conditions.
match_conditions_negation
Indicates whether the match conditions are negated.
match_conditions_match_values
The match values of the match conditions.
match_variables_variable_name
The variable name of the match variables.
rewrite_rule_set_name
The name of the rewrite rule set.
rewrite_rules_name
The name of the rewrite rules.
rewrite_rules_rule_sequence
The rule sequence of the rewrite rules.
rewrite_rules_conditions
The conditions of the rewrite rules.
280/454
rewrite_rulese_response_header_configuration
The response header configuration of the rewrite rules.
rewrite_rules_url
The URL of the rewrite rules.
request_header_configuration_header_name
The header name of the request header configuration.
request_header_configuration_header_value
The header value of the request header configuration.
redirect_configuration_name
The name of the redirect configuration.
redirect_configuration_redirect_type
The redirect type of the redirect configuration.
redirect_configuration_target_listener_name
The target listener name of the redirect configuration. Cannot be set if target_listener_name is set
redirect_configuration_target_url
The target URL of the redirect configuration. Cannot be set if target_listener_name is set
redirect_configuration_include_path
Indicates whether the path is included in the redirect configuration.
redirect_configuration_include_query_string
Indicates whether the query string is included in the redirect configuration.
ssl_certificate_name
The name of the SSL certificate.
ssl_certificate_key_vault_secret_id
The key vault secret ID of the SSL certificate.
ssl_profile_names
The names of the SSL profile.
ssl_profile_trusted_root_certificate_names
The trusted root certificate names of the SSL profile.
281/454
ssl_profile_verify_client_cert_issuer_dn
Indicates whether the client certificate issuer DN is verified.
ssl_profile_verify_client_certificate_revocation
The client certificate revocation of the SSL profile.
ssl_profile_policy
The policy of the SSL profile.
ssl_policy_type
The type of the SSL policy.
ssl_policy_name
The name of the SSL policy.
ssl_policy_cipher_suites
The cipher suites of the SSL policy.
ssl_policy_min_protocol_version
The minimum protocol version of the SSL policy.
ssl_policy_disabled_protocols
The disabled protocols of the SSL policy.
trusted_root_certificate_name
The name of the trusted root certificate. Used for Application Gateway v2
trusted_root_certificate_key_vault_secret_id
The key vault secret ID of the trusted root certificate. Used for Application Gateway v2
trusted_root_certificate_data
The data of the trusted root certificate. Used for Application Gateway v2
trusted_client_certificate_name
The name of the trusted client certificate. Used for Application Gateway v2
trusted_client_certificate_data
The data of the trusted client certificate. Used for Application Gateway v2
authentication_certificate_name
The name of the authentication certificate. Used for Application Gateway v1
282/454
authentication_certificate_data
The data of the authentication certificate. Used for Application Gateway v1
custom_error_configuration_code
The code of the custom error configuration.
custom_error_configuration_url
The URL of the custom error configuration.
outputs
Since state sharing is not recommended due to security the outputs are important if any resources need to be referenced
pip_not_scope
Name Description
value ID of public IP
dependency
/CORE
/PROVISIONER/CICD
/CORE/NETWORK
id: blueprint-management-standard-tf title: Management sidebar_position: 8 —
modules
List modules which are within given blueprint : - Automation Account - Blob Backup - Estate Helper - Ipam - Light House
- Log Analytics - Monitoring - Platform Change Alerting - Sandbox Automation - Sentinel - Service Health Alerting -
Subscription Budget - VM Change Tracking - VM Management
inputs
Make sure you read the descriptions of the variables.
Note: For any of the below parameters which is having multi level structure, if its required to define custom value, then all
the parents also must be uncommented. For eg. in case of sandbox automation, if its requried to define custom value for
vm_shutdown_cron, then both default_properties (parent) and vm_shutdown_cron must be uncommented and then custom
value needs to be added for vm_shutdown_cron.
In this way, all the related parents of a parameter needs to be uncommented to define custom values
sandbox_automation_settings:
instance_001:
enabled : true
location : "northeurope"
location_short : "ne"
# rg_name : ""
# service_plan_name : ""
# app_insights_name : ""
# vnet_name : ""
283/454
common parameters
Name Description Type Default Required
append_tags append_tags map(string) { nc-cf-deployment-name = blueprint.management.standard } yes
log_analytics
Name Description Type Default Required
log_analytics_enabled log_analytics bool true no
log_analytics_workspace_name log_analytics string
“log-schoperationalama-tst-we001”
no
log_analytics_workspace_sku log_analytics string “PerGB2018” no
log_analytics_retention_in_days log_analytics number 180 no
log_analytics_daily_quota_gb log_analytics number 100 no
blob_backup_automation
Name Description Type Default Required
blob_backup_enable blob_backup bool true no
blob_backup_function_name blob_backup string “func-sch-blobbackup-tst-we-001” no
blob_backup_management_group_id_scope blob_backup string acf root level defined in org hcl file no
blob_backup_redundancy blob_backup string “LocallyRedundant” no
blob_backup_retention blob_backup number 60 no
blob_backup_container_soft_delete_retention blob_backup number 30 no
blob_backup_cis_compliant blob_backup bool true no
blob_backup_serverfarms blob_backup map(string) {sku = “Y1”,cisSku = “S1”} no
windows_function_app_http2_enabled blob_backup bool true no
windows_function_app_client_certificate_enabled blob_backup bool true no
application_insights_workspace_id blob_backup string “” no
storage_supports_https_traffic_only blob_backup bool true no
storage_allow_blob_public_access blob_backup bool false no
storage_network_acls_bypass blob_backup list(string) [“AzureServices”] no
storage_network_acls_default_action blob_backup string “Deny” no
storage_network_acls_virtual_network_rules blob_backup list(any) [] no
storage_network_acls_ip_rules blob_backup list(string) [] no
network_address_space blob_backup list(string) [“10.0.0.0/23”] no
subnet_network_address_space blob_backup string “10.0.0.0/24” no
# nsg_name : ""
# snet_name : ""
# cis_compliant : true
# log_analytics_workspace_id : ""
default_properties :
# rg_delete_cron : "0 0 18 * * *"
vm_shutdown_cron : "CUSTOM-VALUE"
# sub_disable_cron : "0 0 20 * * *"
# sub_auto_enabled : true
284/454
Altering the storage_supports_https_traffic_only, storage_allow_blob_public_access, or
storage_network_acls_default_action settings will affect CIS compliance and is not recommended for security reasons.
Also if there are more IP-Based Network ACLS rules than Virtual Network rules, CIS compliance will also be affected.
sentinel
Name Description Type Default Required
sentinel_enabled sentinel bool true no
data_connectors_azure_security_center_enabled sentinel bool true no
data_connectors_azure_security_center_management_group_id_scope sentinel string acf root level defined in org hcl file no
log_analytics_workspace_id sentinel string workspace_resource_id from
management_outputs no
sandbox_automation
Name Description Type Default Required
sandbox_automation_enabled sandbox_automation bool true no
sandbox_automation_settings sandbox_automation map(object()) {instance_001 = {enabled = true,location =
“northeurope”,location_short = “ne” } } no
sandbox_automation_settings
sandbox_automation_settings.instance_001
Name Description Type Default Required
enabled sandbox_automation bool true no
location sandbox_automation string “northeurope” no
location_short sandbox_automation string “ne” no
rg_name sandbox_automation string rg-sch-sandbox-automation-tst-ne-001 no
service_plan_name sandbox_automation string plan-sch-sandbox-automation-tst-ne-001 no
app_insights_name sandbox_automation string appi-sch-sandbox-automation-tst-ne-001 no
vnet_name sandbox_automation string vnet-sch-sandbox-automation-tst-ne-001 no
nsg_name sandbox_automation string nsg-sch-sandbox-automation-tst-ne-001 no
snet_name sandbox_automation string snet-functions-tst-ne-001 no
cis_compliant sandbox_automation bool true no
log_analytics_workspace_id sandbox_automation string workspace_resource_id from management_outputs no
default_properties sandbox_automation object() {} no
properties sandbox_automation object() {} no
app_service sandbox_automation object() {} no
server_farms sandbox_automation object() {} no
vnet_address_prefixes sandbox_automation list(string) [“10.0.0.0/23”] no
snet_address_prefixes sandbox_automation string “10.0.1.0/24” no
storage_account sandbox_automation object() {} no
queue_storage_account sandbox_automation object() {} no
sandbox_automation_default_properties
sandbox_automation_settings.instance_001.default_properties
285/454
Name Description Type Default Required
rg_delete_cron default_properties string “0 0 18 * * *” no
vm_shutdown_cron default_properties string “0 /15 * * *” no
sub_disable_cron default_properties string “0 0 20 * * *” no
sub_auto_enabled default_properties bool true no
vm_auto_enabled default_properties bool true no
rg_auto_enabled default_properties bool true no
decommissioned_mgmt_group_name default_properties string mg-decommissioned value from outputs of core no
rg_delete_tag_name default_properties string “delete” no
rg_delete_days default_properties string 30 no
vm_shutdown_default default_properties string “16” no
vm_shutdown_tag default_properties string “VMShutdown” no
vm_startup_tag default_properties string “VMStart” no
vm_disable_shutdown_tag default_properties string “NO-SHUTDOWN” no
hostile_delete_rg default_properties string “true” no
protected_rg_list default_properties string “NetworkWatcherRG” no
sub_disable_tag_name default_properties string “subDisable” no
sub_disable_days default_properties string 30 no
protected_sub_list default_properties string “5959d188-3a85-4a68-98e0-af236b3c2cac” no
force_disable_sub default_properties string “true” no
sandbox_automation_properties
sandbox_automation_settings.instance_001.properties
Name Description Type Default Required
sub_auto_enabled properties bool false no
sandbox_management_group_name properties string mg-sandbox value from outputs of core no
vm_auto_enabled properties bool true no
rg_auto_enabled properties bool false no
rg_delete_tagName properties string “delete” no
rg_delete_days properties string 1 no
rg_delete_cron properties string “0 0 18 * * *” no
vm_shutdown_cron properties string “0 /15 * * *” no
vm_shutdown_default properties string “16” no
vm_shutdown_tag properties string “VMShutdown” no
vm_startup_tag properties string “VMStart” no
vm_disable_shutdown_tag properties string “NO-SHUTDOWN” no
hostile_delete_rg properties string “true” no
protected_rg_list properties string “NetworkWatcherRG” no
sandbox_automation_app_service
sandbox_automation_settings.instance_001.app_service
286/454
Name Description Type Default Required
name app_service string func-sch-sandbox-automation-tst-ne-001 no
client_cert_enabled app_service bool true no
http2_enabled app_service bool true no
sandbox_automation_server_farms
sandbox_automation_settings.instance_001.server_farms
Name Description Type Default Required
sku server_farms string “Y1” no
cis_sku server_farms string “S1” no
sandbox_automation_storage_account
sandbox_automation_settings.instance_001.storage_account
Name Description Type Default Required
name storage_account string stsbautomfunc<RANDOM>tst001 no
supports_https_traffic_only storage_account bool true no
allow_blob_public_access storage_account bool false no
network_acls_bypass storage_account list(string) [“AzureServices”] no
network_acls_default_action storage_account string “Deny” no
network_acls_virtual_network_rules storage_account list(string) [] no
network_acls_ip_rules storage_account list(string) [] no
sandbox_automation_queue_storage_account
sandbox_automation_settings.instance_001.queue_storage_account
Name Description Type Default Required
name storage_account string stsbautomqueue<RANDOM>tst001 no
supports_https_traffic_only storage_account bool true no
allow_blob_public_access storage_account bool false no
network_acls_bypass storage_account list(string) [“AzureServices”] no
network_acls_default_action storage_account string “Deny” no
network_acls_virtual_network_rules storage_account list(string) [] no
network_acls_ip_rules storage_account list(string) [] no
light_house
Name Description Type Default Required
light_house_enabled light_house bool true no
light_house_settings light_house map(object()) {instance_001 = {enabled = true,location = “northeurope”,location_short
= “ne” } } no
light_house_settings
light_house_settings.instance_001
287/454
Name Description Type Default Required
enabled light_house bool true no
location light_house string “northeurope” no
location_short light_house string “ne” no
rg_name light_house string rg-sch-lighthouse-tst-ne-001 no
custom_service_name light_house string “” no
service_plan_name light_house string plan-sch-lighthouse-tst-ne-001 no
app_insights_name light_house string appi-sch-lighthouse-tst-ne-001 no
vnet_name light_house string vnet-sch-lighthouse-tst-ne-001 no
nsg_name light_house string nsg-sch-lighthouse-tst-ne-001 no
snet_name light_house string snet-functions-tst-ne-001 no
cis_compliant light_house bool true no
management_goup_id_scope light_house string acf root level defined in org hcl file no
msp_offer_name light_house string “Nordcloud-Managed-Cloud” no
msp_offer_description light_house string “Contributor Access for Nordcloud Managed Services” no
managed_by_tenant_id light_house string “f8407946-d2c1-4fcc-ae95-63723ace3665” no
principal_id light_house string “687b48d7-a654-4ed6-a20b-830318245d63” no
role_definition_id light_house string “b24988ac-6180-42a0-ab88-20f7382dd24c” no
principal_id_display_name light_house string “Lighthouse-MCE-ALL” no
excluded_tag_name light_house string “Nordcloud-Managed” no
excluded_tag_value light_house bool false no
vnet_address_prefixes light_house list(string) [“10.0.0.0/23”] no
snet_address_prefixes light_house string “10.0.1.0/24” no
snet_endpoints light_house list(string) [“Microsoft.Storage”] no
server_farms light_house object() {} no
log_analytics_workspace_id light_house string workspace_resource_id from management_outputs no
function_app light_house object() {} no
storage_account light_house object() {} no
light_house_server_farms
light_house_settings.instance_001.server_farms
Name Description Type Default Required
sku server_farms string “Y1” no
cis_sku server_farms string “S1” no
light_house_function_app
light_house_settings.instance_001.function_app
288/454
Name Description Type Default Required
name function_app string func-sch-lighthouse-tst-ne-001 no
identity_type function_app string “SystemAssigned” no
https_only function_app bool true no
client_certificate_enabled function_app bool true no
client_certificate_mode function_app string “Optional” no
auth_settings function_app bool true no
http2_enabled function_app bool true no
ftps_state function_app string “Disabled” no
minimum_tls_version function_app string “1.2” no
scale_limit function_app string “1” no
functions_extension_version function_app string “~4” no
light_house_storage_account
light_house_settings.instance_001.storage_account
Name Description Type Default Required
name storage_account string stlighthouse<RANDOM>tst001 no
supports_https_traffic_only storage_account bool true no
allow_blob_public_access storage_account bool false no
network_acls_bypass storage_account list(string) [“AzureServices”] no
network_acls_default_action storage_account string “Deny” no
network_acls_virtual_network_rules storage_account list(string) [] no
network_acls_ip_rules storage_account list(string) [] no
estate_helper
289/454
Name Description Type Default Required
estate_helper_enabled estate_helper bool true no
estate_helper_rg_name estate_helper string rg-sch-estatehelper-tst-ne-001 no
estate_helper_kv_name estate_helper string kv-sch-es-tst-ne-001 no
estate_helper_kv_short_name estate_helper string “eh” no
estate_helper_kv_kek_expiry_days estate_helper number 0 no
estate_helper_kv_enable_purge_protection estate_helper bool true no
estate_helper_kv_enabled_for_deployment estate_helper bool false no
estate_helper_kv_enabled_for_template_deployment estate_helper bool true no
estate_helper_kv_enabled_for_disk_encryption estate_helper bool true no
estate_helper_kv_enable_rbac_authorization estate_helper bool true no
estate_helper_kv_sku estate_helper string “standard” no
estate_helper_kv_permissions estate_helper map(any) {} no
estate_helper_kv_access_policies estate_helper list(any) [] no
estate_helper_kv_network_acls_bypass estate_helper string “AzureServices” no
estate_helper_kv_network_acls_default_action estate_helper bool “Deny” no
estate_helper_kv_network_acls_virtual_network_rules estate_helper list(any) [] no
estate_helper_kv_network_acls_ip_rules estate_helper list(string) [] no
estate_helper_spn_name estate_helper string “spn-nc-estate-helper” no
estate_helper_identifier_uris estate_helper set(string) [] no
estate_helper_deployment_architect_object_id estate_helper string “” no
estate_helper_application_password_expiry estate_helper string “17520h” no
estate_helper_rotate_application_password estate_helper number 1 no
estate_helper_management_group_assignment estate_helper string acf root level defined in org hcl file no
estate_helper_rbac_role estate_helper string “Reader” no
service_health_alerting
Name Description Type Default Required
service_health_alerting_enabled service_health bool true no
service_health_alerting_settings service_health object() {webhook_receivers_warning_properties=
[{service_uri=“https://events.pagerduty.com/integration/c3343244324232/enqueue”}]} yes
service_health_settings
service_health_alerting_settings
290/454
Name Description Type Default
management_group_id_scope service_health list(string) [mg-platform value from outputs of core, mg-audit value from outputs of
action_group_name service_health string “ag-hub-email”
monitored_regions service_health list(string) [“Global”,“West Europe”,“North Europe”,“Central India”]
service_health_alert_name service_health string alert-service-health-tst-001
resource_group service_health string workspace_resource_group_name from management output
email_receivers service_health list(object()) []
webhook_receivers_warning_enabled service_health bool false
webhook_receivers_warning_properties service_health list(object())
[{name=“Warning_1”,service_uri=“https://events.pagerduty.com/integration/c3343244324232/enqueue”,use_common_alert_schema
= true}]
ipam
Name Description Type Default Required
ipam_enabled ipam bool true no
ipam_settings ipam map(object()) {instance_001 = {enabled = true,location = “northeurope”,location_short = “ne” } } no
ipam_settings
ipam_settings.instance_001
291/454
Name Description Type Default Required
enabled ipam bool true no
location ipam string “northeurope” no
location_short ipam string “ne” no
rg_name ipam string rg-sch-ipam-tst-ne-001 no
custom_service_name ipam string “” no
service_plan_name ipam string plan-sch-ipam-tst-ne-001 no
app_insights_name ipam string appi-sch-ipam-tst-ne-001 no
vnet_name ipam string vnet-sch-ipam-tst-ne-001 no
nsg_name ipam string nsg-sch-ipam-tst-ne-001 no
snet_name ipam string snet-functions-tst-ne-001 no
cis_compliant ipam bool true no
supernet_table_name ipam string “Supernet” no
network_table_name ipam string “Network” no
subnet_table_name ipam string “Subnet” no
azure_enabled ipam bool true no
aws_enabled ipam bool false no
gcp_enabled ipam bool false no
supernet ipam object() {} no
server_farms ipam object() {} no
app_service ipam object() {} no
ip_security_restrictions ipam bool true no
ip_security_restrictions_allow ipam list(map(string))
[{action = “Deny”,description = “Deny Traffic”,ip_address =
“0.0.0.0/0”,name = “ClientIp”, priority = “100”}] no
vnet_address_prefixes ipam list(string) [“10.0.0.0/23”] no
snet_address_prefixes ipam string “10.0.1.0/24” no
log_analytics_workspace_id ipam string workspace_resource_id from management_outputs no
secure_storage_account ipam object() {} no
azure_storage_account ipam object() {} no
aws_storage_account ipam object() {} no
gcp_storage_account ipam object() {} no
ipam_supernet
ipam_settings.instance_001.supernet
Name Description Type Default Required
aws supernet list(object()) [] no
azure supernet list(object()) link no
gcp supernet list(object()) [] no
ipam_server_farms
ipam_settings.instance_001.server_farms
292/454
Name Description Type Default Required
sku server_farms string “Y1” no
cis_sku server_farms string “S1” no
ipam_app_service
ipam_settings.instance_001.app_service
Name Description Type Default Required
name app_service string func-sch-ipam-tst-ne-001 no
client_cert_enabled app_service bool true no
http2_enabled app_service bool true no
ipam_secure_storage_account
ipam_settings.instance_001.secure_storage_account
Name Description Type Default Required
name storage_account string stipam<RANDOM>tst001 no
tier storage_account string “Standard” no
replication_type storage_account string “LRS” no
supports_https_traffic_only storage_account bool true no
allow_blob_public_access storage_account bool false no
network_acls_bypass storage_account list(string) [“AzureServices”] no
network_acls_default_action storage_account string “Deny” no
network_acls_virtual_network_rules storage_account list(string) [] no
network_acls_ip_rules storage_account list(string) [] no
ipam_azure_storage_account
ipam_settings.instance_001.azure_storage_account
Name Description Type Default Required
name storage_account string ipamazure<RANDOM>tst001 no
tier storage_account string “Standard” no
replication_type storage_account string “LRS” no
supports_https_traffic_only storage_account bool true no
allow_blob_public_access storage_account bool false no
network_acls_bypass storage_account list(string) [“AzureServices”] no
network_acls_default_action storage_account string “Deny” no
network_acls_virtual_network_rules storage_account list(string) [] no
network_acls_ip_rules storage_account list(string) [] no
ipam_aws_storage_account
ipam_settings.instance_001.aws_storage_account
293/454
Name Description Type Default Required
name storage_account string ipamaws<RANDOM>tst001 no
tier storage_account string “Standard” no
replication_type storage_account string “LRS” no
supports_https_traffic_only storage_account bool true no
allow_blob_public_access storage_account bool false no
network_acls_bypass storage_account list(string) [“AzureServices”] no
network_acls_default_action storage_account string “Deny” no
network_acls_virtual_network_rules storage_account list(string) [] no
network_acls_ip_rules storage_account list(string) [] no
ipam_gcp_storage_account
ipam_settings.instance_001.gcp_storage_account
Name Description Type Default Required
name storage_account string ipamgcp<RANDOM>tst001 no
tier storage_account string “Standard” no
replication_type storage_account string “LRS” no
supports_https_traffic_only storage_account bool true no
allow_blob_public_access storage_account bool false no
network_acls_bypass storage_account list(string) [“AzureServices”] no
network_acls_default_action storage_account string “Deny” no
network_acls_virtual_network_rules storage_account list(string) [] no
network_acls_ip_rules storage_account list(string) [] no
subscription_budget
Name Description Type Default Required
subscription_budget_enabled subscription_budget bool true no
subscription_budget_settings subscription_budget map(object()) {instance_001 = {enabled = true,location =
“northeurope”,location_short = “ne” } } no
subscription_budget_settings
subscription_budget_settings.instance_001
294/454
Name Description Type Default Required
enabled subscription_budget bool true no
location subscription_budget string “northeurope” no
location_short subscription_budget string “ne” no
rg_name subscription_budget string rg-sch-budget-tst-ne-001 no
custom_service_name subscription_budget string “” no
service_plan_name subscription_budget string plan-sch-budget-tst-ne-001 no
app_insights_name subscription_budget string appi-sch-budget-tst-ne-001 no
vnet_name subscription_budget string vnet-sch-budget-tst-ne-001 no
nsg_name subscription_budget string nsg-sch-budget-tst-ne-001 no
snet_name subscription_budget string snet-functions-tst-ne-001 no
cis_compliant subscription_budget bool true no
management_group_id_scope subscription_budget string acf root level defined in org hcl file no
tenant_id subscription_budget string “a738da5b-465c-4cbd-a7de-1b64c889d37a” no
contact_tag_name subscription_budget string “contact” no
budget_tag_name subscription_budget string “budget” no
threshold_tag_name subscription_budget string “threshold” no
budgets subscription_budget list(object()) link no
server_farms subscription_budget object() {} no
app_service subscription_budget object() {} no
vnet_address_prefixes subscription_budget list(string) [“10.0.0.0/23”] no
snet_address_prefixes subscription_budget string “10.0.1.0/24” no
log_analytics_workspace_id subscription_budget string workspace_resource_id from management_outputs no
secure_storage_account subscription_budget object() {} no
subscription_budget_server_farms
subscription_budget_settings.instance_001.server_farms
Name Description Type Default Required
sku server_farms string “Y1” no
cis_sku server_farms string “S1” no
subscription_budget_app_service
subscription_budget_settings.instance_001.app_service
Name Description Type Default Required
name app_service string func-sch-budget-tst-ne-001 no
client_cert_enabled app_service bool true no
http2_enabled app_service bool true no
subscription_budget_secure_storage_account
subscription_budget_settings.instance_001.secure_storage_account
295/454
Name Description Type Default Required
name storage_account string stbudget<RANDOM>tst001 no
tier storage_account string “Standard” no
replication_type storage_account string “LRS” no
supports_https_traffic_only storage_account bool true no
allow_blob_public_access storage_account bool false no
network_acls_bypass storage_account list(string) [“AzureServices”] no
network_acls_default_action storage_account string “Deny” no
network_acls_virtual_network_rules storage_account list(string) [] no
network_acls_ip_rules storage_account list(string) [] no
platform_change_alerting
Name Description Type Default
platform_change_alerting_enabled platform_change_alerting bool true
platform_change_alert_settings platform_change_alerting object() {webhook_receivers_warning_properties=
[{service_uri=“https://events.pagerduty.com/integration/CHANGE_ME/enqueue”}]}
platform_change_alert_settings
Name Description Type Default
rg_name platform_change_alerting string workspace_resource_group_name from management_outputs
action_group_name platform_change_alerting string “ag-hub-email”
platform_change_alert__name platform_change_alerting string “alert-platform-change-tst-001”
evaluation_frequency platform_change_alerting string “PT5M”
window_duration platform_change_alerting string “PT5M”
severity platform_change_alerting number 3
workspace_id platform_change_alerting string workspace_resource_id from management_outputs
scope_names platform_change_alerting list(string) [mg-platform value from outputs of core
email_receivers platform_change_alerting list(object())
[{name = “testuser-EmailAction-1”,email_address = “notExistingMail@nordcloud.com”,use_common_alert_schema =
true }]
webhook_receivers_warning_enabled platform_change_alerting bool false
webhook_receivers_warning_properties platform_change_alerting list(object())
[{name =
“Warning”,service_uri=“https://events.pagerduty.com/integration/CHANGE_ME/enqueue”,use_common_alert_schema
= true}]
exclusions platform_change_alerting object() {}
platform_change_alert_exclusions
platform_change_alert_settings.exclusions
Name Description Type Default Required
operation_name_values exclusions list(string) operation_name_values no
subscription_ids exclusions list(string) [“”] no
resource_ids exclusions list(string) [“”] no
resource_groups exclusions list(string) [“”] no
monitoring
296/454
Name Description Type Default Required
monitoring_enabled monitoring bool true no
monitoring_settings monitoring map(object()) {email_receivers_default=
[{email_address=“notExistingMail@nordcloud.com”}]} no
monitoring_settings
Name Description Type Default
rg_name_logging monitoring string rg-sch-logging-tst-ne-001
log_analytics_workspace_id monitoring string workspace_resource_id from management_outputs
workspace_friendly_name monitoring string “operational”
vm_insights monitoring object() {}
security_solution monitoring object() {}
action_groups monitoring object() {}
email_receivers_default monitoring list(object()) [{name=“Notify_EmailActions_1”,email_address=“notExistingMail@nordcloud.com”,use_common_alert_schema=true}]
email_receivers_critical monitoring list(object()) []
webhook_receivers_criticial_enabled monitoring bool false
webhook_receivers_critical_properties monitoring list(object()) []
webhook_receivers_warning_enabled monitoring bool false
webhook_receivers_warning_properties monitoring list(object()) []
dcr_data_sources monitoring object() {}
monitoring_workspace_vm_insights
monitoring_settings.vm_insights
Name Description Type Default Required
enabled vm_insights bool false no
vmi_dcr_suffix vm_insights string “” no
monitoring_workspace_security_solution
monitoring_settings.security_solution
Name Description Type Default Required
enabled security_solution bool true no
security_dcr_suffix security_solution string “” no
monitoring_workspace_action_groups
monitoring_settings.action_groups
Name Description Type Default Required
group_short_name_critical action_groups string “Criticals” no
enabled_critical action_groups bool true no
enabled_warning action_groups bool true no
group_short_name_warning action_groups string “Warnings” no
297/454
monitoring_workspace_dcr_data_sources
monitoring_settings.dcr_data_sources.windows
Name Description Type Default Required
enabled dcr bool true no
name dcr string “windows” no
kind dcr string “windows” no
data_sources dcr object() link no
streams dcr list(string) [“Microsoft-Perf”,“Microsoft-Event”] no
monitoring_settings.dcr_data_sources.linux
Name Description Type Default Required
enabled dcr bool false no
name dcr string “linux” no
kind dcr string “Linux” no
data_sources dcr object() link no
streams dcr list(string) [“Microsoft-Perf”] no
automation_account
Name Description Type Default Required
automation_account_enabled automation_account bool true no
automation_account_settings automation_account map(object()) {instance_001 = {enabled = true,location =
“northeurope”,location_short = “ne” } } no
automation_account_settings
automation_account_settings.instance_001
Name Description Type Default Required
enabled automation_account bool true no
location automation_account string “northeurope” no
location_short automation_account string “ne” no
rg_name automation_account string rg-sch-automation-tst-ne-001 no
automation_account_name automation_account string “automation” no
upload_run_books automation_account true true no
configuration_management_rbac automation_account object() {enabled = true, management_group_name = acf root level defined in
org hcl file,role_definition_name = “Virtual Machine Contributor”} no
automation_account_configuration_management_rbac
automation_account_settings.instance_001.configuration_management_rbac
Name Description Type Default Required
enabled rbac bool true no
management_group_name rbac string acf root level defined in org hcl file no
role_definition_name rbac string “Virtual Machine Contributor” no
298/454
vm_change_tracking
Name Description Type Default Required
vm_change_tracking_enabled vm_change_tracking bool true no
vm_change_tracking_settings vm_change_tracking object() {} no
vm_change_tracking_settings
Name Description Type Default Required
rg_name vm_change_tracking string rg-sch-logging-tst-ne-001 no
log_analytics_workspace_id vm_change_tracking string workspace_resource_id from management_outputs no
dcr_suffix vm_change_tracking string sch-dcr-tst-ne-001 no
windows_change_tracking vm_change_tracking object() {} no
linux_change_tracking vm_change_tracking object() {} no
change_track_windows_change_tracking
windows_change_tracking.extension_settings
Name Description Type Default Required
enableFiles windows_extension bool true no
enableSoftware windows_extension bool true no
enableRegistry windows_extension bool true no
enableServices windows_extension bool true no
enableInventory windows_extension bool true no
windows_change_tracking.registry_info.ShellIconOverlayIdentifiers_01
Name Description Type Default
name windows_registry_info string “ShellIconOverlayIdentifiers”
groupTag windows_registry_info string “Recommended”
enabled windows_registry_info bool true
recurse windows_registry_info bool true
description windows_registry_info string “”
keyName windows_registry_info string “HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Explorer\ShellIconOverlayIdentifiers”
valueName windows_registry_info string “”
windows_change_tracking.registry_info.KnownDlls_02
299/454
Name Description Type Default Required
name windows_registry_info string “KnownDlls” no
groupTag windows_registry_info string “Recommended” no
enabled windows_registry_info bool true no
recurse windows_registry_info bool true no
description windows_registry_info string “” no
keyName windows_registry_info string
“HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\KnownDlls” no
valueName windows_registry_info string “” no
windows_change_tracking.registry_info.Extensions_03
Name Description Type Default Required
name windows_registry_info string “Extensions” no
groupTag windows_registry_info string “Recommended” no
enabled windows_registry_info bool true no
recurse windows_registry_info bool true no
description windows_registry_info string “” no
keyName windows_registry_info string
“HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Internet Explorer\Extensions” no
valueName windows_registry_info string “” no
windows_change_tracking.registry_info.Browser_Helper_Objects_04
Name Description Type Default Required
name windows_registry_info string “Browser_Helper_Objects” no
groupTag windows_registry_info string “Recommended” no
enabled windows_registry_info bool true no
recurse windows_registry_info bool true no
description windows_registry_info string “” no
keyName windows_registry_info string
“HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Explorer\Browser Helper Objects” no
valueName windows_registry_info string “” no
windows_change_tracking.registry_info.ShellIconOverlayIdentifiers_05
Name Description Type Default
name windows_registry_info string “ShellIconOverlayIdentifiers”
groupTag windows_registry_info string “Recommended”
enabled windows_registry_info bool true
recurse windows_registry_info bool true
description windows_registry_info string “”
keyName windows_registry_info string “HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Explorer\ShellIconOverlayIdentifiers”
valueName windows_registry_info string “”
windows_change_tracking.registry_info.ContextMenuHandlers_06
300/454
Name Description Type Default Required
name windows_registry_info string “ContextMenuHandlers” no
groupTag windows_registry_info string “Recommended” no
enabled windows_registry_info bool true no
recurse windows_registry_info bool true no
description windows_registry_info string “” no
keyName windows_registry_info string “HKEY_LOCAL_MACHINE\Software\Classes\Directory\ShellEx\ContextMenuHandlers” no
valueName windows_registry_info string “” no
windows_change_tracking.registry_info.ContextMenuHandlers_07
Name Description Type Default Required
name windows_registry_info string “ContextMenuHandlers” no
groupTag windows_registry_info string “Recommended” no
enabled windows_registry_info bool true no
recurse windows_registry_info bool true no
description windows_registry_info string “” no
keyName windows_registry_info string “HKEY_LOCAL_MACHINE\Software\Classes\Directory\Background\ShellEx\ContextMenuHandlers” no
valueName windows_registry_info string “” no
windows_change_tracking.registry_info.Shutdown_08
Name Description Type Default Required
name windows_registry_info string “Shutdown” no
groupTag windows_registry_info string “Recommended” no
enabled windows_registry_info bool true no
recurse windows_registry_info bool true no
description windows_registry_info string “” no
keyName windows_registry_info string
“HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Group
Policy\Scripts\Shutdown” no
valueName windows_registry_info string “” no
windows_change_tracking.registry_info.Startup_09
Name Description Type Default Required
name windows_registry_info string “Startup” no
groupTag windows_registry_info string “Recommended” no
enabled windows_registry_info bool true no
recurse windows_registry_info bool true no
description windows_registry_info string “” no
keyName windows_registry_info string
“HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Group
Policy\Scripts\Startup” no
valueName windows_registry_info string “” no
windows_change_tracking.registry_info.Extensions_10
301/454
Name Description Type Default Required
name windows_registry_info string “Extensions” no
groupTag windows_registry_info string “Recommended” no
enabled windows_registry_info bool true no
recurse windows_registry_info bool true no
description windows_registry_info string “” no
keyName windows_registry_info string
“HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer\Extensions” no
valueName windows_registry_info string “” no
windows_change_tracking.registry_info.Drivers32_11
Name Description Type Default Required
name windows_registry_info string “Drivers32” no
groupTag windows_registry_info string “Recommended” no
enabled windows_registry_info bool true no
recurse windows_registry_info bool true no
description windows_registry_info string “” no
keyName windows_registry_info string
“HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Drivers32” no
valueName windows_registry_info string “” no
windows_change_tracking.registry_info.CopyHookHandlers_12
Name Description Type Default Required
name windows_registry_info string “CopyHookHandlers” no
groupTag windows_registry_info string “Recommended” no
enabled windows_registry_info bool true no
recurse windows_registry_info bool true no
description windows_registry_info string “” no
keyName windows_registry_info string “HKEY_LOCAL_MACHINE\Software\Classes\Directory\Shellex\CopyHookHandlers” no
valueName windows_registry_info string “” no
windows_change_tracking.registry_info.Run_13
Name Description Type Default Required
name windows_registry_info string “Run” no
groupTag windows_registry_info string “Recommended” no
enabled windows_registry_info bool true no
recurse windows_registry_info bool true no
description windows_registry_info string “” no
keyName windows_registry_info string “HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Run” no
valueName windows_registry_info string “” no
windows_change_tracking.registry_info.Browser_Helper_Objects_x64_14
302/454
Name Description Type Default
name windows_registry_info string “Browser_Helper_Objects_x64”
groupTag windows_registry_info string “Recommended”
enabled windows_registry_info bool true
recurse windows_registry_info bool true
description windows_registry_info string “”
keyName windows_registry_info string
“HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Explorer\Browser Helper Objects”
valueName windows_registry_info string “”
windows_change_tracking.registry_info.Drivers32_x64_15
Name Description Type Default Required
name windows_registry_info string “Drivers32_x64” no
groupTag windows_registry_info string “Recommended” no
enabled windows_registry_info bool true no
recurse windows_registry_info bool true no
description windows_registry_info string “” no
keyName windows_registry_info string
“HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Drivers32” no
valueName windows_registry_info string “” no
windows_change_tracking.registry_info.Installed_Components_16
Name Description Type Default Required
name windows_registry_info string “Installed Components” no
groupTag windows_registry_info string “Recommended” no
enabled windows_registry_info bool true no
recurse windows_registry_info bool true no
description windows_registry_info string “” no
keyName windows_registry_info string
“HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Active
Setup\Installed Components” no
valueName windows_registry_info string “” no
windows_change_tracking.registry_info.Notify_17
Name Description Type Default Required
name windows_registry_info string “Notify” no
groupTag windows_registry_info string “Recommended” no
enabled windows_registry_info bool true no
recurse windows_registry_info bool true no
description windows_registry_info string “” no
keyName windows_registry_info string
“HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify” no
valueName windows_registry_info string “” no
windows_change_tracking.file_info.Windows_hosts_file_01
303/454
Name Description Type Default Required
name windows_file_info string “Windows_hosts_file” no
enabled windows_file_info bool true no
description windows_file_info string “” no
path windows_file_info string “C:\Windows\System32\drivers\etc\hosts” no
recurse windows_file_info bool false no
maxContentsReturnable windows_file_info number 5000000 no
maxOutputSize windows_file_info number 500000 no
checksum windows_file_info string “Md5” no
pathType windows_file_info string “File” no
groupTag windows_file_info string “Custom” no
change_track_linux_change_tracking
linux_change_tracking.extension_settings
Name Description Type Default Required
enableFiles linux_extension bool true no
enableSoftware linux_extension bool true no
enableServices linux_extension bool true no
enableInventory linux_extension bool true no
linux_change_tracking.file_info.Linux_hosts_file_01
Name Description Type Default Required
name linux_file_info string “Linux_hosts_file” no
enabled linux_file_info bool true no
destinationPath linux_file_info string “/etc/hosts” no
useSudo linux_file_info bool true no
recurse linux_file_info bool false no
maxContentsReturnable linux_file_info number 5000000 no
pathType linux_file_info string “File” no
type linux_file_info string “File” no
links linux_file_info string “Follow” no
maxOutputSize linux_file_info number 5000000 no
groupTag linux_file_info string “Custom” no
linux_change_tracking.file_info.Linux_conf_files_02
304/454
Name Description Type Default Required
name linux_file_info string “Linux_conf_files” no
enabled linux_file_info bool true no
destinationPath linux_file_info string “/etc/*.conf” no
useSudo linux_file_info bool true no
recurse linux_file_info bool true no
maxContentsReturnable linux_file_info number 100 no
pathType linux_file_info string “File” no
type linux_file_info string “File” no
links linux_file_info string “Follow” no
maxOutputSize linux_file_info number 500000 no
groupTag linux_file_info string “recommended” no
vm_management
Name Description Type Default Required
vm_management_enabled vm_management bool true no
vm_management_settings vm_management map(object()) {} no
vm_management_settings
Name Description Type Default Required
rg_name vm_management string rg-sch-vm-management-tst-ne-001 no
management_group_id_scope vm_management string [“mg-platform”, “mg-audit”] no
exclude_subscriptions vm_management string “” no
maintenance_schedules vm_management object() {} no
vm_management_maintenance_schedules
vm_management_settings.maintenance_schedules.3-tuesday-0200
Name Description Type Default Required
enabled maintenance_schedules bool true no
name maintenance_schedules string
“3-tuesday0200” no
maintenance_window maintenance_schedules object() {} no
install_patches maintenance_schedules object() {} no
maintenance_schedules_03_tue_02_maintenance_window
vm_management_settings.maintenance_schedules.3-tuesday-0200.maintenance_window
Name Description Type Default Required
start_date_time maintenance_window string “2023-07-25 02:00” no
duration maintenance_window string “02:00” no
time_zone maintenance_window string “UTC” no
recur_every maintenance_window string “1Month Third Tuesday” no
305/454
maintenance_schedules_03_tue_02_install_patches
vm_management_settings.maintenance_schedules.3-tuesday-0200.install_patches
Name Description Type Default Required
reboot_setting install_patches string “IfRequired” no
windows_settings install_patches object() {include_kbs = [],exclude_kbs = [],windows_classifications = [“Critical”, “Security”,
“UpdateRollup”,“FeaturePack”,“ServicePack”,“Definition”,“Tools”,“Updates”]} no
linux_settings install_patches object() { package_names_to_include = [],package_names_to_exclude = [],linux_classifications =
[“Critical”, “Security”, “Other”]} no
vm_management_settings.maintenance_schedules.3-tuesday-1200
Name Description Type Default Required
enabled maintenance_schedules bool true no
name maintenance_schedules string
“3-tuesday1200” no
maintenance_window maintenance_schedules object() {} no
install_patches maintenance_schedules object() {} no
maintenance_schedules_03_tue_12_maintenance_window
vm_management_settings.maintenance_schedules.3-tuesday-1200.maintenance_window
Name Description Type Default Required
start_date_time maintenance_window string “2023-07-25 12:00” no
duration maintenance_window string “02:00” no
time_zone maintenance_window string “UTC” no
recur_every maintenance_window string “1Month Third Tuesday” no
maintenance_schedules_03_tue_12_install_patches
vm_management_settings.maintenance_schedules.3-tuesday-1200.install_patches
Name Description Type Default Required
reboot_setting install_patches string “IfRequired” no
windows_settings install_patches object() {include_kbs = [],exclude_kbs = [],windows_classifications = [“Critical”, “Security”,
“UpdateRollup”,“FeaturePack”,“ServicePack”,“Definition”,“Tools”,“Updates”]} no
linux_settings install_patches object() { package_names_to_include = [],package_names_to_exclude = [],linux_classifications =
[“Critical”, “Security”, “Other”]} no
vm_management_settings.maintenance_schedules.3-tuesday-1900
Name Description Type Default Required
enabled maintenance_schedules bool true no
name maintenance_schedules string
“3-tuesday1900” no
maintenance_window maintenance_schedules object() {} no
install_patches maintenance_schedules object() {} no
maintenance_schedules_03_tue_19_maintenance_window
306/454
vm_management_settings.maintenance_schedules.3-tuesday-1900.maintenance_window
Name Description Type Default Required
start_date_time maintenance_window string “2023-07-25 19:00” no
duration maintenance_window string “02:00” no
time_zone maintenance_window string “UTC” no
recur_every maintenance_window string “1Month Third Tuesday” no
maintenance_schedules_03_tue_19_install_patches
vm_management_settings.maintenance_schedules.3-tuesday-1900.install_patches
Name Description Type Default Required
reboot_setting install_patches string “IfRequired” no
windows_settings install_patches object() {include_kbs = [],exclude_kbs = [],windows_classifications = [“Critical”, “Security”,
“UpdateRollup”,“FeaturePack”,“ServicePack”,“Definition”,“Tools”,“Updates”]} no
linux_settings install_patches object() { package_names_to_include = [],package_names_to_exclude = [],linux_classifications =
[“Critical”, “Security”, “Other”]} no
vm_management_settings.maintenance_schedules.4-tuesday-0200
Name Description Type Default Required
enabled maintenance_schedules bool true no
name maintenance_schedules string
“4-tuesday0200” no
maintenance_window maintenance_schedules object() {} no
install_patches maintenance_schedules object() {} no
maintenance_schedules_04_tue_02_maintenance_window
vm_management_settings.maintenance_schedules.4-tuesday-0200.maintenance_window
Name Description Type Default Required
start_date_time maintenance_window string “2023-07-25 02:00” no
duration maintenance_window string “02:00” no
time_zone maintenance_window string “UTC” no
recur_every maintenance_window string “1Month Fourth Tuesday” no
maintenance_schedules_04_tue_02_install_patches
vm_management_settings.maintenance_schedules.4-tuesday-0200.install_patches
Name Description Type Default Required
reboot_setting install_patches string “IfRequired” no
windows_settings install_patches object() {include_kbs = [],exclude_kbs = [],windows_classifications = [“Critical”, “Security”,
“UpdateRollup”,“FeaturePack”,“ServicePack”,“Definition”,“Tools”,“Updates”]} no
linux_settings install_patches object() { package_names_to_include = [],package_names_to_exclude = [],linux_classifications =
[“Critical”, “Security”, “Other”]} no
vm_management_settings.maintenance_schedules.4-tuesday-1200
307/454
Name Description Type Default Required
enabled maintenance_schedules bool true no
name maintenance_schedules string
“4-tuesday1200” no
maintenance_window maintenance_schedules object() {} no
install_patches maintenance_schedules object() {} no
maintenance_schedules_04_tue_12_maintenance_window
vm_management_settings.maintenance_schedules.4-tuesday-1200.maintenance_window
Name Description Type Default Required
start_date_time maintenance_window string “2023-07-25 12:00” no
duration maintenance_window string “02:00” no
time_zone maintenance_window string “UTC” no
recur_every maintenance_window string “1Month Fourth Tuesday” no
maintenance_schedules_04_tue_12_install_patches
vm_management_settings.maintenance_schedules.4-tuesday-1200.install_patches
Name Description Type Default Required
reboot_setting install_patches string “IfRequired” no
windows_settings install_patches object() {include_kbs = [],exclude_kbs = [],windows_classifications = [“Critical”, “Security”,
“UpdateRollup”,“FeaturePack”,“ServicePack”,“Definition”,“Tools”,“Updates”]} no
linux_settings install_patches object() { package_names_to_include = [],package_names_to_exclude = [],linux_classifications =
[“Critical”, “Security”, “Other”]} no
vm_management_settings.maintenance_schedules.4-tuesday-1900
Name Description Type Default Required
enabled maintenance_schedules bool true no
name maintenance_schedules string
“4-tuesday1900” no
maintenance_window maintenance_schedules object() {} no
install_patches maintenance_schedules object() {} no
maintenance_schedules_04_tue_19_maintenance_window
vm_management_settings.maintenance_schedules.4-tuesday-1900.maintenance_window
Name Description Type Default Required
start_date_time maintenance_window string “2023-07-25 19:00” no
duration maintenance_window string “02:00” no
time_zone maintenance_window string “UTC” no
recur_every maintenance_window string “1Month Fourth Tuesday” no
maintenance_schedules_04_tue_19_install_patches
vm_management_settings.maintenance_schedules.4-tuesday-1900.install_patches
308/454
Name Description Type Default Required
reboot_setting install_patches string “IfRequired” no
windows_settings install_patches object() {include_kbs = [],exclude_kbs = [],windows_classifications = [“Critical”, “Security”,
“UpdateRollup”,“FeaturePack”,“ServicePack”,“Definition”,“Tools”,“Updates”]} no
linux_settings install_patches object() { package_names_to_include = [],package_names_to_exclude = [],linux_classifications =
[“Critical”, “Security”, “Other”]} no
vm_management_settings.maintenance_schedules.dc-3-tuesday-0200
Name Description Type Default Required
enabled maintenance_schedules bool true no
name maintenance_schedules string
“dc-3-tuesday0200” no
maintenance_window maintenance_schedules object() {} no
install_patches maintenance_schedules object() {} no
maintenance_schedules_dc_03_tue_02_maintenance_window
vm_management_settings.maintenance_schedules.dc-3-tuesday-0200.maintenance_window
Name Description Type Default Required
start_date_time maintenance_window string “2023-07-25 02:00” no
duration maintenance_window string “02:00” no
time_zone maintenance_window string “UTC” no
recur_every maintenance_window string “1Month Third Tuesday” no
maintenance_schedules_dc_03_tue_02_install_patches
vm_management_settings.maintenance_schedules.dc-3-tuesday-0200.install_patches
Name Description Type Default Required
reboot_setting install_patches string “IfRequired” no
windows_settings install_patches object() {include_kbs = [],exclude_kbs = [],windows_classifications = [“Critical”, “Security”,
“UpdateRollup”,“FeaturePack”,“ServicePack”,“Definition”,“Tools”,“Updates”]} no
linux_settings install_patches object() { package_names_to_include = [],package_names_to_exclude = [],linux_classifications =
[]} no
vm_management_settings.maintenance_schedules.dc-3-wednesday-0200
Name Description Type Default Required
enabled maintenance_schedules bool true no
name maintenance_schedules string
“dc-3-wednesday0200” no
maintenance_window maintenance_schedules object() {} no
install_patches maintenance_schedules object() {} no
maintenance_schedules_dc_03_wed_02_maintenance_window
vm_management_settings.maintenance_schedules.dc-3-wednesday-0200.maintenance_window
309/454
Name Description Type Default Required
start_date_time maintenance_window string “2023-07-26 02:00” no
duration maintenance_window string “02:00” no
time_zone maintenance_window string “UTC” no
recur_every maintenance_window string “1Month Third Wednesday” no
maintenance_schedules_dc_03_wed_02_install_patches
vm_management_settings.maintenance_schedules.dc-3-wednesday-0200.install_patches
Name Description Type Default Required
reboot_setting install_patches string “IfRequired” no
windows_settings install_patches object() {include_kbs = [],exclude_kbs = [],windows_classifications = [“Critical”, “Security”,
“UpdateRollup”,“FeaturePack”,“ServicePack”,“Definition”,“Tools”,“Updates”]} no
linux_settings install_patches object() { package_names_to_include = [],package_names_to_exclude = [],linux_classifications =
[]} no
vm_management_settings.maintenance_schedules.sharedservices-3-tuesday-0200
Name Description Type Default Required
enabled maintenance_schedules bool true no
name maintenance_schedules string
“sharedservices-3-tuesday0200” no
maintenance_window maintenance_schedules object() {} no
install_patches maintenance_schedules object() {} no
maintenance_schedules_ss_03_tue_02_maintenance_window
vm_management_settings.maintenance_schedules.sharedservices-3-tuesday-0200.maintenance_window
Name Description Type Default Required
start_date_time maintenance_window string “2023-07-25 02:00” no
duration maintenance_window string “02:00” no
time_zone maintenance_window string “UTC” no
recur_every maintenance_window string “1Month Third Tuesday” no
maintenance_schedules_ss_03_tue_02_install_patches
vm_management_settings.maintenance_schedules.sharedservices-3-tuesday-0200.install_patches
Name Description Type Default Required
reboot_setting install_patches string “IfRequired” no
windows_settings install_patches object() {include_kbs = [],exclude_kbs = [],windows_classifications = [“Critical”, “Security”,
“UpdateRollup”,“FeaturePack”,“ServicePack”,“Definition”,“Tools”,“Updates”]} no
linux_settings install_patches object() { package_names_to_include = [],package_names_to_exclude = [],linux_classifications =
[“Critical”, “Security”, “Other”]} no
vm_management_settings.maintenance_schedules.sharedservices-3-wednesday-0200
310/454
Name Description Type Default Required
enabled maintenance_schedules bool true no
name maintenance_schedules string
“sharedservices-3-wednesday0200” no
maintenance_window maintenance_schedules object() {} no
install_patches maintenance_schedules object() {} no
maintenance_schedules_ss_03_wed_02_maintenance_window
vm_management_settings.maintenance_schedules.sharedservices-3-wednesday-0200.maintenance_window
Name Description Type Default Required
start_date_time maintenance_window string “2023-07-26 02:00” no
duration maintenance_window string “02:00” no
time_zone maintenance_window string “UTC” no
recur_every maintenance_window string “1Month Third Wednesday” no
maintenance_schedules_ss_03_wed_02_install_patches
vm_management_settings.maintenance_schedules.sharedservices-3-wednesday-0200.install_patches
Name Description Type Default Required
reboot_setting install_patches string “IfRequired” no
windows_settings install_patches object() {include_kbs = [],exclude_kbs = [],windows_classifications = [“Critical”, “Security”,
“UpdateRollup”,“FeaturePack”,“ServicePack”,“Definition”,“Tools”,“Updates”]} no
linux_settings install_patches object() { package_names_to_include = [],package_names_to_exclude = [],linux_classifications =
[“Critical”, “Security”, “Other”]} no
vm_management_settings.maintenance_schedules.app-3-tuesday-0200
Name Description Type Default Required
enabled maintenance_schedules bool true no
name maintenance_schedules string
“app-3-tuesday0200” no
maintenance_window maintenance_schedules object() {} no
install_patches maintenance_schedules object() {} no
maintenance_schedules_app_03_tue_02_maintenance_window
vm_management_settings.maintenance_schedules.app-3-tuesday-0200.maintenance_window
Name Description Type Default Required
start_date_time maintenance_window string “2023-07-25 02:00” no
duration maintenance_window string “02:00” no
time_zone maintenance_window string “UTC” no
recur_every maintenance_window string “1Month Third Tuesday” no
maintenance_schedules_app_03_tue_02_install_patches
vm_management_settings.maintenance_schedules.app-3-tuesday-0200.install_patches
311/454
Name Description Type Default Required
reboot_setting install_patches string “IfRequired” no
windows_settings install_patches object() {include_kbs = [],exclude_kbs = [],windows_classifications = [“Critical”, “Security”,
“UpdateRollup”,“FeaturePack”,“ServicePack”,“Definition”,“Tools”,“Updates”]} no
linux_settings install_patches object() { package_names_to_include = [],package_names_to_exclude = [],linux_classifications =
[“Critical”, “Security”, “Other”]} no
vm_management_settings.maintenance_schedules.app-3-tuesday-1200
Name Description Type Default Required
enabled maintenance_schedules bool true no
name maintenance_schedules string
“app-3-tuesday1200” no
maintenance_window maintenance_schedules object() {} no
install_patches maintenance_schedules object() {} no
maintenance_schedules_app_03_tue_12_maintenance_window
vm_management_settings.maintenance_schedules.app-3-tuesday-1200.maintenance_window
Name Description Type Default Required
start_date_time maintenance_window string “2023-07-25 12:00” no
duration maintenance_window string “02:00” no
time_zone maintenance_window string “UTC” no
recur_every maintenance_window string “1Month Third Tuesday” no
maintenance_schedules_app_03_tue_12_install_patches
vm_management_settings.maintenance_schedules.app-3-tuesday-1200.install_patches
Name Description Type Default Required
reboot_setting install_patches string “IfRequired” no
windows_settings install_patches object() {include_kbs = [],exclude_kbs = [],windows_classifications = [“Critical”, “Security”,
“UpdateRollup”,“FeaturePack”,“ServicePack”,“Definition”,“Tools”,“Updates”]} no
linux_settings install_patches object() { package_names_to_include = [],package_names_to_exclude = [],linux_classifications =
[“Critical”, “Security”, “Other”]} no
vm_management_settings.maintenance_schedules.app-3-tuesday-1900
Name Description Type Default Required
enabled maintenance_schedules bool true no
name maintenance_schedules string
“app-3-tuesday1900” no
maintenance_window maintenance_schedules object() {} no
install_patches maintenance_schedules object() {} no
maintenance_schedules_app_03_tue_19_maintenance_window
vm_management_settings.maintenance_schedules.app-3-tuesday-1900.maintenance_window
312/454
Name Description Type Default Required
start_date_time maintenance_window string “2023-07-25 19:00” no
duration maintenance_window string “02:00” no
time_zone maintenance_window string “UTC” no
recur_every maintenance_window string “1Month Third Tuesday” no
maintenance_schedules_app_03_tue_19_install_patches
vm_management_settings.maintenance_schedules.app-3-tuesday-1900.install_patches
Name Description Type Default Required
reboot_setting install_patches string “IfRequired” no
windows_settings install_patches object() {include_kbs = [],exclude_kbs = [],windows_classifications = [“Critical”, “Security”,
“UpdateRollup”,“FeaturePack”,“ServicePack”,“Definition”,“Tools”,“Updates”]} no
linux_settings install_patches object() { package_names_to_include = [],package_names_to_exclude = [],linux_classifications =
[“Critical”, “Security”, “Other”]} no
vm_management_settings.maintenance_schedules.app-4-tuesday-0200
Name Description Type Default Required
enabled maintenance_schedules bool true no
name maintenance_schedules string
“app-4-tuesday0200” no
maintenance_window maintenance_schedules object() {} no
install_patches maintenance_schedules object() {} no
maintenance_schedules_app_04_tue_02_maintenance_window
vm_management_settings.maintenance_schedules.app-4-tuesday-0200.maintenance_window
Name Description Type Default Required
start_date_time maintenance_window string “2023-07-25 02:00” no
duration maintenance_window string “02:00” no
time_zone maintenance_window string “UTC” no
recur_every maintenance_window string “1Month Fourth Tuesday” no
maintenance_schedules_app_04_tue_02_install_patches
vm_management_settings.maintenance_schedules.app-4-tuesday-0200.install_patches
Name Description Type Default Required
reboot_setting install_patches string “IfRequired” no
windows_settings install_patches object() {include_kbs = [],exclude_kbs = [],windows_classifications = [“Critical”, “Security”,
“UpdateRollup”,“FeaturePack”,“ServicePack”,“Definition”,“Tools”,“Updates”]} no
linux_settings install_patches object() { package_names_to_include = [],package_names_to_exclude = [],linux_classifications =
[“Critical”, “Security”, “Other”]} no
vm_management_settings.maintenance_schedules.app-4-tuesday-1900
313/454
Name Description Type Default Required
enabled maintenance_schedules bool true no
name maintenance_schedules string
“app-4-tuesday1900” no
maintenance_window maintenance_schedules object() {} no
install_patches maintenance_schedules object() {} no
maintenance_schedules_app_04_tue_19_maintenance_window
vm_management_settings.maintenance_schedules.app-4-tuesday-1900.maintenance_window
Name Description Type Default Required
start_date_time maintenance_window string “2023-07-25 19:00” no
duration maintenance_window string “02:00” no
time_zone maintenance_window string “UTC” no
recur_every maintenance_window string “1Month Fourth Tuesday” no
maintenance_schedules_app_04_tue_19_install_patches
vm_management_settings.maintenance_schedules.app-4-tuesday-1900.install_patches
Name Description Type Default Required
reboot_setting install_patches string “IfRequired” no
windows_settings install_patches object() {include_kbs = [],exclude_kbs = [],windows_classifications = [“Critical”, “Security”,
“UpdateRollup”,“FeaturePack”,“ServicePack”,“Definition”,“Tools”,“Updates”]} no
linux_settings install_patches object() { package_names_to_include = [],package_names_to_exclude = [],linux_classifications =
[“Critical”, “Security”, “Other”]} no
LAST APPLIED CONFIGURATION
TEMP Comment: Leave as is for now, will be used later to dynamically update with customer specific config.
outputs
Since state sharing is not recommended due to security the outputs are important if any resources need to be referenced
management_outputs
314/454
Name Description
workspace_resource_id management_outputs
workspace_resource_name management_outputs
workspace_resource_group_name management_outputs
ipam_function_name management_outputs
ipam_resource_group_name management_outputs
ipam_subscription_id management_outputs
action_group_name_warning management_outputs
action_group_name_critical management_outputs
action_group_id_warning management_outputs
action_group_id_critical management_outputs
dcr_name_linux management_outputs
dcr_name_windows management_outputs
dcr_suffix_standard management_outputs
dcr_vmi_suffix management_outputs
dcr_sec_suffix management_outputs
vm_management_rg_name management_outputs
ipam_endpoints
Name Description
get_networks ipam_endpoints
delete_network ipam_endpoints
update_network ipam_endpoints
set_network_range ipam_endpoints
slice_cidr ipam_endpoints
ipam_token - the primary key for the IPAM function (sensitive value) being used to authenticate the IPAM function
(in the Application Landing Zone Blueprint)
input descriptions
instance
The instance number of the deployed module. The number must be unique for each of location and contains 3 digits.
append_tags
Additional tags to be applied to the resources along with globally defined tags. Common for all resources in this blueprint
log_analytics
log_analytics_enabled
Enable or disable log analytics module
log_analytics_workspace_name
The name of a workspace
315/454
log_analytics_workspace_sku
The SKU (tier) of a workspace ##### log_analytics_retention_in_days
The workspace data retention in days. -1 means Unlimited retention for the Unlimited Sku. 730 days is the maximum
allowed for all other Skus ##### log_analytics_daily_quota_gb
The workspace daily quota for ingestion in GB
blob_backup_automation
blob_backup_enable
Indicates if blob backup to be deployed
blob_backup_function_name
The custom name of the function app
blob_backup_management_group_id_scope
Name of the target Management Group. Used during Azure Function deployment as new custom Application Setting
named “managementGroupIdScope” and during each function execution in run.ps1 for getting all subscriptions in management group ##### blob_backup_redundancy
Backup Vault storage redundancy, more about geo and local redundancy. Used during Azure Function deployment as new
custom Application Setting named “redundancy” and in run.ps1 in new-backupVault powershell function #####
blob_backup_retention
Provide the retention duration up to which the backups are to be retained in the data stores. Used during Azure Function
deployment as new custom Application Setting named “blobBackupRetention”. Used also in run.ps1 during checking
existing storage accounts tags and as parameter during creation of the new Backup vaults or policies for the existing
Backup Vaults. ##### blob_backup_container_soft_delete_retention
Indicates the number of days that the deleted item should be retained. The minimum specified value can be 1 and the maximum value can be 365. Used during Azure Function deployment as new custom Application Setting named
“containerSoftDeleteRetention”. Will be applied to the properly tagged container with disabled container’s soft delete
option, used in run.ps1 ##### blob_backup_cis_compliant
If true, configures the function app with a Standard SKU size and VNet integration which allows only traffic over that
VNet to access the Storage Account. It will create a corresponding firewall rule on any target Storage Accounts to allow
only traffic over this VNet to access the Storage Accounts. Also enabled alwaysOn for function application. #####
blob_backup_serverfarms
Config map with sku details in case of cis and noncis. sku = “Y1” and used in case Non-CIS, cisSku=“S1” and used in
case of CIS ##### windows_function_app_http2_enabled
Enables HTTP 2.0. for function app ##### windows_function_app_client_certificate_enabled
Enables client certificate authentication, also known as TLS mutual authentication, this requests a client certificate when
the client request is over TLS/SSL and validates the certificate. Both windows_function_app_client_certificate_enabled
and windows_function_app_http2_enabled settings needs to be true in order to maintain CIS complaince. #####
application_insights_workspace_id
ID of the operational Log Analyatics Workspace ##### storage_supports_https_traffic_only
316/454
Allows https traffic only to storage service if sets to true ##### storage_allow_blob_public_access
Allow or disallow public access to all blobs or containers in the storage account ##### storage_network_acls_bypass
Specifies whether traffic is bypassed for Logging/Metrics/AzureServices. Possible values are any combination of
Logging,Metrics,AzureServices (For example, “Logging, Metrics”), or None to bypass none of those traffics #####
storage_network_acls_default_action
Specifies the default action of allow or deny when no other rules match #####
storage_network_acls_virtual_network_rules
Sets the allowed Subnets, list of subnet resource ids ##### storage_network_acls_ip_rules
Sets the IP ACL rules, public IP or IP ranges in CIDR Format ##### network_address_space
The network address space ##### subnet_network_address_space
The subnet network address space
sentinel
sentinel_enabled
Indicates if Sentinel module to be deployed ##### data_connectors_azure_security_center_enabled
Indicates if azure security center data connectors to be deployed #####
data_connectors_azure_security_center_management_group_id_scope
Name of management group, whose subscriptions to be connected with azure security center data connector #####
log_analytics_workspace_id
ID of the Log Analytics workspace with which the solution will be linked
sandbox_automation
sandbox_automation_enabled
Indicates if Sandbox Automation module to be deployed
sandbox_automation_instance_enabled
Indicates if this instance of sandbox automation needs to be deployed
sandbox_automation_location
Location of the sandbox automation
sandbox_automation_location_short
Short name of the location
sandbox_automation_rg_name
Name of the Resource Group
sandbox_automation_custom_service_name
317/454
Custom service name to be used in construction of rg name etc.,
sandbox_automation_service_plan_name
Name of the App service plan
sandbox_automation_app_insights_name
Name of the App Insights
sandbox_automation_vnet_name
Name of the Vnet
sandbox_automation_nsg_name
Name of the network security group
sandbox_automation_snet_name
Name of the subnet
sandbox_automation_cis_compliant
Indicates if CIS compliant
sandbox_automation_log_analytics_workspace_id
ID of log analytics workspace
sandbox_automation_vnet_address_prefixes
network address space to use for vnet creation
sandbox_automation_snet_address_prefixes
subnet address space to use for subnet
sandbox_automation_settings_default_properties
Sandbox Automation Settings Default Properties
default_properties_rg_delete_cron
Timer schedule for check_rgs function
default_properties_vm_shutdown_cron
Timer schedule for check_vms function
default_properties_sub_disable_cron
Timer schedule for check_subs function
default_properties_sub_auto_enabled
318/454
If false, the subscription automation (disable) will be turned off
default_properties_vm_auto_enabled
If false, the Virtual Machine automation (start/stop) will be turned off
default_properties_rg_auto_enabled
If false, the resource groups automation (delete) will be turned off
default_properties_decommissioned_mgmt_group_name
Management Group name which the disabled Subscription will be moved to
default_properties_rg_delete_tag_name
If rgDeleteTagName tag name will be found, function will check tag value and if it is expired, Resource Group will be
deleted. If rgDeleteTagName is not found, function will add this tag
default_properties_rg_delete_days
Maximum Resource Group’s lifespan. Resource Group will be deleted in rgDeleteDays (30 days by default) from the
given in "rgDeleteTagName":"tagValue" date.
default_properties_vm_shutdown_default
Default stop hour for VM in UTC Timezone. If a tag value in "vmShutdownTag":"tagValue" pair is not found or if a tag
value can not be converted to integer, a default value is set
default_properties_vm_shutdown_tag
Tag name in "vmShutdownTag":"tagValue" tag pair. Used to automate the shutdown of tagged virtual machines.
default_properties_vm_startup_tag
Tag name in "VMStart":"tagValue" tag pair. Used to automate the startup of tagged virtual machines.
default_properties_vm_disable_shutdown_tag
If VM’s tags are cointaining this tag, automation for tagged VM will be disabled
default_properties_hostile_delete_rg
If value in "hostileDeleteRG" is set to "true", the function removes resource locks from RG
default_properties_protected_rg_list
List of protected Resource Groups
default_properties_sub_disable_tag_name
Tag name in "subDisableTagName":"tagValue" tag pair. Used to automate the disable of tagged virtual machines.
default_properties_sub_disable_days
319/454
Maximum Subscription’s lifespan. Subscription will be disabled in subDisableDays (30 days by default) from the given
in "subDisableTagName":"tagValue" date.
default_properties_protected_sub_list
List of protected Subscriptions’ ID
default_properties_force_disable_sub
If the value in "forceDisableSub" is set to "true", the function force disable the subscription
sandbox_automation_settings_properties
Sandbox Automation Settings Properties
properties_sub_auto_enabled
I f sub_auto_enabled is not found, will use the
sandbox_automation_settings_default_properties.sub_auto_enabled
properties_sandbox_management_group_name
Sandbox Management Group ID
properties_vm_auto_enabled
I f vm_auto_enabled is not found, will use the
sandbox_automation_settings_default_properties.vm_auto_enabled
properties_rg_auto_enabled
I f rg_auto_enabled is not found, will use the
sandbox_automation_settings_default_properties.rg_auto_enabled
properties_rg_delete_tagname
I f rg_delete_tagName is not found, will use the
sandbox_automation_settings_default_properties.rg_delete_tagName
properties_rg_delete_days
If rg_delete_days is not found, will use the sandbox_automation_settings_default_properties.rg_delete_days
properties_rg_delete_cron
If rg_delete_cron is not found, will use the sandbox_automation_settings_default_properties.rg_delete_cron
properties_vm_shutdown_cron
I f vm_shutdown_cron is not found, will use the
sandbox_automation_settings_default_properties.vm_shutdown_cron
properties_vm_shutdown_default
320/454
I f vm_shutdown_default is not found, will use the
sandbox_automation_settings_default_properties.vm_shutdown_default
properties_vm_shutdown_tag
I f vm_shutdown_tag is not found, will use the
sandbox_automation_settings_default_properties.vm_shutdown_tag
properties_vm_startup_tag
If vm_startup_tag is not found, will use the sandbox_automation_settings_default_properties.vm_startup_tag
properties_vm_disable_shutdown_tag
I f vm_disable_shutdown_tag is not found, will use the
sandbox_automation_settings_default_properties.vm_disable_shutdown_tag
properties_hostile_delete_rg
I f hostile_delete_rg is not found, will use the
sandbox_automation_settings_default_properties.hostile_delete_rg
properties_protected_rg_list
I f protected_rg_list is not found, will use the
sandbox_automation_settings_default_properties.protected_rg_list
app_service
Function App configurations
app_service_name
Name of the function app. If left empty, terrafrom will construct the name
app_service_client_cert_enabled
Enables client certificate authentication, also known as TLS mutual authentication, this requests a client certificate when
the client request is over TLS/SSL and validates the certificate.
app_service_http2_enabled
Enables HTTP 2.0.
Both client_cert_enabled and http2_enabled settings needs to be true in order to maintain CIS complaince.
server_farms
server_farms
server_farms_sku
The sku used for the Azure function if cis_compliant is false.
server_farms_cis_sku
321/454
The sku used for the Azure function if cis_compliant is true.
storage_account
Storage Account
storage_account_name
Name of the storage account. If left empty, terrafrom will construct the name
storage_account_tier
Tier of storage account
storage_account_replication
Replication type of storage account. Eg. LRS, GRS etc.,
storage_account_supports_https_traffic_only
Allows https traffic only to storage service if sets to true
storage_account_allow_blob_public_access
Allow or disallow public access to all blobs or containers in the storage account
storage_account_network_acls_bypass
Specifies whether traffic is bypassed for Logging/Metrics/AzureServices. Possible values are any combination of
Logging,Metrics,AzureServices (For example, “Logging, Metrics”), or None to bypass none of those traffics
storage_account_network_acls_default_action
Specifies the default action of allow or deny when no other rules match
storage_account_network_acls_virtual_network_rules
Sets the allowed Subnets, list of subnet resource ids
storage_account_network_acls_ip_rules
Sets the IP ACL rules, public IP or IP ranges in CIDR Format
light_house
light_house_enabled
Indicates if Light House module to be deployed
light_house_instance_enabled
Indicates if this instance of Light House needs to be deployed
light_house_location
322/454
Location of the Light House instance
light_house_location_short
Short name of the location
light_house_rg_name
Name of the Resource Group
light_house_custom_service_name
Custom service name to be used in construction of rg name etc.,
light_house_service_plan_name
Name of the App service plan
light_house_app_insights_name
Name of the App Insights
light_house_vnet_name
Name of the Vnet
light_house_nsg_name
Name of the network security group
light_house_snet_name
Name of the subnet
light_house_cis_compliant
Indicates if CIS compliant
light_house_management_goup_id_scope
Name of the customer’s ACF Root Management Group
light_house_msp_offer_name
The display name of the Registration Definition
light_house_msp_offer_description
Description of the type of access that will be granted, the description of the Registration Definition
light_house_managed_by_tenant_id
Property contains a nordcloud.com tenant ID from which MC groups will be taken.
light_house_principal_id
323/454
Object ID of the Principal that will manage these Azure Subscriptions.
Change to a newly created AAD Group created in Nordcloud tenant for the customer
light_house_role_definition_id
Azure RBAC role ID that will be assigned during creation/updating of the registration definition.
Default is Contributor
light_house_principal_id_display_name
Currently is not in use
light_house_excluded_tag_name
Tag name in "Nordcloud-Managed":"tagValue" tag pair.
light_house_excluded_tag_value
Tag value in "Nordcloud-Managed":"tagValue" tag pair. If tag’s "Nordcloud-Managed" (assuming default) value on
the subscription level is equal to false (assuming default), subscription will be skipped and Lighthouse will not be
enabled / Resource Provider will not be registered for it. If the tag value changed, subscription will be automatically
unassigned.
light_house_vnet_address_prefixes
network address space to use for vnet creation
light_house_snet_address_prefixes
subnet address space to use for subnet
light_house_snet_endpoints
subnet address space to use for subnet
light_house_log_analytics_workspace_id
ID of log analytics workspace
function_app
Function App configurations
function_app_name
Name of the function app. If left empty, terrafrom will construct the name
function_app_identity_type
Type of identity to be assigned to the function app
function_app_https_only
Indicates of only HTTPS to be allowed
324/454
function_app_client_certificate_enabled
Enables client certificate authentication, also known as TLS mutual authentication, this requests a client certificate when
the client request is over TLS/SSL and validates the certificate.
function_app_client_certificate_mode
Should the function app use Client Certificates?
function_app_auth_settings
Indicates if the Authentication / Authorization feature be enabled for the Windows Function App?
function_app_http2_enabled
Specifies if the HTTP2 protocol should be enabled.
function_app_ftps_state
State of FTP / FTPS service for this Windows Function App. Possible values include: AllAllowed, FtpsOnly and Disabled
function_app_minimum_tls_version
Configures the minimum version of TLS required for SSL requests. Possible values include: 1.0, 1.1, and 1.2
function_app_scale_limit
The number of workers this function app can scale out to.
functions_extension_version
The runtime version associated with the Function App
estate_helper
estate_helper_enabled
Indicates if estate helper needs to be deployed
estate_helper_rg_name
Name of resource group for estate helper. If empty, terraform constructs the same.
estate_helper_kv_name
Name of keyvault. If empty, terraform constructs the same.
estate_helper_kv_short_name
Short Name of keyvault
estate_helper_kv_kek_expiry_days
The number of days after which the VM disk key encryption key expires.
estate_helper_kv_enable_purge_protection
325/454
I f true, protection against purge is enabled for this vault. The setting is effective only if soft delete is also enabled.
Enabling this functionality is irreversible - that is, the property does not accept false as its value.
estate_helper_kv_enabled_for_deployment
If true, Azure Virtual Machines are permitted to retrieve certificates stored as secrets from the key vault.
estate_helper_kv_enabled_for_template_deployment
If true, Azure Resource Manager is permitted to retrieve secrets from the key vault.
estate_helper_kv_enabled_for_disk_encryption
If true, Azure Disk Encryption is permitted to retrieve secrets from the vault and unwrap keys.
estate_helper_kv_enable_rbac_authorization
If true, the key vault will use Role Based Access Control (RBAC) for authorization of data actions, and the access policies
specified in vault properties will be ignored.
estate_helper_kv_sku
Key Vault SKU name to specify whether the key vault is a standard vault or a premium vault.
estate_helper_kv_permissions
An object giving access to the key vault. All identities must use the same tenantID as the key vault’s tenant ID. Any
RBAC role can be specified
estate_helper_kv_access_policies
Rights should be specified here if enableRbacAuthorization is set to false. An array of 0 to 1024 identities that have access
to the key vault. All identities in the array must use the same tenant ID as the key vault’s tenant ID
estate_helper_kv_network_acls_bypass
Specifies which traffic can bypass the network rules. Possible values are AzureServices and None
estate_helper_kv_network_acls_default_action
The Default Action to use when no rules match from estate_helper_kv_network_acls_ip_rules /
estate_helper_kv_network_acls_virtual_network_rules. Possible values are Allow and Deny
estate_helper_kv_network_acls_virtual_network_rules
One or more Subnet IDs which should be able to access this Key Vault
estate_helper_kv_network_acls_ip_rules
One or more IP Addresses, or CIDR Blocks which should be able to access the Key Vault
Note: ADD YOUR IP HERE, IF TESTING LOCALLY
estate_helper_spn_name
Name of the SPN to use for creating the application
326/454
estate_helper_identifier_uris
A set of user-defined URI(s) that uniquely identify an application within its Azure AD tenant, or within a verified custom
domain if the application is multi-tenant.
estate_helper_deployment_architect_object_id
Object ID to assign permissions on the Application
estate_helper_application_password_expiry
Expiry duration in hours for the application password
estate_helper_rotate_application_password
Duration in years, after which the application password will be rotated
estate_helper_management_group_assignment
Scope to provide rbac roles for the created SPN
estate_helper_rbac_role
Role to be provided for the SPN
service_health_alerting
service_health_alerting_enabled
Indicates if service health alert needs to be deployed
service_health_management_group_id_scope
Name of the platform Management Group to define scope of monitoring
service_health_action_group_name
Name of the Action Group that will be created
service_health_monitored_regions
List of Azure regions (full name) included in Service Health alerting
service_health_alert_name
Name of the Activity Log Alert
service_health_resource_group
Resource Group name of Service Health Alerting
service_health_email_receivers
327/454
The list of maps with email receivers that are part of action group. Each email receiver map contains following:
The name of the email receiver. Names must be unique across all receivers within an action group
The email address of receiver
Indicates whether to use common alert schema
service_health_webhook_receivers_warning_enabled
Indicates if webhook receivers needs to be configured for the action group
service_health_webhook_receivers_warning_properties
The list of maps with webhook receivers that are part of action group. Each webhook receiver map contains following:
The name of the webhook receiver. Names must be unique across all receivers within an action group
The webhook URI of receiver
Indicates whether to use common alert schema
Note: Service URI is a required parameter
ipam
ipam_enabled
Indicates if ipam module to be deployed
ipam_instance_enabled
Indicates if this instance of ipam needs to be deployed
ipam_location
Location of the ipam instance
ipam_location_short
Short name of the location
ipam_rg_name
Name of the Resource Group
ipam_custom_service_name
Custom service name to be used in construction of rg name etc.,
ipam_service_plan_name
Name of the App service plan
email_receivers:
- email_address : "testuser-EmailAction-"
name : "notExistingMail@nordcloud.com"
use_common_alert_schema : true
webhook_receivers_warning_properties:
- service_uri :
"https://events.pagerduty.com/integration/c3343244324232/enqueue" ## REPLACE WITH ACTUAL
name : "Warning"
use_common_alert_schema : true
328/454
ipam_app_insights_name
Name of the App Insights
ipam_vnet_name
Name of the Vnet
ipam_nsg_name
Name of the network security group
ipam_snet_name
Name of the subnet
ipam_cis_compliant
Indicates if CIS compliant
ipam_supernet_table_name
Name of the Storage Account Table where defined supernets will be stored
ipam_network_table_name
Name of the Storage Account Table where allocated CIDRs for VNET will be stored
ipam_subnet_table_name
Name of the Storage Account Table where allocated CIDRs for Subnet will be stored
ipam_azure_enabled
Defines if Storage Account will be created with above tables for Azure reservations
ipam_aws_enabled
Defines if Storage Account will be created with above tables for AWS reservations
ipam_gcp_enabled
Defines if Storage Account will be created with above tables for GCP reservations
ipam_ip_security_restrictions
Indicates if ip restrictions needs to be enabled for function app
ipam_ip_security_restrictions_allow
If ip_security_restrictions is true, list of ips that needs to be whitelisted. Example as below
ip_security_restrictions_allow:
- action : "Allow"
description : "Allow Traffic"
ip_address : "0.0.0.0/0"
name : "AppIpAllow"
priority : "100"
329/454
ipam_vnet_address_prefixes
network address space to use for vnet creation
ipam_snet_address_prefixes
subnet address space to use for subnet
ipam_log_analytics_workspace_id
ID of log analytics workspace
supernet
List containing objects for supernets. Example as below:
supernet_azure
subscription_budget
subscription_budget_enabled
Indicates if subscription budget module to be deployed
subscription_budget_instance_enabled
Indicates if this instance of subscription budget needs to be deployed
subscription_budget_location
Location of the subscription budget instance
subscription_budget_location_short
Short name of the location
subscription_budget_rg_name
Name of the Resource Group
subscription_budget_custom_service_name
Custom service name to be used in construction of rg name etc.,
subscription_budget_service_plan_name
Name of the App service plan
azure :
- location: "westeurope"
name: "mg-corp-we-1"
cidr: "10.222.128.0/17"
- location: "westeurope"
name: "mg-hybrid-we-1"
cidr: "10.222.32.0/19"
- location: "westeurope"
name: "mg-online-we-1"
cidr: "172.16.0.0/12"
330/454
subscription_budget_app_insights_name
Name of the App Insights
subscription_budget_vnet_name
Name of the Vnet
subscription_budget_nsg_name
Name of the network security group
subscription_budget_snet_name
Name of the subnet
subscription_budget_cis_compliant
Indicates if CIS compliant
subscription_budget_management_group_id_scope
Name of the customer’s ACF Root Management Group.
subscription_budget_tenant_id
Tenant ID of the customer’s ACF Root
subscription_budget_contact_tag_name
The tag name ‘contact’ can be adjusted based on customer needs.
subscription_budget_budget_tag_name
The tag name ‘budget’ can be adjusted based on customer needs.
subscription_budget_threshold_tag_name
The tag name ‘threshold’ can be adjusted based on customer needs.
subscription_budget_budgets
List of objects with config related to budgets. Each object has the following parameters
Contact : The email address of the subscription owner.
subscription_id : Subscription ID
threshold : The information email will be sent to the contact once the % of threshold level is reached.
budget : The maximum limit for cost usage in the subscription, based on the subscription currency.
delete : if value is set to true, then after reaching the budget limit, depending on the resource, the resource group will be
deleted or the subscription will be canceled.
subscription_budget_budgets_value
budgets :
- contact : "nobody@nordcloud.com"
subscription_id : "5959d188-3a85-4a68-98e0-af236b3c2cac"
threshold : 70
budget : 50
331/454
subscription_budget_vnet_address_prefixes
network address space to use for vnet creation
subscription_budget_snet_address_prefixes
subnet address space to use for subnet
subscription_budget_log_analytics_workspace_id
ID of log analytics workspace
platform_change_alerting
platform_change_alerting_enabled
Indicates if Platform Change Alerting module needs to be deployed
platform_change_alert_rg_name
Resource Group for Platform Change Alerting
platform_change_alert_action_group_name
Name of the Action Group that will be created
platform_change_alert_platform_change_alert_name
Name of the Activity Log Alert
platform_change_alert_evaluation_frequency
Evaluation of scheduled query alert
platform_change_alert_window_duration
Window of scheduled query alert
platform_change_alert_severity
Severity of scheduled query alert
platform_change_alert_workspace_id
ID of the Operational Log Analytics Workspace
platform_change_alert_scope_names
List of names of the management groups hosting the resources and subscriptions that require monitoring on change
platform_change_alert_email_receivers
delete : "True"
332/454
The list of maps with email receivers that are part of action group. Each email receiver map contains following:
The name of the email receiver. Names must be unique across all receivers within an action group
The email address of receiver
Indicates whether to use common alert schema
platform_change_alert_webhook_receivers_warning_enabled
Indicates whether action group is using webhooks or not
platform_change_alert_webhook_receivers_warning_properties
The list of maps with webhook receivers that are part of action group. Each webhook receiver map contains following:
The name of the webhook receiver. Names must be unique across all receivers within an action group
The webhook URI of receiver
Indicates whether to use common alert schema
Note: Service URI is a required parameter
platform_change_alert_settings_exclusions
exclusions_operation_name_values
Operation Names for exclusion (CASE SENSITIVE). Sample value is as below
exclusions_operation_name_values_default
exclusions_subscription_ids
Subscription Id’s in the mg-platform that should be excluded
exclusions_resource_ids
email_receivers:
- email_address : "testuser-EmailAction-"
name : "notExistingMail@nordcloud.com"
use_common_alert_schema : true
webhook_receivers_warning_properties:
- service_uri :
"https://events.pagerduty.com/integration/c3343244324232/enqueue" ## REPLACE WITH ACTUAL
name : "Warning"
use_common_alert_schema : true
operation_name_values : [
"MICROSOFT.STORAGE/STORAGEACCOUNTS/LISTKEYS/ACTION",
"MICROSOFT.NETWORK/BASTIONHOSTS/GETACTIVESESSIONS/ACTION",
"MICROSOFT.COMPUTE/VIRTUALMACHINES/RESTART/ACTION",
"MICROSOFT.COMPUTE/VIRTUALMACHINES/DEALLOCATE/ACTION",
"MICROSOFT.COMPUTE/VIRTUALMACHINES/START/ACTION",
"MICROSOFT.CHANGEANALYSIS/RESOURCECHANGES/ACTION",
"MICROSOFT.AUTHORIZATION/ROLEASSIGNMENTS/WRITE",
"MICROSOFT.NETWORK/NETWORKWATCHERS/IPFLOWVERIFY/ACTION",
"MICROSOFT.KEYVAULT/VAULTS/WRITE",
"MICROSOFT.WEB/SITES/HOST/SYNC/ACTION",
"MICROSOFT.NETWORK/VPNGATEWAYS/GETBGPPEERSTATUS/ACTION",
"MICROSOFT.NETWORK/VIRTUALHUBS/EFFECTIVEROUTES/ACTION",
"MICROSOFT.NETWORK/NETWORKINTERFACES/EFFECTIVENETWORKSECURITYGROUPS/ACTION",
"MICROSOFT.NETWORK/PRIVATEDNSZONES/A/WRITE",
"MICROSOFT.NETWORK/PRIVATEDNSZONES/A/DELETE"
]
333/454
Resource ID’s of resources that should be excluded (CASE SENSITIVE)
exclusions_resource_groups
Resource groups that should be excluded (CASE SENSITIVE)
monitoring
monitoring_enabled
Indicates if monitoring module to be deployed
monitoring_rg_name_logging
Resource group name for Logging resource group
monitoring_log_analytics_workspace_id
Log Analytics Workspace resource ID, used in all associative templates.
monitoring_workspace_friendly_name
Friendly name used for referencing within templates. This can be changed, but has no impact on deployed resources.
monitoring_email_receivers_default
The list of maps with email receivers that are part of warning action group (If email_receivers_default is left empty). Each
email receiver map contains following:
The name of the email receiver. Names must be unique across all receivers within an action group
The email address of receiver
Indicates whether to use common alert schema
Note: email_address is a required parameter
monitoring_email_receivers_critical
The list of maps with email receivers that are part of critical action group (If left empty,email_receivers_default will be
used for critical action group ). Each email receiver map contains following:
The name of the email receiver. Names must be unique across all receivers within an action group
The email address of receiver
Indicates whether to use common alert schema
Note: email_address is a required parameter
monitoring_webhook_receivers_criticial_enabled
Indicates whether critical action group is using webhooks or not
monitoring_webhook_receivers_critical_properties
email_receivers_default:
- email_address : "testuser-EmailAction-"
name : "notExistingMail@nordcloud.com"
use_common_alert_schema : true
email_receivers_critical:
- email_address : "testuser-EmailAction-"
name : "notExistingMail@nordcloud.com"
use_common_alert_schema : true
334/454
The list of maps with webhook receivers that are part of critical action group. Each webhook receiver map contains
following:
The name of the webhook receiver. Names must be unique across all receivers within an action group
The webhook URI of receiver
Indicates whether to use common alert schema
monitoring_webhook_receivers_warning_enabled
Indicates whether warning action group is using webhooks or not
monitoring_webhook_receivers_warning_properties
The list of maps with webhook receivers that are part of warning action group. Each webhook receiver map contains
following:
The name of the webhook receiver. Names must be unique across all receivers within an action group
The webhook URI of receiver
Indicates whether to use common alert schema
monitoring_vm_insights
vm_insights_enabled
Whether or not to enable the virtual machine insights. Note that this can increase Log Analytics ingestion costs.
vm_insights_vmi_dcr_suffix
The suffix used for the VMI DCR. It’s recommended to leave this as is, as policy parameters will also need updating
monitoring_security_solution
security_solution_enabled
Whether or not the security solution is enabled for MS Defender for Cloud reporting
security_solution_security_dcr_suffix
The suffix used for the Security DCR. It’s recommended to leave this as is, as policy parameters will also need updating
monitoring_action_groups
action_groups_group_short_name_critical
The short name of the critical action group. This will be used in SMS messages.
action_groups_enabled_critical
webhook_receivers_warning_properties:
- service_uri :
"https://events.pagerduty.com/integration/c3343244324232/enqueue" ## REPLACE WITH ACTUAL
name : "Warning"
use_common_alert_schema : true
webhook_receivers_warning_properties:
- service_uri :
"https://events.pagerduty.com/integration/c3343244324232/enqueue" ## REPLACE WITH ACTUAL
name : "Warning"
use_common_alert_schema : true
335/454
Indicates whether this critical action group is enabled. If an action group is not enabled, then none of its receivers will
receive communications.
action_groups_enabled_warning
Indicates whether this warning action group is enabled. If an action group is not enabled, then none of its receivers will
receive communications.
action_groups_group_short_name_warning
The short name of the warning action group. This will be used in SMS messages.
monitoring_dcr
dcr_enabled
Whether or not the DCR is enabled
dcr_name
Name of the DCR (this is the PREFIX), Suffix will be standard -serviceName-dcr-environment-locationShort-001
dcr_kind
The kind of DCR. This represents if the DCR is for either Windows or Linux
dcr_data_sources
Object having configuration related to data_sources. This object contains the following parameters
performance_counters = List of objects containing performance counter configurations link
windows_event_logs = (Windows Only) List of objects containing Windows Event Log configurations link
syslog = (Linux Only) List of objects containing SysLog configurations link
Example for windows ###### dcr_data_sources_windows
Example for Linux ###### dcr_data_sources_linux
data_sources :
performance_counters :
- sampling_frequency_in_seconds : 60
counter_specifiers : [
"\\LogicalDisk(*)\\% Free Space",
"\\Memory(*)\\% Committed Bytes In Use",
"\\Processor(_Total)\\% Processor Times"
]
streams : ["Microsoft-Perf"]
name : "WindowsPerformanceCounters"
windows_event_logs :
- xpath_queries : ["System!*[System[(Level=1 or Level=2 or Level=3)]]"]
streams : ["Microsoft-Event"]
name : "WindowsEventLogs"
syslogs : []
data_sources :
performance_counters :
- sampling_frequency_in_seconds : 60
counter_specifiers : [
"\\Logical Disk(*)\\% Free Space",
"\\Memory(*)\\% Used Memory",
336/454
windows_event_logs = (Windows Only) List of objects containing Windows Event Log configurations link
syslogs = (Linux Only) List of objects containing SysLog configurations link
dcr_streams
List of string containing any of: Microsoft-Event, Microsoft-InsightsMetrics, Microsoft-Perf, MicrosoftSyslog, Microsoft-WindowsEvent
automation_account
automation_account_enabled
Indicates if automation account module to be deployed
automation_account_instance_enabled
Indicates if this instance of automation account needs to be deployed
automation_account_location
Location of the automation account instance
automation_account_location_short
Short name of the location
automation_account_rg_name
Name of the Resource Group
automation_account_automation_account_name
Name of the automation account
automation_account_upload_run_books
Whether or not to upload the runbooks to the automation account.
automation_account_configuration_management_rbac
Configuration related to rbac
rbac_enabled
Whether or not to configure the management group RBAC for the automation account’s system identity.
rbac_management_group_name
Name of the management group the automation account’s system identity will be granted access to.
"\\Processor(*)\\% Processor Time"
]
streams : ["Microsoft-Perf"]
name : "LinuxPerformanceCounters"
windows_event_logs : []
syslogs : []
337/454
rbac_role_definition_name
Display Name of the role definition the automation account’s system identity will be granted access to.
vm_change_tracking
vm_change_tracking_enabled
Indicates if change tracking module to be deployed
change_track_rg_name
Name of resource group for vm change tracking
change_track_log_analytics_workspace_id
Log Analytics Workspace resource ID
change_track_dcr_suffix
Suffix used for the change tracking data collection rule name (prefix ct- is added automatically). It is recommended not to
change this value.
windows_change_tracking_windows_extension
windows_extension_enable_files
Whether or not to track file changes
windows_extension_enable_software
Whether or not to track software changes
windows_extension_enable_registry
Whether or not to track registry changes
windows_extension_enable_services
Whether or not to track service changes
windows_extension_enable_inventory
Whether or not to track inventory changes
windows_change_tracking_windows_registry_info
This is map of objects with each object containing all registry keys that will be tracked by the change tracking data
collection rule.
windows_registry_info_name
Friendly name of the registry key to track
windows_registry_info_grouptag
338/454
Group tag of the registry key to track
windows_registry_info_enabled
Whether or not to track the registry key
windows_registry_info_recurse
Whether or not to track the registry key recursively
windows_registry_info_description
Description of the registry key to track (optional)
windows_registry_info_keyname
Path to the registry key to track
windows_registry_info_valuename
Name of the registry value to track (optional)
windows_change_tracking_windows_file_info
This is map of objects with each object containing all individual files that will be tracked for changes
windows_file_info_name
Friendly name of the file to track
windows_file_info_enabled
Whether or not to track the file
windows_file_info_description
Description of the file to track (optional)
windows_file_info_path
Path to the file to track
windows_file_info_recurse
Whether or not to track the file recursively
windows_file_info_maxcontents_returnable
Maximum number of file contents to return
windows_file_info_maxoutput_size
Maximum size of the file to track
windows_file_info_checksum
339/454
Checksum type of the file to track
windows_file_info_pathtype
Path type of the file to track (file or directory)
windows_file_info_grouptag
Group tag of the file to track
linux_change_tracking_linux_extension
linux_extension_enable_files
Whether or not to track file changes
linux_extension_enable_software
Whether or not to track software changes
linux_extension_enable_services
Whether or not to track service changes
linux_extension_enable_inventory
Whether or not to track inventory changes
linux_change_tracking_linux_file_info
This is map of objects with each object containing all individual files that will be tracked for changes
linux_file_info_name
Friendly name of the file to track
linux_file_info_enabled
Whether or not to track the file
linux_file_info_destination_path
Path to the file to track
linux_file_info_use_sudo
Whether or not to use sudo to track the file
linux_file_info_recurse
Whether or not to track the file recursively
linux_file_info_maxcontents_returnable
Maximum number of file contents to return
340/454
linux_file_info_path_type
Path type of the file to track (file or directory)
linux_file_info_type
Type of the file to track
linux_file_info_links
Links of the file to track
linux_file_info_max_output_size
Maximum size of the file to track
linux_file_info_group_tag
Group tag of the file to track
vm_management
vm_management_enabled
Indicates if vm management module to be deployed
vm_management_rg_name
Name of the Resource Group
vm_management_management_group_id_scope
Name of the Management Group. Used by VM Management Worker to register Microsoft.Maintenance provider. Default
value is [“mg-platform”, “mg-audit”] Details about VM Management Worker can be found here
vm_management_exclude_subscriptions
List of subscription IDs to exclude from the auto configuration assignment. Comma separated string of subscription ids
Used by VM Management Worker to register Microsoft.Maintenance provider. Details about VM Management Worker
can be found here
vm_management_maintenance_schedules
Map of objects containing maintenance schedules
maintenance_schedules_enabled
Whether or not the maintenance schedule should be deployed
maintenance_schedules_name
Name of the maintenance schedule
maintenance_schedules_maintenance_window
341/454
Object that contains the properties of the maintenance window
maintenance_window_start_date_time
Start date of the maintenance window (should be the day of deployment)
maintenance_window_duration
Duration of the maintenance window
maintenance_window_time_zone
What timezone the maintenance window is referenced to
maintenance_window_recur_every
How often the recurrance of the maintenance window is?
maintenance_schedules_install_patches
Object that contains the properties of which patches to install
install_patches_reboot_setting
Whether or not to reboot the VM during the maintenance window if required
install_patches_windows_settings
Object that contains the properties of which patches to install on Windows VMs
include_kbs = List of strings containing KBs to include in the installation of patches on Windows VMs
exclude_kbs = List of strings containing KBs to exclude in the installation of patches on Windows VMs
windows_classifications = List of strings containing patches to install on Windows VMs such as ["Critical",
"Security", "UpdateRollup", "FeaturePack", "ServicePack", "Definition", "Tools", "Updates"]
install_patches_linux_settings
Object that contains the properties of which patches to install on Linux VMs
windows_settings:
include_kbs: []
exclude_kbs: []
windows_classifications:
- Critical
- Security
- UpdateRollup
- FeaturePack
- ServicePack
- Definition
- Tools
- Updates
342/454
package_names_to_include = List of strings containing KBs to include in the installation of patches on Linux VMs
package_names_to_exclude = List of strings containing KBs to exclude in the installation of patches on Linux VMs
linux_classifications = List of strings containing classifications of patches to install on Linux VMs ["Critical",
"Security", "Other"]
output descriptions
management_outputs
Contains various outputs from management root module
workspace_resource_id
ID of log analytics work space
workspace_resource_name
Name of log analytics work space
workspace_resource_group_name
Name of resource group having log analytics work space
ipam_function_name
Name of ipam function app
ipam_resource_group_name
Name of ipam function resource group
ipam_subscription_id
Subscription ID of IPAM
action_group_name_warning
Name of warning action group created in monitoring module
action_group_name_critical
Name of critical action group created in monitoring module
action_group_id_warning
ID of warning action group created in monitoring module
action_group_id_critical
linux_settings:
package_names_to_include: []
package_names_to_exclude: []
linux_classifications:
- Critical
- Security
- Other
343/454
ID of critical action group created in monitoring module
dcr_name_linux
Name of linux data collection rule
dcr_name_windows
Name of windows data collection rule
dcr_suffix_standard
Suffix of DCR
dcr_vmi_suffix
Suffix of vm insights created in monitoring
dcr_sec_suffix
Suffix of security solution created in monitoring
vm_management_rg_name
Name of resource group having vm management
Below is a sample output for management_outputs
{
"action_group_id_critical": "/subscriptions/11111asaq-2222-333-
44444444444/resourceGroups/rg-sch-logging-tst-ne001/providers/Microsoft.Insights/actionGroups/log-sch-operational-ama-tst-ne-001-Critical",
"action_group_id_warning": "/subscriptions/11111asaq-2222-333-
44444444444/resourceGroups/rg-sch-logging-tst-ne001/providers/Microsoft.Insights/actionGroups/log-sch-operational-ama-tst-ne-001-Warning",
"action_group_name_critical": "log-sch-operational-ama-tst-ne-001-Critical",
"action_group_name_warning": "log-sch-operational-ama-tst-ne-001-Warning",
"dcr_name_linux": "linux-sch-dcr-tst-ne-001",
"dcr_name_windows": "windows-sch-dcr-tst-ne-001",
"dcr_sec_suffix": "sch-dcr-tst-ne-001",
"dcr_suffix_standard": "sch-dcr-tst-ne-001",
"dcr_vmi_suffix": "sch-dcr-tst-ne-001",
"ipam_function_name": "func-sch-ipam-tst-ne-001",
"ipam_resource_group_name": "rg-sch-ipam-tst-ne-001",
"ipam_subscription_id": "4d51b4a8-d7c2-4f8d-83d1-4702b2862977",
"vm_management_rg_name": "rg-sch-vm-management-tst-ne-001",
"workspace_resource_group_name": "rg-sch-logging-tst-ne-001",
"workspace_resource_id": "/subscriptions/subscriptions/11111asaq-2222-333-
44444444444/resourceGroups/rg-sch-logging-tst-ne001/providers/Microsoft.OperationalInsights/workspaces/log-sch-operational-ama-tst-ne-001",
"workspace_resource_name": "log-sch-operational-ama-tst-ne-001"
}
ipam_endpoints
Contains management outputs for IPAM module endpoints
get_networks
IPAM Function App endpoint to get networks function
delete_network
344/454
IPAM Function App endpoint to delete network function
update_network
IPAM Function App endpoint to update network function
set_network_range
IPAM Function App endpoint to set network range function
slice_cidr
IPAM Function App endpoint to slice CIDR function
Below is a sample output for ipam_endpoints
{
"delete_network" = "https://func-sch-ipam-tst-ne-001.azurewebsites.net/api/DeleteNetwork"
"get_networks" = "https://func-sch-ipam-tst-ne-001.azurewebsites.net/api/GetNetworks"
"get_network" = "https://func-sch-ipam-tst-ne-001.azurewebsites.net/api/GetNetwork"
"set_network_range" = "https://func-sch-ipam-tst-ne-001.azurewebsites.net/api/SetNetworkRange"
"slice_cidr" = "https://func-sch-ipam-tst-ne-001.azurewebsites.net/api/SliceCIDR"
"update_network" = "https://func-sch-ipam-tst-ne-001.azurewebsites.net/api/UpdateNetwork"
"delete_subnet" = "https://func-sch-ipam-tst-ne-001.azurewebsites.net/api/DeleteSubnet"
"get_subnet" = "https://func-sch-ipam-tst-ne-001.azurewebsites.net/api/GetSubnet"
"set_subnet_range" = "https://func-sch-ipam-tst-ne-001.azurewebsites.net/api/SetSubnetRange"
"update_subnet" = "https://func-sch-ipam-tst-ne-001.azurewebsites.net/api/UpdateSubnet"
}
dependency
T h e Management module is dependent on the following modules: - /CORE - /PROVISIONER/CICD -
/CORE/NETWORK - /CORE/AUDIT — id: blueprint-firewall-standard-tf title: Firewall sidebar_position: 9 —
modules
List modules which are within given blueprint : - Tags - Networks - Firewall - Firewall Policy - IP Groups - Policy Insights
- Diagnostics - DNS - DNS Resolver - Routing intent - Upgrade to Premium - Firewall baseline network rules - Firewall
baseline application rules - Firewall baseline network extended rules
inputs
Make sure you read the descriptions of the variables.
tags
Name Description Type Default Required
append_tags append_tags map { nc-cf-deployment-name: blueprint.firewall.standard } yes
networks_services
settings.networks
345/454
Name Description Type Default Required
enabled network_enabled bool false yes
topology topology string hubspoke yes
vwan_is_main_region vwan_main_region bool true
yes
(vwan
only)
vwan_name vwan_name string vwan-sch-tst-ne-001
yes
(vwan
only)
vwan_resource_group_name vwan_rg string rg-sch-tst-ne-001
yes
(vwan
only)
instance instance string instance_001 yes
location location string northeurope yes
location_short location_short string ne yes
firewall firewall list(object) [{}] no
firewall_policy firewall_policy list(object) [{}] no
ip_groups ip_groups list(object) [{}] no
diagnostics diagnostics list(object) [{}] no
policy_insights policy_insights list(object) [{}] no
dns dns list(object) [{}] no
dns_resolver dns_resolver list(object) [{}] no
routing_intent routing_intent list(object) [{}] no (vwan
only)
upgrade_to_premium upgrade_to_premium list(object) [{}] no
firewall_services
settings.networks.firewall
Name Description Type Default Required
availability_zones availability_zones list(string) [“1”, “2”, “3”] no
public_ips_count public_ips_count number 1 no
sku sku list(object) [{}] no
settings.networks.firewall.sku
Name Description Type Default Required
tier sku string Standard no
firewall_policy_services
settings.networks.firewall_policy
Name Description Type Default Required
threat_intelligence threat_intelligence list(object) [{}] no
intrusion_detection intrusion_detection list(object) [{}] no
snat snat list(object) [{}] no
datadog_rule_set datadog_rule_set bool false no
346/454
threat_intelligence_services
settings.networks.firewall_policy.threat_intelligence
Name Description Type Default Required
mode threat_intelligence string Off no
white_list threat_intelligence list(object) [{}] no
threat_intelligence_white_list_services
settings.networks.firewall_policy.threat_intelligence.white_list
Name Description Type Default Required
fqdns threat_intelligence list(string) [] no
ip_addresses threat_intelligence list(string) [] no
intrusion_detection_services
settings.networks.firewall_policy.intrusion_detection
Name Description Type Default Required
mode intrusion_detection string Off no
private_ranges intrusion_detection list(string) [] no
signature_overrides intrusion_detection list(object) [{}] no
bypass_traffic_settings intrusion_detection list(object) [{}] no
intrusion_detection_signature_overrides_services
settings.networks.firewall_policy.intrusion_detection.signature_overrides
Name Description Type Default Required
id signature_overrides string “bypass-setting” no
state signature_overrides string “TCP” no
intrusion_detection_bypass_traffic_settings_services
settings.networks.firewall_policy.intrusion_detection.bypass_traffic_settings
Name Description Type Default Required
name bypass_traffic_settings string “bypass-setting” no
protocol bypass_traffic_settings string “TCP” no
description bypass_traffic_settings string “bypass rule” no
destination_addresses bypass_traffic_settings list(string) [] no
destination_ip_groups bypass_traffic_settings list(string) [] no
destination_ports bypass_traffic_settings list(string) [] no
source_addresses bypass_traffic_settings list(string) [] no
source_ip_groups bypass_traffic_settings list(string) [] no
snat_services
347/454
settings.networks.firewall_policy.snat
Name Description Type Default Required
enable_custom_SNAT snat bool false no
private_ranges snat list(string)
[“10.0.0.0/8”, “172.16.0.0/12”, “192.168.0.0/16”,
“100.64.0.0/10”] no
ip_groups_services
settings.networks.ip_groups
Name Description Type Default Required
enabled ip_groups bool false no
ip_groups ip_groups list(object) [{}] no
ip_groups_ip_groups_services
settings.networks.ip_groups.ip_groups
Name Description Type Default Required
name ip_groups string ipg-sch-tst-ne-001 no
ip_addresses ip_groups list(string) [] no
policy_insights_services
settings.networks.policy_insights
Name Description Type Default Required
enabled policy_insights bool true no
workspace_id policy_insights string workspace_resource_id from output no
workspace_resource_group_name policy_insights string workspace_resource_group_name from output no
workspace_name policy_insights string workspace_name from output no
diagnostics_services
settings.networks.diagnostics
Name Description Type Default Required
enabled diagnostics bool true no
name diagnostics string setByPolicy no
destination_type diagnostics string Dedicated no
partner_solution_id diagnostics string null no
enabled_log diagnostics list(object) [{}] no
metric diagnostics list(object) [{}] no
workspace_id diagnostics string workspace_resource_id from output no
storage_account_id diagnostics string storage_account_id from output no
diagnostics_enabled_logs_services
settings.networks.diagnostics.enabled_log.AZFWNetworkRule
348/454
Name Description Type Default Required
category enabled_log string AZFWNetworkRule no
category_group enabled_log string null no
retention_policy.days enabled_log number 0 no
retention_policy.enabled enabled_log bool false no
settings.networks.diagnostics.enabled_log.AZFWApplicationRule
Name Description Type Default Required
category enabled_log string AZFWApplicationRule no
category_group enabled_log string null no
retention_policy.days enabled_log number 0 no
retention_policy.enabled enabled_log bool false no
settings.networks.diagnostics.enabled_log.AZFWNatRule
Name Description Type Default Required
category enabled_log string AZFWNatRule no
category_group enabled_log string null no
retention_policy.days enabled_log number 0 no
retention_policy.enabled enabled_log bool false no
settings.networks.diagnostics.enabled_log.AZFWThreatIntel
Name Description Type Default Required
category enabled_log string AZFWThreatIntel no
category_group enabled_log string null no
retention_policy.days enabled_log number 0 no
retention_policy.enabled enabled_log bool false no
settings.networks.diagnostics.enabled_log.AZFWIdpsSignature
Name Description Type Default Required
category enabled_log string AZFWIdpsSignature no
category_group enabled_log string null no
retention_policy.days enabled_log number 0 no
retention_policy.enabled enabled_log bool false no
settings.networks.diagnostics.enabled_log.AZFWDnsQuery
Name Description Type Default Required
category enabled_log string AZFWDnsQuery no
category_group enabled_log string null no
retention_policy.days enabled_log number 0 no
retention_policy.enabled enabled_log bool false no
settings.networks.diagnostics.enabled_log.AZFWFqdnResolveFailure
349/454
Name Description Type Default Required
category enabled_log string AZFWFqdnResolveFailure no
category_group enabled_log string null no
retention_policy.days enabled_log number 0 no
retention_policy.enabled enabled_log bool false no
settings.networks.diagnostics.enabled_log.AZFWFatFlow
Name Description Type Default Required
category enabled_log string AZFWFatFlow no
category_group enabled_log string null no
retention_policy.days enabled_log number 0 no
retention_policy.enabled enabled_log bool false no
settings.networks.diagnostics.enabled_log.AZFWFlowTrace
Name Description Type Default Required
category enabled_log string AZFWFlowTrace no
category_group enabled_log string null no
retention_policy.days enabled_log number 0 no
retention_policy.enabled enabled_log bool false no
settings.networks.diagnostics.enabled_log.AZFWApplicationRuleAggregation
Name Description Type Default Required
category enabled_log string AZFWApplicationRuleAggregation no
category_group enabled_log string null no
retention_policy.days enabled_log number 0 no
retention_policy.enabled enabled_log bool false no
settings.networks.diagnostics.enabled_log.AZFWNatRuleAggregation
Name Description Type Default Required
category enabled_log string AZFWNatRuleAggregation no
category_group enabled_log string null no
retention_policy.days enabled_log number 0 no
retention_policy.enabled enabled_log bool false no
diagnostics_metric_services
settings.networks.diagnostics.metric.AllMetrics
Name Description Type Default Required
category metric string AllMetrics no
enabled metric bool true no
retention_policy.days metric number 0 no
retention_policy.enabled metric bool false no
350/454
dns_services
settings.networks.dns
Name Description Type Default Required
proxy_enabled dns_proxy_enabled bool true no
servers dns_servers list(string) [“168.63.129.16”] no
dns_resolver_services
settings.networks.dns_resolver
Name Description Type Default Required
enabled dns_resolver_enabled bool true no
on_premises_address_space dns_resolver_on_premises_address_space list(string) [“192.168.0.1/32”, “192.168.0.2/32”] no
inbound_subnet_prefix dns_resolver_inbound_subnet_prefix list(string) dns_resolver_inbound_subnet_cidr from output no
outbound_subnet_prefix dns_resolver_outbound_subnet_prefix list(string) dns_resolver_outbound_subnet_cidr from output no
routing_intent_services
settings.networks.routing_intent
Name Description Type Default Required
enabled routing_intent_enabled bool false no
private_traffic routing_intent_private_traffic bool true no
internet_traffic routing_intent_internet_traffic bool true no
upgrade_to_premium_services
settings.networks.upgrade_to_premium
Name Description Type Default Required
enabled upgrade_to_premium_enabled bool false no
LAST APPLIED CONFIGURATION
TEMP Comment: Leave as is for now, will be used later to dynamically update with customer specific config.
input descriptions
The comments #mandatory means that the parameter is always required for the resource to be created if custom
deployment is used. If the default deployment is used, the parameter is not required and can be omitted.
append_tags
Additional tags to be applied to the resources along with globally defined tags. Common for all resources in this blueprint
networks
Example of the hubspoke firewall default deployment:
settings:
networks:
351/454
Example of the vwan firewall default deployment:
networks_enabled
If true, new Hub will be deployed in dedicated location. ##### topology The topology of the network. Possible values are
hubspoke and vwan. ##### vwan_is_main_region if true, and topology is vwan then the vhub will be deployed in the
current region. if false, the vhub will be deployed in the selected vwan resource group. ##### vwan_name The name of the
existing/new vwan name. ##### vwan_resource_group_name The name of the existing vwan resource group where new
hub will be deployed. ##### instance The instance number of the network. The number must be unique for each of
location. ##### location The location of the network. ##### location_short The short name of the location of the network.
firewall
Example of the firewall configuration:
firewall_availability_zones
The availability zones of the firewall. Possible values: [], [“1”], or [“1”, “2”, “3”] ##### firewall_public_ips_count The
number of public IPs for the firewall. ##### firewall_tier The SKU of the firewall.
firewall_policy
threat_intelligence
Example of the threat intelligence configuration:
threat_intelligence_mode
The mode of the threat intelligence. Possible values: Of , Alert, Deny ###### threat_intelligence_white_list The list of
fqdns and ip addresses to be whitelisted. ###### threat_intelligence_white_list_fqdns The list of fqdns to be whitelisted.
###### threat_intelligence_white_list_ip_addresses The list of ip addresses to be whitelisted.
- enabled: true #mandatory
topology: "vwan" #mandatory
instance: "instance_001" #mandatory
location: "northeurope" #mandatory
location_short: "ne" #mandatory
settings:
networks:
- enabled: true #mandatory
topology: "vwan" #mandatory
vwan_is_main_region: true #vwan only
vwan_name: "vwan-sch-tst-ne-001" #vwan only
vwan_resource_group_name: "rg-sch-tst-ne-001" #vwan only
instance: "instance_001" #mandatory
location: "northeurope" #mandatory
location_short: "ne" #mandatory
firewall: #mandatory
- availability_zones: ["1", "2", "3"] #mandatory
public_ips_count: 1
sku:
- tier: "Premium"
firewall_policy: #mandatory
- threat_intelligence: #mandatory
- mode: "Alert"
white_list:
- fqdns: []
ip_addresses: []
352/454
intrusion_detection
Example of the intrusion detection configuration:
intrusion_detection_mode
The mode of the intrusion detection. Possible values: Of , Alert, Deny ###### intrusion_detection_private_ranges The list
of private ranges to be whitelisted. ###### intrusion_detection_signature_overrides The list of signature overrides. ######
intrusion_detection_signature_overrides_id The id of the signature override. ######
intrusion_detection_signature_overrides_state The state of the signature override.
intrusion_detection_bypass_traffic_settings
Example of the intrusion detection bypass traffic settings configuration:
The list of bypass traffic settings. ###### intrusion_detection_bypass_traffic_settings_name The name of the bypass traffic
setting. ###### intrusion_detection_bypass_traffic_settings_protocol The protocol of the bypass traffic setting. ######
intrusion_detection_bypass_traffic_settings_description The description of the bypass traffic setting. ######
intrusion_detection_bypass_traffic_settings_destination_addresses The list of destination addresses of the bypass traffic
setting. ###### intrusion_detection_bypass_traffic_settings_destination_ip_groups The list of destination ip groups of the
bypass traffic setting if exists. ###### intrusion_detection_bypass_traffic_settings_destination_ports The list of destination
ports of the bypass traffic setting. ###### intrusion_detection_bypass_traffic_settings_source_addresses The list of source
addresses of the bypass traffic setting. ###### intrusion_detection_bypass_traffic_settings_source_ip_groups The list of
source ip groups of the bypass traffic setting if exists.
snat
firewall_policy: #mandatory
- threat_intelligence: #mandatory
- mode: "Alert"
white_list:
- fqdns: []
ip_addresses: []
- intrusion_detection: #mandatory
mode: "Off"
private_ranges: []
signature_overrides:
- id: ""
state: ""
firewall_policy: #mandatory
- threat_intelligence:
- mode: "Alert"
white_list:
- fqdns: []
ip_addresses: []
- intrusion_detection: #mandatory
mode: "Off"
private_ranges: []
signature_overrides:
- id: ""
state: ""
bypass_traffic_settings: #mandatory
- name: "bypass-setting" #mandatory
protocol: "TCP"
description: "bypass rule"
destination_addresses: ["10.0.0.0/8"]
destination_ip_groups: []
destination_ports: ["80"]
source_addresses: ["100.64.0.0/10"]
source_ip_groups: []
353/454
Example of the snat configuration:
snat_enable_custom_snat
If true, custom snat will be enabled. ###### snat_private_ranges The list of private ranges to be whitelisted.
datadog_rule_set
If true, the datadog rule set will be enabled.
ip_groups
Example of the ip groups configuration:
ip_groups_enabled
If true, the ip groups will be enabled. ##### ip_groups_name The name of the ip group. ##### ip_groups_ip_addresses
The list of ip addresses of the ip group.
diagnostics
Example of the diagnostics configuration:
diagnostics_enabled
snat: #mandatory
- enable_custom_SNAT: true #mandatory
private_ranges: ["10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16", "100.64.0.0/10"]
ip_groups: #mandatory
- enabled: true #mandatory
ip_groups:
- name: "ip-group-001"
ip_addresses: []
diagnostics: #mandatory
- enabled: true #mandatory
name: "setByPolicy"
destination_type: "Dedicated"
partner_solution_id: null
enabled_log: #mandatory
- category: "AZFWNetworkRule" #mandatory
category_group: null
retention_policy:
- days: 0
enabled: false
metric: #mandatory
- category: "AllMetrics" #mandatory
enabled: true
retention_policy:
- days: 0
enabled: false
workspace_id: "/subscriptions/1fefad98-b527-437d-9d1b-be6a1527f76c/resourceGroups/rgsch-logging-tst-ne-001/providers/Microsoft.OperationalInsights/workspaces/log-sch-audittst-ne-001"
storage_account_id: null
enabled_log: #mandatory
- category: "AZFWNatRuleAggregation" #mandatory
category_group: null
retention_policy:
- days: 0
enabled: false
354/454
If true, diagnostics will be enabled. ##### diagnostics_name The name of the diagnostics. If not set, the name will be set
by policy. ##### diagnostics_destination_type The destination type of the diagnostics. Possible values: Dedicated, Workspace, LogAnalytics ##### diagnostics_partner_solution_id The partner solution id of the diagnostics. #####
diagnostics_enabled_logs The list of enabled logs. ##### diagnostics_metric The list of enabled metrics. #####
diagnostics_workspace_id The id of the workspace where the diagnostics will be sent. #####
diagnostics_storage_account_id The id of the storage account where the diagnostics will be sent. #####
diagnostics_enabled_logs The list of enabled logs. ###### enabled_log_category The category of the enabled log. ######
enabled_log_category_group The category group of the enabled log. ###### enabled_log_retention_policy_days The
retention policy days of the enabled log. ###### enabled_log_retention_policy_enabled The retention policy enabled of the
enabled log.
diagnostics_metric
Example of the diagnostics metric configuration:
The list of enabled metrics. ###### metric_category The category of the metric. ###### metric_enabled If true, the metric
will be enabled. ###### metric_retention_policy_days The retention policy days of the metric. ###### metric_retention_policy_enabled The retention policy enabled of the metric.
policy_insights
Example of the policy insights configuration:
policy_insights_enabled
If true, policy insights will be enabled. ##### policy_insights_workspace_id The id of the workspace where the policy
insights will be sent. ##### policy_insights_workspace_resource_group_name The name of the resource group of the
workspace where the policy insights will be sent. ##### policy_insights_workspace_name The name of the workspace
where the policy insights will be sent.
dns
Example of the dns configuration:
dns_proxy_enabled
metric: #mandatory
- category: "AllMetrics" #mandatory
enabled: true
retention_policy:
- days: 0
enabled: false
workspace_id: "/subscriptions/1111111-b527-437d-9d1b-be6a1527f76c/resourceGroups/rg-schlogging-tst-ne-001/providers/Microsoft.OperationalInsights/workspaces/log-sch-audit-tstne-001"
storage_account_id: null
policy_insights: #mandatory
- enabled: true #mandatory
workspace_id: "/subscriptions/1fefad98-b527-437d-9d1b-be6a1527f76c/resourceGroups/rgsch-logging-tst-ne-001/providers/Microsoft.OperationalInsights/workspaces/log-sch-audittst-ne-001"
workspace_resource_group_name: "rg-sch-tst-we-001"
workspace_name: "log-sch-tst-we-001"
dns: #mandatory
- proxy_enabled: true #mandatory
servers: ["168.63.129.16"]
355/454
If true, the dns proxy will be enabled. ##### dns_servers The list of dns servers.
dns_resolver
Example of the dns resolver configuration:
dns_resolver_enabled
If true, the dns resolver will be enabled. ##### dns_resolver_on_premises_address_space The list of on premises address
space. ##### dns_resolver_inbound_subnet_prefix The list of inbound subnet prefix. #####
dns_resolver_outbound_subnet_prefix The list of outbound subnet prefix.
routing_intent
Example of parametrised deployment of the Routing intent:
routing_intent_enabled
If set to true, this variable enables the routing intent feature for the specified virtual hub. The feature is available only for
virtual WAN. #### routing_intent_private_traffic If set to true, this variable enables the routing of private traffic through
the specified routing intent policies. Private traffic typically refers to traffic that stays within your organization’s network
boundaries, such as traffic between virtual networks (VNets) or on-premises networks connected via VPN or
ExpressRoute. #### routing_intent_internet_traffic If set to true, this variable enables the routing of internet-bound traffic
through the specified routing intent policies. Internet traffic refers to any traffic that is destined for external networks
outside of your organization’s control, such as public websites or cloud services.
upgrade_to_premium
Example of the upgrade to premium configuration:
upgrade_to_premium_enabled
If true, the upgrade to premium will be enabled and the firewall will be upgraded from standard to premium sku.
firewall_baseline_network_rules
The list of default rules for the firewall are defined in the [-firewall-standard_rules] folder.
dns_resolver: #mandatory
- enabled: true #mandatory
on_premises_address_space: ["192.168.0.1/32", "192.168.0.2/32"]
inbound_subnet_prefix: ["10.222.10.0/25"]
outbound_subnet_prefix: ["10.222.11.0/25"]
routing_intent: # Only vWAN
- enabled: true
private_traffic: true
internet_traffic: true
upgrade_to_premium: #mandatory
- enabled: true #mandatory
356/454
Rule Collection Priority
Rule Collection Name
Rule Name Source Port Protocol Destination Action Comment
1000
out-allowazure-core
azure-core xx.xxx.0.0/16 * TCP,UDP,ICMP
168.63.129.16,
169.254.169.254 Allow
Required for
correct Azure
function
1000
out-allowazure-core
azure-kms xx.xxx.0.0/16 1688 TCP
23.102.135.246,
20.118.99.224,
40.83.235.53
Allow
Required for
correct Azure
function
1001
in-allowazure-core
azure-load-balancer 168.63.129.16 * Any xx.xxx.0.0/16 Allow
Required for
correct ALB
Function
1002
remote- management
rdp-ssh-fromonprem-to-bastionsubnet
xx.xxx.0.0/16 22,3389 TCP
xx.xxx.4.128/26,
xx.xxx.8.0/27 Allow
Required for Azure Bastion
1002
remote- management
rdp-ssh-frombastion-subnet-toazure-network
xx.xxx.4.128/26,
xx.xxx.8.0/27
22,3389 TCP xx.xxx.0.0/16 Allow
Required for Azure Bastion
1003 dns dns-from-internalnetworks xx.xxx.0.0/16 53 Any xx.xxx.8.192/27 Allow
Access from
DNS
1003 dns dns-to-internalnetworks xx.xxx.8.192/27 53 Any xx.xxx.0.0/16 Allow Access to DNS
firewall_baseline_application_rules
The list of default rules for the firewall are defined in the [-firewall-standard_rules] folder.
357/454
Rule Collection Priority
Rule Collection Name
Rule Name Source Protocol Destination Action Comment
2000
appruleazureservicess
azure-environment xx.xxx.0.0/16 Http:80,Https:443
gallery.azure.com, go.microsoft.com, management.core.windows.net, management.azure.com,
login.microsoftonline.com, loginp.microsoftonline.com, graph.windows.net
Allow
2000
appruleazureservicess
azure-services xx.xxx.0.0/16 Http:80,Https:443
*.redis.cache.windows.net,
*.database.windows.net, *.core.windows.net,
*.azurewebsites.net, *.documents.azure.com,
*.azuredatalakestore.net,
*.azuredatalakeanalytics.net,
*.batch.azure.com, *.studio.azureml.net,
*.vault.azure.net,
gallery.cortanaintelligence.com,
docs.microsoft.com, *.services.azureml.net,
*.servicesbus.windows.net, *.azuredevices.net, *.azure-api.net, *.azureautomation.net, s2events.azureautomation.net, *.cloudapp.azure.com,
*.search.windows.net, *.logic.azure.com,
*.azureedge.net, *.azurehdinsight.net,
*.asazure.windows.net, *.datalake.azure.net,
api.loganalytics.io
Allow
2001
appruleupdaterepositories
windows-update xx.xxx.0.0/16 Http:80,Https:443 WindowsUpdate Allow Windows Update
Services
2001
appruleupdaterepositories
centos-update xx.xxx.0.0/16 Http:80,Https:443 olcentgbl.trafficmanager.net Allow
Centos Update
Services
2001
appruleupdaterepositories
redhat-update xx.xxx.0.0/16 Http:80,Https:443 rhelimage.blob.core.windows.net Allow
RedHat Update
Services
2001
appruleupdaterepositories
ubuntu-update xx.xxx.0.0/16 Http:80,Https:443 *.ubuntu.com, packages.microsoft.com,
api.snapcraft.io Allow
Ubuntu Update
Services
2002
apprulegithubcontent
githubusercontent.com xx.xxx.0.0/16 Http:80,Https:443 *.githubusercontent.com Allow Github
2002
apprulegithubcontent
github.com xx.xxx.0.0/16 Http:80,Https:443 github.com Allow Github
2003
azure- monitor Azure monitor xx.xxx.0.0/16 Http:80,Https:443
*.ods.opinsights.azure.com,
*.oms.opinsights.azure.com,
*.blob.core.windows.net, *.azureautomation.net, *.opinsights.azure.com,
*.monitoring.azure.com,
*.handler.control.monitor.azure.com
Allow
Required
Azure monitoring
services
firewall_baseline_network_rules_extended
The list of extended rules for the firewall required for the onprem connectivity are defined in the [-firewall-standard_rules]
folder.
358/454
Rule Collection Priority
Rule Collection Name Rule Name Source Protocol Destination Action Comment
210
Establish connection
between Azure DC to
onprem
Azure monitor xx.xxx.12.0/26 Http:80,Https:443 172.222.3.0/24 Allow
Required Azure
onprem
connection
220
Establish connection
between onprem DC and
Azure DC
Azure monitor 172.222.3.0/24 Http:80,Https:443 xx.xxx.12.0/26 Allow
Required Azure
onprem
connection
230 Establish connection
between azure DC to VM
Azure monitor
xx.xxx.32.0/19,
xx.xxx.128.0/17 Http:80,Https:443 xx.xxx.12.0/26 Allow
Required Azure
onprem
connection
240 Establish connection
between VM to azure DC
Azure monitor xx.xxx.12.0/26 Http:80,Https:443
xx.xxx.32.0/19,
xx.xxx.128.0/17 Allow
Required Azure
onprem
connection
outputs
Since state sharing is not recommended due to security the outputs are important if any resources need to be referenced
network
Name Description
public_firewall_ip_addresses_resource_id Public IP addresses resource id of the firewall
public_firewall_ip_addresses Public IP addresses of the firewall
private_firewall_ip_addresses Private IP addresses of the firewall
output descriptions
Example of output description for each hub
network = {
instance_001-northeurope = {
public_firewall_ip_addresses_resource_id = "/subscriptions/00000000-0000-0000-0000-
000000000000/resourceGroups/rg-sch-tst-ne-001/providers/Microsoft.Network/publicIPAddresses/pipsch-tst-ne-001"
public_firewall_ip_addresses = "17.12.13.18"
private_firewall_ip_addresses = "172.16.10.11"
}
}
dependency
The Firewall module is dependent on the following modules: - /CORE/NETWORK - /CORE/MANAGEMENT — id:
blueprint-sharedservices-standard-tf title: Shared Services sidebar_position: 10 —
modules
List modules which are within given blueprint : - Connection Testing - Private Dns - Private Resolver
inputs
Make sure you read the descriptions of the variables.
359/454
Note: For any of the below parameters which is having multi level structure, if its required to define custom value, then all
the parents also must be uncommented. For eg. in case of connection testing, if its requried to define custom value for
short_name of keyvault, then both key_vault (parent) and short_name must be uncommented and then custom value needs
to be added for short_name.
In this way, all the related parents of a parameter needs to be uncommented to define custom values
common parameters
Name Description Type Default Required
append_tags append_tags map(string) { nc-cf-deployment-name = blueprint.sharedservices.standard } yes
connection_testing
Name Description Type Default Required
connection_testing_enabled connection_testing bool true no
connection_testing_settings.instances connection_testing list(object())
[ {enabled = true,location = “northeurope”,location_short =
“ne”,instance = “instance_001” }, {enabled = true,location =
“westeurope”,location_short = “we”,instance = “instance_001” },
{enabled = false, location = “centralindia”,location_short =
“ci”,instance = “instance_001” } ]
yes
connection_testing_settings
connection_testing.instances[0]
Name Description Type Default Required
enabled connection_testing bool true yes
location connection_testing string “northeurope” yes
location_short connection_testing string “ne” yes
instance connection_testing string “instance_001” yes
custom_service_name connection_testing string “” no
rg_name connection_testing string rg-sch-conm-tst-ne-001 no
key_vault connection_testing object() {} no
disk_encryption_enabled connection_testing bool true no
create_vms connection_testing object() {} no
connectionMonitors connection_testing list(object()) [{}] no
connection_testing_0_key_vault
connection_testing.instances[0].key_vault
- enabled : true
location : "westeurope"
location_short : "we"
instance : "instance_001"
# custom_service_name : ""
# rg_name : ""
key_vault :
# name : ""
short_name : "CUSTOM-NAME"
# enable_purge_protection : true
360/454
Name Description Type Default Required
name key_vault string kv-sch-conm-tst-ne-001 no
short_name key_vault string “conm” no
enable_purge_protection key_vault bool true no
enabled_for_deployment key_vault bool false no
enabled_for_template_deployment key_vault bool true no
enabled_for_disk_encryption key_vault bool true no
enable_rbac_authorization key_vault bool true no
enable_soft_delete key_vault bool true no
sku key_vault string “standard” no
url_suffix key_vault string “vault.azure.net” no
kek_expiry_days key_vault number 0 no
setup_username_expiry_days key_vault number 0 no
setup_password_expiry_days key_vault number 0 no
permissions key_vault map(list(string)) {} no
network_acls_bypass key_vault string “AzureServices” no
network_acls_default_action key_vault string “Deny” no
network_acls_ip_rules key_vault list(string) [] no
network_acls_virtual_network_rules key_vault list(string) [] no
access_policies key_vault list(any) [] no
connection_testing_0_create_vms
connection_testing.instances[0].create_vms
Name Description Type Default Required
enabled create_vms bool true no
rg_short_name create_vms string “conm” no
hardware_size create_vms string “Standard_B2ms” no
image_publisher create_vms string “Canonical” no
image_offer create_vms string “0001-com-ubuntu-server-focal” no
image_sku create_vms string “20_04-lts” no
vm_array create_vms list(object()) [{}] no
create_vms_vm_array_0
connection_testing.instances[0].create_vms.vm_array[0]
Name Description Type Default Required
vm_enabled vm bool true no
new_vm_name vm string vmconmtstne001 no
new_vm_subnet_association vm string
connectionmonitor_subnet value for current location and instance from outputs
of network
no
update_management_enabled vm bool true no
maintenance_config vm map(string) {“vm-update” = “sharedservices-3-tuesday-0200”} no
361/454
connection_testing_0_connection_monitors
connection_testing.instances[0].connectionMonitors[0]
Name Description Type Default Required
connectionMonitorEnabled connectionMonitors bool true no
connectionMonitorAlertEnabled connectionMonitors bool false no
connectionMonitorSubscriptionId connectionMonitors string <SHAREDSERVICES_SUBSCRIPTION_ID_FETCHED_BY_TERRAFORM> no
connectionMonitorName connectionMonitors string cm-example-azure-to-externaladdress-ne no
logAnalyticsWorkspaceId connectionMonitors string workspace_resource_id value from management_outputs of management no
alertActionGroupId connectionMonitors string action_group_id_critical value from management_outputs of management no
endPoints connectionMonitors list(object()) [{}] no
testConfiguration connectionMonitors list(object()) [{}] no
testGroups connectionMonitors list(object()) [{}] no
connectionmonitors_alert_end_points_0
connection_testing.instances[0].connectionMonitors[0].endPoints[0]
Name Description Type Default Required
name endPoints string “connectiomonitorVM” no
type endPoints string “azureVM” no
resourceId endPoints string ResourceID of VM vmconmtstne001 no
connection_testing.instances[0].connectionMonitors[0].endPoints[1]
Name Description Type Default Required
name endPoints string “ubuntuArchive” no
type endPoints string “ExternalAddress” no
address endPoints string “archive.ubuntu.com” no
connectionmonitors_alert_test_configuration_0
connection_testing.instances[0].connectionMonitors[0].testConfiguration[0]
Name Description Type Default Required
name testConfiguration string “Http80” no
testFrequencySec testConfiguration number 30 no
protocol testConfiguration string “Http” no
httpConfiguration testConfiguration object() {port = 80,method = “Get”,requestHeaders = [],validStatusCodeRanges
= [],preferHTTPS = false} no
successThreshold testConfiguration object() {checksFailedPercent = 20,roundTripTimeMs = 90} no
connectionmonitors_alert_test_groups_0
connection_testing.instances[0].connectionMonitors[0].testGroups[0]
362/454
Name Description Type Default Required
name testGroups string vmconmtstne001 to http://archive.ubuntu.com no
disable testGroups bool false no
testConfigurations testGroups list(string) [“Http80”] no
sources testGroups list(string) [“connectiomonitorVM”] no
destinations testGroups list(string) [“ubuntuArchive”] no
connection_testing.instances[1]
Name Description Type Default Required
enabled connection_testing bool true yes
location connection_testing string “westeurope” yes
location_short connection_testing string “we” yes
instance connection_testing string “instance_001” yes
custom_service_name connection_testing string “” no
rg_name connection_testing string rg-sch-conm-tst-we-001 no
key_vault connection_testing object() {} no
disk_encryption_enabled connection_testing bool true no
create_vms connection_testing object() {} no
connectionMonitors connection_testing list(object()) [{}] no
connection_testing_1_key_vault
connection_testing.instances[1].key_vault
363/454
Name Description Type Default Required
name key_vault string kv-sch-conm-tst-we-001 no
short_name key_vault string “conm” no
enable_purge_protection key_vault bool true no
enabled_for_deployment key_vault bool false no
enabled_for_template_deployment key_vault bool true no
enabled_for_disk_encryption key_vault bool true no
enable_rbac_authorization key_vault bool true no
enable_soft_delete key_vault bool true no
sku key_vault string “standard” no
url_suffix key_vault string “vault.azure.net” no
kek_expiry_days key_vault number 0 no
setup_username_expiry_days key_vault number 0 no
setup_password_expiry_days key_vault number 0 no
permissions key_vault map(list(string)) {} no
network_acls_bypass key_vault string “AzureServices” no
network_acls_default_action key_vault string “Deny” no
network_acls_ip_rules key_vault list(string) [] no
network_acls_virtual_network_rules key_vault list(string) [] no
access_policies key_vault list(any) [] no
connection_testing_1_create_vms
connection_testing.instances[1].create_vms
Name Description Type Default Required
enabled create_vms bool true no
rg_short_name create_vms string “conm” no
hardware_size create_vms string “Standard_B2ms” no
image_publisher create_vms string “Canonical” no
image_offer create_vms string “0001-com-ubuntu-server-focal” no
image_sku create_vms string “20_04-lts” no
vm_array create_vms list(object()) [{}] no
create_vms_vm_array_1
connection_testing.instances[1].create_vms.vm_array[0]
Name Description Type Default Required
vm_enabled vm bool true no
new_vm_name vm string vmconmtstwe001 no
new_vm_subnet_association vm string
connectionmonitor_subnet value for current location and instance from outputs
of network
no
update_management_enabled vm bool true no
maintenance_config vm map(string) {“vm-update” = “sharedservices-3-tuesday-0200”} no
364/454
connection_testing_1_connection_monitors
connection_testing.instances[1].connectionMonitors
Name Description Type Default Required
connectionMonitorEnabled connectionMonitors bool true no
connectionMonitorAlertEnabled connectionMonitors bool false no
connectionMonitorSubscriptionId connectionMonitors string <SHAREDSERVICES_SUBSCRIPTION_ID_FETCHED_BY_TERRAFORM> no
connectionMonitorName connectionMonitors string cm-example-azure-to-externaladdress-we no
logAnalyticsWorkspaceId connectionMonitors string workspace_resource_id value from management_outputs of management no
alertActionGroupId connectionMonitors string action_group_id_critical value from management_outputs of management no
endPoints connectionMonitors list(object()) [{}] no
testConfiguration connectionMonitors list(object()) [{}] no
testGroups connectionMonitors list(object()) [{}] no
connectionmonitors_alert_end_points_1
connection_testing.instances[1].connectionMonitors.endPoints[0]
Name Description Type Default Required
name endPoints string “connectiomonitorVM” no
type endPoints string “azureVM” no
resourceId endPoints string ResourceID of VM vmconmtstwe001 no
connection_testing.instances[1].connectionMonitors.endPoints[1]
Name Description Type Default Required
name endPoints string “ubuntuArchive” no
type endPoints string “ExternalAddress” no
address endPoints string “archive.ubuntu.com” no
connectionmonitors_alert_test_configuration_1
connection_testing.instances[1].testConfiguration[0]
Name Description Type Default Required
name testConfiguration string “Http80” no
testFrequencySec testConfiguration number 30 no
protocol testConfiguration string “Http” no
httpConfiguration testConfiguration object() {port = 80,method = “Get”,requestHeaders = [],validStatusCodeRanges
= [],preferHTTPS = false} no
successThreshold testConfiguration object() {checksFailedPercent = 20,roundTripTimeMs = 90} no
connectionmonitors_alert_test_groups_1
connection_testing.instances[1].testGroups[0]
365/454
Name Description Type Default Required
name testGroups string vmconmtstwe001 to http://archive.ubuntu.com no
disable testGroups bool false no
testConfigurations testGroups list(string) [“Http80”] no
sources testGroups list(string) [“connectiomonitorVM”] no
destinations testGroups list(string) [“ubuntuArchive”] no
private_dns
Name Description Type Default Required
private_dns_enabled private_dns bool true no
private_dns_settings private_dns object() {} no
private_dns_settings
Name Description Type Default Required
rg_name private_dns string rg-sch-dnsprivatezone-tst-ne-001 no
private_dns_zone_vnet_links private_dns list(string) hub_vnet_resource_ids,sharedservices_vnet_resource_ids values from outputs of
network
no
primary_private_dns_zone_vnet_links private_dns list(string) hub_vnet_resource_ids,sharedservices_vnet_resource_ids,identity_vnet_resource_ids
values from outputs of network
no
dns_private_zone private_dns object() {} no
private_dns_settings_dns_private_zone
Name Description Type Default Required
primary_name dns_private_zone string “azure-we.nord.cloud” no
private_link_zones dns_private_zone list(string) link no
private_resolver
Name Description Type Default Required
private_resolver_enabled private_resolver bool true no
private_resolver_settings.instances private_resolver object()
[{enabled = true,location = “northeurope”,location_short = “ne”, instance =
“instance_001” },{enabled = true,location = “westeurope”,location_short =
“we”, instance = “instance_001” },{enabled = false,location =
“centralindia”,location_short = “ci”, instance = “instance_001” }]
yes
private_resolver_settings
private_resolver_settings.instances[0]
366/454
Name Description Type Default Required
enabled private_resolver bool true yes
location private_resolver string “northeurope” yes
location_short private_resolver string “ne” yes
instance private_resolver string “instance_001” yes
rg_name private_resolver string rg-sch-privateresolver-tst-ne-001 no
custom_service_name private_resolver string “” no
hub_spoke_with_firewall_as_proxy private_resolver bool true no
private_dns_resolver_name private_resolver string dnspr-sch-tst-ne-001 no
private_resolver_ruleset_name private_resolver string dnspr-sch-ruleset-tst-ne-001 no
network private_resolver object() {} no
remote_virtual_networks private_resolver object() {} no
rules private_resolver list(object()) [{}] no
private_resolver_settings_network_0
private_resolver_settings.instances[0].network.inbound
Name Description Type Default Required
enabled private_resolver_network bool false no
endpoint_name private_resolver_network string “dnsprInbound” no
subnet_name private_resolver_network string snet-dnsprinbound-tst-ne-001 no
private_resolver_settings.instances[0].network.outbound
Name Description Type Default Required
enabled private_resolver_network bool true no
endpoint_name private_resolver_network string “dnsprOutbound” no
subnet_name private_resolver_network string snet-dnsproutbound-tst-ne-001 no
private_resolver_settings_remote_virtual_networks_0
private_resolver_settings.instances[0].remote_virtual_networks
Name Description Type Default Required
hub_spoke_network_vnet_id private_resolver_remote_virtual_networks string
hub_vnet_resource_ids value for current location
and instance from outputs of network
no
shared_services_network_vnet_id private_resolver_remote_virtual_networks string
sharedservices_vnet_resource_ids value for current
location and instance from outputs of network
no
private_resolver_settings_rules_0
private_resolver_settings.instances[0].rules[0]
367/454
Name Description Type Default Required
state private_resolver_rules string “Enabled” no
rule_name private_resolver_rules string “testRule” no
domain_name private_resolver_rules string “test.local.” no
target_dns_servers private_resolver_rules list(object())
[{ ip_address = “192.168.0.4”,port = 53 },{ ip_address =
“192.168.0.5”, port = 53 }] no
private_resolver_settings.instances[1]
Name Description Type Default Required
enabled private_resolver bool true yes
location private_resolver string “westeurope” yes
location_short private_resolver string “we” yes
instance private_resolver string “instance_001” yes
rg_name private_resolver string rg-sch-privateresolver-tst-we-001 no
custom_service_name private_resolver string “” no
hub_spoke_with_firewall_as_proxy private_resolver bool true no
private_dns_resolver_name private_resolver string dnspr-sch-tst-we-001 no
private_resolver_ruleset_name private_resolver string dnspr-sch-ruleset-tst-we-001 no
network private_resolver object() {} no
remote_virtual_networks private_resolver object() {} no
rules private_resolver list(object()) [{}] no
private_resolver_settings_network_1
private_resolver_settings.instances[1].network.inbound
Name Description Type Default Required
enabled private_resolver_network bool false no
endpoint_name private_resolver_network string “dnsprInbound” no
subnet_name private_resolver_network string snet-dnsprinbound-tst-we-001 no
private_resolver_settings.instances[1].network.outbound
Name Description Type Default Required
enabled private_resolver_network bool true no
endpoint_name private_resolver_network string “dnsprOutbound” no
subnet_name private_resolver_network string snet-dnsproutbound-tst-we-001 no
private_resolver_settings_remote_virtual_networks_1
private_resolver_settings.instances[1].remote_virtual_networks
Name Description Type Default Required
hub_spoke_network_vnet_id private_resolver_remote_virtual_networks string
hub_vnet_resource_ids value for current location
and instance from outputs of network
no
shared_services_network_vnet_id private_resolver_remote_virtual_networks string
sharedservices_vnet_resource_ids value for current
location and instance from outputs of network
no
368/454
private_resolver_settings_rules_1
private_resolver_settings.instances[1].rules[0]
Name Description Type Default Required
state private_resolver_rules string “Enabled” no
rule_name private_resolver_rules string “testRule” no
domain_name private_resolver_rules string “test.local.” no
target_dns_servers private_resolver_rules list(object())
[{ ip_address = “192.168.0.4”,port = 53 },{ ip_address =
“192.168.0.5”, port = 53 }] no
LAST APPLIED CONFIGURATION
TEMP Comment: Leave as is for now, will be used later to dynamically update with customer specific config.
outputs
Since state sharing is not recommended due to security the outputs are important if any resources need to be referenced
sharedservices_outputs
Name Description
private_dns_rg_name sharedservices_outputs
private_dns_rg_id sharedservices_outputs
private_dns_sub_id sharedservices_outputs
primary_dns_zone_name sharedservices_outputs
private_resolver_sub_id sharedservices_outputs
private_resolver_rg_name sharedservices_outputs
private_resolver_rg_id sharedservices_outputs
private_resolver_rulset_name sharedservices_outputs
input descriptions
instance
The instance number of the deployed module. The number must be unique for each of location and contains 3 digits.
append_tags
Additional tags to be applied to the resources along with globally defined tags. Common for all resources in this blueprint
connection_testing
connection_testing_enabled
Indicates if Connection Testing module to be deployed
connection_testing_instance_enabled
Indicates if this instance of connection testing needs to be deployed
connection_testing_location
369/454
Location of this connection testing instance
connection_testing_location_short
Short Name of the location of this connection testing instance
connection_testing_instance
Instance Name of this connection testing. Must be unique for each instance. Should be in the format instance_001
connection_testing_custom_service_name
Custom service name to be used in construction of rg name etc.,
connection_testing_rg_name
Resource Group Name of connection testing
connection_testing_disk_encryption_enabled
Enable or disable disk encryption for VM (requries 8GB RAM)
connection_testing_keyvault
key_vault_name
Name of the key_vault
key_vault_short_name
ShortName of the keyvault
key_vault_enable_purge_protection
I f true, protection against purge is enabled for this vault. The setting is effective only if soft delete is also enabled.
Enabling this functionality is irreversible - that is, the property does not accept false as its value.
key_vault_enabled_for_deployment
If true, Azure Virtual Machines are permitted to retrieve certificates stored as secrets from the key vault.
key_vault_enabled_for_template_deployment
If true, Azure Resource Manager is permitted to retrieve secrets from the key vault.
key_vault_enabled_for_disk_encryption
If true, Azure Disk Encryption is permitted to retrieve secrets from the vault and unwrap keys.
key_vault_enable_rbac_authorization
If true, the key vault will use Role Based Access Control (RBAC) for authorization of data actions, and the access policies
specified in vault properties will be ignored.
key_vault_enable_soft_delete
370/454
If true, ‘soft delete’ functionality is enabled for this key vault.
key_vault_sku
Key Vault SKU name to specify whether the key vault is a standard vault or a premium vault.
key_vault_url_suffix
The Azure Key Vault DNS suffix. (DO NOT CHANGE)
key_vault_kek_expiry_days
The number of days after which the VM disk key encryption key expires.
key_vault_setup_username_expiry_days
The number of days after which the VM Setup Username expires.
key_vault_setup_password_expiry_days
The number of days after which the VM Setup Password expires.
key_vault_permissions
Map of role assignments to be provided on the keyvault
key_vault_network_acls_bypass
Azure services to bypass the keyvault FW
key_vault_network_acls_default_action
Default action of the keyvault FW if rule is not enabled
key_vault_network_acls_ip_rules
List of IPs to have access to the keyvault
key_vault_network_acls_virtual_network_rules
List of subnet ids to have access to the keyvault
key_vault_access_policies
Access policy to the keyvault if rbac authorisation is disabled
connnection_testing_create_vms
create_vms_enabled
Indicates if VM needs to be created
create_vms_rg_short_name
Short Name to use in RG of VM
371/454
create_vms_hardware_size
Size of the VM
create_vms_image_publisher
Image publisher to create the VM
create_vms_image_offer
Image to create the VM
create_vms_image_sku
Image SKU for the VM
vm_enabled
If the VM described will be deployed or not
new_vm_name
Name of the VM to be created
new_vm_subnet_association
Subnet that the new VM will be created in, this will be deployed in the regional shared services Vnet. The subnet must
already exist
update_management_enabled
Specifies whether the update management is enabled or disabled on the virtual machine.
maintenance_config
Details of the maintanence schedule that the VM should be assigned to
connection_testing_connnection_monitors
connectionmonitors_connection_monitor_enabled
Whether or not to deploy the connection monitor described in the list
connectionmonitors_connection_monitor_alert_enabled
Whether or not to deploy the alert associated with the connection monitor described in the list. If deploying the dinealerting policy, this should be set to false
connectionmonitors_connection_monitor_subscriptionid
The subscription where the connection monitor will be deployed. This can be deployed to any subscription where the
Network Watcher is present (subscription must have a Vnet)
connectionmonitors_connection_monitor_name
372/454
Name of the connection Monitor created in Network Watcher Notice Examples bottom of this document
connectionmonitors_log_analytics_workspace_id
Resource ID of the log analytics workspace for network watcher logging
connectionmonitors_alert_action_group_id
Resource ID of the log analytics workspace action group for alerting
connectionmonitors_end_points
Holds objects of all endpoints that will be used for connection testing
endpoints_name
Friendly name of the end point that will be used as a reference in the test groups
endpoints_type
Either AzureVM or ExternalAddress :: Type of endpoint that will be used in the test group
endpoints_resourceid
Used only for type: AzureVM :: Resource ID of the Azure VM used as an endpoint
endpoints_address
Used only for type: ExternalAddress :: The external web address used for test group
connectionmonitors_test_configurations
Holds objects of all test configurations that will be used for connection testing
testconfiguration_name
Friendly name of the test configuration that will be used as a reference in the test groups
testconfiguration_testfrequencysec
The frequency of test evaluation, in seconds
testconfiguration_protocol
Protocol used for testing
testconfiguration_httpconfiguration
373/454
Only used when protocol = HTTP, more info here
Contains the below parameters
port = Destination HTTP port method = This applied to test configurations whose protocol is HTTP. Select the HTTP request method–either GET or
POST
requestHeaders = Specify custom request header strings that will make be passed to the destination, more info
validStatusCodeRanges = Choose applicable status codes. If response code does not match this list, you will get a
diagnostic message
preferHTTPS = Specify whether to use HTTPS over HTTP, when port used is neither 80 nor 443
testconfiguration_successthreshold
Success Criteria. Contains the below parameters.
checksFailedPercent = Set the percentage of checks that can fail when sources check connectivity to destinations by using
the criteria that you specified. For TCP or ICMP protocol, the percentage of failed checks can be equated to the percentage
of packet loss. For HTTP protocol, this field represents the percentage of HTTP requests that received no response.
roundTripTimeMs = Set the RTT in milliseconds for how long sources can take to connect to the destination over the test
configuration.
connectionmonitors_test_groups
Holds objects of all test groups that will be used for connection testing
testgroups_name
The name of the connection monitor test group.
testgroups_disable
Value indicating whether test group is disabled.
testgroups_testconfigurations
List of test configuration names.
testgroups_sources
List of source endpoint names.
testgroups_destinations
List of destination endpoint names.
private_dns
private_dns_enabled
Indicates if Private DNS module to be deployed
private_dns_rg_name
Resource Group name of Private DNS
private_dns_zone_vnet_links
374/454
List of vnet links for private dns zones
primary_private_dns_zone_vnet_links
List of vnet links for primary private dns zones
dns_private_zone
dns_private_zone_primary_name
Name of the primary Azure Private DNS zone, will be linked with VNET for Shared Services
dns_private_zone_private_link_zones
List of the Azure Private DNS zones that will be created and linked to VNET for Shared Services
private_link_zones_values
private_link_zones = [
"privatelink.azure-automation.net",
"privatelink.database.windows.net",
"privatelink.blob.core.windows.net",
"privatelink.table.core.windows.net",
"privatelink.queue.core.windows.net",
"privatelink.file.core.windows.net",
"privatelink.web.core.windows.net",
"privatelink.dfs.core.windows.net",
"privatelink.documents.azure.com",
"privatelink.mongo.cosmos.azure.com",
"privatelink.cassandra.cosmos.azure.com",
"privatelink.gremlin.cosmos.azure.com",
"privatelink.table.cosmos.azure.com",
"privatelink.postgres.database.azure.com",
"privatelink.mysql.database.azure.com",
"privatelink.mariadb.database.azure.com",
"privatelink.vaultcore.azure.net",
"privatelink.search.windows.net",
"privatelink.azurecr.io",
"ne.privatelink.azurecr.io",
"privatelink.azconfig.io",
"privatelink.servicebus.windows.net",
"privatelink.azure-devices.net",
"privatelink.eventgrid.azure.net",
"privatelink.azurewebsites.net",
"privatelink.api.azureml.ms",
"privatelink.service.signalr.net",
"privatelink.agentsvc.azure-automation.net",
"ne.privatelink.afs.azure.net",
"privatelink.sql.azuresynapse.net",
"privatelink.azuresynapse.net",
"privatelink.managedhsm.azure.net",
"privatelink.siterecovery.windowsazure.com",
"privatelink.notebooks.azure.net",
"privatelink.datafactory.azure.net",
"privatelink.adf.azure.com",
"privatelink.redis.cache.windows.net",
"privatelink.redisenterprise.cache.azure.net",
"privatelink.purview.azure.com",
"privatelink.purviewstudio.azure.com",
"privatelink.digitaltwins.azure.net",
"privatelink.azurehdinsight.net",
"privatelink.his.arc.azure.com",
"privatelink.guestconfiguration.azure.com",
"privatelink.media.azure.net",
"privatelink.1.azurestaticapps.net",
"privatelink.cognitiveservices.azure.com",
375/454
private_resolver
private_resolver_enabled
Indicates if private resolver module needs to be deployed
private_resolver_settings_enabled
Indicates if this instance of private resolver to be deployed
private_resolver_settings_location
Location of the private resolver
private_resolver_settings_location_short
ShortName of the location of private resolver
private_resolver_settings_instance
Instance Name of this private resolver. Must be unique for each instance. Should be in the format instance_001
private_resolver_settings_rg_name
Resource Group name of the private resolver
private_resolver_settings_custom_service_name
Custom service name to use in construction of RG names etc.,
private_resolver_settings_hub_spoke_with_firewall_as_proxy
Whether or not to enable the HubSpoke with Azure Firewall Proxy scenario (if set to false, other scenarios will be enabled)
private_resolver_settings_private_dns_resolver_name
Name of Private DNS resolver
private_resolver_settings_private_resolver_ruleset_name
Name of private resolver ruleset
private_resolver_network
network_inbound_enabled
Whether or not to enable inbound endpoint (refer to scenario) - this should be set to false if
hubSpokeWithFirewallAsProxy is set to true
"privatelink.openai.azure.com",
"privatelink.batch.azure.com",
"privatelink.azure-api.net",
"privatelink.developer.azure-api.net",
"privatelink.analysis.windows.net",
"privatelink.azuredatabricks.net",
"privatelink.ne.azmk8s.io",
"privatelink.ne.kusto.windows.net"
]
376/454
network_inbound_endpoint_name
Name of the endpoint that will be created in the shared services network subnet (subnetName)
network_inbound_subnet_name
Specifies the name of the subnet where the Private DNS Resolver will reside. Must exist prior to deployment
network_outbound_enabled
Whether or not to enable outbound endpoint
network_outbound_endpoint_name
Name of the endpoint that will be created in the shared services network subnet (subnetName)
network_outbound_subnet_name
Specifies the name of the subnet where the Private DNS Resolver will reside. Must exist prior to deployment
Note: Outbound endpoint is required for on-premise domain resolution
private_resolver_remote_virtual_networks
remote_virtual_networks_hub_spoke_network_vnet_id
vnet id of hubspoke vnet
remote_virtual_networks_shared_services_network_vnet_id
vnet id of shared services vnet
private_resolver_rules
rules_state
State of the rule Enabled or Disabled
rules_rule_name
Friendly Name of the rule (usually reference to onprem domain)
rules_domain_name
domain name. The domain name must end in a ., for example nordcloud.com.
rules_target_dns_servers
List of DNS server. With each item of the list having the following:
ip_address = Onpremise DNS server IP address that can resolve this domain
port = Port used for DNS resolution - must be 53
output descriptions
sharedservices_outputs
377/454
output_private_dns_rg_name
Resource group name of Private DNS
output_private_dns_rg_id
Resource group ID of Private DNS
output_private_dns_sub_id
Subscription ID of private DNS
output_primary_dns_zone_name
Name of Primary Private DNS Zone
output_private_resolver_sub_id
Subscription ID of private resolver
output_private_resolver_rg_name
Resource Group name of Private Resolver for each location and instance
output_private_resolver_rg_id
Resource Group ID of Private Resolver for each location and instance
output_private_resolver_rulset_name
Ruleset name of private resolver for each location and instance
Below is an example of sharedservices_outputs
{
"primary_dns_zone_name": "azure-we.nord.cloud",
"private_dns_rg_id": "/subscriptions/11112222-222e-4444-v000-5555555555/resourceGroups/rgsch-dnsprivatezone-tst-ne-001",
"private_dns_rg_name": "rg-sch-dnsprivatezone-tst-ne-001",
"private_dns_sub_id": "11112222-222e-4444-v000-5555555555",
"private_resolver_rg_id": {
"instance_001-northeurope": "/subscriptions/11112222-222e-4444-v000-
5555555555/resourceGroups/rg-sch-privateresolver-tst-ne-001",
"instance_001-westeurope": "/subscriptions/11112222-222e-4444-v000-
5555555555/resourceGroups/rg-sch-privateresolver-tst-we-001"
},
"private_resolver_rg_name": {
"instance_001-northeurope": "rg-sch-privateresolver-tst-ne-001",
"instance_001-westeurope": "rg-sch-privateresolver-tst-we-001"
},
"private_resolver_rulset_name": {
"instance_001-northeurope": "dnspr-sch-ruleset-tst-ne-001",
"instance_001-westeurope": "dnspr-sch-ruleset-tst-we-001"
},
"private_resolver_sub_id": "52b39c07-340e-45f3-a012-204ce5618821"
}
dependency
T h e SharedServices module is dependent on the following modules: - /CORE - /PROVISIONER/CICD -
/CORE/NETWORK - /CORE/MANAGEMENT — id: blueprint-policies-standard-tf title: Policies sidebar_position: 11 —
modules
378/454
List modules which are within given blueprint :
Policies
inputs
policies
Using this blueprint the following components are created:
1. policy definitions
The default pre-defined custom policy definitions present in the path terraform\.modules\acf\modules\blueprintpolicies-standard\acf_policy_definitions and which are having policy assignments would be created.
Currently there are two types of policies : Custom and Built-in. Built-in policies will always have a property named
definitionId, which refers to the ID of Azure policy definition. All other policies without definitionId are custom
policies created by Nordcloud. All policies are divided into different categories:
Compute - contains parameters for policies related to VMs (allowed SKUs, Images, Publishers, type of disks and disk
ecryption, backups)
General - general parameters for policies related to whole environment (allowed/not allowed locations, types of
resources, subscription budgets, classic resources management)
Key Vault - contains parameters for policies related to Key Vaults (deny KV with default network rule, forcing soft
delete)
Monitoring - contains parameters for policies related to monitoring (creating missing alerts, VM diagnostic, datadog
config, deploy not existing LAWs)
Network - contains parameters for policies related to networking (deny public IPs, default configurations, reosurces
without NSG etc.)
Privileges - contains parameters for policy that denies the possibility to creating Role Assignment of Owner or User
Access Administrator privileges
Security - contains parameters for initiative with will automatically enable Azure Security Center for chosen
subscription
SQL - contains parameters for policies related to SQL (audits and deploys threat detection, SQL firewall, data
encryption)
Storage - contains parameters for policies related to Storage Accounts (deny public access, http access, force
encrypting and secure transfer)
Tag - contains parameters for built-in Azure policy which will append provided tag to resource groups
AppServices - contains parameters for built-in Azure policy that control security of app services
2. policy set definitions
379/454
The default pre-defined custom policy set definitions present in the path
terraform\.modules\acf\modules\blueprint-policies-standard\acf_policy_set_definitions and which are
having policy assignments would be created.
3. policy assignments
The default policy assignments using policy definitions or policy set defintions (which can be either builtin or custom)
would be created. These policy assignments are defined in the path terraform\.modules\acf\modules\blueprintpolicies-standard\acf_policy_assignments. These parameters for the policy definitions or policy set definitions can
be changed using the input acf_policy_parameters or can be overriden during the assignment by updating the parameters
for each management group scope in here
3a) policy assignment changes or additional policy assignment
When making changes to default policy assignments or definining a new additional policy assignment, it’s important to
ensure all relevant information is provided.
To make changes to default policy assignments, update the inputs in default_acf_policy_assignments_changes
To add a new policy assignment with built in or custom policy definitions, update the input in
additional_policy_assignments
For Built-In policy assignment (assignments using built-in policy definitions), the below code block defines the structure
that it must adhere to:
Note these have definitionId property
For Custom policy assignment (assignments using custom policy definitions), the below code block defines the structure
that it must adhere to:
Note these have name property
- definitionId: /providers/Microsoft.Authorization/policyDefinitions/xxxx-xxxx-xxxx-xxxx
assignmentName: some-assignment-name
description: Some description about this policy assignment
displayName: Display Name for the policy assignment
identity:
type: None | systemAssigned
managementGroups:
- management_group_name: mg-acf
enabled: true | false
linkedScopes: ["/subscription/xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx/resourceGroups/xxx-xxx" ]
notScopes: ["/subscription/xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx/resourceGroups/xxx-xxx" ]
parameters:
param1: value1
nonComplianceMsg: Message Here
- name: policy name
assignmentName: some-assignment-name
description: Some description about this policy assignment
displayName: Display Name for the policy assignment
identity:
type: None | systemAssigned | UserAssigned
managementGroups:
- management_group_name: mg-acf
enabled: true | false
linkedScopes: ["/subscription/xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx/resourceGroups/xxx-xxx" ]
notScopes: ["/subscription/xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx/resourceGroups/xxx-xxx" ]
parameters:
param1: value1
nonComplianceMsg: Message Here
380/454
3b) exclusions for policy assignments
Exclusions are handled in two different methods.
1. Automatic Exclusions
2. Manual Exclusions
Exclusions to policies are required in specific scenarios. For example, denying a public IP - an exclusion should be made
for VPN Gateways.
automatic exclusions
Following are the list of exclusions that are automatically handled inside terraform code.
Name Description
pipNotScope Public IP resource ID’s that are deployed with ACF
subnetWoNsgNotScope Subnets that do not require an NSG
gatewaySubnetNotScope Gateway Subnet ID’s
subnetWoRtNotScope Subnets that do not require a Route Table
defaultRouteInternetNotScope Route Tables that do not require a default route
vpnGwNotScope Specific VPN Gateway Subnets
erGwNotScope Specific Express Route Gateway Subnets
manual exclusions
It is also possible to manually add an exclusion for a given policy assignment.
Add the list of exclusions to the notScopes property for given management group scope as below:
policies_inputs
Name Description Type Default Required
default_azure_policies_enabled policies_inputs bool true no
customised_azure_policies_enabled policies_inputs bool true no
acf_policy_parameters policies_inputs any {defaults = null } yes
default_acf_policy_assignments_changes policies_inputs any {policy_assignments = null } yes
additional_policy_assignments policies_inputs any {policy_assignments = null } yes
acf_policy_parameters
Note: In order to define a new value for a parameter, the entire value should be uncommented, and make the additions or
removal. For eg. to add an additional value to imagePublisher parameter, the entire value should be uncommented.
managementGroups:
- management_group_name : mg-acf
# enabled: true
# linkedScopes: []
notScopes": [
"/subscriptions/xxxx/resourceGroups/xxxx",
"/subscriptions/yyyy/resourceGroups/yyyy"
]
# parameters:
# param1: value1
381/454
Note: Only below static parameters listed acf_policy_parameters.defaults might require adjustment for initial
deployment
acf_policy_parameters_defaults
acf_policy_parameters.defaults
Name Description Type Default Required
imagePublisher parameters list(string) [“Redhat”,“OpenLogic”,“Canonical”,“MicrosoftWindowsServer”] no
imageOffer parameters list(string)
[“RHEL”,“rhel-byos”,“SLES”,“UbuntuServer”,“0001-com-ubuntu-serverfocal”,“Windows-10”,“WindowsServer”] no
imageSku parameters list(string) link no
listOfAllowedSKUs parameters list(string) link no
approvedExtensions parameters list(string) link no
vaultScheduledRuntime parameters string “02:00:00” no
vaultDefaultRetentionDailyCount parameters string “30” no
vaultDefaultRetentionWeeklyCount parameters string “4” no
rsvNamePrefix parameters string “rsv-cent-bak” no
rsvResourceGroupNamePrefix parameters string “rg-cent-vm-bak” no
datadogSite parameters string “datadoghq.com” no
datadogApiSecretName parameters string “datadogAPI” no
StorageAccountDiagNosticsWrite parameters bool false no
StorageAccountDiagNosticsRead parameters bool false no
WAFModeRequirement parameters string “Detection” no
subnetNSGExclusions parameters list(string) [“AzureFirewallManagementSubnet”,“AzureFirewallSubnet”,“GatewaySubnet”] no
ascEmailContact parameters string “notexisting@nordcloud.com” no
ascSecurityPhoneNumber parameters string “123456789” no
ascPricingTier parameters string “Standard” no
ascAutoProvision parameters string “Off” no
ascMcasIntegration parameters string “True” no
ascWdatpIntegration parameters string “True” no
vmBackupTag parameters string “enabled”, no
vmUpdateTag parameters string “3-tuesday-0200” no
blobbackupTag parameters string “true” no
Original:
# imagePublisher: [
# "Redhat",
# "OpenLogic",
# "Canonical",
# "MicrosoftWindowsServer"
# ]
Updated:
imagePublisher: [
"Redhat",
"OpenLogic",
"Canonical",
"MicrosoftWindowsServer",
"NEW-VALUE"
]
382/454
acf_locations parameters map(string) acf_locations map from global_vars.yaml file no
allowedLocations parameters list(string) [<keys of acf_locations map from global_vars.yaml file>, “global”] no
auditWorkspaceSubscriptionId parameters string audit value from subscription map from global_vars.yaml file no
workspaceSubscriptionId parameters string management value from subscription map from global_vars.yaml file no
spokeWorkspaceNamePrefix parameters string log-sch-spoke-tst-ne-001 no
spokeWorkspaceRg parameters string rg-sch-logging-spoke-tst-ne-001 no
spokeWorkspaceLocation parameters string location defined in org hcl file no
sharedKeyvaultId parameters string
/subscriptions/<audit value from subscription map from global_vars.yaml
file>/resourceGroups/rg-sch-keyvault-tst-ne001/providers/Microsoft.KeyVault/vaults/kvncsharedservicesdevwe2”
no
cisAlertsrgName parameters string rg-sch-alerts-tst-ne-001 no
cisAlertsLocation parameters string location defined in org hcl file no
saResourceGroupNamePrefix parameters string rg-sch-flowlogs no
saNamePrefix parameters string saschtst no
subnetRTExclusions parameters list(string)
[“AzureFirewallManagementSubnet”,“AzureBastionSubnet”, “snetfunctions-tst-ne-001” ] no
sandboxMgId parameters string
/providers/Microsoft.Management/managementGroups/mg-sandbox value from
outputs of core no
connectivityMgId parameters string
/providers/Microsoft.Management/managementGroups/mg-connectivity value
from outputs of core no
onlineMgId parameters string
/providers/Microsoft.Management/managementGroups/mg-online value from
outputs of core no
auditMgId parameters string
/providers/Microsoft.Management/managementGroups/mg-audit value from
outputs of core no
auditWorkspaceResourceGroupName parameters string workspace_resource_group_name from audit_outputs no
auditStorageName parameters string storage_account_name from audit_outputs no
auditWorkspaceName parameters string workspace_resource_name from audit_outputs no
audit_storage_enabled parameters string storage_enabled from audit_outputs no
workspaceResourceGroupName parameters string workspace_resource_group_name from management_outputs no
workspaceName parameters string workspace_resource_name from management_outputs no
actionGroupNameWarningId parameters string action_group_name_warning from management_outputs no
actionGroupNameCriticalId parameters string action_group_name_critical from management_outputs no
dcrNameWindows parameters string dcr_name_windows from management_outputs no
dcrNameLinux parameters string dcr_name_linux from management_outputs no
dcrSuffixStandard parameters string dcr_suffix_standard from management_outputs no
topology parameters string selected_topology from network output no
subnetWoRtNotScope parameters list(string) combination of subnet_wo_rt_not_scope lists across all instances from network
output no
erGwNotScope parameters list(string) combination of er_gw_not_scope lists across all instances from network output,
if their count >= 1 else [“/subscriptions/dummy”] no
vpnGwNotScope parameters list(string) combination of vpn_gw_not_scope lists across all instances from network
output, if their count >= 1 else [“/subscriptions/dummy”] no
defaultRouteInternetNotScope parameters list(string) combination of default_route_internet_not_scope lists across all instances from
network output no
hubVnetResourceIds parameters list(string) combination of hub_vnet_resource_ids lists across all instances from network
output no
Name Description Type Default Required
383/454
subnetWoNsgNotScope parameters list(string) combination of subnet_wo_nsg_not_scope lists across all instances from
network output no
pipNotScope parameters list(string)
[ pip_not_scope from app gw output,combination of pip_not_scope lists across
all instances from network output if their count >= 1 else
[“/subscriptions/dummy”], combination of
public_firewall_ip_addresses_resource_id lists across all instances from firewall
output if their count >= 1 else [“/subscriptions/dummy”] ]
no
firewallIpAddresses parameters list(string) private_firewall_ip_addresses from firewall output no
privateDNSZoneResourceGroupId parameters string private_dns_rg_id from sharedservices_outputs no
vmManagementResourceGroupName parameters string vm_management_rg_name from management_outputs no
privateEndpointDnsNotScope parameters list(string) [ private_dns_rg_id from sharedservices_outputs ] no
Name Description Type Default Required
default_acf_policy_assignments_changes
default_acf_policy_assignments_changes.policy_assignments[0]
Name Description Type Default Required
definitionId policy_assignments_changes string
/providers/Microsoft.Authorization/policyDefinitions/399b2637-a50f4f95-96f8-3a145476eb15
no
assignmentName policy_assignments_changes string aine-fapp-ftps no
description policy_assignments_changes string Enable FTPS enforcement for enhanced security. no
displayName policy_assignments_changes string Function apps should require FTPS only no
identity policy_assignments_changes map(string) {type = None} no
managementGroups policy_assignments_changes list(map) [] no
nonComplianceMsg policy_assignments_changes string FTPS should be enabled for Function Apps no
management_groups_0_0
default_acf_policy_assignments_changes.policy_assignments[0].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-landing-zones no
enabled management_groups bool true no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect = AuditIfNotExists } no
default_acf_policy_assignments_changes.policy_assignments[1]
384/454
Name Description Type Default Required
definitionId policy_assignments_changes string
/providers/Microsoft.Authorization/policyDefinitions/f9d614c5-c173-4d56-
95a7-b4437057d193
no
assignmentName policy_assignments_changes string aine-fapp-lat-tls no
description policy_assignments_changes string
Periodically, newer versions are released for TLS either due to security flaws,
include additional functionality, and enhance speed. Upgrade to the latest TLS
version for Function apps to take advantage of security fixes, if any, and/or
new functionalities of the latest version.
no
displayName policy_assignments_changes string Function apps should use the latest TLS version no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Latest TLS version should be enabled for Function Apps no
management_groups_1_0
default_acf_policy_assignments_changes.policy_assignments[1].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-landing-zones no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=AuditIfNotExists} no
default_acf_policy_assignments_changes.policy_assignments[2]
Name Description Type Default Required
definitionId policy_assignments_changes string
/providers/Microsoft.Authorization/policyDefinitions/0e60b895-3786-
45da-8377-9c6b4b6ac5f9
no
assignmentName policy_assignments_changes string aine-fapp-wo-debug no
description policy_assignments_changes string
Remote debugging requires inbound ports to be opened on Function apps. Remote debugging should be turned off. no
displayName policy_assignments_changes string Function apps should have remote debugging turned off no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Remote Debugging should be turned off for Function Apps no
management_groups_2_0
default_acf_policy_assignments_changes.policy_assignments[2].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-landing-zones no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=AuditIfNotExists} no
default_acf_policy_assignments_changes.policy_assignments[3]
385/454
Name Description Type Default Required
name policy_assignments_changes string aine-sql-paas-specific-firewall-ip no
assignmentName policy_assignments_changes string aine-sql-fw-ip no
description policy_assignments_changes string This policy audits specific firewall IPs on SQL Server. no
displayName policy_assignments_changes string
Audit SQL Server firewalls without specified firewall
IPs no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
PaaS SQL servers should have given network rule in
place no
management_groups_3_0
default_acf_policy_assignments_changes.policy_assignments[3].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-landing-zones no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{endIpAddress=10.0.0.1,
startIpAddress=10.0.0.1} no
default_acf_policy_assignments_changes.policy_assignments[4]
Name Description Type Default Required
name policy_assignments_changes string aine-sql-paas-specific-firewall-vnet no
assignmentName policy_assignments_changes string aine-sql-fw-vnet no
description policy_assignments_changes string
This policy auditsifnotexists that SQL server firewall is
opened to subnet no
displayName policy_assignments_changes string Audit SQL Server firewalls without specified Subnet allowed no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string PaaS SQL should have specific virtual network rule enabled no
management_groups_4_0
default_acf_policy_assignments_changes.policy_assignments[4].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-landing-zones no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {subnetId=} no
default_acf_policy_assignments_changes.policy_assignments[5]
386/454
Name Description Type Default Required
definitionId policy_assignments_changes string
/providers/Microsoft.Authorization/policyDefinitions/4d24b6d4-5e53-
4a4f-a7f4-618fa573ee4b
no
assignmentName policy_assignments_changes string aine-webapp-ftps no
description policy_assignments_changes string Enable FTPS enforcement for enhanced security. no
displayName policy_assignments_changes string App Service apps should require FTPS only no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string FTPS should be enabled for WebApps no
management_groups_5_0
default_acf_policy_assignments_changes.policy_assignments[5].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-landing-zones no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=AuditIfNotExists} no
default_acf_policy_assignments_changes.policy_assignments[6]
Name Description Type Default Required
definitionId policy_assignments_changes string
/providers/Microsoft.Authorization/policyDefinitions/f0e6e85b-9b9f-4a4bb67b-f730d42f1b0b
no
assignmentName policy_assignments_changes string aine-webapp-lat-tls no
description policy_assignments_changes string
Periodically, newer versions are released for TLS either due to security flaws,
include additional functionality, and enhance speed. Upgrade to the latest TLS
version for App Service apps to take advantage of security fixes, if any, and/or
new functionalities of the latest version.
no
displayName policy_assignments_changes string App Service apps should use the latest TLS version no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Latest TLS version should be enabled for WebApps no
management_groups_6_0
default_acf_policy_assignments_changes.policy_assignments[6].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-landing-zones no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=AuditIfNotExists} no
default_acf_policy_assignments_changes.policy_assignments[7]
387/454
Name Description Type Default Required
definitionId policy_assignments_changes string
/providers/Microsoft.Authorization/policyDefinitions/cb510bfd-1cba4d9f-a230-cb0976f4bb71
no
assignmentName policy_assignments_changes string aine-webapp-wo-debug no
description policy_assignments_changes string
Remote debugging requires inbound ports to be opened on an App Service
app. Remote debugging should be turned off. no
displayName policy_assignments_changes string App Service apps should have remote debugging turned off no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Remote Debugging should be turned off for WebApps no
management_groups_7_0
default_acf_policy_assignments_changes.policy_assignments[7].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-landing-zones no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=AuditIfNotExists} no
default_acf_policy_assignments_changes.policy_assignments[8]
Name Description Type Default Required
definitionId policy_assignments_changes string
/providers/Microsoft.Authorization/policyDefinitions/c0e996f8-39cf4af9-9f45-83fbde810432
no
assignmentName policy_assignments_changes string allow-approved-vm-ex no
description policy_assignments_changes string
This policy governs the virtual machine extensions that are not
approved. no
displayName policy_assignments_changes string Only approved VM extensions should be installed no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Only VM extensions in allow list should be deployed no
management_groups_8_0
default_acf_policy_assignments_changes.policy_assignments[8].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string)
[/providers/Microsoft.Management/managementGroups/mgsandbox] no
parameters management_groups map {approvedExtensions=link, effect=Deny} no
default_acf_policy_assignments_changes.policy_assignments[9]
388/454
Name Description Type Default Required
definitionId policy_assignments_changes string
/providers/Microsoft.Authorization/policyDefinitions/e765b5de-1225-4ba3-
bd56-1ac6695af988
no
assignmentName policy_assignments_changes string allow-location-rg no
description policy_assignments_changes string
This policy enables you to restrict the locations your organization can create
resource groups in. Use to enforce your geo-compliance requirements. no
displayName policy_assignments_changes string Allowed locations for resource groups no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Deployments should only occur in allowed locations no
management_groups_9_0
default_acf_policy_assignments_changes.policy_assignments[9].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{listOfAllowedLocations=
[centralindia,northeurope,westeurope,global]} no
default_acf_policy_assignments_changes.policy_assignments[10]
Name Description Type Default Required
definitionId policy_assignments_changes string
/providers/Microsoft.Authorization/policyDefinitions/e56962a6-4747-49cdb67b-bf8b01975c4c no
assignmentName policy_assignments_changes string allow-location-rsc no
description policy_assignments_changes string
This policy enables you to restrict the locations your organization can specify when deploying resources. Use to enforce your geo-compliance requirements. Excludes resource groups, Microsoft.AzureActiveDirectory/b2cDirectories,
and resources that use the ‘global’ region.
no
displayName policy_assignments_changes string Allowed locations no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Deployments should only occur in allowed locations no
management_groups_10_0
default_acf_policy_assignments_changes.policy_assignments[10].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{listOfAllowedLocations=
[centralindia,northeurope,westeurope,global]} no
389/454
default_acf_policy_assignments_changes.policy_assignments[11]
Name Description Type Default Required
name policy_assignments_changes string allow-vm-image no
assignmentName policy_assignments_changes string allow-vm-image no
description policy_assignments_changes string This policy governs the approved VM images. no
displayName policy_assignments_changes string Allow only specified VM images no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
Only VM Images in allow list should be
deployed
no
management_groups_11_0
default_acf_policy_assignments_changes.policy_assignments[11].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{imageOffer=[“RHEL”,“rhel-byos”,“SLES”,“UbuntuServer”,“0001-comubuntu-server-focal”,“Windows-10”,“WindowsServer”], imagePublisher=
[“Redhat”,“OpenLogic”,“Canonical”,“MicrosoftWindowsServer”] ,
imageSku=link }
no
default_acf_policy_assignments_changes.policy_assignments[12]
Name Description Type Default Required
name policy_assignments_changes string allow-vm-sku no
assignmentName policy_assignments_changes string allow-vm-sku no
description policy_assignments_changes string
This policy allows you to specify what skus are allowed for storage
accounts and virtual machines. no
displayName policy_assignments_changes string Allow only specified VM SKUs no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Only VM SKU’s in allow list should be deployed no
management_groups_12_0
default_acf_policy_assignments_changes.policy_assignments[12].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {listOfAllowedSKUs=link} no
390/454
default_acf_policy_assignments_changes.policy_assignments[13]
Name Description Type Default Required
name policy_assignments_changes string append-keyvault-purge-protection no
assignmentName policy_assignments_changes string append-kv-purge no
description policy_assignments_changes string This policy appends purge protection to key vaults no
displayName policy_assignments_changes string Ensure purge protection is enabled for Key Vaults no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Keyvaults should have purge protection enabled no
management_groups_13_0
default_acf_policy_assignments_changes.policy_assignments[13].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {} no
default_acf_policy_assignments_changes.policy_assignments[14]
Name Description Type Default Required
name policy_assignments_changes string append-keyvault-soft-delete no
assignmentName policy_assignments_changes string append-kv-soft-del no
description policy_assignments_changes string This policy appends soft delete to key vaults no
displayName policy_assignments_changes string Ensure soft delete is enabled for Key Vaults no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Keyvaults should have soft delete enabled no
management_groups_14_0
default_acf_policy_assignments_changes.policy_assignments[14].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {} no
default_acf_policy_assignments_changes.policy_assignments[15]
391/454
Name Description Type Default Required
name policy_assignments_changes string append-vmmonitor-tag no
assignmentName policy_assignments_changes string append-vmmonitor-tag no
description policy_assignments_changes string
This initiative modifies the azmonitor tag to VM’s with specified
value which states which DCR to assign to
no
displayName policy_assignments_changes string Enforce Azure Monitor Tagging for DCR Association no
identity policy_assignments_changes map(string) {type=systemAssigned} no
isInitiative policy_assignments_changes bool true no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
DCR tags should be deployed for the AMA agent to assign to correct DCR configuration
no
management_groups_15_0
default_acf_policy_assignments_changes.policy_assignments[15].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{dcrRuleResourceNameLinux=dcr-sch-linux-tst-ne-001,
dcrRuleResourceNameWindows=dcr-sch-windows-tst-ne-001} no
default_acf_policy_assignments_changes.policy_assignments[16]
Name Description Type Default Required
definitionId policy_assignments_changes string
/providers/Microsoft.Authorization/policyDefinitions/12430be1-6cc8-4527-
a9a8-e3d38f250096
no
assignmentName policy_assignments_changes string audit-appgw-waf-mode no
description policy_assignments_changes string
Mandates the use of ‘Detection’ or ‘Prevention’ mode to be active on all
Web Application Firewall policies for Application Gateway. no
displayName policy_assignments_changes string
Web Application Firewall (WAF) should use the specified mode for Application Gateway
no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
The selected WAF Mode Requirement (‘Detection’ or ‘Prevention’) should
be enabled
no
management_groups_16_0
default_acf_policy_assignments_changes.policy_assignments[16].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=Audit, modeRequirement=Detection} no
392/454
default_acf_policy_assignments_changes.policy_assignments[17]
Name Description Type Default Required
definitionId policy_assignments_changes string
/providers/Microsoft.Authorization/policyDefinitions/6d555dd1-86f2-
4f1c-8ed7-5abae7c6cbab
no
assignmentName policy_assignments_changes string audit-fapp-https no
description policy_assignments_changes string
Use of HTTPS ensures server/service authentication and protects data in
transit from network layer eavesdropping attacks. no
displayName policy_assignments_changes string Function apps should only be accessible over HTTPS no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string HTTPS should be enabled for Function Apps no
management_groups_17_0
default_acf_policy_assignments_changes.policy_assignments[17].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-landing-zones no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=Audit} no
default_acf_policy_assignments_changes.policy_assignments[18]
Name Description Type Default Required
definitionId policy_assignments_changes string
/providers/Microsoft.Authorization/policyDefinitions/21a8cd35-125e-4d13-
b82d-2e19b7208bb7
no
assignmentName policy_assignments_changes string audit-fs-pub-access no
description policy_assignments_changes string
Disabling the public endpoint allows you to restrict access to your Storage
Sync Service resource to requests destined to approved private endpoints on
your organization’s network. There is nothing inherently insecure about
allowing requests to the public endpoint, however, you may wish to disable it
to meet regulatory, legal, or organizational policy requirements. You can
disable the public endpoint for a Storage Sync Service by setting the
incomingTrafficPolicy of the resource to AllowVirtualNetworksOnly.
no
displayName policy_assignments_changes string Public network access should be disabled for Azure File Sync no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Storage Sync Service should disable public access no
management_groups_18_0
default_acf_policy_assignments_changes.policy_assignments[18].managementGroups[0]
393/454
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=Audit} no
default_acf_policy_assignments_changes.policy_assignments[19]
Name Description Type Default Required
name policy_assignments_changes string audit-nsg-rule-pub-rdp no
assignmentName policy_assignments_changes string audit-nsg-pub-rdp no
description policy_assignments_changes string
This policy audits any network security rule that allows RDP
access from Internet no
displayName policy_assignments_changes string RDP access from the Internet should be blocked no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string NSG’s should not have public RDP enabled no
management_groups_19_0
default_acf_policy_assignments_changes.policy_assignments[19].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {} no
default_acf_policy_assignments_changes.policy_assignments[20]
Name Description Type Default Required
name policy_assignments_changes string audit-nsg-rule-pub-ssh no
assignmentName policy_assignments_changes string audit-nsg-pub-ssh no
description policy_assignments_changes string
This policy audits any network security rule that allows SSH
access from Internet no
displayName policy_assignments_changes string SSH access from the Internet should be blocked no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string NSG’s should not have public SSH enabled no
management_groups_20_0
default_acf_policy_assignments_changes.policy_assignments[20].managementGroups[0]
394/454
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {} no
default_acf_policy_assignments_changes.policy_assignments[21]
Name Description Type Default Required
definitionId policy_assignments_changes string
/providers/Microsoft.Authorization/policyDefinitions/34c877ad-507e-4c82-
993e-3452a6e0ad3c no
assignmentName policy_assignments_changes string audit-sa-restric-net no
description policy_assignments_changes string
Network access to storage accounts should be restricted. Configure network
rules so only applications from allowed networks can access the storage
account. To allow connections from specific internet or on-premises clients,
access can be granted to traffic from specific Azure virtual networks or to
public internet IP address ranges
no
displayName policy_assignments_changes string Storage accounts should restrict network access no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Storage Account should restrict network traffic no
management_groups_21_0
default_acf_policy_assignments_changes.policy_assignments[21].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=Audit} no
default_acf_policy_assignments_changes.policy_assignments[22]
Name Description Type Default Required
definitionId policy_assignments_changes string
/providers/Microsoft.Authorization/policyDefinitions/404c3081-a854-4457-
ae30-26a93ef643f9
no
assignmentName policy_assignments_changes string audit-sa-wo-sectrans no
description policy_assignments_changes string
Audit requirement of Secure transfer in your storage account. Secure transfer is
an option that forces your storage account to accept requests only from secure
connections (HTTPS). Use of HTTPS ensures authentication between the
server and the service and protects data in transit from network layer attacks
such as man-in-the-middle, eavesdropping, and session-hijacking
no
displayName policy_assignments_changes string Secure transfer to storage accounts should be enabled no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Storage Accounts should have Secure Transfer enabled no
management_groups_22_0
395/454
default_acf_policy_assignments_changes.policy_assignments[22].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=Audit} no
default_acf_policy_assignments_changes.policy_assignments[23]
Name Description Type Default Required
name policy_assignments_changes string audit-sql-paas-anyany-firewall no
assignmentName policy_assignments_changes string audit-sql-anyany-fw no
description policy_assignments_changes string
This policy audits that SQL server firewall is not
completely open
no
displayName policy_assignments_changes string Audit SQL Server firewalls that are open to all IPs no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string PaaS SQL shoul not allow Any-Any on the firewall no
management_groups_23_0
default_acf_policy_assignments_changes.policy_assignments[23].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-landing-zones no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {} no
default_acf_policy_assignments_changes.policy_assignments[24]
Name Description Type Default Required
name policy_assignments_changes string audit-sql-paas-firewall no
assignmentName policy_assignments_changes string audit-sql-firewall no
description policy_assignments_changes string
Disabling the public network access property improves security by ensuring
your Azure SQL Database can only be accessed from a private endpoint. This
configuration denies all logins that match IP or virtual network based firewall
rules.
no
displayName policy_assignments_changes string Public network access on Azure SQL Database should be disabled no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string PaaS SQL should have Firewall enabled no
management_groups_24_0
default_acf_policy_assignments_changes.policy_assignments[24].managementGroups[0]
396/454
Name Description Type Default Required
management_group_name management_groups string mg-landing-zones no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {} no
default_acf_policy_assignments_changes.policy_assignments[25]
Name Description Type Default Required
name policy_assignments_changes string audit-subnet-wo-nsg no
assignmentName policy_assignments_changes string audit-subnet-wo-nsg no
description policy_assignments_changes string
This policy audits any subnet that does not have an associated
Network Security Group
no
displayName policy_assignments_changes string Subnets should be associated with a Network Security Group no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
Subnets should have NSG’s, except when serving specific Azure
services that do not require it no
management_groups_25_0
default_acf_policy_assignments_changes.policy_assignments[25].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{excludedSubnets=
[AzureFirewallManagementSubnet,AzureFirewallSubnet,GatewaySubnet]} no
default_acf_policy_assignments_changes.policy_assignments[26]
Name Description Type Default Required
name policy_assignments_changes string audit-subnet-wo-routetable no
assignmentName policy_assignments_changes string audit-subnet-wo-rt no
description policy_assignments_changes string
This policy audits any subnet that does not have an associated route table,
except for AzureBastionSubnet and AzureFirewallManagementSubnet that
do not need them.
no
displayName policy_assignments_changes string Subnets should be associated with a Route Table no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
Subnets should have Route Tables, except when serving specific Azure
services that do not require it no
management_groups_26_0
default_acf_policy_assignments_changes.policy_assignments[26].managementGroups[0]
397/454
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{excludedSubnets=
[AzureFirewallManagementSubnet,AzureBastionSubnet,snetfunctions-tst-ne-001]}
no
default_acf_policy_assignments_changes.policy_assignments[27]
Name Description Type Default Required
definitionId policy_assignments_changes string
/providers/Microsoft.Authorization/policyDefinitions/a4af4a39-4135-47fbb175-47fbdf85311d
no
assignmentName policy_assignments_changes string audit-webapp-https no
description policy_assignments_changes string
Use of HTTPS ensures server/service authentication and protects data in
transit from network layer eavesdropping attacks. no
displayName policy_assignments_changes string App Service apps should only be accessible over HTTPS no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string HTTPS should be enabled for WebApps no
management_groups_27_0
default_acf_policy_assignments_changes.policy_assignments[27].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-landing-zones no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=Audit} no
default_acf_policy_assignments_changes.policy_assignments[28]
Name Description Type Default Required
definitionId policy_assignments_changes string
/providers/Microsoft.Authorization/policyDefinitions/564feb30-bf6a-4854-
b4bb-0d2d2d1e6c66
no
assignmentName policy_assignments_changes string deny-appgw-wo-waf no
description policy_assignments_changes string
Deploy Azure Web Application Firewall (WAF) in front of public facing web
applications for additional inspection of incoming traffic. Web Application
Firewall (WAF) provides centralized protection of your web applications from
common exploits and vulnerabilities such as SQL injections, Cross-Site
Scripting, local and remote file executions. You can also restrict access to your web applications by countries, IP address ranges, and other http(s) parameters
via custom rules.
no
displayName policy_assignments_changes string Web Application Firewall (WAF) should be enabled for Application Gateway no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Application Gateways must have WAF enabled no
398/454
management_groups_28_0
default_acf_policy_assignments_changes.policy_assignments[28].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=Deny} no
default_acf_policy_assignments_changes.policy_assignments[29]
Name Description Type Default Required
name policy_assignments_changes string deny-classic-resources no
assignmentName policy_assignments_changes string deny-classic-res no
description policy_assignments_changes string
This policy denies the creation of Azure Classic resources
(ASM). no
displayName policy_assignments_changes string Deny creation of Azure Classic Resources [ASM] no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
No classic resources are allowed, only Azure Resource Manager resources no
management_groups_29_0
default_acf_policy_assignments_changes.policy_assignments[29].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=Deny} no
default_acf_policy_assignments_changes.policy_assignments[30]
Name Description Type Default Required
name policy_assignments_changes string deny-gw-er no
assignmentName policy_assignments_changes string deny-gw-er no
description policy_assignments_changes string Deny use of Virtual Network Gateway SKU: ExpressRoute. no
displayName policy_assignments_changes string Deny Virtual Network Gateway Express Route SKU no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
No Express Route Gateways are allowed to be deployed except
for in given notScopes no
management_groups_30_0
399/454
default_acf_policy_assignments_changes.policy_assignments[30].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=Deny} no
default_acf_policy_assignments_changes.policy_assignments[31]
Name Description Type Default Required
name policy_assignments_changes string deny-gw-vpn no
assignmentName policy_assignments_changes string deny-gw-vpn no
description policy_assignments_changes string Deny use of Virtual Network Gateway SKU: Vpn. no
displayName policy_assignments_changes string Deny Virtual Network Gateway VPN SKU no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
No VPN Gateways are allowed to be deployed except for in
given notScopes no
management_groups_31_0
default_acf_policy_assignments_changes.policy_assignments[31].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=Deny} no
default_acf_policy_assignments_changes.policy_assignments[32]
Name Description Type Default Required
name policy_assignments_changes string deny-keyvault-allow-all no
assignmentName policy_assignments_changes string deny-kv-allow-all no
description policy_assignments_changes string
This policy deny keyvaults that have the default network.acl
rule ‘allow all’. no
displayName policy_assignments_changes string Deny Key Vaults that use allow all ACLs no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Keyvaults should not allow all traffic no
management_groups_32_0
default_acf_policy_assignments_changes.policy_assignments[32].managementGroups[0]
400/454
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=Deny} no
default_acf_policy_assignments_changes.policy_assignments[33]
Name Description Type Default Required
definitionId policy_assignments_changes string
/providers/Microsoft.Authorization/policyDefinitions/83a86a26-fd1f-447cb59d-e51f44264114
no
assignmentName policy_assignments_changes string deny-nic-pip no
description policy_assignments_changes string
This policy denies the network interfaces which are configured with any public
IP. Public IP addresses allow internet resources to communicate inbound to Azure resources, and Azure resources to communicate outbound to the
internet. This should be reviewed by the network security team.
no
displayName policy_assignments_changes string Network interfaces should not have public IPs no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
Public IP’s are not allowed to be assigned to NIC’s except for in given
notScopes no
management_groups_33_0
default_acf_policy_assignments_changes.policy_assignments[33].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {} no
default_acf_policy_assignments_changes.policy_assignments[34]
Name Description Type Default Required
name policy_assignments_changes string deny-nsg-allow-all no
assignmentName policy_assignments_changes string deny-nsg-allow-all no
description policy_assignments_changes string
This initiative denies creation of nsg allowall rules via portal or
via update no
displayName policy_assignments_changes string Deny creation of NSG allow all network rules no
identity policy_assignments_changes map(string) {type=None} no
isInitiative policy_assignments_changes bool true no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string NSG’s should not allow all traffic no
management_groups_34_0
401/454
default_acf_policy_assignments_changes.policy_assignments[34].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=Deny} no
default_acf_policy_assignments_changes.policy_assignments[35]
Name Description Type Default Required
name policy_assignments_changes string deny-vnet-peering-wo-hub no
assignmentName policy_assignments_changes string deny-peering-wo-hub no
description policy_assignments_changes string
Deny vNet peering where either virtual network id or remote virtual
network id is not the hub network
no
displayName policy_assignments_changes string
Deny Virtual Network Peering not connected to the Hub Virtual
Network
no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
Vnet Peerings must only go to the Hub network, except for in given
notScopes no
management_groups_35_0
default_acf_policy_assignments_changes.policy_assignments[35].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{effect=Deny, hubVnetResourceIds=[/subscriptions/xxxxx-xxxxxxxxxx/resourceGroups/rg-sch-network-tst-ne001/providers/Microsoft.Network/virtualNetworks/vnet-sch-hub-tst-ne-0]}
no
default_acf_policy_assignments_changes.policy_assignments[36]
Name Description Type Default Required
name policy_assignments_changes string deny-privilege-elevation no
assignmentName policy_assignments_changes string deny-priv-elevation no
description policy_assignments_changes string
This policy denies the possibility to creating Role Assignment of
Owner or User Access Administrator privileges. no
displayName policy_assignments_changes string Deny Role Assignment for specified role IDs no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Priviledge Elevation is not allowed for specific roles no
management_groups_36_0
402/454
default_acf_policy_assignments_changes.policy_assignments[36].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-landing-zones no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{deniedRoleIds=[8e3af657-a8ff-443c-a75c2fe8c4bcb635,18d7d88d-d35e-4fb5-a5c3-7773c20a72d9],
effect=Deny}
no
default_acf_policy_assignments_changes.policy_assignments[37]
Name Description Type Default Required
name policy_assignments_changes string deny-public-ip no
assignmentName policy_assignments_changes string deny-public-ip no
description policy_assignments_changes string Deny use of Public IP. no
displayName policy_assignments_changes string Deny deployment of all Public IPs no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
No Public IP’s are allowed except for in given
notScopes no
management_groups_37_0
default_acf_policy_assignments_changes.policy_assignments[37].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=Deny} no
default_acf_policy_assignments_changes.policy_assignments[38]
Name Description Type Default Required
definitionId policy_assignments_changes string
/providers/Microsoft.Authorization/policyDefinitions/96670d01-0a4d4649-9c89-2d3abc0a5025
no
assignmentName policy_assignments_changes string deny-rg-wo-TAGNAME no
description policy_assignments_changes string Enforces existence of a tag on resource groups. no
displayName policy_assignments_changes string Require a tag on resource groups no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Resource Groups should have specified tags on deployment no
management_groups_38_0
default_acf_policy_assignments_changes.policy_assignments[38].managementGroups[0]
403/454
Name Description Type Default Required
management_group_name management_groups string mg-landing-zones no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{tagName=CHANGE- ME} no
default_acf_policy_assignments_changes.policy_assignments[39]
Name Description Type Default Required
name policy_assignments_changes string deny-rt-default-wo-fw no
assignmentName policy_assignments_changes string deny-rt-wo-fw no
description policy_assignments_changes string Deny routes that are not default route to Firewall no
displayName policy_assignments_changes string Deny routes that are not default route to Firewall no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
Route Tables must have a default 0.0.0.0/0 route to the Azure Firewall no
management_groups_39_0
default_acf_policy_assignments_changes.policy_assignments[39].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{effect=Deny, firewallIpAddresses=
[10.222.4.68]} no
default_acf_policy_assignments_changes.policy_assignments[40]
Name Description Type Default Required
name policy_assignments_changes string deny-storage-unencrypt no
assignmentName policy_assignments_changes string deny-st-unecrypted no
description policy_assignments_changes string
This policy denies unencrypted storage accounts blob
containers. no
displayName policy_assignments_changes string Deny unencrypted Storage Blob Containers no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Storage Blob Encryption should be enabled no
management_groups_40_0
default_acf_policy_assignments_changes.policy_assignments[40].managementGroups[0]
404/454
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=Deny} no
default_acf_policy_assignments_changes.policy_assignments[41]
Name Description Type Default Required
name policy_assignments_changes string deny-subnet-wo-nsg no
assignmentName policy_assignments_changes string deny-subnet-wo-nsg no
description policy_assignments_changes string
Deny subnets without attached Network Security Group. Virtual Network
subnets without attached Network Security Group will be denied. no
displayName policy_assignments_changes string Deny Subnet without a NSG no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
Subnets should have NSG’s, except when serving specific Azure services
that do not require it no
management_groups_41_0
default_acf_policy_assignments_changes.policy_assignments[41].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=Deny} no
default_acf_policy_assignments_changes.policy_assignments[42]
Name Description Type Default Required
name policy_assignments_changes string deny-subnet-wo-routetable no
assignmentName policy_assignments_changes string deny-subnet-wo-rt no
description policy_assignments_changes string
Deny subnets without attached Route Table. Virtual Network subnets without attached Route Table will be denied. no
displayName policy_assignments_changes string Deny Subnet without a Route Table no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
Subnets should have Route Tables, except when serving specific Azure services that do not require it no
management_groups_42_0
default_acf_policy_assignments_changes.policy_assignments[42].managementGroups[0]
405/454
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=Deny} no
default_acf_policy_assignments_changes.policy_assignments[43]
Name Description Type Default Required
name policy_assignments_changes string deny-vm-non-managed-disk no
assignmentName policy_assignments_changes string deny-vm-nonman-disk no
description policy_assignments_changes string Deny use of VMs with non-managed disk. no
displayName policy_assignments_changes string Deny VM’s using a non-managed disk no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Only managed VM disks are allowed no
management_groups_43_0
default_acf_policy_assignments_changes.policy_assignments[43].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=Deny} no
default_acf_policy_assignments_changes.policy_assignments[44]
Name Description Type Default Required
name policy_assignments_changes string deny-vnet-peering no
assignmentName policy_assignments_changes string deny-vnet-peering no
description policy_assignments_changes string
Deny vNet peering with a vNet in a different
subscription. no
displayName policy_assignments_changes string Deny Virtual Network Peering no
identity policy_assignments_changes map(string) {type=None} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Vnet Peerings should not be enabled for Mg-Sandbox no
management_groups_44_0
default_acf_policy_assignments_changes.policy_assignments[44].managementGroups[0]
406/454
Name Description Type Default Required
management_group_name management_groups string mg-online no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=Deny} no
default_acf_policy_assignments_changes.policy_assignments[44].managementGroups[1]
Name Description Type Default Required
management_group_name management_groups string mg-sandbox no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=Deny} no
default_acf_policy_assignments_changes.policy_assignments[45]
Name Description Type Default Required
name policy_assignments_changes string dine-activity-log-shipping-law-audit no
assignmentName policy_assignments_changes string dine-logstolaw-audit no
description policy_assignments_changes string
Ships all logs at subscription level to Audit log analytics workspace no
displayName policy_assignments_changes string
Enforce shipping of all subscription level logs to Audit Log
Analytics Workspace no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Activity logs should be shipped to Audit Log Analytics no
management_groups_45_0
default_acf_policy_assignments_changes.policy_assignments[45].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{auditWorkspaceName=log-sch-audit-tst-ne-001,
auditWorkspaceResourceGroupName=rg-sch-logging-tst-ne-001,
auditWorkspaceSubscriptionId=7fefad98-b527-437d-9d1b-be6a1527f76c}
no
default_acf_policy_assignments_changes.policy_assignments[46]
407/454
Name Description Type Default Required
name policy_assignments_changes string dine-activity-log-shipping-law-operational no
assignmentName policy_assignments_changes string dine-logstolaw-oper no
description policy_assignments_changes string
Ships all logs at subscription level to Operational log analytics workspace no
displayName policy_assignments_changes string
Enforce shipping of all subscription level logs to Operational Log
Analytics Workspace no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
Activity logs should be shipped to Management Log Analytics Workspace no
management_groups_46_0
default_acf_policy_assignments_changes.policy_assignments[46].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{workspaceName=log-sch-operational-logs-tst-ne-001, workspaceResourceGroupName=rg-sch-logging-tst-ne-001, workspaceSubscriptionId=4d51b4a8-d7c2-4f8d-83d1-4702b2862977}
no
default_acf_policy_assignments_changes.policy_assignments[47]
Name Description Type Default Required
name policy_assignments_changes string dine-alerting no
assignmentName policy_assignments_changes string dine-alerting no
description policy_assignments_changes string
This initiative configures Azure Alerts for ACF
Resources. no
displayName policy_assignments_changes string Enforce Azure Alerts for ACF Resources no
identity policy_assignments_changes map(string) {type=systemAssigned} no
isInitiative policy_assignments_changes bool true no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Alerts should be deployed no
management_groups_47_0
default_acf_policy_assignments_changes.policy_assignments[47].managementGroups[0]
408/454
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{actionGroupNameCriticalId=/subscriptions/xxxx-xxxxxxxxxxxxxx/resourceGroups/rg-sch-logging-tst-ne001/providers/Microsoft.Insights/actiongroups/ag-hub-email,
actionGroupNameWarningId=/subscriptions/xxxx-xxxxxxxxxxxxxx/resourceGroups/rg-sch-logging-tst-ne001/providers/Microsoft.Insights/actiongroups/ag-hub-email, workspaceName=log-sch-operational-logs-tst-ne-001, workspaceResourceGroupName=rg-sch-logging-tst-ne-001, workspaceSubscriptionId=xxxx-xxxxxxx-xxxxxxx}
no
default_acf_policy_assignments_changes.policy_assignments[48]
Name Description Type Default Required
name policy_assignments_changes string dine-aum no
assignmentName policy_assignments_changes string dine-aum no
description policy_assignments_changes string
Configure Azure Update Manager schedules for Virtual
Machines no
displayName policy_assignments_changes string
Configure Azure Update Manager schedules for Virtual
Machines no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
Virtual Machines should have Azure Update Manager Enabled
no
management_groups_48_0
default_acf_policy_assignments_changes.policy_assignments[48].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{vmUpdateResourceGroupName=rg-sch-vm-management-tst-ne001, vmUpdateSubscriptionId=xxxxx-xxxxx-xxxxx-xxxxx} no
default_acf_policy_assignments_changes.policy_assignments[49]
409/454
Name Description Type Default Required
name policy_assignments_changes string dine-az-mon-agent no
assignmentName policy_assignments_changes string dine-az-mon-agent no
description policy_assignments_changes string
This initiative installs Azure Monitor Agents and Dependency
Agents on Windows and Linux VMs. no
displayName policy_assignments_changes string Enforce Azure Monitor Agent and Dependencies on VMs no
identity policy_assignments_changes map(string) {type=systemAssigned} no
isInitiative policy_assignments_changes bool true no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
Azure Monitor Agent should be deployed to VMs with
Dependency Agent and System Identity
no
management_groups_49_0
default_acf_policy_assignments_changes.policy_assignments[49].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {} no
default_acf_policy_assignments_changes.policy_assignments[50]
Name Description Type Default Required
name policy_assignments_changes string dine-az-sec-agent no
assignmentName policy_assignments_changes string dine-az-sec-agent no
description policy_assignments_changes string
This initiative deploys VM Security Agents, MDE and
associates them with a DCR
no
displayName policy_assignments_changes string Enforce VM Security Agent, MDE and DCR Association no
identity policy_assignments_changes map(string) {type=systemAssigned} no
isInitiative policy_assignments_changes bool true no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string VM’s should have Security Logs Configured no
management_groups_50_0
default_acf_policy_assignments_changes.policy_assignments[50].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{dcrSubscriptionId=xxxx-xxxxx-xxxxx-xxxx,
dcrResourceGroupName=rg-nc-logging-dev-we-001,
dcrSecSuffix=nc-dcr-dev-we-001}
no
410/454
default_acf_policy_assignments_changes.policy_assignments[51]
Name Description Type Default Required
name policy_assignments_changes string dine-cis-alerts no
assignmentName policy_assignments_changes string dine-cis-alerts no
description policy_assignments_changes string
This initiative configures Azure Alerts for ACF Resources to be
compliant with CIS 1.1.0
no
displayName policy_assignments_changes string Enforce CIS compliant Azure Alerts for ACF Resources no
identity policy_assignments_changes map(string) {type=systemAssigned} no
isInitiative policy_assignments_changes bool true no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string CIS compliant alerts should be deployed no
management_groups_51_0
default_acf_policy_assignments_changes.policy_assignments[51].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{actionGroupNameWarningId=/subscriptions/xxxx-xxxxx-xxxxxxxxx/resourceGroups/rg-sch-logging-tst-ne001/providers/Microsoft.Insights/actiongroups/ag-hub-email,
rgLocation=northeurope, rgName=rg-sch-alerts-tst-ne-001, workspaceResourceGroupName=rg-sch-logging-tst-ne-001, workspaceSubscriptionId=xxxx-xxxxx-xxxx-xxxxx}
no
default_acf_policy_assignments_changes.policy_assignments[52]
Name Description Type Default Required
name policy_assignments_changes string dine-diagnostics no
assignmentName policy_assignments_changes string dine-diagnostics no
description policy_assignments_changes string
This initiative configures Azure resources to forward diagnostic logs
and metrics to an Azure Log Analytics workspace. no
displayName policy_assignments_changes string
Enforce diagnostic logs and metrics for Azure Resources to Log
Analytics no
identity policy_assignments_changes map(string) {type=systemAssigned} no
isInitiative policy_assignments_changes bool true no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Diagnostic settings for resources should be enabled no
management_groups_52_0
default_acf_policy_assignments_changes.policy_assignments[52].managementGroups[0]
411/454
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{StorageAccountDiagNosticsRead=false,
StorageAccountDiagNosticsWrite=false, workspaceName=log-sch-operationallogs-tst-ne-001, workspaceResourceGroup=rg-sch-logging-tst-ne-001, workspaceSubscriptionId=xxxx-xxxxx-xxxxx-xxxxxxx}
no
default_acf_policy_assignments_changes.policy_assignments[53]
Name Description Type Default Required
name policy_assignments_changes string dine-msvmi-assoc no
assignmentName policy_assignments_changes string dine-msvmi-assoc no
description policy_assignments_changes string Associates VMs to the VM Insights DC no
displayName policy_assignments_changes string Enforce VM Insights on Virtual Machines no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string VM’s should be assicated to VM Insights DCR no
management_groups_53_0
default_acf_policy_assignments_changes.policy_assignments[53].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{dcrSubscriptionId=xxx-xxxxxx-xxxx-xxxxxx,
dcrResourceGroupName=rg-nc-logging-dev-we-001,
dcrVMISuffix=nc-dcr-dev-we-001}
no
default_acf_policy_assignments_changes.policy_assignments[54]
Name Description Type Default Required
name policy_assignments_changes string dine-networkwatcher no
assignmentName policy_assignments_changes string dine-networkwatcher no
description policy_assignments_changes string
This policy creates a network watcher resource in regions with virtual
networks. You need to ensure existence of a resource group named
networkWatcherRG, which will be used to deploy network watcher instances.
no
displayName policy_assignments_changes string Enforce Network Watcher in regions with Virtual Networks no
identity policy_assignments_changes map(string) {type=systemAssigned} no
isInitiative policy_assignments_changes bool true no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string NetworkWatcher should be deployed in given region no
management_groups_54_0
412/454
default_acf_policy_assignments_changes.policy_assignments[54].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {rgLocation=northeurope} no
default_acf_policy_assignments_changes.policy_assignments[55]
Name Description Type Default Required
name policy_assignments_changes string ine-nsg-flowlogs no
assignmentName policy_assignments_changes string dine-nsg-flowlogs no
description policy_assignments_changes string Deploys NSG flow logs and traffic analytics no
displayName policy_assignments_changes string
Enforce NSG flow logs and traffic analytics to centralised
Storage Account no
identity policy_assignments_changes map(string) {type=systemAssigned} no
isInitiative policy_assignments_changes bool true no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
NSG FlowLogs should be enabled - follow remediation steps
in documentation
no
management_groups_55_0
default_acf_policy_assignments_changes.policy_assignments[55].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{environment=tst, flowAnalyticsenabled=True, locations={centralindia={short =
ci}, northeurope={short = ne},westeurope={short = we} }, managementSubId=xxxx-xxxxx-xxxxx-xxxxxx, retention=2,
saNamePrefix=saschtst, saResourceGroupNamePrefix=rg-sch-flowlogs,
trafficAnalyticsInterval=60, workspaceName=log-sch-operational-logs-tst-ne001, workspaceResourceGroupName=rg-sch-logging-tst-ne-001, workspaceSubscriptionId=yyyyy-yyyy-yyyyy-yyyyyyy}
no
default_acf_policy_assignments_changes.policy_assignments[56]
413/454
Name Description Type Default Required
name policy_assignments_changes string dine-private-endpoint-dns no
assignmentName policy_assignments_changes string private-endpoint-dns no
description policy_assignments_changes string
This initiative Deploys Private Endpoint DNS as well as
blocking certain DNS zones no
displayName policy_assignments_changes string Manage Private Endpoint DNS associations no
identity policy_assignments_changes map(string) {type=systemAssigned} no
isInitiative policy_assignments_changes bool true no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
Private Endpoint DNS should be remediated for deployment of
zones no
management_groups_56_0
default_acf_policy_assignments_changes.policy_assignments[56].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{adfDataFactoryEffect=deployIfNotExists,
amlworkspaceEffect=deployIfNotExists,
appServiceSitesEffect=deployIfNotExists,
automationAccountsEffect=deployIfNotExists,
azureSQLSqlServerEffect=deployIfNotExists,
cognitiveServicesEffect=deployIfNotExists,
configurationStoresEffect=deployIfNotExists,
containerRegistryEffect=deployIfNotExists,
cosmosdbCassandraEffect=deployIfNotExists,
cosmosdbGremlinEffect=deployIfNotExists,
cosmosdbMongoEffect=deployIfNotExists,
cosmosdbSqlEffect=deployIfNotExists,
cosmosdbTableEffect=deployIfNotExists,
dataLakeFileSystemEffect=deployIfNotExists,
denyPrivatelinkDNSZonesEffect=Deny, keyvaultVaultEffect=deployIfNotExists, managementEffect=deployIfNotExists, mariadbServerEffect=deployIfNotExists,
portalDataFactoryEffect=deployIfNotExists,
postgresqlServerEffect=deployIfNotExists,
privateDNSZoneResourceGroupId=/subscriptions/xxx-xxxx-xxxxxxxxxxxxx/resourceGroups/rg-sch-dnsprivatezone-tst-ne-001,
purviewAccountEffect=deployIfNotExists,
purviewPortalEffect=deployIfNotExists, redisCacheEffect=deployIfNotExists,
redisEnterpriseEffect=deployIfNotExists,
searchServicesEffect=deployIfNotExists, servicebusEffect=deployIfNotExists,
signalREffect=deployIfNotExists, storageAccountBlobEffect=deployIfNotExists,
storageAccountFileEffect=deployIfNotExists,
storageAccountQueueEffect=deployIfNotExists,
storageAccountTableEffect=deployIfNotExists,
storageAccountWebEffect=deployIfNotExists,
storageSyncServicesEffect=deployIfNotExists}
no
default_acf_policy_assignments_changes.policy_assignments[57]
414/454
Name Description Type Default Required
name policy_assignments_changes string dine-securitycenter no
assignmentName policy_assignments_changes string dine-securitycenter no
description policy_assignments_changes string
This policy automatically enables Azure Security Center for
this subscription. no
displayName policy_assignments_changes string Enforce Azure Security Center no
identity policy_assignments_changes map(string) {type=systemAssigned} no
isInitiative policy_assignments_changes bool true no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
Azure Security Centre (MS Defender for Cloud) should be
deployed
no
management_groups_57_0
default_acf_policy_assignments_changes.policy_assignments[57].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{autoProvision=Off, emailContact=notexistingnordcloud.com, mcasintegration=True, pricingTier=Standard, securityPhoneNumber=123456789, wdatpintegration=True, workspaceName=log-sch-operational-logs-tst-ne-001, workspaceResourceGroupName=rg-sch-logging-tst-ne-001, workspaceSubscriptionId=xxx-xxxxxx-xxxxx-xxxxx}
no
default_acf_policy_assignments_changes.policy_assignments[58]
Name Description Type Default Required
name policy_assignments_changes string dine-sql-auditing no
assignmentName policy_assignments_changes string dine-sql-auditing no
description policy_assignments_changes string
Deploy auditing for SQL Servers to the specified Storage Account. no
displayName policy_assignments_changes string
Enforce auditing on SQL servers to the specified Storage Account no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string SQL Auditing should be enabled no
management_groups_58_0
default_acf_policy_assignments_changes.policy_assignments[58].managementGroups[0]
415/454
Name Description Type Default Required
management_group_name management_groups string mg-landing-zones no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{retentionDays=CHANGE-ME, storageAccountName=CHANGE- ME, storageAccountResourceGroupName=CHANGE-ME} no
default_acf_policy_assignments_changes.policy_assignments[59]
Name Description Type Default Required
name policy_assignments_changes string dine-sql-data-encryption no
assignmentName policy_assignments_changes string dine-sql-encryption no
description policy_assignments_changes string
Deploy transparent data encryption status for SQL
databases. no
displayName policy_assignments_changes string
Enforce transparent data encryption status for SQL
databases no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string SQL Data Encryption should be deployed no
management_groups_59_0
default_acf_policy_assignments_changes.policy_assignments[59].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {} no
default_acf_policy_assignments_changes.policy_assignments[60]
Name Description Type Default Required
name policy_assignments_changes string dine-sql-threat-detection no
assignmentName policy_assignments_changes string dine-sql-threat-det no
description policy_assignments_changes string
This policy deploys threat detection to the SQL
Server. no
displayName policy_assignments_changes string Enforce threat detection for SQL servers no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string SQL Threat Detection should be deployed no
management_groups_60_0
default_acf_policy_assignments_changes.policy_assignments[60].managementGroups[0]
416/454
Name Description Type Default Required
management_group_name management_groups string mg-landing-zones no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{emailAccountAdmins=True,
emailAddresses=CHANGE-ME} no
default_acf_policy_assignments_changes.policy_assignments[61]
Name Description Type Default Required
name policy_assignments_changes string dine-sql-firewall-vnet no
assignmentName policy_assignments_changes string dine-sql-vnet-rule no
description policy_assignments_changes string Deploy vnet rule to Azure SQL Servers. no
displayName policy_assignments_changes string Enforce specified Virtual Network rule for SQL servers no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
PaaS SQL should have specific virtual network rule
enabled
no
management_groups_61_0
default_acf_policy_assignments_changes.policy_assignments[61].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-landing-zones no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{subnetId=CHANGE-ME,
vnetRuleName=CHANGE-ME} no
default_acf_policy_assignments_changes.policy_assignments[62]
Name Description Type Default Required
name policy_assignments_changes string dine-storage-securetransfer no
assignmentName policy_assignments_changes string dine-st-sectransfer no
description policy_assignments_changes string
This policy deploys supportsHttpsTrafficOnly setting to
storage accounts. no
displayName policy_assignments_changes string Enforce secure transfer for Storage Accounts no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Storage Accounts should have Secure Transfer enabled no
management_groups_62_0
default_acf_policy_assignments_changes.policy_assignments[62].managementGroups[0]
417/454
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {} no
default_acf_policy_assignments_changes.policy_assignments[63]
Name Description Type Default Required
name policy_assignments_changes string dine-subscription-log-analytics no
assignmentName policy_assignments_changes string dine-logworkspace no
description policy_assignments_changes string
Creates a log analytics workspace for a new subscription and
adds a connection
no
displayName policy_assignments_changes string Enforce a Log Analytics Workspace in new subscriptions no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Subscriptions should contain a Log Analytics Workspace no
management_groups_63_0
default_acf_policy_assignments_changes.policy_assignments[63].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{rgName=rg-sch-logging-spoke-tst-ne-001, workspaceLocation=northeurope, workspaceNamePrefix=log-schspoke-tst-ne-001}
no
default_acf_policy_assignments_changes.policy_assignments[64]
Name Description Type Default Required
name policy_assignments_changes string dine-subscription-log-shipping-sa no
assignmentName policy_assignments_changes string dine-logstosa-audit no
description policy_assignments_changes string Ships all logs at subscription level to Audit Storage Account no
displayName policy_assignments_changes string
Enforce shipping of all subscription level logs to Audit
Storage Account no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Subscription logs should ship to audit storage account no
management_groups_64_0
default_acf_policy_assignments_changes.policy_assignments[64].managementGroups[0]
418/454
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{auditStorageName=stschy4kw0tstne001,
auditWorkspaceResourceGroupName=rg-sch-logging-tst-ne-001,
auditWorkspaceSubscriptionId=zzz-zzzz-zzzzz-zzzzzzzzz}
no
default_acf_policy_assignments_changes.policy_assignments[65]
Name Description Type Default Required
name policy_assignments_changes string dine-vm-backup-centralized-rsv no
assignmentName policy_assignments_changes string dine-centralized-rsv no
description policy_assignments_changes string This initiative backs up virtual machines to centralized RSV no
displayName policy_assignments_changes string
Deploy centralised backup in VM subscription and assign
backup policy to VM
no
identity policy_assignments_changes map(string) {type=systemAssigned} no
isInitiative policy_assignments_changes bool true no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
dine-centralized-rsv should be remediated to deploy backup
policies for VMs no
management_groups_65_0
default_acf_policy_assignments_changes.policy_assignments[65].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{environment=tst, locations={centralindia = {short = ci},northeurope = {short =
ne},westeurope = {short = we}}, rsvName=rsv-cent-bak,
rsvResourceGroupName=rg-cent-vm-bak, vaultDefaultRetentionDailyCount=30,
vaultDefaultRetentionWeeklyCount=4, vaultScheduledRuntime=02:00:00}
no
default_acf_policy_assignments_changes.policy_assignments[66]
419/454
Name Description Type Default Required
name policy_assignments_changes string dine-vm-backup no
assignmentName policy_assignments_changes string dine-vm-backup no
description policy_assignments_changes string
This policy creates an Azure Recovery Services vault automatically when the
first VM with supported OS is deployed in to the Resource Group, creates a
backup policy and assigns the VM in to backup policy schedule. All
subsequent VMs are assigned to the same RSV and backup policy. Only single RSV is created per Resource Group.
no
displayName policy_assignments_changes string Deploy decentralised VM backup and subsequent Recovery Services Vaults no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Dine-vm-backup should be remediated to deploy backup policies for VMs no
management_groups_66_0
default_acf_policy_assignments_changes.policy_assignments[66].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{vaultDefaultRetentionDailyCount=30,
vaultDefaultRetentionWeeklyCount=4,
vaultScheduledRuntime=02:00:00}
no
default_acf_policy_assignments_changes.policy_assignments[67]
Name Description Type Default Required
name policy_assignments_changes string dine-vm-cspm no
assignmentName policy_assignments_changes string dine-vm-cspm no
description policy_assignments_changes string
Defender Cloud Security Posture Management (CSPM) provides enhanced
posture capabilities and a new intelligent cloud security graph to help identify,
prioritize, and reduce risk. Defender CSPM is available in addition to the free
foundational security posture capabilities turned on by default in Defender for Cloud.
no
displayName policy_assignments_changes string Configure Microsoft Defender CSPM to be enabled no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string CSPM should be enabled for VMs no
management_groups_67_0
default_acf_policy_assignments_changes.policy_assignments[67].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=DeployIfNotExists} no
420/454
default_acf_policy_assignments_changes.policy_assignments[68]
Name Description Type Default Required
name policy_assignments_changes string dine-vm-ct no
assignmentName policy_assignments_changes string dine-vm-ct no
description policy_assignments_changes string
Associates VM’s to Change Tracking DCR’s and enables Change Tracking on the VM’s no
displayName policy_assignments_changes string Enforce VM Change Tracking with AMA no
identity policy_assignments_changes map(string) {type=systemAssigned} no
isInitiative policy_assignments_changes bool true no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string VM’s should have Change Tracking enabled” no
management_groups_68_0
default_acf_policy_assignments_changes.policy_assignments[68].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{dcrSubscriptionId=xxx-xxx-xxxxxx-xxxxxxx,
dcrResourceGroupName=rg-nc-logging-dev-we-001,
dcrCTSuffix=nc-dcr-dev-we-001}
no
default_acf_policy_assignments_changes.policy_assignments[69]
Name Description Type Default Required
name policy_assignments_changes string dine-vm-datadog-linux no
assignmentName policy_assignments_changes string dine-vm-dd-linux no
description policy_assignments_changes string Deploys Datadog agent to all Linux VMs no
displayName policy_assignments_changes string Enforce Datadog Agent on all Linux VMs no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
DataDog configuration should be deployed for Linux VMs no
management_groups_69_0
default_acf_policy_assignments_changes.policy_assignments[69].managementGroups[0]
421/454
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{datadogApiSecretName=datadogAPI, datadogSite=datadoghq.com,
sharedKeyvaultId=/subscriptions/xxxx-xxxxxx-xxxxxxxxxxxx/resourceGroups/rg-sch-keyvault-tst-ne001/providers/Microsoft.KeyVault/vaults/kvncsharedservicesdevwe2}
no
default_acf_policy_assignments_changes.policy_assignments[70]
Name Description Type Default Required
name policy_assignments_changes string dine-vm-datadog-windows no
assignmentName policy_assignments_changes string dine-vm-dd-windows no
description policy_assignments_changes string Deploys Datadog agent to all Windows VMs no
displayName policy_assignments_changes string Enforce Datadog Agent on all Windows VMs no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
DataDog configuration should be deployed for Windows VMs no
management_groups_70_0
default_acf_policy_assignments_changes.policy_assignments[70].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{datadogApiSecretName=datadogAPI, datadogSite=datadoghq.com,
sharedKeyvaultId=/subscriptions/xxxxx-xxxxx-xxxxxxxxxxxxxx/resourceGroups/rg-sch-keyvault-tst-ne001/providers/Microsoft.KeyVault/vaults/kvncsharedservicesdevwe2}
no
default_acf_policy_assignments_changes.policy_assignments[71]
Name Description Type Default Required
name policy_assignments_changes string dine-vm-monitoring-dcr no
assignmentName policy_assignments_changes string dine-vm-monitor no
description policy_assignments_changes string
Associates VM’s to Monitoring DCR’s according to
their tags no
displayName policy_assignments_changes string Enforce VM Monitoring with AMA no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string VM’s should have monitoring enabled no
management_groups_71_0
422/454
default_acf_policy_assignments_changes.policy_assignments[71].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{vmMonitoringSubscriptionId=xxxxx-xxxxxx-xxxxxxx-xxxxxxx,
vmMonitoringResourceGroupName=rg-sch-logging-tst-ne-001} no
default_acf_policy_assignments_changes.policy_assignments[72]
Name Description Type Default Required
name policy_assignments_changes string modify-ahub-sqlserver no
assignmentName policy_assignments_changes string modify-ahub-sqlsrv no
description policy_assignments_changes string
This policy enabled Azure Hybrid Use Benefit on all SQL
Windows Servers no
displayName policy_assignments_changes string Configure AHUB on SQL Server VMs no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
Azure Hybrid Benefit should be enabled for Windows
Servers no
management_groups_72_0
default_acf_policy_assignments_changes.policy_assignments[72].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=Modify} no
default_acf_policy_assignments_changes.policy_assignments[73]
Name Description Type Default Required
name policy_assignments_changes string modify-ahub-winserver no
assignmentName policy_assignments_changes string modify-ahub-winsrv no
description policy_assignments_changes string
This policy enabled Azure Hybrid Use Benefit on all
Windows Servers no
displayName policy_assignments_changes string Configure AHUB on Windows Server VMs no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string
Azure Hybrid Benefit should be enabled for Windows
Servers no
management_groups_73_0
default_acf_policy_assignments_changes.policy_assignments[73].managementGroups[0]
423/454
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {effect=Modify} no
default_acf_policy_assignments_changes.policy_assignments[74]
Name Description Type Default Required
name policy_assignments_changes string modify-blobbackup-tag no
assignmentName policy_assignments_changes string modify-blobbackuptag no
description policy_assignments_changes string
This policy modifies the tags for storage account on assigned management group to enable backup to RSV
no
displayName policy_assignments_changes string Add the tags to storage account V2 for backup no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Blob Backup Tags should be enabled to allow Blob Backup no
management_groups_74_0
default_acf_policy_assignments_changes.policy_assignments[74].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {blobbackupTag=True} no
default_acf_policy_assignments_changes.policy_assignments[75]
Name Description Type Default Required
definitionId policy_assignments_changes string
/providers/Microsoft.Authorization/policyDefinitions/cd3aa116-8754-49c9-
a813-ad46512ece54
no
assignmentName policy_assignments_changes string modify-inhrg-TAGNAME no
description policy_assignments_changes string
Adds or replaces the specified tag and value from the parent resource group when any resource is created or updated. Existing resources can be remediated
by triggering a remediation task.
no
displayName policy_assignments_changes string Inherit a tag from the resource group no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Resources should have appropriate tags inherited from the Resource Group no
management_groups_75_0
default_acf_policy_assignments_changes.policy_assignments[75].managementGroups[0]
424/454
Name Description Type Default Required
management_group_name management_groups string mg-landing-zones no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{tagName=CHANGE- ME} no
default_acf_policy_assignments_changes.policy_assignments[76]
Name Description Type Default Required
definitionId policy_assignments_changes string
/providers/Microsoft.Authorization/policyDefinitions/b27a0cbd-a167-4dfaae64-4337be671140
no
assignmentName policy_assignments_changes string modify-inht-TAGNAME no
description policy_assignments_changes string
Adds or replaces the specified tag and value from the containing subscription when any resource is created or updated. Existing resources can be remediated
by triggering a remediation task.
no
displayName policy_assignments_changes string Inherit a tag from the subscription no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Resources should have appropriate tags inherited from subscription no
management_groups_76_0
default_acf_policy_assignments_changes.policy_assignments[76].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-landing-zones no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{tagName=CHANGE- ME} no
default_acf_policy_assignments_changes.policy_assignments[77]
Name Description Type Default Required
name policy_assignments_changes string modify-vm-backup-tag no
assignmentName policy_assignments_changes string modify-vm-backup-tag no
description policy_assignments_changes string
This policy modifies the tags for vm backup on assigned management group
no
displayName policy_assignments_changes string Add the tags for vm backup no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Backup Tags should be deployed to allow VM Backups no
management_groups_77_0
default_acf_policy_assignments_changes.policy_assignments[77].managementGroups[0]
425/454
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool TRUE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {vmBackupTag=enabled} no
default_acf_policy_assignments_changes.policy_assignments[78]
Name Description Type Default Required
name policy_assignments_changes string modify-vm-update-tag no
assignmentName policy_assignments_changes string modify-vm-update-tag no
description policy_assignments_changes string
This policy modifies the tags for vm update on assigned management group for
the update management. This will add the date and time as tag value when
update need to be done for VMs
no
displayName policy_assignments_changes string Add the tags for vm update for update management no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string Update Management Tags should be enabled to allow Update Management no
management_groups_78_0
default_acf_policy_assignments_changes.policy_assignments[78].managementGroups[0]
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map {vmUpdateTag=3-tuesday-0200} no
default_acf_policy_assignments_changes.policy_assignments[79]
Name Description Type Default Required
name policy_assignments_changes string
/providers/Microsoft.Authorization/policyDefinitions/94de2ad3-e0c1-4cafad78-5d47bbc83d3d
no
assignmentName policy_assignments_changes string modify-vnet-ddos-pla no
description policy_assignments_changes string
Protect your virtual networks against volumetric and protocol attacks with
Azure DDoS Protection Standard. For more information, visit
https://aka.ms/ddosprotectiondocs.
no
displayName policy_assignments_changes string Virtual networks should be protected by Azure DDoS Protection Standard no
identity policy_assignments_changes map(string) {type=systemAssigned} no
managementGroups policy_assignments_changes list(map) {} no
nonComplianceMsg policy_assignments_changes string DDoS Protection should be enabled for virtual networks no
management_groups_79_0
default_acf_policy_assignments_changes.policy_assignments[79].managementGroups[0]
426/454
Name Description Type Default Required
management_group_name management_groups string mg-acf no
enabled management_groups bool FALSE no
linkedScopes management_groups list(string) [] no
notScopes management_groups list(string) [] no
parameters management_groups map
{ddosPlan=CHANGE_ME,
effect=Modify} no
additional_policy_assignments
Apart from the default policy assignments it is also possible to deploy additional policy assignments using below:
Built in policy defintions
Custom policy defintions (located in terraform\.modules\acf\modules\blueprint-policiesstandard\acf_policy_definition)
Built in policy set defintions
Custom policy set defintions (located in terraform\.modules\acf\modules\blueprint-policiesstandard\acf_policy_set_definitions)
These additional policy assignments should be defined as list of objects and to provided as input to
additional_policy_assignments.policy_assignments in \terragrunt\prod\CORE\AZUREPOLICIES\policies_vars.yaml
file.
Below is a sample example for the same. The description of each of the below argument are available here
additional_policy_assignments: #THIS LINE MUST REMAIN UNCOMMENTED
policy_assignments: #THIS LINE MUST REMAIN UNCOMMENTED
# Example of additional policy assignment using built in policy definition or policy set
definition
- definitionId: /providers/Microsoft.Authorization/policyDefinitions/96670d01-0a4d-4649-9c89-
2d3abc0a5025
assignmentName: deny-rg-wo-tag1
displayName: Require a tag on resource groups
description: Enforces existence of a tag on resource groups.
nonComplianceMsg: Resource Groups should have specified tags on deployment
identity:
type: None
managementGroups:
- management_group_name: mg-landing-zones
enabled: true
parameters:
tagName: CHANGE_ME
notScopes: []
linkedScopes: []
# Example of additional policy assignment using custom policy definition or policy set
definition
- name: allow-vm-sku
assignmentName: allow-vm-sku
description: This policy allows you to specify what skus are allowed for storage accounts
and virtual machines.
displayName: Allow only specified VM SKUs
nonComplianceMsg: Only VM SKU's in allow list should be deployed
identity:
type: systemAssigned
#isInitiative : true # UNCOMMENT AND SET TO TRUE ONLY IN CASE OF INITIATIVE
managementGroups:
- management_group_name: mg-landing-zones
enabled: true
parameters:
listOfAllowedSKUs: ["Standard_B2ms","Standard_B2ms"]
notScopes: []
427/454
LAST APPLIED CONFIGURATION
TEMP Comment: Leave as is for now, will be used later to dynamically update with customer specific config.
input descriptions
default_azure_policies_enabled
Default Azure policies can be turned off entirely using this.
customised_azure_policies_enabled
Customised Azure policies can be turned off entirely using this.
acf_policy_parameters
image_publisher
List of approved VM Publishers. Default for allow-vm-image policy parameter
image_offer
List of approved VM Offers. Default for allow-vm-image policy parameter
image_sku
List of approved VM Image SKUs. Default for allow-vm-image policy parameter
image_sku_value
imageSku = [
"6.7",
"6.8",
"6.9",
"6.10",
"7.6",
"7.7",
"12-sp4-gen2",
"15",
"18.04-LTS",
"20_04-lts",
"20_04-lts-gen2",
"19h1-entn",
"19h1-pro",
"rs5-enterprisen",
"rs5-enterprise",
"rs5-enterprise-g2",
"rs5-enterprise-standard-g2",
"rs5-pro-g2",
"rs5-pron",
"rs5-pron-g2",
"2019-Datacenter",
"2019-Datacenter-smalldisk",
"2019-Datacenter-Server-Core",
"2019-Datacenter-Server-Core-smalldisk",
"2022-datacenter-g2",
"2022-datacenter",
"2022-datacenter-core-smalldisk",
"2022-datacenter-core-smalldisk-g2",
"2022-datacenter-core",
"2022-datacenter-core-g2",
"2022-datacenter-smalldisk",
"2022-datacenter-smalldisk-g2",
"2022-datacenter",
linkedScope: []
428/454
"2022-datacenter-g2",
"2019-Datacenter-gensecond"
]
list_of_allowed_skus
List of Approved VM sizes. Default for allow-vm-sku policy parameter
list_of_allowed_skus_value
listOfAllowedSKUs = [
"Standard_B1ls",
"Standard_B1s",
"Standard_B1ms",
"Standard_B2s",
"Standard_B2ms",
"Standard_B2ms",
"Standard_B2ms",
"Standard_D2s_v3",
"Standard_D4s_v3",
"Standard_D8s_v3",
"Standard_D2_v3",
"Standard_D2_v3",
"Standard_D2_v3",
"Standard_DS1_v2",
"Standard_DS2_v2",
"Standard_DS3_v2",
"Standard_DS4_v2",
"Standard_D1_v2",
"Standard_D2_v2",
"Standard_D3_v2",
"Standard_D4_v2",
"Standard_A1_v2",
"Standard_A2_v2",
"Standard_A4_v2",
"Standard_A8_v2",
"Standard_A2m_v2",
"Standard_A4m_v2",
"Standard_A8m_v2"
]
approved_extensions
List of approved extensions for VM’s. Default for allow-approved-vm-ex parameter
approved_extensions_value
approvedExtensions = [
"AADLoginForLinux",
"AzureMonitorLinuxAgent",
"DependencyAgentLinux",
"enablevmaccess",
"GuestHealthLinuxAgent",
"LinuxAgent.AzureSecurityCenter",
"OMSAgentForLinux",
"IaaSAntimalware",
"WindowsAgent.AzureSecurityCenter",
"MicrosoftMonitoringAgent",
"DependencyAgentWindows",
"AzureMonitorWindowsAgent",
"Microsoft.Powershell.DSC",
"CustomScriptExtension",
"AzurePolicyforWindows",
"EnableVMAccess",
"AADLoginForWindows",
"Microsoft.Azure.DevOps.Pipelines.Agent",
"AzureNetworkWatcherExtension",
"MDE.Windows"
]
vault_scheduled_run_time
429/454
Backup schedule runtime. Default for dine-centralized-rsv & dine-vm-backup parameter
vault_default_retention_daily_count
Backup daily retention count. Default for dine-centralized-rsv & dine-vm-backup parameter
vault_default_retention_weekly_count
Backup weekly retention count. Default for dine-centralized-rsv & dine-vm-backup parameter
rsv_name_prefix
RSV name prefix for centralised RSV deployment. Default for dine-centralized-rsv only parameter
rsv_resource_group_name_prefix
RG name prefix for centralised RSV deployment. Default for dine-centralized-rsv only parameter
datadog_site
Datadog Site Name for Linux/Windows Datadog agents.Default for dine-vm-dd-linux & dine-vm-dd-windows parameter
datadog_api_secret_name
Secret name which holds the Datadog API Key for Linux/Windows Datadog agents. Default for dine-vm-dd-linux & dinevm-dd-windows parameter
storage_account_diagnostics_write
Whether or not to log StorageWrite events in diagnostics. Default for dine-diagnostics parameter
storage_account_diagnostics_read
Whether or not to log StorageRead events in diagnostics. Default for dine-diagnostics parameter
waf_mode_requirement
Which WAF mode to audit when checking for Application Gateways. Default for audit-appgw-waf-mode parameter
subnet_nsg_exclusions
Subnet names to ignore when auditing for NSGs. Default for audit-subnet-wo-nsg parameter
asc_email_contact
Email address for ASC Contact Persons. Default for dine-securitycenter parameter
asc_security_phone_number
Phone Number for ASC Contact Persons. Default for dine-securitycenter parameter
asc_pricing_tier
Pricing Tier for ASC. Default for dine-securitycenter parameter
asc_auto_provision
430/454
Whether or not to enable Auto Provisioning of MMA Agents. Default for dine-securitycenter parameter
asc_mcas_integration
Whether or not to enable MCAS Integration. Default for dine-securitycenter parameter
asc_wdatp_integration
Whether or not to enable WDATP Integration. Default for dine-securitycenter parameter
modify_vm_backup_tag_param
Value of vm back up tag. Default for modify-vm-backup-tag parameter
modify_vm_update_tag_param
Value of vm update tag. Default for modify-vm-update-tag parameter
modify_blob_backup_tag_param
Value of bob backup tag. Default for modify-blobbackuptag parameter
acf_locations
Map of acf_locations fetched from global_vars.yaml file
allowed_locations
List of the allowed locations for built-in Allowed locations policy
audit_workspace_subscription_id
Subscription ID of the Audit subscription
workspace_subscription_id
Subscription ID of the Management subscription
spoke_workspace_name_prefix
Name of the Log Analytics Workspace used by ProjectSpaceProvisioner module
spoke_workspace_rg
Name of the Resource Group for Log Analytics Workspace used by ProjectSpaceProvisioner module
spoke_workspace_location
Location of the Log Analytics Workspace used by ProjectSpaceProvisioner module
shared_keyvault_id
ID of the KeyVault in SharedServices subscription which stores the datadog API key
cis_alertsrg_name
431/454
Name of the Resource Group used during deployment of the Activity Log Alerts (Monitoring/cis-alerts initiative)
cis_alerts_location
Location of the Resource Group used during deployment of the Activity Log Alerts (Monitoring/cis-alerts initiative)
sa_resource_group_name_prefix
Prefix of the resource group name to deploy to Management to host NSG Flow Logs
dine_nsg_flowlogs_param
Prefix of the storage account name to deploy to Management to host NSG Flow Logs. Default for dine-nsg-flowlogs.
This must be changed during parametrisation due to conflict with existing sa’s, as this is using pattern “sa $\
{var.service_name}${var.environment_name}” (which might be already in use by other storage account).
subnet_rt_exclusions
Subnet names to ignore when auditing for Route Tables
sandbox_mg_id
Management group Resource ID for the Sandbox environment
connectivity_mg_id
Management group Resource ID for the Connectivity environment
online_mg_id
Management group Resource ID for the Online environment
audit_mg_id
Management group Resource ID for the Audit environment
audit_workspace_resource_group_name
Name of the Resource Group for Log Analytics Workspace deployed in Audit subscription
audit_storage_name
Name of the Storage Account deployed in Audit subscription
audit_workspace_name
Name of the Log Analytics Workspace deployed in Audit subscription
audit_storage_enabled
storage_enabled output from audit module
workspace_resource_group_name
Name of the Resource Group for Log Analytics Workspace deployed in Management subscription
432/454
workspace_name
Name of the Log Analytics Workspace deployed in Management subscription
action_group_name_warning_id
ID of the Action Group for the Warning alerts created in the Management subscription (name only)
action_group_name_critical_id
ID of the Action Group for the Critical alerts created in the Management subscription (name only)
dcr_name_windows
Name of windows data collection rule from Management module
dcr_name_linux
Name of linux data collection rule from Management module
dcr_suffix_standard
Suffix of DCR from Management module
topology
The topology of the network from Network module. Possible values are hubspoke and vwan.
subnet_wo_rt_not_scope
Subnets that do not require a Route Table
er_gw_not_scope
Specific Express Route Gateway Subnets
vpn_gw_not_scope
Specific VPN Gateway Subnets
default_route_internet_not_scope
Route Tables that do not require a default route
hub_vnet_resource_ids
ONLY FOR HUB AND SPOKE - Resource IDs of the hub virtual networks in Network module
subnet_wo_nsg_not_scope
Subnets that do not require an NSG
pip_not_scope
Public IP resource ID’s that are deployed with ACF
firewall_ip_addresses
433/454
Firewall IP addresses. Used for denying routes in a route table that are not default to these values
private_dns_zone_resource_group_id
Resource Group Id where privatelink private dns zones are located from SharedServices module
vm_management_resource_group_name
Name of the VM Management Resource Group from Management module
private_endpoint_dns_not_scope
List of Resource Group Id where privatelink private dns zones are located from SharedServices module
default_acf_policy_assignments_changes_descriptions
definition_id
ID of the built-in policy definition. Either definition_id or name are required
name
Name of the custom policy definition. Either definition_id or name are required
assignment_name
Name of the policy assignment
description
Description for the policy assignment
display_name
Display Name for the policy assignment
identity
Identity to be assigned for the policy assignment. type = None if no identity is to be assigned. type = SystemAssigned
if system assigned identity to be created.
is_initiative
Indicates if the assignment is an initiative. This property is required in case of initiative
management_group_name
Name of the management group which would be the scope for the policy assignment.
management_group_enabled
Indicates if this policy assignment is enabled. If false, policy assignment would be disable for the given management
group scope.
management_group_linked_scopes
434/454
List of any linked scopes required for MSI. For eg. ["/subscription/xxxxxxx-xxxx-xxxx-xxxxxxxxxxxxxx/resourceGroups/xxx-xxx" ]
management_group_not_scopes
List of exemptions to assignment. For eg. ["/subscription/xxxxxxx-xxxx-xxxx-xxxxxxxxxxxxxx/resourceGroups/xxx-xxx" ]
management_group_parameters
Map of parameters in the form of key-value pairs to be passed to the policy assignment. Eg:
non_compliance_msg
Custom Non Compliance Message relating to the policy and management group
dependency
The Policies module is dependent on the following modules: - /CORE - /PROVISIONER/CICD - /CORE/NETWORK -
/CORE/AUDIT - /CORE/MANAGEMENT - /CORE/APPLICATIONGATEWAY - /CORE/FIREWALL -
/CORE/SHAREDSERVICES — id: blueprint-landingzone-standard-tf title: Application Landing Zone sidebar_position:
12 —
inputs
app_vars.yaml
group_vars.yaml
Make sure you read the descriptions of the variables.
app_vars
Dry (with some basic values only) config file - more robust sample is here
parameters:
param1: value1
param2: value2
---
##Copyright 2024 Nordcloud Oy or its affiliates. All Rights Reserved.
## This YAML file contains variables for the application.
application:
name: app3
location: northeurope
location_short: ne
environment:
- dev
subscription:
dev: # Name of the environment (must match one of the above application.environment)
name_or_id: ACFDemo - AppLz2
virtual_networks:
dev: # Name of the environment (must match one of the above application.environment)
- vnet: default
ipam_network_mask: [24]
ipam_supernet_name: mg-corp-ne-2
subnets:
- subnet: default
ipam_subnet_mask: 24
435/454
application
Name Description Type Default Required
name name string app3 (must be accordingly adjusted) yes
environment environment list [dev] (must be accordingly adjusted) yes
location location string northeurope (must be accordingly adjusted) yes
location_short locationShort string ne (must be accordingly adjusted) yes
advisory_alerts advisory_alerts map(object) { } no
resource_group resource_group map(object) { } no
subscription subscription map(object) { } yes
aad_spn aad_spn list(object) [{}] no
aad_group aad_group list(object) [{}] no
virtual_networks virtual_networks map(object) { } no
advisory_alerts
application.advisory_alerts.$env
Name Description Type Default Required
enabled enabled bool true no
resource_group_name resource_group_name string rg-advisor-alerts no
resource_group
application.resource_group.$env[0]
Name Description Type Default Required
name name string ’’ yes
location location string ’’ no
iam iam list(object) [{}] no
tags tags map { } no
resource_group_iam
application.resource_group.$env[0].iam[0]
Name Description Type Default Required
Owner Owner list(string) [] yes
subscription
application.subscription.$env
436/454
Name Description Type Default Required
name_or_id name_or_id string ACFDemo - AppLz2 (must be accordingly adjusted) yes
create_new create_new bool false no*
enrollment_account enrollment_account string ’’ no***
billing_account billing_account string ’’ no*
billing_profile billing_profile string ’’ no**
invoice_section invoice_section string ’’ no**
purchasing_model purchasing_model string ’’ no
workload_type workload_type string ’’ no
iam iam list(object) [{}] no
management_group_id management_group_id string ’’ no*
resource_providers resource_providers list(string)
[Microsoft.PolicyInsights, microsoft.insights, Microsoft.OperationalInsights, Microsoft.ManagedServices] no
tags tags map { } no
* Required if subscription.create_new is true
** Required if subscription.create_new is true and subscription.purchasing_model is MCA
*** Required if subscription.create_new is true and subscription.purchasing_model is EA
subscription_iam
application.subscription.$env.iam[0]
Name Description Type Default Required
Owner Owner list(string) [] no
aad_spn
application.aad_spn[0]
Name Description Type Default Required
name name string ’’ yes
owner owner list(string) [] no
aad_group
application.aad_group[0]
Name Description Type Default Required
name name string ’’ yes
description description string ’’ no
owner owner list(string) [] no
virtual_networks
application.virtual_networks.$env[0]
437/454
Name Description Type Default Required
vnet vnet string default yes
custom_vnet_name custom_vnet_name string ’’ no
resource_group_name resource_group_name string ’’ no
resource_group_lock resource_group_lock bool false no
environment environment string ’’ no
location location string ’’ no
location_short location_short string ’’ no
ipam_network_mask ipam_network_mask list(number) [] yes*
ipam_supernet_name ipam_supernet_name string ’’ yes*
network_prefixes network_prefixes list [] yes**
dns_servers dns_servers list [] no
private_dns_name private_dns_name list [] no
private_dns_custom_resource_group private_dns_custom_resource_group string ’’ no
peering peering map { } no
auto_register_in_primary_private_dns auto_register_in_primary_private_dns bool false no
azure_bastion azure_bastion map { } no
subnets subnets list(object) [{}] no
* If IPAM is enabled
** If IPAM is not enabled
peering
application.virtual_networks.$env[0].peering
Name Description Type Default Required
enabled enabled bool true no
peering_name_overwrite peering_name_overwrite string ’’ no
peering_use_remote_gateways peering_use_remote_gateways bool dynamic - see description for more no
azure_bastion
application.virtual_networks.$env[0].azure_bastion
Name Description Type Default Required
enabled enabled bool false no
sku sku string Standard no
scale_units scale_units number 2 no
copy_paste_enabled copy_paste_enabled bool true no
file_copy_enabled file_copy_enabled bool false no
ip_connect_enabled ip_connect_enabled bool false no
tunneling_enabled tunneling_enabled bool false no
subnets
438/454
application.virtual_networks.$env[0].subnets[0]
Name Description Type Default Required
subnet subnet string default yes
custom_subnet_name custom_subnet_name string ’’ no
ipam_subnet_mask ipam_subnet_mask number yes*
subnet_prefix subnet_prefix string ’’ yes**
deploy_route_table deploy_route_table bool true no
deploy_service_endpoints deploy_service_endpoints bool true no
deploy_network_security_group deploy_network_security_group bool true no
service_endpoints service_endpoints list
[Microsoft.AzureActiveDirectory, Microsoft.AzureCosmosDB, Microsoft.ContainerRegistry, Microsoft.EventHub, Microsoft.KeyVault, Microsoft.ServiceBus, Microsoft.Sql, Microsoft.Storage, Microsoft.Web]
no
network_security_group network_security_group map { } no
route_table route_table map { } no
* If IPAM is enabled
** If IPAM is not enabled
network_security_group
application.virtual_networks.$env[0].subnets[0].network_security_group
Name Description Type Default Required
custom_nsg_name custom_nsg_name string ’’ no
security_rules security_rules list(object) [{}] no
security_rules
application.virtual_networks.$env[0].subnets[0].network_security_group.security_rules[0]
Name Description Type Default Required
name name string ’’ yes
protocol protocol string ’’ yes
sourcePortRange sourcePortRange string ’’ yes
destinationPortRanges destinationPortRanges list [] yes
sourceAddressPrefixes sourceAddressPrefixes list [] yes
destinationAddressPrefixes destinationAddressPrefixes list [] yes
access access string ’’ yes
priority priority number yes
direction direction string ’’ yes
description description string ’’ yes
route_table
application.virtual_networks.$env[0].subnets[0].route_table
439/454
Name Description Type Default Required
custom_route_table_name custom_route_table_name string ’’ no
disable_bgp_route_propagation disable_bgp_route_propagation bool true no
routes routes list(object) [{}] no
routes
application.virtual_networks.$env[0].subnets[0].route_table.routes[0]
Name Description Type Default Required
name name string ’’ yes
address_prefix address_prefix string ’’ yes
next_hop_type next_hop_type string ’’ yes
next_hop_in_ip_address next_hop_in_ip_address string ’’ yes
group_vars
Definition for common parameters across all Application Landing Zones in terragrunt/prod/APPLZ/group_vars.yaml
input descriptions
name
The name of the application being deployed within given Application Landing Zone. The application name will be
included in the name of other resources (i.e. rg-application.name − network−application.environment-
$application.location_short-001).
environment
Environments of the application. Given environment name will be included in the name of other resources
(i.e. rg-application.name − network−application.environment-$application.location_short-001).
## Copyright 2024 Nordcloud Oy or its affiliates. All Rights Reserved.
applz_defaults:
private_resolver_link_enabled: false # By default false, change to true to perform a linkage
between VNET and Private DNS Resolver being deployed in the Shared Services Blueprint
ipam_automation_enabled: true # By defaul true, change to false to disable IPAM automation
ipam_automation_enabled_for_disconnected_network: false # By default false, change to true to
enable IPAM automation for disconnected network (not peered).
# service_endpoints: #OPTIONAL, uncomment to modify the default service endpoints liste below
(being enabled for subnet)
# - Microsoft.AzureActiveDirectory
# - Microsoft.AzureCosmosDB
# - Microsoft.ContainerRegistry
# - Microsoft.EventHub
# - Microsoft.KeyVault
# - Microsoft.ServiceBus
# - Microsoft.Sql
# - Microsoft.Storage
# - Microsoft.Web
# resource_providers: #OPTIONAL, uncomment to modify the default resource providers listed below
(being registered for subscription)
# - Microsoft.PolicyInsights
# - microsoft.insights
# - Microsoft.OperationalInsights
# - Microsoft.ManagedServices
440/454
location
The location of the resources.
locationshort
Shortname of the location. The shortname of the location will be included in the name of other resources
(i.e. rg-application.name − network−application.environment-$application.location_short-001).
advisoryalertsenabled
The advisory alerts enabled flag. Enable or Disable advisory alerts. Default is true.
advisoryalertsresourcegroupname
The advisory alerts resource group name. Name of the resource group where advisory alerts will be created. Default is rgadvisor-alerts.
resourcegroupname
The name of the resource group for creation, by default in the location specified in application.location. For
virtual_networks the resource group is created automatically, even if resource group name is not provided here. If
resource group for network (matching by name) is pvoided, it will possible to change location, specify iam or tags.
resourcegroupiamowner
Owner is just an example of the Entra ID role which will granted on the subscription level. Any pre-created role can be
specified here as a key with value being set to the list of object ids or/and newly created SPNs or Entra ID groups created
in aad_spn or aad_group sections.
resourcegrouptags
Tags for the resource group. Tags are used to categorize resources. Each tag consists of a key and a value. Not defined tag
in code will be removed from the resource group.
subscriptionnameorid
The name or id of the subscription where the resources will be created.
subscriptioncreatenew
The create new subscription flag. True or False to define based on condition if new subscription need to be created.
subscriptionenrollmentaccount
The enrollment account on the EA agreement where subscription should be created. Note! Only applicable in EA
agreement.
subscriptionbillingaccount
The billing account on the EA or MCA agreement where subscription should be created. Note! Only applicable in EA or MCA agreement.
subscriptionbillingprofile
441/454
The billing profile name. Billing Profile on the MCA agreement where subscription should be created. Note! Only
applicable in MCA agreement.
subscriptioninvoicesection
The invoice section name. Invoice Section on the MCA agreement where subscription should be created. Note! Only
applicable in MCA agreement.
subscriptionpurchasingmodel
The purchasing model. Purchasing model used for the new subscription. It can be either EA or MCA.
subscriptionworkloadtype
The workload type of the subscription. It can be either Production or DevTest.
subscriptionmanagementgroupid
Management group id where the subscription will be put after creation, so it’s mandatory for new subscription only.
subscriptionresourceproviders
List of resource providers that will be registered for the subscription.
subscriptiontags
Tags for the subscription. Tags are used to categorize resources. Each tag consists of a key and a value. Not defined tag in
code will be removed from the subscription.
subscriptioniamowner
Owner is just an example of the Entra ID role which will granted on the subscription level. Any pre-created role can be
specified here as a key with value being set to the list of object ids or/and newly created SPNs or Entra ID groups created
in aad_spn or aad_group sections.
aadspnname
The name of the Entra ID service principal which will be created and to whom privileges are granted on resource group
level or subscription level.
aadspnowner
The object id of the owner of the Entra ID service principal.
aadgroupname
The name of the Entra ID group which will be created and to whom privileges are granted on resource group level or
subscription level.
aadgroupdescription
The description of the Entra ID group.
aadgroupowner
442/454
The object id of the owner of the Entra ID.
virtualnetworksvnet
The short name of the virtual network, must be unique within config.
virtualnetworkscustomvnetname
The custom name of the virtual network. By default is empty and vnet name is generated automatically:
vnet-application.name−application.environment-$application.location_short-001 (where 001 is a sequence number of
subnet in the subnets list).
virtualnetworksresourcegroupname
The name of the resource group where the virtual network will be created. By default is empty and vnet will be created in
the resource group named: rg-application.name − network−application.environment-$application.location_short-001
virtualnetworksresourcegrouplock
The resource group lock flag. True or False to define based on condition if resource group should be locked.
virtualnetworksenvironment
To overwrite the default $application.environment being used for the vnet, subnet, nsg, route table and resource group
names.
virtualnetworkslocation
To overwrite the default $application.location being used for the vnet, subnet, nsg, route table (without resource group
names - for resource group location change use resource_group.location).
virtualnetworkslocationshort
To overwrite the default $application.location_short being used for the vnet, subnet, nsg, route table (without resource
group names - for resource group location change use resource_group.location_short).
virtualnetworksipamnetworkmask
The masks of the virtual network (with IPAM). Mandatory if IPAM is in use.
virtualnetworksipamsupernetname
The supernet name of the virtual network (with IPAM) - must be the same like already existing supernet within IPAM
module (part of the Management Blueprint). Mandatory if IPAM is in use.
virtualnetworksnetworkprefixes
The network prefixes list. Mandatory if IPAM is not in use. With IPAM, if not provided, the network_prefixes will be
calculated based on the ipam_network_mask. If provided IPAM will try to satisfy the the provided network_prefixes wihin
given supernet.
virtualnetworksdnsservers
443/454
To overwrite the DNS server for the VNET. If not defined, then DNS servers is automatically set based on the outputs
from the Network Blueprint.
virtualnetworksprivatednsname
Name for new DNS private zone. New DNS zone will only be created if this field has value. Creating will be skipped if
empty.
virtualnetworksprivatednscustomresourcegroup
The custom resource group name for the private DNS. By default is empty and private DNS will be created in the resource
group named: rg-application.name − network−application.environment-$application.location_short-001 (same as vnet).
peeringenabled
The peering enabled flag. Enable or Disable peering. Default is true (if VNET is created).
peeringnameoverwrite
The peering name overwrite. Can be used to overwrite peering name. By default is empty and peering name is generated
automatically (name of the vnet with “to-hub-vnet-peering” suffix or “hub-to-” prefix followed by the name of the vnet and
ending with “-vnet-peering” name).
peeringuseremotegateways
Enable or Disable use remote gateways. Default is dynamic, which means if Hub network contains a gateway, the spoke
network will use it. By uncommenting this line, you can steer it to use the remote gateway or not.
auto_register_in_primary_private_dns
Enable or Disable auto register in primary private DNS. Default is false. Preqrequisite is to have primary private DNS zone
created (part of the SharedServices blueprint).
azurebastionenabled
The bastion enabled flag. True or False to define based on condition if bastion need to deployed. Default is false. If
enabled it’s required to create a subnet called bastion with custom_subnet_name AzureBastionSubnet in the the same
virtual network as enabled Azure Bastion.
azurebastionsku
The SKU for the bastion. Basic or Standard is supported, SKU limitations
azurebastionscaleunits
The scale units for the bastion. Number of scale units supported, only Supported in Standard Sku.
azurebastioncopypasteenabled
The copy paste enabled flag for the bastion. Disables copy/paste when using the portal.
azurebastionfilecopyenabled
The file copy enabled flag for the bastion. Enables file copy/paste when using the portal.
444/454
azurebastionipconnectenabled
The IP connect enabled flag for the bastion. Enables the connect blade under Azure Bastion where the VM can be
connected to by IP, only supported in Standard SKU
azurebastiontunnelingenabled
The tunneling enabled flag for the bastion. Enables Native Client Support, only supported with Standard SKU
documentation
subnetsubnet
The short name of the subnet, must be unique within config in scope of given vnet.
subnetscustomsubnetname
The custom name of the subnet. By default is empty and subnet name is generated automatically:
snet-application.name−application.environment-$application.location_short-001 (where 001 is a sequence number of
subnet in the subnets list).
subnetsipamsubnetmask
The mask of the subnet (with IPAM). Mandatory if IPAM is in use.
subnetsubnetprefix
The prefix of the subnet (without IPAM). Mandatory if IPAM is not in use. With IPAM, if not provided, the
subnet_prefixe will be calculated based on the ipam_subnet_mask. If provided IPAM will try to satisfy the the provided
subnet_prefix wihin given vnet address space.
subnetsdeployroutetable
The deploy route table flag for the subnet. Default value is set dynamically depends on the topology - is true for HubSpoke
and false for the vWAN. For Azure Bastion deploy_route_table must be manualy set to false.
deploy_service_endpoints
The deploy service endpoints flag for the subnet. Default is true.
deploy_network_security_group
The deploy network security group flag for the subnet. Default is true.
service_endpoints
Allows to overwrite default list of service endpoints for the subnet. Default list is [Microsoft.AzureActiveDirectory, Microsoft.AzureCosmosDB, Microsoft.ContainerRegistry, Microsoft.EventHub, Microsoft.KeyVault, Microsoft.ServiceBus, Microsoft.Sql, Microsoft.Storage, Microsoft.Web].
networksecuritygroupcustomnsgname
The custom name of the network security group. By default is empty and nsg name is generated automatically: nsg-name
of the subnet.
securityrulesname
445/454
The name of the security rule. Restricted to 80 chars.
securityrulesprotocol
The protocol for the security rule. The protocol of the rule. The protocol can be one of Tcp, Udp, Icmp, or ’*’.
securityrulessourceportrange
The source port range for the security rule. The source port or range. Integer or range between 0 and 65535.
securityrulesdestinationportranges
The destination port ranges for the security rule. The destination port or range. Integer or range between 0 and 65535.
securityrulessourceaddressprefixes
The source address prefixes for the security rule. The source address prefixes. CIDR or source IP ranges.
securityrulesdestinationaddressprefixes
The destination address prefixes for the security rule. The destination address prefixes. CIDR or destination IP ranges.
securityrulesaccess
The access for the security rule. Whether network traffic is allowed or denied.
securityrulespriority
The priority for the security rule. The priority of the rule. The value can be between 100 and 4096. The priority number must be unique for each rule in the collection. The lower the priority number, the higher the priority of the rule.
securityrulesdirection
The direction for the security rule. The direction of the rule. The direction specifies if rule will be evaluated on incoming or
outgoing traffic.
securityrulesdescription
The description for the security rule. Restricted to 140 chars.
routetablecustomroutetablename
The custom name of the route table. By default is empty and route table name is generated automatically: rt-name of the
subnet.
routetabledisablebgproutepropagation
The disable BGP route propagation flag. Whether to disable the routes learned by BGP on that route table. True means
disable, which is default.
routesname
The route name. The default route for the HubSpoke topology is created automatically and is named default-route-internet.
routesaddressprefix
446/454
The address prefix for the route. The destination CIDR to which the route applies. The default route for the HubSpoke
topology is created automatically and is having address prefix set to 0.0.0.0/0.
routesnexthopipaddress
The next hop IP address for the route. The type of Azure hop the packet should be sent to. The default route for the
HubSpoke topology is created automatically and is having next hop IP address set to Azure Firewall IP address being
pulled automatically from the Network Blueprint.
routesnexthoptype
The next hop type for the route. The IP address packets should be forwarded to. Next hop values are only allowed in routes
where the next hop type is VirtualAppliance. The default route for the HubSpoke topology is created automatically and is
having next hop type set to VirtualAppliance.
dependency
T h e APPLZ module is dependent on the following modules: - /CORE - /PROVISIONER/CICD -
/CORE/MANAGEMENT - /CORE/NETWORK - /CORE/SHAREDSERVICES — id: security-analysis title: Security
analysis —
Security and linting analysis solution for Terraform
Azure Cloud Foundation (ACF) follows best security practices and ensures the quality of the code by implementing a
security and linting analysis solution for Terraform. This solution is based on the following tools: - Terraform_fmt -
Terraform_lint - Checkov
The security and linting analysis solution is integrated into the CI/CD pipeline to automatically check the Terraform code
for security vulnerabilities, compliance issues, and best practices. By using these tools, ACF ensures that the Terraform
code adheres to industry standards, security requirements, and organizational policies, reducing the risk of misconfigurations and security breaches. The validate_pr.yml contains the configuration for the security and linting
analysis solution, which is executed when a pull request is created or updated.
terraform_fmt
Terraform fmt is a built-in Terraform command that formats your Terraform configuration files to a canonical format and
style. It helps maintain consistency across the codebase by automatically adjusting indentation and alignment of Terraform
code, which makes it easier to read and review.
terraform_lint
TFLint is a Terraform linter that checks your Terraform code for best practices, possible errors, and stylistic issues. It
supports custom rules and plugins to extend its capabilities, ensuring your code adheres to your organization’s standards
and guidelines. The configuration file for TFLint is stored in the ./hooks/.tflint.hcl file in the root directory of your
Terraform project.
checkov
Checkov is an open-source tool that scans your Terraform code for security and compliance misconfigurations. It uses a
comprehensive set of policies to identify potential issues in your infrastructure as code, helping to ensure that your
deployments are secure and compliant with industry standards. The configuration file for checkov is stored in the
./hooks/.checkov.yaml file in the root directory of your Terraform project.
447/454
Exclusion list
While these tools provide a robust set of security checks, not all of them are relevant to every environment or use case.
Therefore, some of rules were excluded certain checks from our analysis. This decision is based on specific architectural
choices, existing security measures, and compliance requirements. Here are some of the exclusions and the rationale
behind them:
checkov:
CKV_AZURE_120: "Ensure that Application Gateway enables WAF". The setting is parameterized and can
be enabled or configured within the module. The module provides flexibility for different
environments and use cases, ensuring that WAF can be enabled as needed.
CKV_AZURE_217: "Ensure Azure Application gateways listener that allow connection requests over
HTTP" The configuration uses HTTPS protocol, ensuring secure communication but allow HTTP protocol
as well for flexibility and compatibility with different environments.
CKV_AZURE_218: "Ensure Application Gateway defines secure protocols for in transit communication".
The secure protocols are defined in the configuration by default but can not cannot be set when
policy_name or policy_type are set.
CKV_AZURE_233: "Ensure Azure Container Registry (ACR) is zone redundant" The zone redundant is
only applicable for the Premium SKU. As the current configuration does not use the Premium SKU,
this check is not applicable.
CKV_AZURE_165: "Ensure geo-replicated container registries to match multi-region container
deployments." The multi-region is only applicable for the Premium SKU. As the current
configuration does not use the Premium SKU, this check is not applicable.
CKV_AZURE_237: "Ensure dedicated data endpoints are enabled" ACF is using network ACLs (Access
Control Lists) and NSG (Network Security Group) to secure data traffic, providing the necessary
security without dedicated data endpoints.
CKV_AZURE_163: "Enable vulnerability scanning for container images." This requirement is only
applicable for the Standard SKU and higher. The current configuration does not use a qualifying
SKU, making this check not applicable.
CKV_AZURE_164: "Ensures that ACR uses signed/trusted images." This specific configuration does not
enforce the use of signed/trusted images, making this check not applicable. ACR trust policy can
only be applied when using the Premium Sku. The requirement to ensure that Azure Container
Registry (ACR) uses signed or trusted images is acknowledged
CKV_AZURE_166: "Ensure container image quarantine, scan, and mark images verified" This
requirement is only applicable for the Premium SKU of Azure Container Registry (ACR). Since the
current configuration does not use the Premium SKU, this check is not applicable.
CKV_AZURE_167: "Ensure a retention policy is set to cleanup untagged manifests." This requirement
applies exclusively to the Premium SKU of Azure Container Registry (ACR). As the current
configuration does not utilize the Premium SKU, this check is not applicable.
CKV_AZURE_139: "Ensure ACR set to disable public networking" The public networking is effectively
disabled at the network level. The restriction is can not be enforced at the ACR level as the
access is needed for the CI/CD process.
CKV_AZURE_216: "Ensure DenyIntelMode is set to Deny for Azure Firewalls" The setting is
parameterized and can be enabled or configured within the module. The module provides flexibility
for different environments and use cases.
CKV_AZURE_220: "Ensure Firewall policy has IDPS mode as deny" The setting is parameterized and can
be configured within the module. The module provides flexibility for different environments and
use cases.
CKV2_AZURE_32: "Ensure private endpoint is configured to key vault" ACF is currently secured using
network ACLs (Access Control Lists) and Network Firewall rules to manage data traffic security
effectively. As such, the use of dedicated private endpoints for Key Vault is not required in our
current configuration.
CKV_AZURE_110: "Ensure that key vault enables purge protection" The setting is parameterized and
can be enabled (default) or disabled within the module.
CKV_AZURE_109: "Ensure that key vault allows firewall rules settings" The current configuration
mandates enforcing firewall rules for Key Vault to meet specific security requirements.
CKV_AZURE_189: "Ensure that Azure Key Vault disables public network access" The public network
access is effectively disabled at the network level. The restriction cannot be enforced at the Key
Vault level as the access is needed for the CI/CD process.
CKV_AZURE_112: "Ensure that key vault key is backed by HSM" This requirement is only applicable
when using the Premium SKU of Azure Key Vault, which supports keys backed by HSMs for enhanced
security. As the current configuration does not utilize the Premium SKU, this check is not
applicable.
CKV2_AZURE_39: "Ensure Azure VM is not configured with public IP and serial console access" The
public IP addresses by default is effectively disabled at the network level and by Azure policy.
The serial console access is disabled by default.
CKV_AZURE_199: "Ensure that Azure Service Bus uses double encryption" This check is not applicable
because the current configuration does not require double encryption for Azure Service Bus and not
using customer-managed key. The security measures in place are deemed sufficient to meet the
project's security requirements.
CKV_AZURE_201: "Ensure that Azure Service Bus uses a customer-managed key to encrypt data" This
check is not applicable because the current configuration relies on Azure-managed keys for
448/454
encryption. The use of Azure-managed keys is sufficient for our security and compliance
requirements.
CKV_AZURE_212: "Ensure App Service has a minimum number of instances for failover" This check is
not applicable because the requirement for a minimum number of instances for failover only applies
to the Elastic SKU. The current configuration does not use the Elastic SKU, so this requirement is
not relevant.
CKV_AZURE_225: "Ensure the App Service Plan is zone redundant" Not applicable because the current
SKU does not support zone redundancy. The chosen SKU meets our application's performance and cost
requirements without the need for zone redundancy.
CKV2_AZURE_1: "Ensure storage for critical data are encrypted with Customer Managed Key" This
check is not applicable because the current configuration relies on Azure-managed keys for
encryption. The use of Azure-managed keys is sufficient for our security and compliance
requirements.
CKV2_AZURE_33 "Ensure storage account is configured with private endpoint" This check is not
required because the current network security configuration, which includes network ACLs (Access
Control Lists) and NSGs (Network Security Groups), Storage Firewall, adequately secures access to
the storage account. Therefore, a private endpoint is not necessary.
CKV2_AZURE_40: "Ensure storage account is not configured with Shared Key authorization" This check
is needed for the current configuration. Disabling this check genereates a errors in some cases
related to storage access
CKV_AZURE_59: "Ensure that Storage accounts disallow public access" This check is needed for the
current configuration and CICD process.
CKV2_AZURE_41: "Ensure storage account is configured with SAS expiration policy" Already
implemented in the current configuration. No further action is required.
CKV_AZURE_36: "Ensure 'Trusted Microsoft Services' is enabled for Storage Account access." This
check is skipped because 'Trusted Microsoft Services' is already enabled for access to the storage
account in the current configuration (AzureServices). This setting allows Azure services to
securely access the storage account without requiring additional authorization steps.
CKV_AZURE_35: "Ensure default network access rule for Storage Accounts is set to deny" This check
is skipped because the default network access rule for the storage account is already set to deny
by default in the current configuration. This ensures that network access to the storage account
is restricted unless explicitly allowed, thereby meeting the security recommendation.
CKV2_AZURE_21: "Ensure Storage logging is enabled for Blob service for read requests" This check
is skipped because storage logging for Blob service read requests is enabled by default in the
current configuration. Therefore, no further action is needed to comply with this security
recommendation.
CKV2_AZURE_31 "Ensure VNET subnet is configured with a Network Security Group (NSG)" This check is
skipped because Network Security Groups (NSGs) are enabled by default for all subnets within the
Virtual Network (VNET) in the current configuration. Therefore, every subnet automatically
inherits network security controls from its associated NSG, ensuring network traffic is properly
filtered and secured.
CKV2_AZURE_9: "Ensure Virtual Machines are utilizing Managed Disks" This check is skipped because
Managed Disks are indeed enabled and encrypted for Virtual Machines in the current configuration.
The alert is considered a false positive as Managed Disks meet the storage requirements and
security standards without further action needed.
CKV2_AZURE_12 "Ensure that virtual machines are backed up using Azure Backup" This check is
skipped because Azure Backup is not required for the virtual machines in the default setup.
Alternative backup solutions are in place and deemed sufficient to meet our backup and recovery
requirements.
CKV2_AZURE_10: "Ensure that Microsoft Antimalware is configured to automatically updates for
Virtual Machines" Microsoft Antimalware extension is enabled for Virtual Machines in the current
setup. Alternative MS Defender and Azure security policies are implemented and considered
sufficient to meet our security requirements.
CKV_AZURE_135: "Ensure Application Gateway WAF prevents message lookup in Log4j2. See CVE-2021-
44228 aka log4jshell" This version is not vulnerable to CVE-2021-44228 (Log4j2) exploits.
Alternative mitigations or protections are in place to address this vulnerability, making this
specific check not applicable.
tflint:
rule "terraform_required_version"
rule "terraform_required_providers"
rule "terraform_standard_module_structure"
rule "terraform_deprecated_interpolation"
rule "terraform_unused_declarations"
rule "terraform_naming_convention"
rule "terraform_deprecated_index"
rule "terraform_deprecated_lookup"
rule "terraform_empty_list_equality"
Exclusion of rules
Checkov rules can be done by adding the rule id in the ./hooks/.checkov.yaml file, section skip_checks or per
resource by adding the checkov_skip attribute.
449/454
Example of exclusion for checkov
Example of exclusion for tflint in the ./hooks/.tflint.hcl file
rule "terraform_required_version" {
enabled = false
}
rule "terraform_required_providers" {
enabled = false
}
rule "terraform_standard_module_structure" {
enabled = false
}
rule "terraform_deprecated_interpolation" {
enabled = false
}
rule "terraform_unused_declarations" {
enabled = false
}
rule "terraform_naming_convention" {
enabled = false
}
rule "terraform_deprecated_index" {
enabled = false
}
rule "terraform_deprecated_lookup" {
enabled = false
}
rule "terraform_empty_list_equality" {
enabled = false
}
Extensibility
The security and linting analysis solution for Terraform is designed to be highly extensible, allowing you to tailor it to your
specific needs by adding custom rules, integrate additional tools, and adjust configurations as security requirements evolve.
resource "azurerm_firewall" "firewall" {
#checkov:skip=CKV_AZURE_216: "Ensure DenyIntelMode is set to Deny for Azure Firewalls" The
setting is parameterized and can be enabled or configured within the module. The module
provides flexibility for different environments and use cases.
provider = azurerm
name = var.name
resource_group_name = var.resource_group_name
location = var.location
sku_name = var.firewall_sku_name
sku_tier = var.firewall_sku_tier
firewall_policy_id = var.firewall_policy_id
zones = var.firewall_zones
tags = var.tags
}
450/454
Release notes
Version: ACF TF 1.1.0 (2024.08)
New features
Routing intent support for Azure Firewall vWAN Hub.
Bastion Host support for Azure Firewall vWAN Hub.
Enhancements / Updates
Application Landing Zone refactored to work TF nateively with multiple environments and stateful subnet.
IPAM functionction updated to support subnet reservation.
The *.yaml config file rename in accordance to the unified design.
Ability to defined custom name for the Audit and Operational Log Analytic Workspace.
Option to specify custom name for the Azure Function App of the Blob Backup module.
Updated exemptions for regulatory compliance to align with updated initiatives
Bugfixes
Vulnerability fix for python modules.
Deprecated and removed features
PSP API has been removed from ACF TF
Version: ACF TF 1.0.4 (2024.08)
New features
None
Enhancements / Updates
None
Bugfixes
Added missing output for the resource group name in the linux function app.
Added dependency for the data “azurerm_function_app_host_keys” provider.
Deprecated and removed features
None
Version: ACF TF 1.0.3 (2024.08)
New features
None
Enhancements / Updates
None
451/454
Bugfixes
Condition issue in Azure Policy when running deployment without Private DNS Resolver.
Deprecated and removed features
Version: ACF TF 1.0.2 (2024.07)
New features
None
Enhancements / Updates
None
Bugfixes
Updated logic for Management blueprint to ignore modules unselected for deployment.
Deprecated and removed features
None
Version: ACF TF 1.0.1 (2024.07)
New features
None
Enhancements / Updates
None
Bugfixes
Terraform azurerm provider upgrade from 3.60.0 to 3.111.0 due to issue with Microsoft.TimeSeriesInsights provider
registration (deprecated by MS and needed by old azurerm provider)
Deprecated and removed features
None
Version: ACF TF 1.0 (2024.04)
ACF TF 1.0 is the first release of the ACF-TF (Terraform based version of the ACF) and is based on the ARM version
of ACF 4.0.2 (2024.04.08) release.
New features
None
Enhancements / Updates
None
452/454
Bugfixes
None
Deprecated and removed features
None
453/454
Download documentation in PDF (always contains the
latest version)
<a target=“_blank” href={ require(“/documentation.pdf”).default } download>Dwonload documentation in PDF
454/454
